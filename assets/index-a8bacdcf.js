(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))g(x);new MutationObserver(x=>{for(const E of x)if(E.type==="childList")for(const I of E.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&g(I)}).observe(document,{childList:!0,subtree:!0});function d(x){const E={};return x.integrity&&(E.integrity=x.integrity),x.referrerpolicy&&(E.referrerPolicy=x.referrerpolicy),x.crossorigin==="use-credentials"?E.credentials="include":x.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function g(x){if(x.ep)return;x.ep=!0;const E=d(x);fetch(x.href,E)}})();function Eg(s,a){const d=Object.create(null),g=s.split(",");for(let x=0;x<g.length;x++)d[g[x]]=!0;return a?x=>!!d[x.toLowerCase()]:x=>!!d[x]}function Tg(s){if(ii(s)){const a={};for(let d=0;d<s.length;d++){const g=s[d],x=Cn(g)?hA(g):Tg(g);if(x)for(const E in x)a[E]=x[E]}return a}else{if(Cn(s))return s;if(sn(s))return s}}const lA=/;(?![^(]*\))/g,cA=/:([^]+)/,uA=/\/\*.*?\*\//gs;function hA(s){const a={};return s.replace(uA,"").split(lA).forEach(d=>{if(d){const g=d.split(cA);g.length>1&&(a[g[0].trim()]=g[1].trim())}}),a}function Dc(s){let a="";if(Cn(s))a=s;else if(ii(s))for(let d=0;d<s.length;d++){const g=Dc(s[d]);g&&(a+=g+" ")}else if(sn(s))for(const d in s)s[d]&&(a+=d+" ");return a.trim()}const dA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",pA=Eg(dA);function zb(s){return!!s||s===""}const $p=s=>Cn(s)?s:s==null?"":ii(s)||sn(s)&&(s.toString===Bb||!ci(s.toString))?JSON.stringify(s,kb,2):String(s),kb=(s,a)=>a&&a.__v_isRef?kb(s,a.value):zc(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((d,[g,x])=>(d[`${g} =>`]=x,d),{})}:Ob(a)?{[`Set(${a.size})`]:[...a.values()]}:sn(a)&&!ii(a)&&!Fb(a)?String(a):a,en={},Lc=[],go=()=>{},fA=()=>!1,mA=/^on[^a-z]/,Lf=s=>mA.test(s),Ag=s=>s.startsWith("onUpdate:"),er=Object.assign,Sg=(s,a)=>{const d=s.indexOf(a);d>-1&&s.splice(d,1)},_A=Object.prototype.hasOwnProperty,Ii=(s,a)=>_A.call(s,a),ii=Array.isArray,zc=s=>zf(s)==="[object Map]",Ob=s=>zf(s)==="[object Set]",ci=s=>typeof s=="function",Cn=s=>typeof s=="string",Cg=s=>typeof s=="symbol",sn=s=>s!==null&&typeof s=="object",Rb=s=>sn(s)&&ci(s.then)&&ci(s.catch),Bb=Object.prototype.toString,zf=s=>Bb.call(s),gA=s=>zf(s).slice(8,-1),Fb=s=>zf(s)==="[object Object]",Ig=s=>Cn(s)&&s!=="NaN"&&s[0]!=="-"&&""+parseInt(s,10)===s,af=Eg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),kf=s=>{const a=Object.create(null);return d=>a[d]||(a[d]=s(d))},yA=/-(\w)/g,Fc=kf(s=>s.replace(yA,(a,d)=>d?d.toUpperCase():"")),vA=/\B([A-Z])/g,Kc=kf(s=>s.replace(vA,"-$1").toLowerCase()),Nb=kf(s=>s.charAt(0).toUpperCase()+s.slice(1)),v_=kf(s=>s?`on${Nb(s)}`:""),Gh=(s,a)=>!Object.is(s,a),x_=(s,a)=>{for(let d=0;d<s.length;d++)s[d](a)},vf=(s,a,d)=>{Object.defineProperty(s,a,{configurable:!0,enumerable:!1,value:d})},Ub=s=>{const a=parseFloat(s);return isNaN(a)?s:a};let i0;const xA=()=>i0||(i0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Uo;class bA{constructor(a=!1){this.detached=a,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Uo,!a&&Uo&&(this.index=(Uo.scopes||(Uo.scopes=[])).push(this)-1)}run(a){if(this.active){const d=Uo;try{return Uo=this,a()}finally{Uo=d}}}on(){Uo=this}off(){Uo=this.parent}stop(a){if(this.active){let d,g;for(d=0,g=this.effects.length;d<g;d++)this.effects[d].stop();for(d=0,g=this.cleanups.length;d<g;d++)this.cleanups[d]();if(this.scopes)for(d=0,g=this.scopes.length;d<g;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!a){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this.active=!1}}}function wA(s,a=Uo){a&&a.active&&a.effects.push(s)}const Mg=s=>{const a=new Set(s);return a.w=0,a.n=0,a},jb=s=>(s.w&aa)>0,Vb=s=>(s.n&aa)>0,EA=({deps:s})=>{if(s.length)for(let a=0;a<s.length;a++)s[a].w|=aa},TA=s=>{const{deps:a}=s;if(a.length){let d=0;for(let g=0;g<a.length;g++){const x=a[g];jb(x)&&!Vb(x)?x.delete(s):a[d++]=x,x.w&=~aa,x.n&=~aa}a.length=d}},X_=new WeakMap;let Bh=0,aa=1;const K_=30;let fo;const al=Symbol(""),Y_=Symbol("");class Pg{constructor(a,d=null,g){this.fn=a,this.scheduler=d,this.active=!0,this.deps=[],this.parent=void 0,wA(this,g)}run(){if(!this.active)return this.fn();let a=fo,d=ra;for(;a;){if(a===this)return;a=a.parent}try{return this.parent=fo,fo=this,ra=!0,aa=1<<++Bh,Bh<=K_?EA(this):n0(this),this.fn()}finally{Bh<=K_&&TA(this),aa=1<<--Bh,fo=this.parent,ra=d,this.parent=void 0,this.deferStop&&this.stop()}}stop(){fo===this?this.deferStop=!0:this.active&&(n0(this),this.onStop&&this.onStop(),this.active=!1)}}function n0(s){const{deps:a}=s;if(a.length){for(let d=0;d<a.length;d++)a[d].delete(s);a.length=0}}let ra=!0;const $b=[];function Yc(){$b.push(ra),ra=!1}function Jc(){const s=$b.pop();ra=s===void 0?!0:s}function Ir(s,a,d){if(ra&&fo){let g=X_.get(s);g||X_.set(s,g=new Map);let x=g.get(d);x||g.set(d,x=Mg()),Gb(x)}}function Gb(s,a){let d=!1;Bh<=K_?Vb(s)||(s.n|=aa,d=!jb(s)):d=!s.has(fo),d&&(s.add(fo),fo.deps.push(s))}function vs(s,a,d,g,x,E){const I=X_.get(s);if(!I)return;let o=[];if(a==="clear")o=[...I.values()];else if(d==="length"&&ii(s)){const L=Ub(g);I.forEach((U,G)=>{(G==="length"||G>=L)&&o.push(U)})}else switch(d!==void 0&&o.push(I.get(d)),a){case"add":ii(s)?Ig(d)&&o.push(I.get("length")):(o.push(I.get(al)),zc(s)&&o.push(I.get(Y_)));break;case"delete":ii(s)||(o.push(I.get(al)),zc(s)&&o.push(I.get(Y_)));break;case"set":zc(s)&&o.push(I.get(al));break}if(o.length===1)o[0]&&J_(o[0]);else{const L=[];for(const U of o)U&&L.push(...U);J_(Mg(L))}}function J_(s,a){const d=ii(s)?s:[...s];for(const g of d)g.computed&&r0(g);for(const g of d)g.computed||r0(g)}function r0(s,a){(s!==fo||s.allowRecurse)&&(s.scheduler?s.scheduler():s.run())}const AA=Eg("__proto__,__v_isRef,__isVue"),qb=new Set(Object.getOwnPropertyNames(Symbol).filter(s=>s!=="arguments"&&s!=="caller").map(s=>Symbol[s]).filter(Cg)),SA=Dg(),CA=Dg(!1,!0),IA=Dg(!0),o0=MA();function MA(){const s={};return["includes","indexOf","lastIndexOf"].forEach(a=>{s[a]=function(...d){const g=zi(this);for(let E=0,I=this.length;E<I;E++)Ir(g,"get",E+"");const x=g[a](...d);return x===-1||x===!1?g[a](...d.map(zi)):x}}),["push","pop","shift","unshift","splice"].forEach(a=>{s[a]=function(...d){Yc();const g=zi(this)[a].apply(this,d);return Jc(),g}}),s}function Dg(s=!1,a=!1){return function(g,x,E){if(x==="__v_isReactive")return!s;if(x==="__v_isReadonly")return s;if(x==="__v_isShallow")return a;if(x==="__v_raw"&&E===(s?a?qA:Kb:a?Xb:Hb).get(g))return g;const I=ii(g);if(!s&&I&&Ii(o0,x))return Reflect.get(o0,x,E);const o=Reflect.get(g,x,E);return(Cg(x)?qb.has(x):AA(x))||(s||Ir(g,"get",x),a)?o:Jn(o)?I&&Ig(x)?o:o.value:sn(o)?s?Yb(o):kg(o):o}}const PA=Zb(),DA=Zb(!0);function Zb(s=!1){return function(d,g,x,E){let I=d[g];if(Nc(I)&&Jn(I)&&!Jn(x))return!1;if(!s&&(!xf(x)&&!Nc(x)&&(I=zi(I),x=zi(x)),!ii(d)&&Jn(I)&&!Jn(x)))return I.value=x,!0;const o=ii(d)&&Ig(g)?Number(g)<d.length:Ii(d,g),L=Reflect.set(d,g,x,E);return d===zi(E)&&(o?Gh(x,I)&&vs(d,"set",g,x):vs(d,"add",g,x)),L}}function LA(s,a){const d=Ii(s,a);s[a];const g=Reflect.deleteProperty(s,a);return g&&d&&vs(s,"delete",a,void 0),g}function zA(s,a){const d=Reflect.has(s,a);return(!Cg(a)||!qb.has(a))&&Ir(s,"has",a),d}function kA(s){return Ir(s,"iterate",ii(s)?"length":al),Reflect.ownKeys(s)}const Wb={get:SA,set:PA,deleteProperty:LA,has:zA,ownKeys:kA},OA={get:IA,set(s,a){return!0},deleteProperty(s,a){return!0}},RA=er({},Wb,{get:CA,set:DA}),Lg=s=>s,Of=s=>Reflect.getPrototypeOf(s);function Gp(s,a,d=!1,g=!1){s=s.__v_raw;const x=zi(s),E=zi(a);d||(a!==E&&Ir(x,"get",a),Ir(x,"get",E));const{has:I}=Of(x),o=g?Lg:d?Rg:qh;if(I.call(x,a))return o(s.get(a));if(I.call(x,E))return o(s.get(E));s!==x&&s.get(a)}function qp(s,a=!1){const d=this.__v_raw,g=zi(d),x=zi(s);return a||(s!==x&&Ir(g,"has",s),Ir(g,"has",x)),s===x?d.has(s):d.has(s)||d.has(x)}function Zp(s,a=!1){return s=s.__v_raw,!a&&Ir(zi(s),"iterate",al),Reflect.get(s,"size",s)}function s0(s){s=zi(s);const a=zi(this);return Of(a).has.call(a,s)||(a.add(s),vs(a,"add",s,s)),this}function a0(s,a){a=zi(a);const d=zi(this),{has:g,get:x}=Of(d);let E=g.call(d,s);E||(s=zi(s),E=g.call(d,s));const I=x.call(d,s);return d.set(s,a),E?Gh(a,I)&&vs(d,"set",s,a):vs(d,"add",s,a),this}function l0(s){const a=zi(this),{has:d,get:g}=Of(a);let x=d.call(a,s);x||(s=zi(s),x=d.call(a,s)),g&&g.call(a,s);const E=a.delete(s);return x&&vs(a,"delete",s,void 0),E}function c0(){const s=zi(this),a=s.size!==0,d=s.clear();return a&&vs(s,"clear",void 0,void 0),d}function Wp(s,a){return function(g,x){const E=this,I=E.__v_raw,o=zi(I),L=a?Lg:s?Rg:qh;return!s&&Ir(o,"iterate",al),I.forEach((U,G)=>g.call(x,L(U),L(G),E))}}function Hp(s,a,d){return function(...g){const x=this.__v_raw,E=zi(x),I=zc(E),o=s==="entries"||s===Symbol.iterator&&I,L=s==="keys"&&I,U=x[s](...g),G=d?Lg:a?Rg:qh;return!a&&Ir(E,"iterate",L?Y_:al),{next(){const{value:J,done:de}=U.next();return de?{value:J,done:de}:{value:o?[G(J[0]),G(J[1])]:G(J),done:de}},[Symbol.iterator](){return this}}}}function Qs(s){return function(...a){return s==="delete"?!1:this}}function BA(){const s={get(E){return Gp(this,E)},get size(){return Zp(this)},has:qp,add:s0,set:a0,delete:l0,clear:c0,forEach:Wp(!1,!1)},a={get(E){return Gp(this,E,!1,!0)},get size(){return Zp(this)},has:qp,add:s0,set:a0,delete:l0,clear:c0,forEach:Wp(!1,!0)},d={get(E){return Gp(this,E,!0)},get size(){return Zp(this,!0)},has(E){return qp.call(this,E,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:Wp(!0,!1)},g={get(E){return Gp(this,E,!0,!0)},get size(){return Zp(this,!0)},has(E){return qp.call(this,E,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:Wp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(E=>{s[E]=Hp(E,!1,!1),d[E]=Hp(E,!0,!1),a[E]=Hp(E,!1,!0),g[E]=Hp(E,!0,!0)}),[s,d,a,g]}const[FA,NA,UA,jA]=BA();function zg(s,a){const d=a?s?jA:UA:s?NA:FA;return(g,x,E)=>x==="__v_isReactive"?!s:x==="__v_isReadonly"?s:x==="__v_raw"?g:Reflect.get(Ii(d,x)&&x in g?d:g,x,E)}const VA={get:zg(!1,!1)},$A={get:zg(!1,!0)},GA={get:zg(!0,!1)},Hb=new WeakMap,Xb=new WeakMap,Kb=new WeakMap,qA=new WeakMap;function ZA(s){switch(s){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function WA(s){return s.__v_skip||!Object.isExtensible(s)?0:ZA(gA(s))}function kg(s){return Nc(s)?s:Og(s,!1,Wb,VA,Hb)}function HA(s){return Og(s,!1,RA,$A,Xb)}function Yb(s){return Og(s,!0,OA,GA,Kb)}function Og(s,a,d,g,x){if(!sn(s)||s.__v_raw&&!(a&&s.__v_isReactive))return s;const E=x.get(s);if(E)return E;const I=WA(s);if(I===0)return s;const o=new Proxy(s,I===2?g:d);return x.set(s,o),o}function kc(s){return Nc(s)?kc(s.__v_raw):!!(s&&s.__v_isReactive)}function Nc(s){return!!(s&&s.__v_isReadonly)}function xf(s){return!!(s&&s.__v_isShallow)}function Jb(s){return kc(s)||Nc(s)}function zi(s){const a=s&&s.__v_raw;return a?zi(a):s}function Qb(s){return vf(s,"__v_skip",!0),s}const qh=s=>sn(s)?kg(s):s,Rg=s=>sn(s)?Yb(s):s;function e1(s){ra&&fo&&(s=zi(s),Gb(s.dep||(s.dep=Mg())))}function t1(s,a){s=zi(s),s.dep&&J_(s.dep)}function Jn(s){return!!(s&&s.__v_isRef===!0)}function lf(s){return XA(s,!1)}function XA(s,a){return Jn(s)?s:new KA(s,a)}class KA{constructor(a,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?a:zi(a),this._value=d?a:qh(a)}get value(){return e1(this),this._value}set value(a){const d=this.__v_isShallow||xf(a)||Nc(a);a=d?a:zi(a),Gh(a,this._rawValue)&&(this._rawValue=a,this._value=d?a:qh(a),t1(this))}}function ti(s){return Jn(s)?s.value:s}const YA={get:(s,a,d)=>ti(Reflect.get(s,a,d)),set:(s,a,d,g)=>{const x=s[a];return Jn(x)&&!Jn(d)?(x.value=d,!0):Reflect.set(s,a,d,g)}};function i1(s){return kc(s)?s:new Proxy(s,YA)}var n1;class JA{constructor(a,d,g,x){this._setter=d,this.dep=void 0,this.__v_isRef=!0,this[n1]=!1,this._dirty=!0,this.effect=new Pg(a,()=>{this._dirty||(this._dirty=!0,t1(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=g}get value(){const a=zi(this);return e1(a),(a._dirty||!a._cacheable)&&(a._dirty=!1,a._value=a.effect.run()),a._value}set value(a){this._setter(a)}}n1="__v_isReadonly";function QA(s,a,d=!1){let g,x;const E=ci(s);return E?(g=s,x=go):(g=s.get,x=s.set),new JA(g,x,E||!x,d)}function oa(s,a,d,g){let x;try{x=g?s(...g):s()}catch(E){Rf(E,a,d)}return x}function qr(s,a,d,g){if(ci(s)){const E=oa(s,a,d,g);return E&&Rb(E)&&E.catch(I=>{Rf(I,a,d)}),E}const x=[];for(let E=0;E<s.length;E++)x.push(qr(s[E],a,d,g));return x}function Rf(s,a,d,g=!0){const x=a?a.vnode:null;if(a){let E=a.parent;const I=a.proxy,o=d;for(;E;){const U=E.ec;if(U){for(let G=0;G<U.length;G++)if(U[G](s,I,o)===!1)return}E=E.parent}const L=a.appContext.config.errorHandler;if(L){oa(L,null,10,[s,I,o]);return}}eS(s,d,x,g)}function eS(s,a,d,g=!0){console.error(s)}let Zh=!1,Q_=!1;const Yn=[];let Vo=0;const Oc=[];let ds=null,il=0;const r1=Promise.resolve();let Bg=null;function tS(s){const a=Bg||r1;return s?a.then(this?s.bind(this):s):a}function iS(s){let a=Vo+1,d=Yn.length;for(;a<d;){const g=a+d>>>1;Wh(Yn[g])<s?a=g+1:d=g}return a}function Fg(s){(!Yn.length||!Yn.includes(s,Zh&&s.allowRecurse?Vo+1:Vo))&&(s.id==null?Yn.push(s):Yn.splice(iS(s.id),0,s),o1())}function o1(){!Zh&&!Q_&&(Q_=!0,Bg=r1.then(a1))}function nS(s){const a=Yn.indexOf(s);a>Vo&&Yn.splice(a,1)}function rS(s){ii(s)?Oc.push(...s):(!ds||!ds.includes(s,s.allowRecurse?il+1:il))&&Oc.push(s),o1()}function u0(s,a=Zh?Vo+1:0){for(;a<Yn.length;a++){const d=Yn[a];d&&d.pre&&(Yn.splice(a,1),a--,d())}}function s1(s){if(Oc.length){const a=[...new Set(Oc)];if(Oc.length=0,ds){ds.push(...a);return}for(ds=a,ds.sort((d,g)=>Wh(d)-Wh(g)),il=0;il<ds.length;il++)ds[il]();ds=null,il=0}}const Wh=s=>s.id==null?1/0:s.id,oS=(s,a)=>{const d=Wh(s)-Wh(a);if(d===0){if(s.pre&&!a.pre)return-1;if(a.pre&&!s.pre)return 1}return d};function a1(s){Q_=!1,Zh=!0,Yn.sort(oS);const a=go;try{for(Vo=0;Vo<Yn.length;Vo++){const d=Yn[Vo];d&&d.active!==!1&&oa(d,null,14)}}finally{Vo=0,Yn.length=0,s1(),Zh=!1,Bg=null,(Yn.length||Oc.length)&&a1()}}function sS(s,a,...d){if(s.isUnmounted)return;const g=s.vnode.props||en;let x=d;const E=a.startsWith("update:"),I=E&&a.slice(7);if(I&&I in g){const G=`${I==="modelValue"?"model":I}Modifiers`,{number:J,trim:de}=g[G]||en;de&&(x=d.map(xe=>Cn(xe)?xe.trim():xe)),J&&(x=d.map(Ub))}let o,L=g[o=v_(a)]||g[o=v_(Fc(a))];!L&&E&&(L=g[o=v_(Kc(a))]),L&&qr(L,s,6,x);const U=g[o+"Once"];if(U){if(!s.emitted)s.emitted={};else if(s.emitted[o])return;s.emitted[o]=!0,qr(U,s,6,x)}}function l1(s,a,d=!1){const g=a.emitsCache,x=g.get(s);if(x!==void 0)return x;const E=s.emits;let I={},o=!1;if(!ci(s)){const L=U=>{const G=l1(U,a,!0);G&&(o=!0,er(I,G))};!d&&a.mixins.length&&a.mixins.forEach(L),s.extends&&L(s.extends),s.mixins&&s.mixins.forEach(L)}return!E&&!o?(sn(s)&&g.set(s,null),null):(ii(E)?E.forEach(L=>I[L]=null):er(I,E),sn(s)&&g.set(s,I),I)}function Bf(s,a){return!s||!Lf(a)?!1:(a=a.slice(2).replace(/Once$/,""),Ii(s,a[0].toLowerCase()+a.slice(1))||Ii(s,Kc(a))||Ii(s,a))}let ar=null,c1=null;function bf(s){const a=ar;return ar=s,c1=s&&s.type.__scopeId||null,a}function u1(s,a=ar,d){if(!a||s._n)return s;const g=(...x)=>{g._d&&x0(-1);const E=bf(a);let I;try{I=s(...x)}finally{bf(E),g._d&&x0(1)}return I};return g._n=!0,g._c=!0,g._d=!0,g}function b_(s){const{type:a,vnode:d,proxy:g,withProxy:x,props:E,propsOptions:[I],slots:o,attrs:L,emit:U,render:G,renderCache:J,data:de,setupState:xe,ctx:ge,inheritAttrs:Ie}=s;let Ne,et;const ut=bf(s);try{if(d.shapeFlag&4){const ft=x||g;Ne=jo(G.call(ft,ft,J,E,xe,de,ge)),et=L}else{const ft=a;Ne=jo(ft.length>1?ft(E,{attrs:L,slots:o,emit:U}):ft(E,null)),et=a.props?L:aS(L)}}catch(ft){jh.length=0,Rf(ft,s,1),Ne=Qn(Zr)}let Ve=Ne;if(et&&Ie!==!1){const ft=Object.keys(et),{shapeFlag:Ce}=Ve;ft.length&&Ce&7&&(I&&ft.some(Ag)&&(et=lS(et,I)),Ve=la(Ve,et))}return d.dirs&&(Ve=la(Ve),Ve.dirs=Ve.dirs?Ve.dirs.concat(d.dirs):d.dirs),d.transition&&(Ve.transition=d.transition),Ne=Ve,bf(ut),Ne}const aS=s=>{let a;for(const d in s)(d==="class"||d==="style"||Lf(d))&&((a||(a={}))[d]=s[d]);return a},lS=(s,a)=>{const d={};for(const g in s)(!Ag(g)||!(g.slice(9)in a))&&(d[g]=s[g]);return d};function cS(s,a,d){const{props:g,children:x,component:E}=s,{props:I,children:o,patchFlag:L}=a,U=E.emitsOptions;if(a.dirs||a.transition)return!0;if(d&&L>=0){if(L&1024)return!0;if(L&16)return g?h0(g,I,U):!!I;if(L&8){const G=a.dynamicProps;for(let J=0;J<G.length;J++){const de=G[J];if(I[de]!==g[de]&&!Bf(U,de))return!0}}}else return(x||o)&&(!o||!o.$stable)?!0:g===I?!1:g?I?h0(g,I,U):!0:!!I;return!1}function h0(s,a,d){const g=Object.keys(a);if(g.length!==Object.keys(s).length)return!0;for(let x=0;x<g.length;x++){const E=g[x];if(a[E]!==s[E]&&!Bf(d,E))return!0}return!1}function uS({vnode:s,parent:a},d){for(;a&&a.subTree===s;)(s=a.vnode).el=d,a=a.parent}const hS=s=>s.__isSuspense;function dS(s,a){a&&a.pendingBranch?ii(s)?a.effects.push(...s):a.effects.push(s):rS(s)}function h1(s,a){if(jn){let d=jn.provides;const g=jn.parent&&jn.parent.provides;g===d&&(d=jn.provides=Object.create(g)),d[s]=a}}function Fh(s,a,d=!1){const g=jn||ar;if(g){const x=g.parent==null?g.vnode.appContext&&g.vnode.appContext.provides:g.parent.provides;if(x&&s in x)return x[s];if(arguments.length>1)return d&&ci(a)?a.call(g.proxy):a}}const Xp={};function sa(s,a,d){return d1(s,a,d)}function d1(s,a,{immediate:d,deep:g,flush:x,onTrack:E,onTrigger:I}=en){const o=jn;let L,U=!1,G=!1;if(Jn(s)?(L=()=>s.value,U=xf(s)):kc(s)?(L=()=>s,g=!0):ii(s)?(G=!0,U=s.some(Ve=>kc(Ve)||xf(Ve)),L=()=>s.map(Ve=>{if(Jn(Ve))return Ve.value;if(kc(Ve))return Mc(Ve);if(ci(Ve))return oa(Ve,o,2)})):ci(s)?a?L=()=>oa(s,o,2):L=()=>{if(!(o&&o.isUnmounted))return J&&J(),qr(s,o,3,[de])}:L=go,a&&g){const Ve=L;L=()=>Mc(Ve())}let J,de=Ve=>{J=et.onStop=()=>{oa(Ve,o,4)}},xe;if(Xh)if(de=go,a?d&&qr(a,o,3,[L(),G?[]:void 0,de]):L(),x==="sync"){const Ve=oC();xe=Ve.__watcherHandles||(Ve.__watcherHandles=[])}else return go;let ge=G?new Array(s.length).fill(Xp):Xp;const Ie=()=>{if(et.active)if(a){const Ve=et.run();(g||U||(G?Ve.some((ft,Ce)=>Gh(ft,ge[Ce])):Gh(Ve,ge)))&&(J&&J(),qr(a,o,3,[Ve,ge===Xp?void 0:G&&ge[0]===Xp?[]:ge,de]),ge=Ve)}else et.run()};Ie.allowRecurse=!!a;let Ne;x==="sync"?Ne=Ie:x==="post"?Ne=()=>_r(Ie,o&&o.suspense):(Ie.pre=!0,o&&(Ie.id=o.uid),Ne=()=>Fg(Ie));const et=new Pg(L,Ne);a?d?Ie():ge=et.run():x==="post"?_r(et.run.bind(et),o&&o.suspense):et.run();const ut=()=>{et.stop(),o&&o.scope&&Sg(o.scope.effects,et)};return xe&&xe.push(ut),ut}function pS(s,a,d){const g=this.proxy,x=Cn(s)?s.includes(".")?p1(g,s):()=>g[s]:s.bind(g,g);let E;ci(a)?E=a:(E=a.handler,d=a);const I=jn;Uc(this);const o=d1(x,E.bind(g),d);return I?Uc(I):ll(),o}function p1(s,a){const d=a.split(".");return()=>{let g=s;for(let x=0;x<d.length&&g;x++)g=g[d[x]];return g}}function Mc(s,a){if(!sn(s)||s.__v_skip||(a=a||new Set,a.has(s)))return s;if(a.add(s),Jn(s))Mc(s.value,a);else if(ii(s))for(let d=0;d<s.length;d++)Mc(s[d],a);else if(Ob(s)||zc(s))s.forEach(d=>{Mc(d,a)});else if(Fb(s))for(const d in s)Mc(s[d],a);return s}function fS(){const s={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Jh(()=>{s.isMounted=!0}),g1(()=>{s.isUnmounting=!0}),s}const Gr=[Function,Array],mS={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Gr,onEnter:Gr,onAfterEnter:Gr,onEnterCancelled:Gr,onBeforeLeave:Gr,onLeave:Gr,onAfterLeave:Gr,onLeaveCancelled:Gr,onBeforeAppear:Gr,onAppear:Gr,onAfterAppear:Gr,onAppearCancelled:Gr},setup(s,{slots:a}){const d=L1(),g=fS();let x;return()=>{const E=a.default&&m1(a.default(),!0);if(!E||!E.length)return;let I=E[0];if(E.length>1){for(const Ie of E)if(Ie.type!==Zr){I=Ie;break}}const o=zi(s),{mode:L}=o;if(g.isLeaving)return w_(I);const U=d0(I);if(!U)return w_(I);const G=eg(U,o,g,d);tg(U,G);const J=d.subTree,de=J&&d0(J);let xe=!1;const{getTransitionKey:ge}=U.type;if(ge){const Ie=ge();x===void 0?x=Ie:Ie!==x&&(x=Ie,xe=!0)}if(de&&de.type!==Zr&&(!nl(U,de)||xe)){const Ie=eg(de,o,g,d);if(tg(de,Ie),L==="out-in")return g.isLeaving=!0,Ie.afterLeave=()=>{g.isLeaving=!1,d.update.active!==!1&&d.update()},w_(I);L==="in-out"&&U.type!==Zr&&(Ie.delayLeave=(Ne,et,ut)=>{const Ve=f1(g,de);Ve[String(de.key)]=de,Ne._leaveCb=()=>{et(),Ne._leaveCb=void 0,delete G.delayedLeave},G.delayedLeave=ut})}return I}}},_S=mS;function f1(s,a){const{leavingVNodes:d}=s;let g=d.get(a.type);return g||(g=Object.create(null),d.set(a.type,g)),g}function eg(s,a,d,g){const{appear:x,mode:E,persisted:I=!1,onBeforeEnter:o,onEnter:L,onAfterEnter:U,onEnterCancelled:G,onBeforeLeave:J,onLeave:de,onAfterLeave:xe,onLeaveCancelled:ge,onBeforeAppear:Ie,onAppear:Ne,onAfterAppear:et,onAppearCancelled:ut}=a,Ve=String(s.key),ft=f1(d,s),Ce=(At,_t)=>{At&&qr(At,g,9,_t)},xt=(At,_t)=>{const It=_t[1];Ce(At,_t),ii(At)?At.every(mi=>mi.length<=1)&&It():At.length<=1&&It()},Gt={mode:E,persisted:I,beforeEnter(At){let _t=o;if(!d.isMounted)if(x)_t=Ie||o;else return;At._leaveCb&&At._leaveCb(!0);const It=ft[Ve];It&&nl(s,It)&&It.el._leaveCb&&It.el._leaveCb(),Ce(_t,[At])},enter(At){let _t=L,It=U,mi=G;if(!d.isMounted)if(x)_t=Ne||L,It=et||U,mi=ut||G;else return;let Bi=!1;const bi=At._enterCb=hn=>{Bi||(Bi=!0,hn?Ce(mi,[At]):Ce(It,[At]),Gt.delayedLeave&&Gt.delayedLeave(),At._enterCb=void 0)};_t?xt(_t,[At,bi]):bi()},leave(At,_t){const It=String(s.key);if(At._enterCb&&At._enterCb(!0),d.isUnmounting)return _t();Ce(J,[At]);let mi=!1;const Bi=At._leaveCb=bi=>{mi||(mi=!0,_t(),bi?Ce(ge,[At]):Ce(xe,[At]),At._leaveCb=void 0,ft[It]===s&&delete ft[It])};ft[It]=s,de?xt(de,[At,Bi]):Bi()},clone(At){return eg(At,a,d,g)}};return Gt}function w_(s){if(Ff(s))return s=la(s),s.children=null,s}function d0(s){return Ff(s)?s.children?s.children[0]:void 0:s}function tg(s,a){s.shapeFlag&6&&s.component?tg(s.component.subTree,a):s.shapeFlag&128?(s.ssContent.transition=a.clone(s.ssContent),s.ssFallback.transition=a.clone(s.ssFallback)):s.transition=a}function m1(s,a=!1,d){let g=[],x=0;for(let E=0;E<s.length;E++){let I=s[E];const o=d==null?I.key:String(d)+String(I.key!=null?I.key:E);I.type===gr?(I.patchFlag&128&&x++,g=g.concat(m1(I.children,a,o))):(a||I.type!==Zr)&&g.push(o!=null?la(I,{key:o}):I)}if(x>1)for(let E=0;E<g.length;E++)g[E].patchFlag=-2;return g}const Nh=s=>!!s.type.__asyncLoader,Ff=s=>s.type.__isKeepAlive;function gS(s,a){_1(s,"a",a)}function yS(s,a){_1(s,"da",a)}function _1(s,a,d=jn){const g=s.__wdc||(s.__wdc=()=>{let x=d;for(;x;){if(x.isDeactivated)return;x=x.parent}return s()});if(Nf(a,g,d),d){let x=d.parent;for(;x&&x.parent;)Ff(x.parent.vnode)&&vS(g,a,d,x),x=x.parent}}function vS(s,a,d,g){const x=Nf(a,s,g,!0);Qh(()=>{Sg(g[a],x)},d)}function Nf(s,a,d=jn,g=!1){if(d){const x=d[s]||(d[s]=[]),E=a.__weh||(a.__weh=(...I)=>{if(d.isUnmounted)return;Yc(),Uc(d);const o=qr(a,d,s,I);return ll(),Jc(),o});return g?x.unshift(E):x.push(E),E}}const bs=s=>(a,d=jn)=>(!Xh||s==="sp")&&Nf(s,(...g)=>a(...g),d),xS=bs("bm"),Jh=bs("m"),bS=bs("bu"),wS=bs("u"),g1=bs("bum"),Qh=bs("um"),ES=bs("sp"),TS=bs("rtg"),AS=bs("rtc");function SS(s,a=jn){Nf("ec",s,a)}function Ya(s,a,d,g){const x=s.dirs,E=a&&a.dirs;for(let I=0;I<x.length;I++){const o=x[I];E&&(o.oldValue=E[I].value);let L=o.dir[g];L&&(Yc(),qr(L,d,8,[s.el,o,s,a]),Jc())}}const CS=Symbol();function IS(s,a,d,g){let x;const E=d&&d[g];if(ii(s)||Cn(s)){x=new Array(s.length);for(let I=0,o=s.length;I<o;I++)x[I]=a(s[I],I,void 0,E&&E[I])}else if(typeof s=="number"){x=new Array(s);for(let I=0;I<s;I++)x[I]=a(I+1,I,void 0,E&&E[I])}else if(sn(s))if(s[Symbol.iterator])x=Array.from(s,(I,o)=>a(I,o,void 0,E&&E[o]));else{const I=Object.keys(s);x=new Array(I.length);for(let o=0,L=I.length;o<L;o++){const U=I[o];x[o]=a(s[U],U,o,E&&E[o])}}else x=[];return d&&(d[g]=x),x}function p0(s,a,d={},g,x){if(ar.isCE||ar.parent&&Nh(ar.parent)&&ar.parent.isCE)return a!=="default"&&(d.name=a),Qn("slot",d,g&&g());let E=s[a];E&&E._c&&(E._d=!1),kn();const I=E&&y1(E(d)),o=jg(gr,{key:d.key||I&&I.key||`_${a}`},I||(g?g():[]),I&&s._===1?64:-2);return!x&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),E&&E._c&&(E._d=!0),o}function y1(s){return s.some(a=>I1(a)?!(a.type===Zr||a.type===gr&&!y1(a.children)):!0)?s:null}const ig=s=>s?z1(s)?$g(s)||s.proxy:ig(s.parent):null,Uh=er(Object.create(null),{$:s=>s,$el:s=>s.vnode.el,$data:s=>s.data,$props:s=>s.props,$attrs:s=>s.attrs,$slots:s=>s.slots,$refs:s=>s.refs,$parent:s=>ig(s.parent),$root:s=>ig(s.root),$emit:s=>s.emit,$options:s=>Ng(s),$forceUpdate:s=>s.f||(s.f=()=>Fg(s.update)),$nextTick:s=>s.n||(s.n=tS.bind(s.proxy)),$watch:s=>pS.bind(s)}),E_=(s,a)=>s!==en&&!s.__isScriptSetup&&Ii(s,a),MS={get({_:s},a){const{ctx:d,setupState:g,data:x,props:E,accessCache:I,type:o,appContext:L}=s;let U;if(a[0]!=="$"){const xe=I[a];if(xe!==void 0)switch(xe){case 1:return g[a];case 2:return x[a];case 4:return d[a];case 3:return E[a]}else{if(E_(g,a))return I[a]=1,g[a];if(x!==en&&Ii(x,a))return I[a]=2,x[a];if((U=s.propsOptions[0])&&Ii(U,a))return I[a]=3,E[a];if(d!==en&&Ii(d,a))return I[a]=4,d[a];ng&&(I[a]=0)}}const G=Uh[a];let J,de;if(G)return a==="$attrs"&&Ir(s,"get",a),G(s);if((J=o.__cssModules)&&(J=J[a]))return J;if(d!==en&&Ii(d,a))return I[a]=4,d[a];if(de=L.config.globalProperties,Ii(de,a))return de[a]},set({_:s},a,d){const{data:g,setupState:x,ctx:E}=s;return E_(x,a)?(x[a]=d,!0):g!==en&&Ii(g,a)?(g[a]=d,!0):Ii(s.props,a)||a[0]==="$"&&a.slice(1)in s?!1:(E[a]=d,!0)},has({_:{data:s,setupState:a,accessCache:d,ctx:g,appContext:x,propsOptions:E}},I){let o;return!!d[I]||s!==en&&Ii(s,I)||E_(a,I)||(o=E[0])&&Ii(o,I)||Ii(g,I)||Ii(Uh,I)||Ii(x.config.globalProperties,I)},defineProperty(s,a,d){return d.get!=null?s._.accessCache[a]=0:Ii(d,"value")&&this.set(s,a,d.value,null),Reflect.defineProperty(s,a,d)}};let ng=!0;function PS(s){const a=Ng(s),d=s.proxy,g=s.ctx;ng=!1,a.beforeCreate&&f0(a.beforeCreate,s,"bc");const{data:x,computed:E,methods:I,watch:o,provide:L,inject:U,created:G,beforeMount:J,mounted:de,beforeUpdate:xe,updated:ge,activated:Ie,deactivated:Ne,beforeDestroy:et,beforeUnmount:ut,destroyed:Ve,unmounted:ft,render:Ce,renderTracked:xt,renderTriggered:Gt,errorCaptured:At,serverPrefetch:_t,expose:It,inheritAttrs:mi,components:Bi,directives:bi,filters:hn}=a;if(U&&DS(U,g,null,s.appContext.config.unwrapInjectedRef),I)for(const Jt in I){const ei=I[Jt];ci(ei)&&(g[Jt]=ei.bind(d))}if(x){const Jt=x.call(d,d);sn(Jt)&&(s.data=kg(Jt))}if(ng=!0,E)for(const Jt in E){const ei=E[Jt],Wi=ci(ei)?ei.bind(d,d):ci(ei.get)?ei.get.bind(d,d):go,gi=!ci(ei)&&ci(ei.set)?ei.set.bind(d):go,yn=ps({get:Wi,set:gi});Object.defineProperty(g,Jt,{enumerable:!0,configurable:!0,get:()=>yn.value,set:Ki=>yn.value=Ki})}if(o)for(const Jt in o)v1(o[Jt],g,d,Jt);if(L){const Jt=ci(L)?L.call(d):L;Reflect.ownKeys(Jt).forEach(ei=>{h1(ei,Jt[ei])})}G&&f0(G,s,"c");function ui(Jt,ei){ii(ei)?ei.forEach(Wi=>Jt(Wi.bind(d))):ei&&Jt(ei.bind(d))}if(ui(xS,J),ui(Jh,de),ui(bS,xe),ui(wS,ge),ui(gS,Ie),ui(yS,Ne),ui(SS,At),ui(AS,xt),ui(TS,Gt),ui(g1,ut),ui(Qh,ft),ui(ES,_t),ii(It))if(It.length){const Jt=s.exposed||(s.exposed={});It.forEach(ei=>{Object.defineProperty(Jt,ei,{get:()=>d[ei],set:Wi=>d[ei]=Wi})})}else s.exposed||(s.exposed={});Ce&&s.render===go&&(s.render=Ce),mi!=null&&(s.inheritAttrs=mi),Bi&&(s.components=Bi),bi&&(s.directives=bi)}function DS(s,a,d=go,g=!1){ii(s)&&(s=rg(s));for(const x in s){const E=s[x];let I;sn(E)?"default"in E?I=Fh(E.from||x,E.default,!0):I=Fh(E.from||x):I=Fh(E),Jn(I)&&g?Object.defineProperty(a,x,{enumerable:!0,configurable:!0,get:()=>I.value,set:o=>I.value=o}):a[x]=I}}function f0(s,a,d){qr(ii(s)?s.map(g=>g.bind(a.proxy)):s.bind(a.proxy),a,d)}function v1(s,a,d,g){const x=g.includes(".")?p1(d,g):()=>d[g];if(Cn(s)){const E=a[s];ci(E)&&sa(x,E)}else if(ci(s))sa(x,s.bind(d));else if(sn(s))if(ii(s))s.forEach(E=>v1(E,a,d,g));else{const E=ci(s.handler)?s.handler.bind(d):a[s.handler];ci(E)&&sa(x,E,s)}}function Ng(s){const a=s.type,{mixins:d,extends:g}=a,{mixins:x,optionsCache:E,config:{optionMergeStrategies:I}}=s.appContext,o=E.get(a);let L;return o?L=o:!x.length&&!d&&!g?L=a:(L={},x.length&&x.forEach(U=>wf(L,U,I,!0)),wf(L,a,I)),sn(a)&&E.set(a,L),L}function wf(s,a,d,g=!1){const{mixins:x,extends:E}=a;E&&wf(s,E,d,!0),x&&x.forEach(I=>wf(s,I,d,!0));for(const I in a)if(!(g&&I==="expose")){const o=LS[I]||d&&d[I];s[I]=o?o(s[I],a[I]):a[I]}return s}const LS={data:m0,props:el,emits:el,methods:el,computed:el,beforeCreate:or,created:or,beforeMount:or,mounted:or,beforeUpdate:or,updated:or,beforeDestroy:or,beforeUnmount:or,destroyed:or,unmounted:or,activated:or,deactivated:or,errorCaptured:or,serverPrefetch:or,components:el,directives:el,watch:kS,provide:m0,inject:zS};function m0(s,a){return a?s?function(){return er(ci(s)?s.call(this,this):s,ci(a)?a.call(this,this):a)}:a:s}function zS(s,a){return el(rg(s),rg(a))}function rg(s){if(ii(s)){const a={};for(let d=0;d<s.length;d++)a[s[d]]=s[d];return a}return s}function or(s,a){return s?[...new Set([].concat(s,a))]:a}function el(s,a){return s?er(er(Object.create(null),s),a):a}function kS(s,a){if(!s)return a;if(!a)return s;const d=er(Object.create(null),s);for(const g in a)d[g]=or(s[g],a[g]);return d}function OS(s,a,d,g=!1){const x={},E={};vf(E,jf,1),s.propsDefaults=Object.create(null),x1(s,a,x,E);for(const I in s.propsOptions[0])I in x||(x[I]=void 0);d?s.props=g?x:HA(x):s.type.props?s.props=x:s.props=E,s.attrs=E}function RS(s,a,d,g){const{props:x,attrs:E,vnode:{patchFlag:I}}=s,o=zi(x),[L]=s.propsOptions;let U=!1;if((g||I>0)&&!(I&16)){if(I&8){const G=s.vnode.dynamicProps;for(let J=0;J<G.length;J++){let de=G[J];if(Bf(s.emitsOptions,de))continue;const xe=a[de];if(L)if(Ii(E,de))xe!==E[de]&&(E[de]=xe,U=!0);else{const ge=Fc(de);x[ge]=og(L,o,ge,xe,s,!1)}else xe!==E[de]&&(E[de]=xe,U=!0)}}}else{x1(s,a,x,E)&&(U=!0);let G;for(const J in o)(!a||!Ii(a,J)&&((G=Kc(J))===J||!Ii(a,G)))&&(L?d&&(d[J]!==void 0||d[G]!==void 0)&&(x[J]=og(L,o,J,void 0,s,!0)):delete x[J]);if(E!==o)for(const J in E)(!a||!Ii(a,J))&&(delete E[J],U=!0)}U&&vs(s,"set","$attrs")}function x1(s,a,d,g){const[x,E]=s.propsOptions;let I=!1,o;if(a)for(let L in a){if(af(L))continue;const U=a[L];let G;x&&Ii(x,G=Fc(L))?!E||!E.includes(G)?d[G]=U:(o||(o={}))[G]=U:Bf(s.emitsOptions,L)||(!(L in g)||U!==g[L])&&(g[L]=U,I=!0)}if(E){const L=zi(d),U=o||en;for(let G=0;G<E.length;G++){const J=E[G];d[J]=og(x,L,J,U[J],s,!Ii(U,J))}}return I}function og(s,a,d,g,x,E){const I=s[d];if(I!=null){const o=Ii(I,"default");if(o&&g===void 0){const L=I.default;if(I.type!==Function&&ci(L)){const{propsDefaults:U}=x;d in U?g=U[d]:(Uc(x),g=U[d]=L.call(null,a),ll())}else g=L}I[0]&&(E&&!o?g=!1:I[1]&&(g===""||g===Kc(d))&&(g=!0))}return g}function b1(s,a,d=!1){const g=a.propsCache,x=g.get(s);if(x)return x;const E=s.props,I={},o=[];let L=!1;if(!ci(s)){const G=J=>{L=!0;const[de,xe]=b1(J,a,!0);er(I,de),xe&&o.push(...xe)};!d&&a.mixins.length&&a.mixins.forEach(G),s.extends&&G(s.extends),s.mixins&&s.mixins.forEach(G)}if(!E&&!L)return sn(s)&&g.set(s,Lc),Lc;if(ii(E))for(let G=0;G<E.length;G++){const J=Fc(E[G]);_0(J)&&(I[J]=en)}else if(E)for(const G in E){const J=Fc(G);if(_0(J)){const de=E[G],xe=I[J]=ii(de)||ci(de)?{type:de}:Object.assign({},de);if(xe){const ge=v0(Boolean,xe.type),Ie=v0(String,xe.type);xe[0]=ge>-1,xe[1]=Ie<0||ge<Ie,(ge>-1||Ii(xe,"default"))&&o.push(J)}}}const U=[I,o];return sn(s)&&g.set(s,U),U}function _0(s){return s[0]!=="$"}function g0(s){const a=s&&s.toString().match(/^\s*function (\w+)/);return a?a[1]:s===null?"null":""}function y0(s,a){return g0(s)===g0(a)}function v0(s,a){return ii(a)?a.findIndex(d=>y0(d,s)):ci(a)&&y0(a,s)?0:-1}const w1=s=>s[0]==="_"||s==="$stable",Ug=s=>ii(s)?s.map(jo):[jo(s)],BS=(s,a,d)=>{if(a._n)return a;const g=u1((...x)=>Ug(a(...x)),d);return g._c=!1,g},E1=(s,a,d)=>{const g=s._ctx;for(const x in s){if(w1(x))continue;const E=s[x];if(ci(E))a[x]=BS(x,E,g);else if(E!=null){const I=Ug(E);a[x]=()=>I}}},T1=(s,a)=>{const d=Ug(a);s.slots.default=()=>d},FS=(s,a)=>{if(s.vnode.shapeFlag&32){const d=a._;d?(s.slots=zi(a),vf(a,"_",d)):E1(a,s.slots={})}else s.slots={},a&&T1(s,a);vf(s.slots,jf,1)},NS=(s,a,d)=>{const{vnode:g,slots:x}=s;let E=!0,I=en;if(g.shapeFlag&32){const o=a._;o?d&&o===1?E=!1:(er(x,a),!d&&o===1&&delete x._):(E=!a.$stable,E1(a,x)),I=a}else a&&(T1(s,a),I={default:1});if(E)for(const o in x)!w1(o)&&!(o in I)&&delete x[o]};function A1(){return{app:null,config:{isNativeTag:fA,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let US=0;function jS(s,a){return function(g,x=null){ci(g)||(g=Object.assign({},g)),x!=null&&!sn(x)&&(x=null);const E=A1(),I=new Set;let o=!1;const L=E.app={_uid:US++,_component:g,_props:x,_container:null,_context:E,_instance:null,version:sC,get config(){return E.config},set config(U){},use(U,...G){return I.has(U)||(U&&ci(U.install)?(I.add(U),U.install(L,...G)):ci(U)&&(I.add(U),U(L,...G))),L},mixin(U){return E.mixins.includes(U)||E.mixins.push(U),L},component(U,G){return G?(E.components[U]=G,L):E.components[U]},directive(U,G){return G?(E.directives[U]=G,L):E.directives[U]},mount(U,G,J){if(!o){const de=Qn(g,x);return de.appContext=E,G&&a?a(de,U):s(de,U,J),o=!0,L._container=U,U.__vue_app__=L,$g(de.component)||de.component.proxy}},unmount(){o&&(s(null,L._container),delete L._container.__vue_app__)},provide(U,G){return E.provides[U]=G,L}};return L}}function sg(s,a,d,g,x=!1){if(ii(s)){s.forEach((de,xe)=>sg(de,a&&(ii(a)?a[xe]:a),d,g,x));return}if(Nh(g)&&!x)return;const E=g.shapeFlag&4?$g(g.component)||g.component.proxy:g.el,I=x?null:E,{i:o,r:L}=s,U=a&&a.r,G=o.refs===en?o.refs={}:o.refs,J=o.setupState;if(U!=null&&U!==L&&(Cn(U)?(G[U]=null,Ii(J,U)&&(J[U]=null)):Jn(U)&&(U.value=null)),ci(L))oa(L,o,12,[I,G]);else{const de=Cn(L),xe=Jn(L);if(de||xe){const ge=()=>{if(s.f){const Ie=de?Ii(J,L)?J[L]:G[L]:L.value;x?ii(Ie)&&Sg(Ie,E):ii(Ie)?Ie.includes(E)||Ie.push(E):de?(G[L]=[E],Ii(J,L)&&(J[L]=G[L])):(L.value=[E],s.k&&(G[s.k]=L.value))}else de?(G[L]=I,Ii(J,L)&&(J[L]=I)):xe&&(L.value=I,s.k&&(G[s.k]=I))};I?(ge.id=-1,_r(ge,d)):ge()}}}const _r=dS;function VS(s){return $S(s)}function $S(s,a){const d=xA();d.__VUE__=!0;const{insert:g,remove:x,patchProp:E,createElement:I,createText:o,createComment:L,setText:U,setElementText:G,parentNode:J,nextSibling:de,setScopeId:xe=go,insertStaticContent:ge}=s,Ie=(se,me,Me,$e=null,Xe=null,nt=null,gt=!1,lt=null,rt=!!me.dynamicChildren)=>{if(se===me)return;se&&!nl(se,me)&&($e=Yi(se),Ki(se,Xe,nt,!0),se=null),me.patchFlag===-2&&(rt=!1,me.dynamicChildren=null);const{type:Ye,ref:bt,shapeFlag:wt}=me;switch(Ye){case Uf:Ne(se,me,Me,$e);break;case Zr:et(se,me,Me,$e);break;case cf:se==null&&ut(me,Me,$e,gt);break;case gr:Bi(se,me,Me,$e,Xe,nt,gt,lt,rt);break;default:wt&1?Ce(se,me,Me,$e,Xe,nt,gt,lt,rt):wt&6?bi(se,me,Me,$e,Xe,nt,gt,lt,rt):(wt&64||wt&128)&&Ye.process(se,me,Me,$e,Xe,nt,gt,lt,rt,In)}bt!=null&&Xe&&sg(bt,se&&se.ref,nt,me||se,!me)},Ne=(se,me,Me,$e)=>{if(se==null)g(me.el=o(me.children),Me,$e);else{const Xe=me.el=se.el;me.children!==se.children&&U(Xe,me.children)}},et=(se,me,Me,$e)=>{se==null?g(me.el=L(me.children||""),Me,$e):me.el=se.el},ut=(se,me,Me,$e)=>{[se.el,se.anchor]=ge(se.children,me,Me,$e,se.el,se.anchor)},Ve=({el:se,anchor:me},Me,$e)=>{let Xe;for(;se&&se!==me;)Xe=de(se),g(se,Me,$e),se=Xe;g(me,Me,$e)},ft=({el:se,anchor:me})=>{let Me;for(;se&&se!==me;)Me=de(se),x(se),se=Me;x(me)},Ce=(se,me,Me,$e,Xe,nt,gt,lt,rt)=>{gt=gt||me.type==="svg",se==null?xt(me,Me,$e,Xe,nt,gt,lt,rt):_t(se,me,Xe,nt,gt,lt,rt)},xt=(se,me,Me,$e,Xe,nt,gt,lt)=>{let rt,Ye;const{type:bt,props:wt,shapeFlag:Ct,transition:Nt,dirs:Wt}=se;if(rt=se.el=I(se.type,nt,wt&&wt.is,wt),Ct&8?G(rt,se.children):Ct&16&&At(se.children,rt,null,$e,Xe,nt&&bt!=="foreignObject",gt,lt),Wt&&Ya(se,null,$e,"created"),wt){for(const si in wt)si!=="value"&&!af(si)&&E(rt,si,null,wt[si],nt,se.children,$e,Xe,Hi);"value"in wt&&E(rt,"value",null,wt.value),(Ye=wt.onVnodeBeforeMount)&&No(Ye,$e,se)}Gt(rt,se,se.scopeId,gt,$e),Wt&&Ya(se,null,$e,"beforeMount");const ni=(!Xe||Xe&&!Xe.pendingBranch)&&Nt&&!Nt.persisted;ni&&Nt.beforeEnter(rt),g(rt,me,Me),((Ye=wt&&wt.onVnodeMounted)||ni||Wt)&&_r(()=>{Ye&&No(Ye,$e,se),ni&&Nt.enter(rt),Wt&&Ya(se,null,$e,"mounted")},Xe)},Gt=(se,me,Me,$e,Xe)=>{if(Me&&xe(se,Me),$e)for(let nt=0;nt<$e.length;nt++)xe(se,$e[nt]);if(Xe){let nt=Xe.subTree;if(me===nt){const gt=Xe.vnode;Gt(se,gt,gt.scopeId,gt.slotScopeIds,Xe.parent)}}},At=(se,me,Me,$e,Xe,nt,gt,lt,rt=0)=>{for(let Ye=rt;Ye<se.length;Ye++){const bt=se[Ye]=lt?na(se[Ye]):jo(se[Ye]);Ie(null,bt,me,Me,$e,Xe,nt,gt,lt)}},_t=(se,me,Me,$e,Xe,nt,gt)=>{const lt=me.el=se.el;let{patchFlag:rt,dynamicChildren:Ye,dirs:bt}=me;rt|=se.patchFlag&16;const wt=se.props||en,Ct=me.props||en;let Nt;Me&&Ja(Me,!1),(Nt=Ct.onVnodeBeforeUpdate)&&No(Nt,Me,me,se),bt&&Ya(me,se,Me,"beforeUpdate"),Me&&Ja(Me,!0);const Wt=Xe&&me.type!=="foreignObject";if(Ye?It(se.dynamicChildren,Ye,lt,Me,$e,Wt,nt):gt||ei(se,me,lt,null,Me,$e,Wt,nt,!1),rt>0){if(rt&16)mi(lt,me,wt,Ct,Me,$e,Xe);else if(rt&2&&wt.class!==Ct.class&&E(lt,"class",null,Ct.class,Xe),rt&4&&E(lt,"style",wt.style,Ct.style,Xe),rt&8){const ni=me.dynamicProps;for(let si=0;si<ni.length;si++){const Fi=ni[si],$i=wt[Fi],hr=Ct[Fi];(hr!==$i||Fi==="value")&&E(lt,Fi,$i,hr,Xe,se.children,Me,$e,Hi)}}rt&1&&se.children!==me.children&&G(lt,me.children)}else!gt&&Ye==null&&mi(lt,me,wt,Ct,Me,$e,Xe);((Nt=Ct.onVnodeUpdated)||bt)&&_r(()=>{Nt&&No(Nt,Me,me,se),bt&&Ya(me,se,Me,"updated")},$e)},It=(se,me,Me,$e,Xe,nt,gt)=>{for(let lt=0;lt<me.length;lt++){const rt=se[lt],Ye=me[lt],bt=rt.el&&(rt.type===gr||!nl(rt,Ye)||rt.shapeFlag&70)?J(rt.el):Me;Ie(rt,Ye,bt,null,$e,Xe,nt,gt,!0)}},mi=(se,me,Me,$e,Xe,nt,gt)=>{if(Me!==$e){if(Me!==en)for(const lt in Me)!af(lt)&&!(lt in $e)&&E(se,lt,Me[lt],null,gt,me.children,Xe,nt,Hi);for(const lt in $e){if(af(lt))continue;const rt=$e[lt],Ye=Me[lt];rt!==Ye&&lt!=="value"&&E(se,lt,Ye,rt,gt,me.children,Xe,nt,Hi)}"value"in $e&&E(se,"value",Me.value,$e.value)}},Bi=(se,me,Me,$e,Xe,nt,gt,lt,rt)=>{const Ye=me.el=se?se.el:o(""),bt=me.anchor=se?se.anchor:o("");let{patchFlag:wt,dynamicChildren:Ct,slotScopeIds:Nt}=me;Nt&&(lt=lt?lt.concat(Nt):Nt),se==null?(g(Ye,Me,$e),g(bt,Me,$e),At(me.children,Me,bt,Xe,nt,gt,lt,rt)):wt>0&&wt&64&&Ct&&se.dynamicChildren?(It(se.dynamicChildren,Ct,Me,Xe,nt,gt,lt),(me.key!=null||Xe&&me===Xe.subTree)&&S1(se,me,!0)):ei(se,me,Me,bt,Xe,nt,gt,lt,rt)},bi=(se,me,Me,$e,Xe,nt,gt,lt,rt)=>{me.slotScopeIds=lt,se==null?me.shapeFlag&512?Xe.ctx.activate(me,Me,$e,gt,rt):hn(me,Me,$e,Xe,nt,gt,rt):Ft(se,me,rt)},hn=(se,me,Me,$e,Xe,nt,gt)=>{const lt=se.component=YS(se,$e,Xe);if(Ff(se)&&(lt.ctx.renderer=In),JS(lt),lt.asyncDep){if(Xe&&Xe.registerDep(lt,ui),!se.el){const rt=lt.subTree=Qn(Zr);et(null,rt,me,Me)}return}ui(lt,se,me,Me,Xe,nt,gt)},Ft=(se,me,Me)=>{const $e=me.component=se.component;if(cS(se,me,Me))if($e.asyncDep&&!$e.asyncResolved){Jt($e,me,Me);return}else $e.next=me,nS($e.update),$e.update();else me.el=se.el,$e.vnode=me},ui=(se,me,Me,$e,Xe,nt,gt)=>{const lt=()=>{if(se.isMounted){let{next:bt,bu:wt,u:Ct,parent:Nt,vnode:Wt}=se,ni=bt,si;Ja(se,!1),bt?(bt.el=Wt.el,Jt(se,bt,gt)):bt=Wt,wt&&x_(wt),(si=bt.props&&bt.props.onVnodeBeforeUpdate)&&No(si,Nt,bt,Wt),Ja(se,!0);const Fi=b_(se),$i=se.subTree;se.subTree=Fi,Ie($i,Fi,J($i.el),Yi($i),se,Xe,nt),bt.el=Fi.el,ni===null&&uS(se,Fi.el),Ct&&_r(Ct,Xe),(si=bt.props&&bt.props.onVnodeUpdated)&&_r(()=>No(si,Nt,bt,Wt),Xe)}else{let bt;const{el:wt,props:Ct}=me,{bm:Nt,m:Wt,parent:ni}=se,si=Nh(me);if(Ja(se,!1),Nt&&x_(Nt),!si&&(bt=Ct&&Ct.onVnodeBeforeMount)&&No(bt,ni,me),Ja(se,!0),wt&&ur){const Fi=()=>{se.subTree=b_(se),ur(wt,se.subTree,se,Xe,null)};si?me.type.__asyncLoader().then(()=>!se.isUnmounted&&Fi()):Fi()}else{const Fi=se.subTree=b_(se);Ie(null,Fi,Me,$e,se,Xe,nt),me.el=Fi.el}if(Wt&&_r(Wt,Xe),!si&&(bt=Ct&&Ct.onVnodeMounted)){const Fi=me;_r(()=>No(bt,ni,Fi),Xe)}(me.shapeFlag&256||ni&&Nh(ni.vnode)&&ni.vnode.shapeFlag&256)&&se.a&&_r(se.a,Xe),se.isMounted=!0,me=Me=$e=null}},rt=se.effect=new Pg(lt,()=>Fg(Ye),se.scope),Ye=se.update=()=>rt.run();Ye.id=se.uid,Ja(se,!0),Ye()},Jt=(se,me,Me)=>{me.component=se;const $e=se.vnode.props;se.vnode=me,se.next=null,RS(se,me.props,$e,Me),NS(se,me.children,Me),Yc(),u0(),Jc()},ei=(se,me,Me,$e,Xe,nt,gt,lt,rt=!1)=>{const Ye=se&&se.children,bt=se?se.shapeFlag:0,wt=me.children,{patchFlag:Ct,shapeFlag:Nt}=me;if(Ct>0){if(Ct&128){gi(Ye,wt,Me,$e,Xe,nt,gt,lt,rt);return}else if(Ct&256){Wi(Ye,wt,Me,$e,Xe,nt,gt,lt,rt);return}}Nt&8?(bt&16&&Hi(Ye,Xe,nt),wt!==Ye&&G(Me,wt)):bt&16?Nt&16?gi(Ye,wt,Me,$e,Xe,nt,gt,lt,rt):Hi(Ye,Xe,nt,!0):(bt&8&&G(Me,""),Nt&16&&At(wt,Me,$e,Xe,nt,gt,lt,rt))},Wi=(se,me,Me,$e,Xe,nt,gt,lt,rt)=>{se=se||Lc,me=me||Lc;const Ye=se.length,bt=me.length,wt=Math.min(Ye,bt);let Ct;for(Ct=0;Ct<wt;Ct++){const Nt=me[Ct]=rt?na(me[Ct]):jo(me[Ct]);Ie(se[Ct],Nt,Me,null,Xe,nt,gt,lt,rt)}Ye>bt?Hi(se,Xe,nt,!0,!1,wt):At(me,Me,$e,Xe,nt,gt,lt,rt,wt)},gi=(se,me,Me,$e,Xe,nt,gt,lt,rt)=>{let Ye=0;const bt=me.length;let wt=se.length-1,Ct=bt-1;for(;Ye<=wt&&Ye<=Ct;){const Nt=se[Ye],Wt=me[Ye]=rt?na(me[Ye]):jo(me[Ye]);if(nl(Nt,Wt))Ie(Nt,Wt,Me,null,Xe,nt,gt,lt,rt);else break;Ye++}for(;Ye<=wt&&Ye<=Ct;){const Nt=se[wt],Wt=me[Ct]=rt?na(me[Ct]):jo(me[Ct]);if(nl(Nt,Wt))Ie(Nt,Wt,Me,null,Xe,nt,gt,lt,rt);else break;wt--,Ct--}if(Ye>wt){if(Ye<=Ct){const Nt=Ct+1,Wt=Nt<bt?me[Nt].el:$e;for(;Ye<=Ct;)Ie(null,me[Ye]=rt?na(me[Ye]):jo(me[Ye]),Me,Wt,Xe,nt,gt,lt,rt),Ye++}}else if(Ye>Ct)for(;Ye<=wt;)Ki(se[Ye],Xe,nt,!0),Ye++;else{const Nt=Ye,Wt=Ye,ni=new Map;for(Ye=Wt;Ye<=Ct;Ye++){const mn=me[Ye]=rt?na(me[Ye]):jo(me[Ye]);mn.key!=null&&ni.set(mn.key,Ye)}let si,Fi=0;const $i=Ct-Wt+1;let hr=!1,Yr=0;const Vn=new Array($i);for(Ye=0;Ye<$i;Ye++)Vn[Ye]=0;for(Ye=Nt;Ye<=wt;Ye++){const mn=se[Ye];if(Fi>=$i){Ki(mn,Xe,nt,!0);continue}let Rn;if(mn.key!=null)Rn=ni.get(mn.key);else for(si=Wt;si<=Ct;si++)if(Vn[si-Wt]===0&&nl(mn,me[si])){Rn=si;break}Rn===void 0?Ki(mn,Xe,nt,!0):(Vn[Rn-Wt]=Ye+1,Rn>=Yr?Yr=Rn:hr=!0,Ie(mn,me[Rn],Me,null,Xe,nt,gt,lt,rt),Fi++)}const vr=hr?GS(Vn):Lc;for(si=vr.length-1,Ye=$i-1;Ye>=0;Ye--){const mn=Wt+Ye,Rn=me[mn],Jr=mn+1<bt?me[mn+1].el:$e;Vn[Ye]===0?Ie(null,Rn,Me,Jr,Xe,nt,gt,lt,rt):hr&&(si<0||Ye!==vr[si]?yn(Rn,Me,Jr,2):si--)}}},yn=(se,me,Me,$e,Xe=null)=>{const{el:nt,type:gt,transition:lt,children:rt,shapeFlag:Ye}=se;if(Ye&6){yn(se.component.subTree,me,Me,$e);return}if(Ye&128){se.suspense.move(me,Me,$e);return}if(Ye&64){gt.move(se,me,Me,In);return}if(gt===gr){g(nt,me,Me);for(let wt=0;wt<rt.length;wt++)yn(rt[wt],me,Me,$e);g(se.anchor,me,Me);return}if(gt===cf){Ve(se,me,Me);return}if($e!==2&&Ye&1&&lt)if($e===0)lt.beforeEnter(nt),g(nt,me,Me),_r(()=>lt.enter(nt),Xe);else{const{leave:wt,delayLeave:Ct,afterLeave:Nt}=lt,Wt=()=>g(nt,me,Me),ni=()=>{wt(nt,()=>{Wt(),Nt&&Nt()})};Ct?Ct(nt,Wt,ni):ni()}else g(nt,me,Me)},Ki=(se,me,Me,$e=!1,Xe=!1)=>{const{type:nt,props:gt,ref:lt,children:rt,dynamicChildren:Ye,shapeFlag:bt,patchFlag:wt,dirs:Ct}=se;if(lt!=null&&sg(lt,null,Me,se,!0),bt&256){me.ctx.deactivate(se);return}const Nt=bt&1&&Ct,Wt=!Nh(se);let ni;if(Wt&&(ni=gt&&gt.onVnodeBeforeUnmount)&&No(ni,me,se),bt&6)vn(se.component,Me,$e);else{if(bt&128){se.suspense.unmount(Me,$e);return}Nt&&Ya(se,null,me,"beforeUnmount"),bt&64?se.type.remove(se,me,Me,Xe,In,$e):Ye&&(nt!==gr||wt>0&&wt&64)?Hi(Ye,me,Me,!1,!0):(nt===gr&&wt&384||!Xe&&bt&16)&&Hi(rt,me,Me),$e&&xn(se)}(Wt&&(ni=gt&&gt.onVnodeUnmounted)||Nt)&&_r(()=>{ni&&No(ni,me,se),Nt&&Ya(se,null,me,"unmounted")},Me)},xn=se=>{const{type:me,el:Me,anchor:$e,transition:Xe}=se;if(me===gr){dn(Me,$e);return}if(me===cf){ft(se);return}const nt=()=>{x(Me),Xe&&!Xe.persisted&&Xe.afterLeave&&Xe.afterLeave()};if(se.shapeFlag&1&&Xe&&!Xe.persisted){const{leave:gt,delayLeave:lt}=Xe,rt=()=>gt(Me,nt);lt?lt(se.el,nt,rt):rt()}else nt()},dn=(se,me)=>{let Me;for(;se!==me;)Me=de(se),x(se),se=Me;x(me)},vn=(se,me,Me)=>{const{bum:$e,scope:Xe,update:nt,subTree:gt,um:lt}=se;$e&&x_($e),Xe.stop(),nt&&(nt.active=!1,Ki(gt,se,me,Me)),lt&&_r(lt,me),_r(()=>{se.isUnmounted=!0},me),me&&me.pendingBranch&&!me.isUnmounted&&se.asyncDep&&!se.asyncResolved&&se.suspenseId===me.pendingId&&(me.deps--,me.deps===0&&me.resolve())},Hi=(se,me,Me,$e=!1,Xe=!1,nt=0)=>{for(let gt=nt;gt<se.length;gt++)Ki(se[gt],me,Me,$e,Xe)},Yi=se=>se.shapeFlag&6?Yi(se.component.subTree):se.shapeFlag&128?se.suspense.next():de(se.anchor||se.el),pn=(se,me,Me)=>{se==null?me._vnode&&Ki(me._vnode,null,null,!0):Ie(me._vnode||null,se,me,null,null,null,Me),u0(),s1(),me._vnode=se},In={p:Ie,um:Ki,m:yn,r:xn,mt:hn,mc:At,pc:ei,pbc:It,n:Yi,o:s};let fn,ur;return a&&([fn,ur]=a(In)),{render:pn,hydrate:fn,createApp:jS(pn,fn)}}function Ja({effect:s,update:a},d){s.allowRecurse=a.allowRecurse=d}function S1(s,a,d=!1){const g=s.children,x=a.children;if(ii(g)&&ii(x))for(let E=0;E<g.length;E++){const I=g[E];let o=x[E];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=x[E]=na(x[E]),o.el=I.el),d||S1(I,o)),o.type===Uf&&(o.el=I.el)}}function GS(s){const a=s.slice(),d=[0];let g,x,E,I,o;const L=s.length;for(g=0;g<L;g++){const U=s[g];if(U!==0){if(x=d[d.length-1],s[x]<U){a[g]=x,d.push(g);continue}for(E=0,I=d.length-1;E<I;)o=E+I>>1,s[d[o]]<U?E=o+1:I=o;U<s[d[E]]&&(E>0&&(a[g]=d[E-1]),d[E]=g)}}for(E=d.length,I=d[E-1];E-- >0;)d[E]=I,I=a[I];return d}const qS=s=>s.__isTeleport,gr=Symbol(void 0),Uf=Symbol(void 0),Zr=Symbol(void 0),cf=Symbol(void 0),jh=[];let mo=null;function kn(s=!1){jh.push(mo=s?null:[])}function ZS(){jh.pop(),mo=jh[jh.length-1]||null}let Hh=1;function x0(s){Hh+=s}function C1(s){return s.dynamicChildren=Hh>0?mo||Lc:null,ZS(),Hh>0&&mo&&mo.push(s),s}function sr(s,a,d,g,x,E){return C1(Vt(s,a,d,g,x,E,!0))}function jg(s,a,d,g,x){return C1(Qn(s,a,d,g,x,!0))}function I1(s){return s?s.__v_isVNode===!0:!1}function nl(s,a){return s.type===a.type&&s.key===a.key}const jf="__vInternal",M1=({key:s})=>s??null,uf=({ref:s,ref_key:a,ref_for:d})=>s!=null?Cn(s)||Jn(s)||ci(s)?{i:ar,r:s,k:a,f:!!d}:s:null;function Vt(s,a=null,d=null,g=0,x=null,E=s===gr?0:1,I=!1,o=!1){const L={__v_isVNode:!0,__v_skip:!0,type:s,props:a,key:a&&M1(a),ref:a&&uf(a),scopeId:c1,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:g,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:ar};return o?(Vg(L,d),E&128&&s.normalize(L)):d&&(L.shapeFlag|=Cn(d)?8:16),Hh>0&&!I&&mo&&(L.patchFlag>0||E&6)&&L.patchFlag!==32&&mo.push(L),L}const Qn=WS;function WS(s,a=null,d=null,g=0,x=null,E=!1){if((!s||s===CS)&&(s=Zr),I1(s)){const o=la(s,a,!0);return d&&Vg(o,d),Hh>0&&!E&&mo&&(o.shapeFlag&6?mo[mo.indexOf(s)]=o:mo.push(o)),o.patchFlag|=-2,o}if(tC(s)&&(s=s.__vccOpts),a){a=HS(a);let{class:o,style:L}=a;o&&!Cn(o)&&(a.class=Dc(o)),sn(L)&&(Jb(L)&&!ii(L)&&(L=er({},L)),a.style=Tg(L))}const I=Cn(s)?1:hS(s)?128:qS(s)?64:sn(s)?4:ci(s)?2:0;return Vt(s,a,d,g,x,I,E,!0)}function HS(s){return s?Jb(s)||jf in s?er({},s):s:null}function la(s,a,d=!1){const{props:g,ref:x,patchFlag:E,children:I}=s,o=a?D1(g||{},a):g;return{__v_isVNode:!0,__v_skip:!0,type:s.type,props:o,key:o&&M1(o),ref:a&&a.ref?d&&x?ii(x)?x.concat(uf(a)):[x,uf(a)]:uf(a):x,scopeId:s.scopeId,slotScopeIds:s.slotScopeIds,children:I,target:s.target,targetAnchor:s.targetAnchor,staticCount:s.staticCount,shapeFlag:s.shapeFlag,patchFlag:a&&s.type!==gr?E===-1?16:E|16:E,dynamicProps:s.dynamicProps,dynamicChildren:s.dynamicChildren,appContext:s.appContext,dirs:s.dirs,transition:s.transition,component:s.component,suspense:s.suspense,ssContent:s.ssContent&&la(s.ssContent),ssFallback:s.ssFallback&&la(s.ssFallback),el:s.el,anchor:s.anchor,ctx:s.ctx}}function ul(s=" ",a=0){return Qn(Uf,null,s,a)}function P1(s,a){const d=Qn(cf,null,s);return d.staticCount=a,d}function Kp(s="",a=!1){return a?(kn(),jg(Zr,null,s)):Qn(Zr,null,s)}function jo(s){return s==null||typeof s=="boolean"?Qn(Zr):ii(s)?Qn(gr,null,s.slice()):typeof s=="object"?na(s):Qn(Uf,null,String(s))}function na(s){return s.el===null&&s.patchFlag!==-1||s.memo?s:la(s)}function Vg(s,a){let d=0;const{shapeFlag:g}=s;if(a==null)a=null;else if(ii(a))d=16;else if(typeof a=="object")if(g&65){const x=a.default;x&&(x._c&&(x._d=!1),Vg(s,x()),x._c&&(x._d=!0));return}else{d=32;const x=a._;!x&&!(jf in a)?a._ctx=ar:x===3&&ar&&(ar.slots._===1?a._=1:(a._=2,s.patchFlag|=1024))}else ci(a)?(a={default:a,_ctx:ar},d=32):(a=String(a),g&64?(d=16,a=[ul(a)]):d=8);s.children=a,s.shapeFlag|=d}function D1(...s){const a={};for(let d=0;d<s.length;d++){const g=s[d];for(const x in g)if(x==="class")a.class!==g.class&&(a.class=Dc([a.class,g.class]));else if(x==="style")a.style=Tg([a.style,g.style]);else if(Lf(x)){const E=a[x],I=g[x];I&&E!==I&&!(ii(E)&&E.includes(I))&&(a[x]=E?[].concat(E,I):I)}else x!==""&&(a[x]=g[x])}return a}function No(s,a,d,g=null){qr(s,a,7,[d,g])}const XS=A1();let KS=0;function YS(s,a,d){const g=s.type,x=(a?a.appContext:s.appContext)||XS,E={uid:KS++,vnode:s,type:g,parent:a,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new bA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:b1(g,x),emitsOptions:l1(g,x),emit:null,emitted:null,propsDefaults:en,inheritAttrs:g.inheritAttrs,ctx:en,data:en,props:en,attrs:en,slots:en,refs:en,setupState:en,setupContext:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=a?a.root:E,E.emit=sS.bind(null,E),s.ce&&s.ce(E),E}let jn=null;const L1=()=>jn||ar,Uc=s=>{jn=s,s.scope.on()},ll=()=>{jn&&jn.scope.off(),jn=null};function z1(s){return s.vnode.shapeFlag&4}let Xh=!1;function JS(s,a=!1){Xh=a;const{props:d,children:g}=s.vnode,x=z1(s);OS(s,d,x,a),FS(s,g);const E=x?QS(s,a):void 0;return Xh=!1,E}function QS(s,a){const d=s.type;s.accessCache=Object.create(null),s.proxy=Qb(new Proxy(s.ctx,MS));const{setup:g}=d;if(g){const x=s.setupContext=g.length>1?O1(s):null;Uc(s),Yc();const E=oa(g,s,0,[s.props,x]);if(Jc(),ll(),Rb(E)){if(E.then(ll,ll),a)return E.then(I=>{b0(s,I,a)}).catch(I=>{Rf(I,s,0)});s.asyncDep=E}else b0(s,E,a)}else k1(s,a)}function b0(s,a,d){ci(a)?s.type.__ssrInlineRender?s.ssrRender=a:s.render=a:sn(a)&&(s.setupState=i1(a)),k1(s,d)}let w0;function k1(s,a,d){const g=s.type;if(!s.render){if(!a&&w0&&!g.render){const x=g.template||Ng(s).template;if(x){const{isCustomElement:E,compilerOptions:I}=s.appContext.config,{delimiters:o,compilerOptions:L}=g,U=er(er({isCustomElement:E,delimiters:o},I),L);g.render=w0(x,U)}}s.render=g.render||go}Uc(s),Yc(),PS(s),Jc(),ll()}function eC(s){return new Proxy(s.attrs,{get(a,d){return Ir(s,"get","$attrs"),a[d]}})}function O1(s){const a=g=>{s.exposed=g||{}};let d;return{get attrs(){return d||(d=eC(s))},slots:s.slots,emit:s.emit,expose:a}}function $g(s){if(s.exposed)return s.exposeProxy||(s.exposeProxy=new Proxy(i1(Qb(s.exposed)),{get(a,d){if(d in a)return a[d];if(d in Uh)return Uh[d](s)},has(a,d){return d in a||d in Uh}}))}function tC(s){return ci(s)&&"__vccOpts"in s}const ps=(s,a)=>QA(s,a,Xh);function iC(){return nC().attrs}function nC(){const s=L1();return s.setupContext||(s.setupContext=O1(s))}const rC=Symbol(""),oC=()=>Fh(rC),sC="3.2.45",aC="http://www.w3.org/2000/svg",rl=typeof document<"u"?document:null,E0=rl&&rl.createElement("template"),lC={insert:(s,a,d)=>{a.insertBefore(s,d||null)},remove:s=>{const a=s.parentNode;a&&a.removeChild(s)},createElement:(s,a,d,g)=>{const x=a?rl.createElementNS(aC,s):rl.createElement(s,d?{is:d}:void 0);return s==="select"&&g&&g.multiple!=null&&x.setAttribute("multiple",g.multiple),x},createText:s=>rl.createTextNode(s),createComment:s=>rl.createComment(s),setText:(s,a)=>{s.nodeValue=a},setElementText:(s,a)=>{s.textContent=a},parentNode:s=>s.parentNode,nextSibling:s=>s.nextSibling,querySelector:s=>rl.querySelector(s),setScopeId(s,a){s.setAttribute(a,"")},insertStaticContent(s,a,d,g,x,E){const I=d?d.previousSibling:a.lastChild;if(x&&(x===E||x.nextSibling))for(;a.insertBefore(x.cloneNode(!0),d),!(x===E||!(x=x.nextSibling)););else{E0.innerHTML=g?`<svg>${s}</svg>`:s;const o=E0.content;if(g){const L=o.firstChild;for(;L.firstChild;)o.appendChild(L.firstChild);o.removeChild(L)}a.insertBefore(o,d)}return[I?I.nextSibling:a.firstChild,d?d.previousSibling:a.lastChild]}};function cC(s,a,d){const g=s._vtc;g&&(a=(a?[a,...g]:[...g]).join(" ")),a==null?s.removeAttribute("class"):d?s.setAttribute("class",a):s.className=a}function uC(s,a,d){const g=s.style,x=Cn(d);if(d&&!x){for(const E in d)ag(g,E,d[E]);if(a&&!Cn(a))for(const E in a)d[E]==null&&ag(g,E,"")}else{const E=g.display;x?a!==d&&(g.cssText=d):a&&s.removeAttribute("style"),"_vod"in s&&(g.display=E)}}const T0=/\s*!important$/;function ag(s,a,d){if(ii(d))d.forEach(g=>ag(s,a,g));else if(d==null&&(d=""),a.startsWith("--"))s.setProperty(a,d);else{const g=hC(s,a);T0.test(d)?s.setProperty(Kc(g),d.replace(T0,""),"important"):s[g]=d}}const A0=["Webkit","Moz","ms"],T_={};function hC(s,a){const d=T_[a];if(d)return d;let g=Fc(a);if(g!=="filter"&&g in s)return T_[a]=g;g=Nb(g);for(let x=0;x<A0.length;x++){const E=A0[x]+g;if(E in s)return T_[a]=E}return a}const S0="http://www.w3.org/1999/xlink";function dC(s,a,d,g,x){if(g&&a.startsWith("xlink:"))d==null?s.removeAttributeNS(S0,a.slice(6,a.length)):s.setAttributeNS(S0,a,d);else{const E=pA(a);d==null||E&&!zb(d)?s.removeAttribute(a):s.setAttribute(a,E?"":d)}}function pC(s,a,d,g,x,E,I){if(a==="innerHTML"||a==="textContent"){g&&I(g,x,E),s[a]=d??"";return}if(a==="value"&&s.tagName!=="PROGRESS"&&!s.tagName.includes("-")){s._value=d;const L=d??"";(s.value!==L||s.tagName==="OPTION")&&(s.value=L),d==null&&s.removeAttribute(a);return}let o=!1;if(d===""||d==null){const L=typeof s[a];L==="boolean"?d=zb(d):d==null&&L==="string"?(d="",o=!0):L==="number"&&(d=0,o=!0)}try{s[a]=d}catch{}o&&s.removeAttribute(a)}function fC(s,a,d,g){s.addEventListener(a,d,g)}function mC(s,a,d,g){s.removeEventListener(a,d,g)}function _C(s,a,d,g,x=null){const E=s._vei||(s._vei={}),I=E[a];if(g&&I)I.value=g;else{const[o,L]=gC(a);if(g){const U=E[a]=xC(g,x);fC(s,o,U,L)}else I&&(mC(s,o,I,L),E[a]=void 0)}}const C0=/(?:Once|Passive|Capture)$/;function gC(s){let a;if(C0.test(s)){a={};let g;for(;g=s.match(C0);)s=s.slice(0,s.length-g[0].length),a[g[0].toLowerCase()]=!0}return[s[2]===":"?s.slice(3):Kc(s.slice(2)),a]}let A_=0;const yC=Promise.resolve(),vC=()=>A_||(yC.then(()=>A_=0),A_=Date.now());function xC(s,a){const d=g=>{if(!g._vts)g._vts=Date.now();else if(g._vts<=d.attached)return;qr(bC(g,d.value),a,5,[g])};return d.value=s,d.attached=vC(),d}function bC(s,a){if(ii(a)){const d=s.stopImmediatePropagation;return s.stopImmediatePropagation=()=>{d.call(s),s._stopped=!0},a.map(g=>x=>!x._stopped&&g&&g(x))}else return a}const I0=/^on[a-z]/,wC=(s,a,d,g,x=!1,E,I,o,L)=>{a==="class"?cC(s,g,x):a==="style"?uC(s,d,g):Lf(a)?Ag(a)||_C(s,a,d,g,I):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):EC(s,a,g,x))?pC(s,a,g,E,I,o,L):(a==="true-value"?s._trueValue=g:a==="false-value"&&(s._falseValue=g),dC(s,a,g,x))};function EC(s,a,d,g){return g?!!(a==="innerHTML"||a==="textContent"||a in s&&I0.test(a)&&ci(d)):a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&s.tagName==="INPUT"||a==="type"&&s.tagName==="TEXTAREA"||I0.test(a)&&Cn(d)?!1:a in s}const TC={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};_S.props;const AC=er({patchProp:wC},lC);let M0;function SC(){return M0||(M0=VS(AC))}const CC=(...s)=>{const a=SC().createApp(...s),{mount:d}=a;return a.mount=g=>{const x=IC(g);if(!x)return;const E=a._component;!ci(E)&&!E.render&&!E.template&&(E.template=x.innerHTML),x.innerHTML="";const I=d(x,!1,x instanceof SVGElement);return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),I},a};function IC(s){return Cn(s)?document.querySelector(s):s}var _o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MC(s){if(s.__esModule)return s;var a=s.default;if(typeof a=="function"){var d=function g(){if(this instanceof g){var x=[null];x.push.apply(x,arguments);var E=Function.bind.apply(a,x);return new E}return a.apply(this,arguments)};d.prototype=a.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(s).forEach(function(g){var x=Object.getOwnPropertyDescriptor(s,g);Object.defineProperty(d,g,x.get?x:{enumerable:!0,get:function(){return s[g]}})}),d}var lg={},PC={get exports(){return lg},set exports(s){lg=s}};(function(s,a){(function(d,g){s.exports=g()})(_o,function(){var d,g,x;function E(o,L){if(!d)d=L;else if(!g)g=L;else{var U="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",G={};d(G),x=L(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}E(["exports"],function(o){var L=typeof self<"u"?self:{},U="2.11.1";let G;const J={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(G==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{G={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{G=t}}return G},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},de={supported:!1,testSupport:function(t){!Ie&&ge&&(Ne?et(t):xe=t)}};let xe,ge,Ie=!1,Ne=!1;function et(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ge),t.isContextLost())return;de.supported=!0}catch{}t.deleteTexture(e),Ie=!0}L.document&&(ge=L.document.createElement("img"),ge.onload=function(){xe&&et(xe),xe=null,Ne=!0},ge.onerror=function(){Ie=!0,xe=null},ge.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ut="01";var Ve=ft;function ft(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}ft.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var c=this.sampleCurveX(i)-t;if(Math.abs(c)<e)return i;var h=this.sampleCurveDerivativeX(i);if(Math.abs(h)<1e-6)break;i-=c/h}var f=0,_=1;for(i=t,r=0;r<20&&(c=this.sampleCurveX(i),!(Math.abs(c-t)<e));r++)t>c?f=i:_=i,i=.5*(_-f)+f;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ce=xt;function xt(t,e){this.x=t,this.y=e}xt.prototype={clone:function(){return new xt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),c=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xt.convert=function(t){return t instanceof xt?t:Array.isArray(t)?new xt(t[0],t[1]):t};const Gt=Math.PI/180,At=180/Math.PI;function _t(t){return t*Gt}function It(t){return t*At}const mi=[[0,0],[1,0],[1,1],[0,1]];function Bi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function bi(t,e,i,r){const c=new Ve(t,e,i,r);return function(h){return c.solve(h)}}const hn=bi(.25,.1,.25,1);function Ft(t,e,i){return Math.min(i,Math.max(e,t))}function ui(t,e,i){return(i=Ft((i-t)/(e-t),0,1))*i*(3-2*i)}function Jt(t,e,i){const r=i-e,c=((t-e)%r+r)%r+e;return c===e?i:c}function ei(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const c=new Array(t.length);let h=null;t.forEach((f,_)=>{e(f,(v,b)=>{v&&(h=v),c[_]=b,--r==0&&i(h,c)})})}function Wi(t){const e=[];for(const i in t)e.push(t[i]);return e}function gi(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let yn=1;function Ki(){return yn++}function xn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function vn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Hi(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Yi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function pn(t,e,i){const r={};for(const c in t)r[c]=e.call(i||this,t[c],c,t);return r}function In(t,e,i){const r={};for(const c in t)e.call(i||this,t[c],c,t)&&(r[c]=t[c]);return r}function fn(t){return Array.isArray(t)?t.map(fn):typeof t=="object"&&t?pn(t,fn):t}const ur={};function se(t){ur[t]||(typeof console<"u"&&console.warn(t),ur[t]=!0)}function me(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Me(t){let e=0;for(let i,r,c=0,h=t.length,f=h-1;c<h;f=c++)i=t[c],r=t[f],e+=(r.x-i.x)*(i.y+r.y);return e}function $e(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xe(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,c,h)=>{const f=c||h;return e[r]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let nt=null;function gt(t){if(nt==null){const e=t.navigator?t.navigator.userAgent:null;nt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return nt}function lt(t){try{const e=L[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function rt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Ye="mapbox-tiles";let bt,wt,Ct=500,Nt=50;function Wt(){try{return L.caches}catch{}}function ni(){Wt()&&!bt&&(bt=L.caches.open(Ye))}function si(t){const e=t.indexOf("?");if(e<0)return t;const i=function(c){const h=c.indexOf("?");return h>0?c.slice(h+1).split("&"):[]}(t),r=i.filter(c=>{const h=c.split("=");return h[0]==="language"||h[0]==="worldview"});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let Fi=1/0;const $i={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze($i);class hr extends Error{constructor(e,i,r){i===401&&Ss(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yr=$e()?()=>self.worker&&self.worker.referrer:()=>(L.location.protocol==="blob:"?L.parent:L).location.href,Vn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Yr())&&!/^\w+:/.test(i))){if(L.fetch&&L.Request&&L.AbortController&&L.Request.prototype.hasOwnProperty("signal"))return function(r,c){const h=new L.AbortController,f=new L.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Yr(),signal:h.signal});let _=!1,v=!1;const b=(T=f.url).indexOf("sku=")>0&&Ss(T);var T;r.type==="json"&&f.headers.set("Accept","application/json");const C=(z,k,B)=>{if(v)return;if(z&&z.message!=="SecurityError"&&se(z),k&&B)return M(k);const j=Date.now();L.fetch(f).then(ee=>{if(ee.ok){const le=b?ee.clone():null;return M(ee,le,j)}return c(new hr(ee.statusText,ee.status,r.url))}).catch(ee=>{ee.code!==20&&c(new Error(ee.message))})},M=(z,k,B)=>{(r.type==="arrayBuffer"?z.arrayBuffer():r.type==="json"?z.json():z.text()).then(j=>{v||(k&&B&&function(ee,le,Q){if(ni(),!bt)return;const ne={status:le.status,statusText:le.statusText,headers:new L.Headers};le.headers.forEach((Se,Te)=>ne.headers.set(Te,Se));const he=Xe(le.headers.get("Cache-Control")||"");if(he["no-store"])return;he["max-age"]&&ne.headers.set("Expires",new Date(Q+1e3*he["max-age"]).toUTCString());const re=ne.headers.get("Expires");re&&(new Date(re).getTime()-Q<42e4||function(Se,Te){if(wt===void 0)try{new Response(new ReadableStream),wt=!0}catch{wt=!1}wt?Te(Se.body):Se.blob().then(Te)}(le,Se=>{const Te=new L.Response(Se,ne);ni(),bt&&bt.then(ke=>ke.put(si(ee.url),Te)).catch(ke=>se(ke.message))}))}(f,k,B),_=!0,c(null,j,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(j=>{v||c(new Error(j.message))})};return b?function(z,k){if(ni(),!bt)return k(null);const B=si(z.url);bt.then(j=>{j.match(B).then(ee=>{const le=function(Q){if(!Q)return!1;const ne=new Date(Q.headers.get("Expires")||0),he=Xe(Q.headers.get("Cache-Control")||"");return ne>Date.now()&&!he["no-cache"]}(ee);j.delete(B),le&&j.put(B,ee.clone()),k(null,ee,le)}).catch(k)}).catch(k)}(f,C):C(null,null),{cancel:()=>{v=!0,_||h.abort()}}}(t,e);if($e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,c){const h=new L.XMLHttpRequest;h.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const f in r.headers)h.setRequestHeader(f,r.headers[f]);return r.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=r.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let f=h.response;if(r.type==="json")try{f=JSON.parse(h.response)}catch(_){return c(_)}c(null,f,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new hr(h.statusText,h.status,r.url))},h.send(r.body),{cancel:()=>h.abort()}}(t,e)},vr=function(t,e){return Vn(gi(t,{type:"arrayBuffer"}),e)};function mn(t){const e=L.document.createElement("a");return e.href=t,e.protocol===L.document.location.protocol&&e.host===L.document.location.host}const Rn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Jr,xo;Jr=[],xo=0;const Ts=function(t,e){if(de.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),xo>=J.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Jr.push(h),h}xo++;let i=!1;const r=()=>{if(!i)for(i=!0,xo--;Jr.length&&xo<J.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Jr.shift(),{requestParameters:f,callback:_,cancelled:v}=h;v||(h.cancel=Ts(f,_).cancel)}},c=vr(t,(h,f,_,v)=>{r(),h?e(h):f&&(L.createImageBitmap?function(b,T){const C=new L.Blob([new Uint8Array(b)],{type:"image/png"});L.createImageBitmap(C).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,T)=>e(b,T,_,v)):function(b,T){const C=new L.Image,M=L.URL;C.onload=()=>{T(null,C),M.revokeObjectURL(C.src),C.onload=null,L.requestAnimationFrame(()=>{C.src=Rn})},C.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new L.Blob([new Uint8Array(b)],{type:"image/png"});C.src=b.byteLength?M.createObjectURL(z):Rn}(f,(b,T)=>e(b,T,_,v)))});return{cancel:()=>{c.cancel(),r()}}},As="NO_ACCESS_TOKEN";function xr(t){return t.indexOf("mapbox:")===0}function Ss(t){return J.API_URL_REGEX.test(t)}function gl(t){return J.API_STYLE_REGEX.test(t)&&!Cs(t)}function Cs(t){return J.API_SPRITE_REGEX.test(t)}const Is=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $n(t){const e=t.match(Is);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Wo(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ga(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(L.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ho{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ga(J.ACCESS_TOKEN);let r="";return r=i&&i.u?L.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(Number("0x"+h)))):J.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=lt("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const c=L.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const h=L.localStorage.getItem(r);h&&(this.anonId=h)}catch{se("Unable to read from LocalStorage")}}saveEventData(){const e=lt("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{L.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&L.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{se("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,c){if(!J.EVENTS_URL)return;const h=$n(J.EVENTS_URL);h.params.push(`access_token=${c||J.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},_=i?gi(f,i):f,v={url:Wo(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return Vn(gi(b,{method:"POST"}),T)}(v,b=>{this.pendingRequest=null,r(b),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Y=new class extends Ho{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){J.EVENTS_URL&&J.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>xr(i)||Ss(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ga(J.ACCESS_TOKEN),i=e?e.u:J.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;vn(this.anonId)||(this.anonId=xn(),r=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),f=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;r=r||_>=1||_<-1||h.getDate()!==f.getDate()}else r=!0;r?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:ut,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},t):this.processRequests()}},O=Y.postTurnstileEvent.bind(Y),F=new class extends Ho{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,J.EVENTS_URL&&(i||J.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(As)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),vn(this.anonId)||(this.anonId=xn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:ut,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},X=F.postMapLoadEvent.bind(F),ie=new class extends Ho{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){J.EVENTS_URL&&(t||J.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(c){const h=L.performance.getEntriesByType("resource"),f=L.performance.getEntriesByType("mark"),_=function(M){const z={};if(M){for(const k in M)if(k!=="other")for(const B of M[k]){const j=`${k}RequestCount`,ee=`${k}ResolveRangeMin`,le=`${k}ResolveRangeMax`;z[ee]=Math.min(z[ee]||1/0,B.startTime),z[le]=Math.max(z[le]||-1/0,B.responseEnd),z[j]===void 0&&(z[j]=0),++z[j]}}return z}(function(M,z){const k={};if(M)for(const B of M){const j=z(B);k[j]===void 0&&(k[j]=[]),k[j].push(B)}return k}(h,dt)),v=L.devicePixelRatio,b=L.navigator.connection||L.navigator.mozConnection||L.navigator.webkitConnection,T={counters:[],metadata:[],attributes:[]},C=(M,z,k)=>{k!=null&&M.push({name:z,value:k.toString()})};for(const M in _)C(T.counters,M,_[M]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(C(T.counters,"interactionRangeMin",c.interactionRange[0]),C(T.counters,"interactionRangeMax",c.interactionRange[1])),f)for(const M of Object.keys(Ee)){const z=Ee[M],k=f.find(B=>B.name===z);k&&C(T.counters,z,k.startTime)}return C(T.counters,"visibilityHidden",c.visibilityHidden),C(T.attributes,"style",function(M){if(M)for(const z of M){const k=z.name.split("?")[0];if(gl(k)){const B=k.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),C(T.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),C(T.attributes,"fogEnabled",c.fogEnabled?"true":"false"),C(T.attributes,"projection",c.projection.name),C(T.attributes,"zoom",c.zoom),C(T.metadata,"devicePixelRatio",v),C(T.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),C(T.metadata,"navigatorUserAgent",L.navigator.userAgent),C(T.metadata,"screenWidth",L.screen.width),C(T.metadata,"screenHeight",L.screen.height),C(T.metadata,"windowWidth",L.innerWidth),C(T.metadata,"windowHeight",L.innerHeight),C(T.metadata,"mapWidth",c.width/v),C(T.metadata,"mapHeight",c.height/v),C(T.metadata,"webglRenderer",c.renderer),C(T.metadata,"webglVendor",c.vendor),C(T.metadata,"sdkVersion",U),C(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(i);for(const c of r.metadata);for(const c of r.counters);for(const c of r.attributes);this.postEvent(e,r,()=>{},t)}},ue=ie.postPerformanceEvent.bind(ie),ve=new class extends Ho{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!J.API_URL||!J.SESSION_PATH)return;const c=$n(J.API_URL+J.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${r||J.ACCESS_TOKEN||""}`);const h={url:Wo(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return Vn(gi(f,{method:"GET"}),_)}(h,f=>{this.pendingRequest=null,i(f),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,J.SESSION_PATH&&J.API_URL&&(i||J.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(As)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},ye=ve.getSessionAPI.bind(ve),pe=new Set,Ee={create:"create",load:"load",fullLoad:"fullLoad"},Ue={mark(t){L.performance.mark(t)},measure(t,e,i){L.performance.measure(t,e,i)}};function dt(t){const e=t.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":function(i){return J.API_FONTS_REGEX.test(i)}(e)?"fontRange":Cs(e)?"sprite":gl(e)?"style":function(i){return J.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const qe=L.performance;function Mt(t){const e=t?t.url.toString():void 0;return qe.getEntriesByName(e)}let St,Tt,Ot,Ht;const hi={now:()=>Ot!==void 0?Ot:L.performance.now(),setNow(t){Ot=t},restoreNow(){Ot=void 0},frame(t){const e=L.requestAnimationFrame(t);return{cancel:()=>L.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;Ht||(Ht=L.document.createElement("canvas"));const c=Ht.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(i>Ht.width||r>Ht.height)&&(Ht.width=i,Ht.height=r),c.clearRect(-e,-e,i+2*e,r+2*e),c.drawImage(t,0,0,i,r),c.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(St||(St=L.document.createElement("a")),St.href=t,St.href),get devicePixelRatio(){return L.devicePixelRatio},get prefersReducedMotion(){return!!L.matchMedia&&(Tt==null&&(Tt=L.matchMedia("(prefers-reduced-motion: reduce)")),Tt.matches)}};function Lt(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function wi(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class Ei{constructor(e,i={}){gi(this,i),this.type=e}}class bo extends Ei{constructor(e,i={}){super("error",gi({error:e},i))}}class Qr{on(e,i){return this._listeners=this._listeners||{},Lt(e,i,this._listeners),this}off(e,i){return wi(e,i,this._listeners),wi(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Lt(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new Ei(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const c=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const _ of c)_.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const _ of h)wi(r,_,this._oneTimeListeners),_.call(this,e);const f=this._eventedParent;f&&(gi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof bo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function eo(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function tn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function wo(t){if(Array.isArray(t))return t.map(wo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=wo(t[i]);return e}return tn(t)}class ad extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Dr=ad;class Ms{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,c]of i)this.bindings[r]=c}concat(e){return new Ms(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ld=Ms;const Ps={kind:"null"},ct={kind:"number"},Xt={kind:"string"},Kt={kind:"boolean"},Lr={kind:"color"},Ds={kind:"object"},Yt={kind:"value"},ya={kind:"collator"},Ls={kind:"formatted"},zs={kind:"resolvedImage"};function ir(t,e){return{kind:"array",itemType:t,N:e}}function Ni(t){if(t.kind==="array"){const e=Ni(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const nm=[Ps,ct,Xt,Kt,Lr,Ls,Ds,ir(Yt),zs];function br(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!br(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of nm)if(!br(i,e))return null}}return`Expected ${Ni(t)} but found ${Ni(e)} instead.`}function yl(t,e){return e.some(i=>i.kind===t.kind)}function Gn(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var ou,vl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xl(t){return(t=Math.round(t))<0?0:t>255?255:t}function va(t){return xl(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function xa(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Xo(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{ou={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in vl)return vl[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),c=i.indexOf(")");if(r!==-1&&c+1===i.length){var h=i.substr(0,r),f=i.substr(r+1,c-(r+1)).split(","),_=1;switch(h){case"rgba":if(f.length!==4)return null;_=xa(f.pop());case"rgb":return f.length!==3?null:[va(f[0]),va(f[1]),va(f[2]),_];case"hsla":if(f.length!==4)return null;_=xa(f.pop());case"hsl":if(f.length!==3)return null;var v=(parseFloat(f[0])%360+360)%360/360,b=xa(f[1]),T=xa(f[2]),C=T<=.5?T*(b+1):T+b-T*b,M=2*T-C;return[xl(255*Xo(M,C,v+1/3)),xl(255*Xo(M,C,v)),xl(255*Xo(M,C,v-1/3)),_];default:return null}}return null}}catch{}class Mn{constructor(e,i,r,c=1){this.r=e,this.g=i,this.b=r,this.a=c}static parse(e){if(!e)return;if(e instanceof Mn)return e;if(typeof e!="string")return;const i=ou(e);return i?new Mn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${c})`}toArray(){const{r:e,g:i,b:r,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*r/c,c]}toArray01(){const{r:e,g:i,b:r,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,r/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:c}=this;return[e,i,r,c]}}Mn.black=new Mn(0,0,0,1),Mn.white=new Mn(1,1,1,1),Mn.transparent=new Mn(0,0,0,0),Mn.red=new Mn(1,0,0,1),Mn.blue=new Mn(0,0,1,1);var Ji=Mn;class su{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class au{constructor(e,i,r,c,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=c,this.textColor=h}}class Bn{constructor(e){this.sections=e}static fromString(e){return new Bn([new au(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Bn?e:Bn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class qn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new qn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function cd(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ji||t instanceof su||t instanceof Bn||t instanceof qn)return!0;if(Array.isArray(t)){for(const e of t)if(!Ko(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ko(t[e]))return!1;return!0}return!1}function an(t){if(t===null)return Ps;if(typeof t=="string")return Xt;if(typeof t=="boolean")return Kt;if(typeof t=="number")return ct;if(t instanceof Ji)return Lr;if(t instanceof su)return ya;if(t instanceof Bn)return Ls;if(t instanceof qn)return zs;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const c=an(r);if(i){if(i===c)continue;i=Yt;break}i=c}return ir(i||Yt,e)}return Ds}function ba(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ji||t instanceof Bn||t instanceof qn?t.toString():JSON.stringify(t)}class lu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ko(e[1]))return i.error("invalid value");const r=e[1];let c=an(r);const h=i.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new lu(c,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ji?["rgba"].concat(this.value.toArray()):this.value instanceof Bn?this.value.serialize():this.value}}var wa=lu,bn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const cu={string:Xt,number:ct,boolean:Kt,object:Ds};class uu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,c=1;const h=e[0];if(h==="array"){let _,v;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in cu)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=cu[b],c++}else _=Yt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);v=e[2],c++}r=ir(_,v)}else r=cu[h];const f=[];for(;c<e.length;c++){const _=i.parse(e[c],c,Yt);if(!_)return null;f.push(_)}return new uu(r,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!br(this.type,an(r)))return r;if(i===this.args.length-1)throw new bn(`Expected value to be of type ${Ni(this.type)}, but found ${Ni(an(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(r=>r.serialize()))}}var zr=uu;class Eo{constructor(e){this.type=Ls,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const c=[];let h=!1;for(let f=1;f<=e.length-1;++f){const _=e[f];if(h&&typeof _=="object"&&!Array.isArray(_)){h=!1;let v=null;if(_["font-scale"]&&(v=i.parse(_["font-scale"],1,ct),!v))return null;let b=null;if(_["text-font"]&&(b=i.parse(_["text-font"],1,ir(Xt)),!b))return null;let T=null;if(_["text-color"]&&(T=i.parse(_["text-color"],1,Lr),!T))return null;const C=c[c.length-1];C.scale=v,C.font=b,C.textColor=T}else{const v=i.parse(e[f],1,Yt);if(!v)return null;const b=v.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:v,scale:null,font:null,textColor:null})}}return new Eo(c)}evaluate(e){return new Bn(this.sections.map(i=>{const r=i.content.evaluate(e);return an(r)===zs?new au("",r,null,null,null):new au(ba(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class bl{constructor(e){this.type=zs,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Xt);return r?new bl(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=qn.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const rm={"to-boolean":Kt,"to-color":Lr,"to-number":ct,"to-string":Xt};class hu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=rm[r],h=[];for(let f=1;f<e.length;f++){const _=i.parse(e[f],f,Yt);if(!_)return null;h.push(_)}return new hu(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,r;for(const c of this.args){if(i=c.evaluate(e),r=null,i instanceof Ji)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:cd(i[0],i[1],i[2],i[3]),!r))return new Ji(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new bn(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new bn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Bn.fromString(ba(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qn.fromString(ba(this.args[0].evaluate(e))):ba(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Eo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new bl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ks=hu;const om=["Unknown","Point","LineString","Polygon"];var ud=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?om[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Ji.parse(t)),e}};class Yo{constructor(e,i,r,c){this.name=e,this.type=i,this._evaluate=r,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],c=Yo.definitions[r];if(!c)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=f.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let v=null;for(const[b,T]of _){v=new vu(i.registry,i.path,null,i.scope);const C=[];let M=!1;for(let z=1;z<e.length;z++){const k=e[z],B=Array.isArray(b)?b[z-1]:b.type,j=v.parse(k,1+C.length,B);if(!j){M=!0;break}C.push(j)}if(!M)if(Array.isArray(b)&&b.length!==C.length)v.error(`Expected ${b.length} arguments, but found ${C.length} instead.`);else{for(let z=0;z<C.length;z++){const k=Array.isArray(b)?b[z]:b.type,B=C[z];v.concat(z+1).checkSubtype(k,B.type)}if(v.errors.length===0)return new Yo(r,h,T,C)}}if(_.length===1)i.errors.push(...v.errors);else{const b=(_.length?_:f).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Ni).join(", ")})`:`(${Ni(M.type)}...)`;var M}).join(" | "),T=[];for(let C=1;C<e.length;C++){const M=i.parse(e[C],1+T.length);if(!M)return null;T.push(Ni(M.type))}i.error(`Expected arguments of type ${b}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){Yo.definitions=i;for(const r in i)e[r]=Yo}}var wr=Yo;class wl{constructor(e,i,r){this.type=ya,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const c=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Kt);if(!c)return null;const h=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Kt);if(!h)return null;let f=null;return r.locale&&(f=i.parse(r.locale,1,Xt),!f)?null:new wl(c,h,f)}evaluate(e){return new su(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const To=8192;function du(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function El(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function kr(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*To),Math.round(r*c*To)]}function hd(t,e,i){const r=t[0]-e[0],c=t[1]-e[1],h=t[0]-i[0],f=t[1]-i[1];return r*f-h*c==0&&r*h<=0&&c*f<=0}function Tl(t,e){let i=!1;for(let f=0,_=e.length;f<_;f++){const v=e[f];for(let b=0,T=v.length;b<T-1;b++){if(hd(t,v[b],v[b+1]))return!1;(c=v[b])[1]>(r=t)[1]!=(h=v[b+1])[1]>r[1]&&r[0]<(h[0]-c[0])*(r[1]-c[1])/(h[1]-c[1])+c[0]&&(i=!i)}}var r,c,h;return i}function dd(t,e){for(let i=0;i<e.length;i++)if(Tl(t,e[i]))return!0;return!1}function pu(t,e,i,r){const c=r[0]-i[0],h=r[1]-i[1],f=(t[0]-i[0])*h-c*(t[1]-i[1]),_=(e[0]-i[0])*h-c*(e[1]-i[1]);return f>0&&_<0||f<0&&_>0}function pd(t,e,i){for(const b of i)for(let T=0;T<b.length-1;++T)if((_=[(f=b[T+1])[0]-(h=b[T])[0],f[1]-h[1]])[0]*(v=[(c=e)[0]-(r=t)[0],c[1]-r[1]])[1]-_[1]*v[0]!=0&&pu(r,c,h,f)&&pu(h,f,r,c))return!0;var r,c,h,f,_,v;return!1}function fu(t,e){for(let i=0;i<t.length;++i)if(!Tl(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(pd(t[i],t[i+1],e))return!1;return!0}function mu(t,e){for(let i=0;i<e.length;i++)if(fu(t,e[i]))return!0;return!1}function Jo(t,e,i){const r=[];for(let c=0;c<t.length;c++){const h=[];for(let f=0;f<t[c].length;f++){const _=kr(t[c][f],i);du(e,_),h.push(_)}r.push(h)}return r}function _u(t,e,i){const r=[];for(let c=0;c<t.length;c++){const h=Jo(t[c],e,i);r.push(h)}return r}function gu(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const c=.5*r;let h=t[0]-i[0]>c?-r:i[0]-t[0]>c?r:0;h===0&&(h=t[0]-i[2]>c?-r:i[2]-t[0]>c?r:0),t[0]+=h}du(e,t)}function Al(t,e,i,r){const c=Math.pow(2,r.z)*To,h=[r.x*To,r.y*To],f=[];if(!t)return f;for(const _ of t)for(const v of _){const b=[v.x+h[0],v.y+h[1]];gu(b,e,i,c),f.push(b)}return f}function yu(t,e,i,r){const c=Math.pow(2,r.z)*To,h=[r.x*To,r.y*To],f=[];if(!t)return f;for(const v of t){const b=[];for(const T of v){const C=[T.x+h[0],T.y+h[1]];du(e,C),b.push(C)}f.push(b)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const v of f)for(const b of v)gu(b,e,i,c)}var _;return f}class Or{constructor(e,i){this.type=Kt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ko(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let c=0;c<r.features.length;++c){const h=r.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Or(r,r.features[c].geometry)}else if(r.type==="Feature"){const c=r.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Or(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Or(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(r.type==="Polygon"){const _=Jo(r.coordinates,h,f),v=Al(i.geometry(),c,h,f);if(!El(c,h))return!1;for(const b of v)if(!Tl(b,_))return!1}if(r.type==="MultiPolygon"){const _=_u(r.coordinates,h,f),v=Al(i.geometry(),c,h,f);if(!El(c,h))return!1;for(const b of v)if(!dd(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(r.type==="Polygon"){const _=Jo(r.coordinates,h,f),v=yu(i.geometry(),c,h,f);if(!El(c,h))return!1;for(const b of v)if(!fu(b,_))return!1}if(r.type==="MultiPolygon"){const _=_u(r.coordinates,h,f),v=yu(i.geometry(),c,h,f);if(!El(c,h))return!1;for(const b of v)if(!mu(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var di=Or;function Ea(t){if(t instanceof wr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof di)return!1;let e=!0;return t.eachChild(i=>{e&&!Ea(i)&&(e=!1)}),e}function Sl(t){if(t instanceof wr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Sl(i)&&(e=!1)}),e}function Cl(t,e){if(t instanceof wr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!Cl(r,e)&&(i=!1)}),i}class Il{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new Il(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var fd=Il;class Ml{constructor(e,i=[],r,c=new ld,h=[]){this.registry=e,this.path=i,this.key=i.map(f=>`[${f}]`).join(""),this.scope=c,this.errors=h,this.expectedType=r}parse(e,i,r,c,h={}){return i?this.concat(i,r,c)._parse(e,h):this._parse(e,h)}_parse(e,i){function r(c,h,f){return f==="assert"?new zr(h,[c]):f==="coerce"?new ks(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let f=h.parse(e,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,v=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else f=r(f,_,i.typeAnnotation||"coerce");else f=r(f,_,i.typeAnnotation||"assert")}if(!(f instanceof wa)&&f.type.kind!=="resolvedImage"&&Pl(f)){const _=new ud;try{f=new wa(f.type,f.evaluate(_))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const c=typeof e=="number"?this.path.concat(e):this.path,h=r?this.scope.concat(r):this.scope;return new Ml(this.registry,c,i||null,h,this.errors)}error(e,...i){const r=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Dr(r,e))}checkSubtype(e,i){const r=br(e,i);return r&&this.error(r),r}}var vu=Ml;function Pl(t){if(t instanceof fd)return Pl(t.boundExpression);if(t instanceof wr&&t.name==="error"||t instanceof wl||t instanceof di)return!1;const e=t instanceof ks||t instanceof zr;let i=!0;return t.eachChild(r=>{i=e?i&&Pl(r):i&&r instanceof wa}),!!i&&Ea(t)&&Cl(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ta(t,e){const i=t.length-1;let r,c,h=0,f=i,_=0;for(;h<=f;)if(_=Math.floor((h+f)/2),r=t[_],c=t[_+1],r<=e){if(_===i||e<c)return _;h=_+1}else{if(!(r>e))throw new bn("Input is not a number.");f=_-1}return 0}class Ao{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,h]of r)this.labels.push(c),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,ct);if(!r)return null;const c=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let f=1;f<e.length;f+=2){const _=f===1?-1/0:e[f],v=e[f+1],b=f,T=f+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const C=i.parse(v,T,h);if(!C)return null;h=h||C.type,c.push([_,C])}return new Ao(h,r,c)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return r[0].evaluate(e);const h=i.length;return c>=i[h-1]?r[h-1].evaluate(e):r[Ta(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Os=Ao;function ai(t,e,i){return t*(1-i)+e*i}var Rs=Object.freeze({__proto__:null,number:ai,color:function(t,e,i){return new Ji(ai(t.r,e.r,i),ai(t.g,e.g,i),ai(t.b,e.b,i),ai(t.a,e.a,i))},array:function(t,e,i){return t.map((r,c)=>ai(r,e[c],i))}});const xu=.95047,md=1.08883,_d=4/29,Dl=6/29,gd=3*Dl*Dl,yd=Math.PI/180,vd=180/Math.PI;function bu(t){return t>.008856451679035631?Math.pow(t,1/3):t/gd+_d}function Ll(t){return t>Dl?t*t*t:gd*(t-_d)}function wu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function zl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Eu(t){const e=zl(t.r),i=zl(t.g),r=zl(t.b),c=bu((.4124564*e+.3575761*i+.1804375*r)/xu),h=bu((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-bu((.0193339*e+.119192*i+.9503041*r)/md)),alpha:t.a}}function xd(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Ll(e),i=xu*Ll(i),r=md*Ll(r),new Ji(wu(3.2404542*i-1.5371385*e-.4985314*r),wu(-.969266*i+1.8760108*e+.041556*r),wu(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function sm(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Aa={forward:Eu,reverse:xd,interpolate:function(t,e,i){return{l:ai(t.l,e.l,i),a:ai(t.a,e.a,i),b:ai(t.b,e.b,i),alpha:ai(t.alpha,e.alpha,i)}}},Sa={forward:function(t){const{l:e,a:i,b:r}=Eu(t),c=Math.atan2(r,i)*vd;return{h:c<0?c+360:c,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*yd,i=t.c;return xd({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:sm(t.h,e.h,i),c:ai(t.c,e.c,i),l:ai(t.l,e.l,i),alpha:ai(t.alpha,e.alpha,i)}}};var bd=Object.freeze({__proto__:null,lab:Aa,hcl:Sa});class kl{constructor(e,i,r,c,h){this.type=e,this.operator=i,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,i,r,c){let h=0;if(e.name==="exponential")h=Ol(i,e.base,r,c);else if(e.name==="linear")h=Ol(i,1,r,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;h=new Ve(f[0],f[1],f[2],f[3]).solve(Ol(i,1,r,c))}return h}static parse(e,i){let[r,c,h,...f]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const b=c[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const b=c.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,ct),!h)return null;const _=[];let v=null;r==="interpolate-hcl"||r==="interpolate-lab"?v=Lr:i.expectedType&&i.expectedType.kind!=="value"&&(v=i.expectedType);for(let b=0;b<f.length;b+=2){const T=f[b],C=f[b+1],M=b+3,z=b+4;if(typeof T!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(_.length&&_[_.length-1][0]>=T)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const k=i.parse(C,z,v);if(!k)return null;v=v||k.type,_.push([T,k])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new kl(v,r,c,h,_):i.error(`Type ${Ni(v)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return r[0].evaluate(e);const h=i.length;if(c>=i[h-1])return r[h-1].evaluate(e);const f=Ta(i,c),_=kl.interpolationFactor(this.interpolation,c,i[f],i[f+1]),v=r[f].evaluate(e),b=r[f+1].evaluate(e);return this.operator==="interpolate"?Rs[this.type.kind.toLowerCase()](v,b,_):this.operator==="interpolate-hcl"?Sa.reverse(Sa.interpolate(Sa.forward(v),Sa.forward(b),_)):Aa.reverse(Aa.interpolate(Aa.forward(v),Aa.forward(b),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Ol(t,e,i,r){const c=r-i,h=t-i;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}var Rr=kl;class Tu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const c=i.expectedType;c&&c.kind!=="value"&&(r=c);const h=[];for(const _ of e.slice(1)){const v=i.parse(_,1+h.length,r,void 0,{typeAnnotation:"omit"});if(!v)return null;r=r||v.type,h.push(v)}const f=c&&h.some(_=>br(c,_.type));return new Tu(f?Yt:r,h)}evaluate(e){let i,r=null,c=0;for(const h of this.args){if(c++,r=h.evaluate(e),r&&r instanceof qn&&!r.available&&(i||(i=r),r=null,c===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var wd=Tu;class Au{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let h=1;h<e.length-1;h+=2){const f=e[h];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const _=i.parse(e[h+1],h+1);if(!_)return null;r.push([f,_])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return c?new Au(r,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var Su=Au;class Rl{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,ct),c=i.parse(e[2],2,ir(i.expectedType||Yt));return r&&c?new Rl(c.type.itemType,r,c):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new bn(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new bn(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new bn(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ed=Rl;class Cu{constructor(e,i){this.type=Kt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Yt),c=i.parse(e[2],2,Yt);return r&&c?yl(r.type,[Kt,Xt,ct,Ps,Yt])?new Cu(r,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!Gn(i,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(an(i))} instead.`);if(!Gn(r,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${Ni(an(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var am=Cu;class Ca{constructor(e,i,r){this.type=ct,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Yt),c=i.parse(e[2],2,Yt);if(!r||!c)return null;if(!yl(r.type,[Kt,Xt,ct,Ps,Yt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(r.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,ct);return h?new Ca(r,c,h):null}return new Ca(r,c)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Gn(i,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(an(i))} instead.`);if(!Gn(r,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${Ni(an(r))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return r.indexOf(i,c)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Td=Ca;class Bl{constructor(e,i,r,c,h,f){this.inputType=e,this.type=i,this.input=r,this.cases=c,this.outputs=h,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const h={},f=[];for(let b=2;b<e.length-1;b+=2){let T=e[b];const C=e[b+1];Array.isArray(T)||(T=[T]);const M=i.concat(b);if(T.length===0)return M.error("Expected at least one branch label.");for(const k of T){if(typeof k!="number"&&typeof k!="string")return M.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return M.error("Numeric branch labels must be integer values.");if(r){if(M.checkSubtype(r,an(k)))return null}else r=an(k);if(h[String(k)]!==void 0)return M.error("Branch labels must be unique.");h[String(k)]=f.length}const z=i.parse(C,b,c);if(!z)return null;c=c||z.type,f.push(z)}const _=i.parse(e[1],1,Yt);if(!_)return null;const v=i.parse(e[e.length-1],e.length-1,c);return v?_.type.kind!=="value"&&i.concat(1).checkSubtype(r,_.type)?null:new Bl(r,c,_,h,f,v):null}evaluate(e){const i=this.input.evaluate(e);return(an(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],c={};for(const f of i){const _=c[this.cases[f]];_===void 0?(c[this.cases[f]]=r.length,r.push([this.cases[f],[f]])):r[_][1].push(f)}const h=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,_]of r)e.push(_.length===1?h(_[0]):_.map(h)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var lm=Bl;class Iu{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const _=i.parse(e[f],f,Kt);if(!_)return null;const v=i.parse(e[f+1],f+1,r);if(!v)return null;c.push([_,v]),r=r||v.type}const h=i.parse(e[e.length-1],e.length-1,r);return h?new Iu(r,c,h):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var cm=Iu;class Fl{constructor(e,i,r,c){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Yt),c=i.parse(e[2],2,ct);if(!r||!c)return null;if(!yl(r.type,[ir(Yt),Xt,Yt]))return i.error(`Expected first argument to be of type array or string, but found ${Ni(r.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,ct);return h?new Fl(r.type,r,c,h):null}return new Fl(r.type,r,c)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Gn(i,["string","array"]))throw new bn(`Expected first argument to be of type array or string, but found ${Ni(an(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(r,c)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Nl=Fl;function Mu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Pu(t,e,i,r){return r.compare(e,i)===0}function Bs(t,e,i){const r=t!=="=="&&t!=="!=";return class R1{constructor(h,f,_){this.type=Kt,this.lhs=h,this.rhs=f,this.collator=_,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const _=h[0];let v=f.parse(h[1],1,Yt);if(!v)return null;if(!Mu(_,v.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${Ni(v.type)}'.`);let b=f.parse(h[2],2,Yt);if(!b)return null;if(!Mu(_,b.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${Ni(b.type)}'.`);if(v.type.kind!==b.type.kind&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${Ni(v.type)}' and '${Ni(b.type)}'.`);r&&(v.type.kind==="value"&&b.type.kind!=="value"?v=new zr(b.type,[v]):v.type.kind!=="value"&&b.type.kind==="value"&&(b=new zr(v.type,[b])));let T=null;if(h.length===4){if(v.type.kind!=="string"&&b.type.kind!=="string"&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(T=f.parse(h[3],3,ya),!T)return null}return new R1(v,b,T)}evaluate(h){const f=this.lhs.evaluate(h),_=this.rhs.evaluate(h);if(r&&this.hasUntypedArgument){const v=an(f),b=an(_);if(v.kind!==b.kind||v.kind!=="string"&&v.kind!=="number")throw new bn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const v=an(f),b=an(_);if(v.kind!=="string"||b.kind!=="string")return e(h,f,_)}return this.collator?i(h,f,_,this.collator.evaluate(h)):e(h,f,_)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[t];return this.eachChild(f=>{h.push(f.serialize())}),h}}}const um=Bs("==",function(t,e,i){return e===i},Pu),hm=Bs("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!Pu(0,e,i,r)}),Ad=Bs("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Sd=Bs(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),Cd=Bs("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),Du=Bs(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class Lu{constructor(e,i,r,c,h,f){this.type=Xt,this.number=e,this.locale=i,this.currency=r,this.unit=c,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,ct);if(!r)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=i.parse(c.locale,1,Xt),!h))return null;let f=null;if(c.currency&&(f=i.parse(c.currency,1,Xt),!f))return null;let _=null;if(c.unit&&(_=i.parse(c.unit,1,Xt),!_))return null;let v=null;if(c["min-fraction-digits"]&&(v=i.parse(c["min-fraction-digits"],1,ct),!v))return null;let b=null;return c["max-fraction-digits"]&&(b=i.parse(c["max-fraction-digits"],1,ct),!b)?null:new Lu(r,h,f,_,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class zu{constructor(e){this.type=ct,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ni(r.type)} instead.`):new zu(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new bn(`Expected value to be of type string or array, but found ${Ni(an(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Id={"==":um,"!=":hm,">":Sd,"<":Ad,">=":Du,"<=":Cd,array:zr,at:Ed,boolean:zr,case:cm,coalesce:wd,collator:wl,format:Eo,image:bl,in:am,"index-of":Td,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:zu,let:Su,literal:wa,match:lm,number:zr,"number-format":Lu,object:zr,slice:Nl,step:Os,string:zr,"to-boolean":ks,"to-color":ks,"to-number":ks,"to-string":ks,var:fd,within:di};function Md(t,[e,i,r,c]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const h=c?c.evaluate(t):1,f=cd(e,i,r,h);if(f)throw new bn(f);return new Ji(e/255*h,i/255*h,r/255*h,h)}function Pd(t,e){return t in e}function ku(t,e){const i=e[t];return i===void 0?null:i}function Qo(t){return{type:t}}wr.register(Id,{error:[{kind:"error"},[Xt],(t,[e])=>{throw new bn(e.evaluate(t))}],typeof:[Xt,[Yt],(t,[e])=>Ni(an(e.evaluate(t)))],"to-rgba":[ir(ct,4),[Lr],(t,[e])=>e.evaluate(t).toArray()],rgb:[Lr,[ct,ct,ct],Md],rgba:[Lr,[ct,ct,ct,ct],Md],has:{type:Kt,overloads:[[[Xt],(t,[e])=>Pd(e.evaluate(t),t.properties())],[[Xt,Ds],(t,[e,i])=>Pd(e.evaluate(t),i.evaluate(t))]]},get:{type:Yt,overloads:[[[Xt],(t,[e])=>ku(e.evaluate(t),t.properties())],[[Xt,Ds],(t,[e,i])=>ku(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Yt,[Xt],(t,[e])=>ku(e.evaluate(t),t.featureState||{})],properties:[Ds,[],t=>t.properties()],"geometry-type":[Xt,[],t=>t.geometryType()],id:[Yt,[],t=>t.id()],zoom:[ct,[],t=>t.globals.zoom],pitch:[ct,[],t=>t.globals.pitch||0],"distance-from-center":[ct,[],t=>t.distanceFromCenter()],"heatmap-density":[ct,[],t=>t.globals.heatmapDensity||0],"line-progress":[ct,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[ct,[],t=>t.globals.skyRadialProgress||0],accumulated:[Yt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ct,Qo(ct),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[ct,Qo(ct),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:ct,overloads:[[[ct,ct],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ct],(t,[e])=>-e.evaluate(t)]]},"/":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ct,[ct],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))],log2:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ct,[ct],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ct,[ct],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ct,[ct],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ct,[ct],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ct,[ct],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ct,[ct],(t,[e])=>Math.atan(e.evaluate(t))],min:[ct,Qo(ct),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[ct,Qo(ct),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[ct,[ct],(t,[e])=>Math.abs(e.evaluate(t))],round:[ct,[ct],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ct,[ct],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ct,[ct],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Kt,[Xt,Yt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Kt,[Yt],(t,[e])=>t.id()===e.value],"filter-type-==":[Kt,[Xt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Kt,[Xt,Yt],(t,[e,i])=>{const r=t.properties()[e.value],c=i.value;return typeof r==typeof c&&r<c}],"filter-id-<":[Kt,[Yt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[Kt,[Xt,Yt],(t,[e,i])=>{const r=t.properties()[e.value],c=i.value;return typeof r==typeof c&&r>c}],"filter-id->":[Kt,[Yt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[Kt,[Xt,Yt],(t,[e,i])=>{const r=t.properties()[e.value],c=i.value;return typeof r==typeof c&&r<=c}],"filter-id-<=":[Kt,[Yt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[Kt,[Xt,Yt],(t,[e,i])=>{const r=t.properties()[e.value],c=i.value;return typeof r==typeof c&&r>=c}],"filter-id->=":[Kt,[Yt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[Kt,[Yt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Kt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Kt,[ir(Xt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Kt,[ir(Yt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Kt,[Xt,ir(Yt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Kt,[Xt,ir(Yt)],(t,[e,i])=>function(r,c,h,f){for(;h<=f;){const _=h+f>>1;if(c[_]===r)return!0;c[_]>r?f=_-1:h=_+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Kt,overloads:[[[Kt,Kt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Qo(Kt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Kt,overloads:[[[Kt,Kt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Qo(Kt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Kt,[Kt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Kt,[Xt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Xt,[Xt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Xt,[Xt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Xt,Qo(Yt),(t,e)=>e.map(i=>ba(i.evaluate(t))).join("")],"resolved-locale":[Xt,[ya],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Fs=Id;function Ou(t){return{result:"success",value:t}}function to(t){return{result:"error",value:t}}function Ns(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Dd(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Br(t){return!!t.expression&&t.expression.interpolated}function pi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function io(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function dm(t){return t}function Ld(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",c=r||!(r||t.property!==void 0),h=t.type||(Br(e)?"exponential":"interval");if(i&&((t=eo({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Ji.parse(b[1])])),t.default=Ji.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!bd[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,v;if(h==="exponential")f=Bu;else if(h==="interval")f=Ru;else if(h==="categorical"){f=pm,_=Object.create(null);for(const b of t.stops)_[b[0]]=b[1];v=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=Fu}if(r){const b={},T=[];for(let z=0;z<t.stops.length;z++){const k=t.stops[z],B=k[0].zoom;b[B]===void 0&&(b[B]={zoom:B,type:t.type,property:t.property,default:t.default,stops:[]},T.push(B)),b[B].stops.push([k[0].value,k[1]])}const C=[];for(const z of T)C.push([b[z].zoom,Ld(b[z],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Rr.interpolationFactor.bind(void 0,M),zoomStops:C.map(z=>z[0]),evaluate:({zoom:z},k)=>Bu({stops:C,base:t.base},e,z).evaluate(z,k)}}if(c){const b=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Rr.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(t,e,T,_,v)}}return{kind:"source",evaluate(b,T){const C=T&&T.properties?T.properties[t.property]:void 0;return C===void 0?Us(t.default,e.default):f(t,e,C,_,v)}}}function Us(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function pm(t,e,i,r,c){return Us(typeof i===c?r[i]:void 0,t.default,e.default)}function Ru(t,e,i){if(pi(i)!=="number")return Us(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const c=Ta(t.stops.map(h=>h[0]),i);return t.stops[c][1]}function Bu(t,e,i){const r=t.base!==void 0?t.base:1;if(pi(i)!=="number")return Us(t.default,e.default);const c=t.stops.length;if(c===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[c-1][0])return t.stops[c-1][1];const h=Ta(t.stops.map(T=>T[0]),i),f=function(T,C,M,z){const k=z-M,B=T-M;return k===0?0:C===1?B/k:(Math.pow(C,B)-1)/(Math.pow(C,k)-1)}(i,r,t.stops[h][0],t.stops[h+1][0]),_=t.stops[h][1],v=t.stops[h+1][1];let b=Rs[e.type]||dm;if(t.colorSpace&&t.colorSpace!=="rgb"){const T=bd[t.colorSpace];b=(C,M)=>T.reverse(T.interpolate(T.forward(C),T.forward(M),f))}return typeof _.evaluate=="function"?{evaluate(...T){const C=_.evaluate.apply(void 0,T),M=v.evaluate.apply(void 0,T);if(C!==void 0&&M!==void 0)return b(C,M,f)}}:b(_,v,f)}function Fu(t,e,i){return e.type==="color"?i=Ji.parse(i):e.type==="formatted"?i=Bn.fromString(i.toString()):e.type==="resolvedImage"?i=qn.fromString(i.toString()):pi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Us(i,t.default,e.default)}class Ia{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new ud,this._defaultValue=i?function(r){return r.type==="color"&&(io(r.default)||Array.isArray(r.default))?new Ji(0,0,0,0):r.type==="color"?Ji.parse(r.default)||null:r.default===void 0?null:r.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,c,h,f,_,v){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,c,h,f,_,v){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ma(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Fs}function es(t,e){const i=new vu(Fs,[],e?function(c){const h={color:Lr,string:Xt,number:ct,enum:Xt,boolean:Kt,formatted:Ls,resolvedImage:zs};return c.type==="array"?ir(h[c.value]||Yt,c.length):h[c.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Ou(new Ia(r,e)):to(i.errors)}class Ul{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Sl(i.expression)}evaluateWithoutErrorHandling(e,i,r,c,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,c,h,f)}evaluate(e,i,r,c,h,f){return this._styleExpression.evaluate(e,i,r,c,h,f)}}class jl{constructor(e,i,r,c){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Sl(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,r,c,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,c,h,f)}evaluate(e,i,r,c,h,f){return this._styleExpression.evaluate(e,i,r,c,h,f)}interpolationFactor(e,i,r){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,e,i,r):0}}function Pa(t,e){if((t=es(t,e)).result==="error")return t;const i=t.value.expression,r=Ea(i);if(!r&&!Ns(e))return to([new Dr("","data expressions not supported")]);const c=Cl(i,["zoom","pitch","distance-from-center"]);if(!c&&!Dd(e))return to([new Dr("","zoom expressions not supported")]);const h=Da(i);return h||c?h instanceof Dr?to([h]):h instanceof Rr&&!Br(e)?to([new Dr("",'"interpolate" expressions cannot be used with this property')]):Ou(h?new jl(r?"camera":"composite",t.value,h.labels,h instanceof Rr?h.interpolation:void 0):new Ul(r?"constant":"source",t.value)):to([new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class no{constructor(e,i){this._parameters=e,this._specification=i,eo(this,Ld(this._parameters,this._specification))}static deserialize(e){return new no(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Da(t){let e=null;if(t instanceof Su)e=Da(t.result);else if(t instanceof wd){for(const i of t.args)if(e=Da(i),e)break}else(t instanceof Os||t instanceof Rr)&&t.input instanceof wr&&t.input.name==="zoom"&&(e=t);return e instanceof Dr||t.eachChild(i=>{const r=Da(i);r instanceof Dr?e=r:!e&&r?e=new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class pt{constructor(e,i,r,c){this.message=(e?`${e}: `:"")+r,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function nr(t){const e=t.key,i=t.value,r=t.valueSpec||{},c=t.objectElementValidators||{},h=t.style,f=t.styleSpec;let _=[];const v=pi(i);if(v!=="object")return[new pt(e,i,`object expected, ${v} found`)];for(const b in i){const T=b.split(".")[0],C=r[T]||r["*"];let M;c[T]?M=c[T]:r[T]?M=Pn:c["*"]?M=c["*"]:r["*"]&&(M=Pn),M?_=_.concat(M({key:(e&&`${e}.`)+b,value:i[b],valueSpec:C,style:h,styleSpec:f,object:i,objectKey:b},i)):_.push(new pt(e,i[b],`unknown property "${b}"`))}for(const b in r)c[b]||r[b].required&&r[b].default===void 0&&i[b]===void 0&&_.push(new pt(e,i,`missing required property "${b}"`));return _}function Nu(t){const e=t.value,i=t.valueSpec,r=t.style,c=t.styleSpec,h=t.key,f=t.arrayElementValidator||Pn;if(pi(e)!=="array")return[new pt(h,e,`array expected, ${pi(e)} found`)];if(i.length&&e.length!==i.length)return[new pt(h,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new pt(h,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let _={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(_.function=i.function),pi(i.value)==="object"&&(_=i.value);let v=[];for(let b=0;b<e.length;b++)v=v.concat(f({array:e,arrayIndex:b,value:e[b],valueSpec:_,style:r,styleSpec:c,key:`${h}[${b}]`}));return v}function zd(t){const e=t.key,i=t.value,r=t.valueSpec;let c=pi(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new pt(e,i,`number expected, ${c} found`)];if("minimum"in r){let h=r.minimum;if(pi(r.minimum)==="array"&&(h=r.minimum[t.arrayIndex]),i<h)return[new pt(e,i,`${i} is less than the minimum value ${h}`)]}if("maximum"in r){let h=r.maximum;if(pi(r.maximum)==="array"&&(h=r.maximum[t.arrayIndex]),i>h)return[new pt(e,i,`${i} is greater than the maximum value ${h}`)]}return[]}function Uu(t){const e=t.valueSpec,i=tn(t.value.type);let r,c,h,f={};const _=i!=="categorical"&&t.value.property===void 0,v=!_,b=pi(t.value.stops)==="array"&&pi(t.value.stops[0])==="array"&&pi(t.value.stops[0][0])==="object",T=nr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(z){if(i==="identity")return[new pt(z.key,z.value,'identity function may not have a "stops" property')];let k=[];const B=z.value;return k=k.concat(Nu({key:z.key,value:B,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:C})),pi(B)==="array"&&B.length===0&&k.push(new pt(z.key,B,"array must have at least one stop")),k},default:function(z){return Pn({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return i==="identity"&&_&&T.push(new pt(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||T.push(new pt(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!Br(t.valueSpec)&&T.push(new pt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(v&&!Ns(t.valueSpec)?T.push(new pt(t.key,t.value,"property functions not supported")):_&&!Dd(t.valueSpec)&&T.push(new pt(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!b||t.value.property!==void 0||T.push(new pt(t.key,t.value,'"property" property is required')),T;function C(z){let k=[];const B=z.value,j=z.key;if(pi(B)!=="array")return[new pt(j,B,`array expected, ${pi(B)} found`)];if(B.length!==2)return[new pt(j,B,`array length 2 expected, length ${B.length} found`)];if(b){if(pi(B[0])!=="object")return[new pt(j,B,`object expected, ${pi(B[0])} found`)];if(B[0].zoom===void 0)return[new pt(j,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new pt(j,B,"object stop key must have value")];const ee=tn(B[0].zoom);if(typeof ee!="number")return[new pt(j,B[0].zoom,"stop zoom values must be numbers")];if(h&&h>ee)return[new pt(j,B[0].zoom,"stop zoom values must appear in ascending order")];ee!==h&&(h=ee,c=void 0,f={}),k=k.concat(nr({key:`${j}[0]`,value:B[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:zd,value:M}}))}else k=k.concat(M({key:`${j}[0]`,value:B[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},B));return Ma(wo(B[1]))?k.concat([new pt(`${j}[1]`,B[1],"expressions are not allowed in function stops.")]):k.concat(Pn({key:`${j}[1]`,value:B[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function M(z,k){const B=pi(z.value),j=tn(z.value),ee=z.value!==null?z.value:k;if(r){if(B!==r)return[new pt(z.key,ee,`${B} stop domain type must match previous stop domain type ${r}`)]}else r=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof j!="number"&&typeof j!="string"&&typeof j!="boolean")return[new pt(z.key,ee,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&i!=="categorical"){let le=`number expected, ${B} found`;return Ns(e)&&i===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(z.key,ee,le)]}return i!=="categorical"||B!=="number"||typeof j=="number"&&isFinite(j)&&Math.floor(j)===j?i!=="categorical"&&B==="number"&&typeof j=="number"&&typeof c=="number"&&c!==void 0&&j<c?[new pt(z.key,ee,"stop domain values must appear in ascending order")]:(c=j,i==="categorical"&&j in f?[new pt(z.key,ee,"stop domain values must be unique")]:(f[j]=!0,[])):[new pt(z.key,ee,`integer expected, found ${String(j)}`)]}}function ro(t){const e=(t.expressionContext==="property"?Pa:es)(wo(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new pt(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new pt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Sl(i))return[new pt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return kd(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Cl(i,["zoom","feature-state"]))return[new pt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Ea(i))return[new pt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function kd(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const r=[];return t instanceof wr&&i.has(t.name)?[new pt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{r.push(...kd(c,e))}),r)}function Vl(t){const e=t.key,i=t.value,r=t.valueSpec,c=[];return Array.isArray(r.values)?r.values.indexOf(tn(i))===-1&&c.push(new pt(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(tn(i))===-1&&c.push(new pt(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ju(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ju(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function $l(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ju(t)||(t=ql(t));const i=t;let r=!0;try{r=function(b){if(!oo(b))return b;let T=wo(b);return La(T),T=Od(T),T}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=ze[`filter_${e}`],h=es(r,c);let f=null;if(h.result==="error")throw new Error(h.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,T,C)=>h.value.evaluate(b,T,{},C);let _=null,v=null;if(r!==i){const b=es(i,c);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,C,M,z,k)=>b.value.evaluate(T,C,{},M,void 0,void 0,z,k),v=!Ea(b.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:Rd(r),needFeature:!!v}}function Od(t){if(!Array.isArray(t))return t;const e=function(i){if(rr.has(i[0])){for(let r=1;r<i.length;r++)if(oo(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>Od(i))}function La(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||oo(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||oo(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||oo(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)La(t[r])}function oo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(oo(t[i]))return!0;return!1}const rr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gl(t,e){return t<e?-1:t>e?1:0}function Rd(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Rd(t[e]))return!0;return!1}function ql(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Vu(t[1],t[2],"=="):e==="!="?Wl(Vu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vu(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(ql))):e==="all"?["all"].concat(t.slice(1).map(ql)):e==="none"?["all"].concat(t.slice(1).map(ql).map(Wl)):e==="in"?Bd(t[1],t.slice(2)):e==="!in"?Wl(Bd(t[1],t.slice(2))):e==="has"?Zl(t[1]):e==="!has"?Wl(Zl(t[1])):e!=="within"||t;var i}function Vu(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Bd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Gl)]]:["filter-in-small",t,["literal",e]]}}function Zl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Wl(t){return["!",t]}function za(t){return ju(wo(t.value))?ro(eo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Fd(t)}function Fd(t){const e=t.value,i=t.key;if(pi(e)!=="array")return[new pt(i,e,`array expected, ${pi(e)} found`)];const r=t.styleSpec;let c,h=[];if(e.length<1)return[new pt(i,e,"filter array must have at least 1 element")];switch(h=h.concat(Vl({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),tn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&tn(e[1])==="$type"&&h.push(new pt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new pt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=pi(e[1]),c!=="string"&&h.push(new pt(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=pi(e[f]),tn(e[1])==="$type"?h=h.concat(Vl({key:`${i}[${f}]`,value:e[f],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new pt(`${i}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)h=h.concat(Fd({key:`${i}[${f}]`,value:e[f],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=pi(e[1]),e.length!==2?h.push(new pt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new pt(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=pi(e[1]),e.length!==2?h.push(new pt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new pt(`${i}[1]`,e[1],`object expected, ${c} found`))}return h}function Nd(t,e){const i=t.key,r=t.style,c=t.styleSpec,h=t.value,f=t.objectKey,_=c[`${e}_${t.layerType}`];if(!_)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&_[v[1]]&&_[v[1]].transition)return Pn({key:i,value:h,valueSpec:c.transition,style:r,styleSpec:c});const b=t.valueSpec||_[f];if(!b)return[new pt(i,h,`unknown property "${f}"`)];let T;if(pi(h)==="string"&&Ns(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(h)))return[new pt(i,h,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const C=[];return t.layerType==="symbol"&&(f==="text-field"&&r&&!r.glyphs&&C.push(new pt(i,h,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&io(wo(h))&&tn(h.type)==="identity"&&C.push(new pt(i,h,'"text-font" does not support identity functions'))),C.concat(Pn({key:t.key,value:h,valueSpec:b,style:r,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:f}))}function Hl(t){return Nd(t,"paint")}function Ud(t){return Nd(t,"layout")}function $u(t){let e=[];const i=t.value,r=t.key,c=t.style,h=t.styleSpec;i.type||i.ref||e.push(new pt(r,i,'either "type" or "ref" is required'));let f=tn(i.type);const _=tn(i.ref);if(i.id){const v=tn(i.id);for(let b=0;b<t.arrayIndex;b++){const T=c.layers[b];tn(T.id)===v&&e.push(new pt(r,i.id,`duplicate layer id "${i.id}", previously used at line ${T.id.__line__}`))}}if("ref"in i){let v;["type","source","source-layer","filter","layout"].forEach(b=>{b in i&&e.push(new pt(r,i[b],`"${b}" is prohibited for ref layers`))}),c.layers.forEach(b=>{tn(b.id)===_&&(v=b)}),v?v.ref?e.push(new pt(r,i.ref,"ref cannot reference another ref layer")):f=tn(v.type):typeof _=="string"&&e.push(new pt(r,i.ref,`ref layer "${_}" not found`))}else if(f!=="background"&&f!=="sky")if(i.source){const v=c.sources&&c.sources[i.source],b=v&&tn(v.type);v?b==="vector"&&f==="raster"?e.push(new pt(r,i.source,`layer "${i.id}" requires a raster source`)):b==="raster"&&f!=="raster"?e.push(new pt(r,i.source,`layer "${i.id}" requires a vector source`)):b!=="vector"||i["source-layer"]?b==="raster-dem"&&f!=="hillshade"?e.push(new pt(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||b==="geojson"&&v.lineMetrics||e.push(new pt(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pt(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new pt(r,i.source,`source "${i.source}" not found`))}else e.push(new pt(r,i,'missing required property "source"'));return e=e.concat(nr({key:r,value:i,valueSpec:h.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pn({key:`${r}.type`,value:i.type,valueSpec:h.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:v=>za(eo({layerType:f},v)),layout:v=>nr({layer:i,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Ud(eo({layerType:f},b))}}),paint:v=>nr({layer:i,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Hl(eo({layerType:f},b))}})}})),e}function ts(t){const e=t.value,i=t.key,r=pi(e);return r!=="string"?[new pt(i,e,`string expected, ${r} found`)]:[]}const jd={promoteId:function({key:t,value:e}){if(pi(e)==="string")return ts({key:t,value:e});{const i=[];for(const r in e)i.push(...ts({key:`${t}.${r}`,value:e[r]}));return i}}};function Xl(t){const e=t.value,i=t.key,r=t.styleSpec,c=t.style;if(!e.type)return[new pt(i,e,'"type" is required')];const h=tn(e.type);let f;switch(h){case"vector":case"raster":case"raster-dem":return f=nr({key:i,value:e,valueSpec:r[`source_${h.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:jd}),f;case"geojson":if(f=nr({key:i,value:e,valueSpec:r.source_geojson,style:c,styleSpec:r,objectElementValidators:jd}),e.cluster)for(const _ in e.clusterProperties){const[v,b]=e.clusterProperties[_],T=typeof v=="string"?[v,["accumulated"],["get",_]]:v;f.push(...ro({key:`${i}.${_}.map`,value:b,expressionContext:"cluster-map"})),f.push(...ro({key:`${i}.${_}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return f;case"video":return nr({key:i,value:e,valueSpec:r.source_video,style:c,styleSpec:r});case"image":return nr({key:i,value:e,valueSpec:r.source_image,style:c,styleSpec:r});case"canvas":return[new pt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vl({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:r})}}function ka(t){const e=t.value,i=t.styleSpec,r=i.light,c=t.style;let h=[];const f=pi(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new pt("light",e,`object expected, ${f} found`)]),h;for(const _ in e){const v=_.match(/^(.*)-transition$/);h=h.concat(v&&r[v[1]]&&r[v[1]].transition?Pn({key:_,value:e[_],valueSpec:i.transition,style:c,styleSpec:i}):r[_]?Pn({key:_,value:e[_],valueSpec:r[_],style:c,styleSpec:i}):[new pt(_,e[_],`unknown property "${_}"`)])}return h}function Gu(t){const e=t.value,i=t.key,r=t.style,c=t.styleSpec,h=c.terrain;let f=[];const _=pi(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new pt("terrain",e,`object expected, ${_} found`)]),f;for(const v in e){const b=v.match(/^(.*)-transition$/);f=f.concat(b&&h[b[1]]&&h[b[1]].transition?Pn({key:v,value:e[v],valueSpec:c.transition,style:r,styleSpec:c}):h[v]?Pn({key:v,value:e[v],valueSpec:h[v],style:r,styleSpec:c}):[new pt(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=r.sources&&r.sources[e.source],b=v&&tn(v.type);v?b!=="raster-dem"&&f.push(new pt(i,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):f.push(new pt(i,e.source,`source "${e.source}" not found`))}else f.push(new pt(i,e,'terrain is missing required property "source"'));return f}function Vd(t){const e=t.value,i=t.style,r=t.styleSpec,c=r.fog;let h=[];const f=pi(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new pt("fog",e,`object expected, ${f} found`)]),h;for(const _ in e){const v=_.match(/^(.*)-transition$/);h=h.concat(v&&c[v[1]]&&c[v[1]].transition?Pn({key:_,value:e[_],valueSpec:r.transition,style:i,styleSpec:r}):c[_]?Pn({key:_,value:e[_],valueSpec:c[_],style:i,styleSpec:r}):[new pt(_,e[_],`unknown property "${_}"`)])}return h}const qu={"*":()=>[],array:Nu,boolean:function(t){const e=t.value,i=t.key,r=pi(e);return r!=="boolean"?[new pt(i,e,`boolean expected, ${r} found`)]:[]},number:zd,color:function(t){const e=t.key,i=t.value,r=pi(i);return r!=="string"?[new pt(e,i,`color expected, ${r} found`)]:ou(i)===null?[new pt(e,i,`color expected, "${i}" found`)]:[]},enum:Vl,filter:za,function:Uu,layer:$u,object:nr,source:Xl,light:ka,terrain:Gu,fog:Vd,string:ts,formatted:function(t){return ts(t).length===0?[]:ro(t)},resolvedImage:function(t){return ts(t).length===0?[]:ro(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,c=t.style;let h=[];const f=pi(e);if(f==="object")for(const _ in e)h=h.concat(Pn({key:_,value:e[_],valueSpec:r[_],style:c,styleSpec:i}));else f!=="string"&&(h=h.concat([new pt("projection",e,`object or string expected, ${f} found`)]));return h}};function Pn(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&io(tn(e))?Uu(t):i.expression&&Ma(wo(e))?ro(t):i.type&&qu[i.type]?qu[i.type](t):nr(eo({},t,{valueSpec:i.type?r[i.type]:i}))}function Zu(t){const e=t.value,i=t.key,r=ts(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new pt(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new pt(i,e,'"glyphs" url must include a "{range}" token'))),r}function $d(t,e=ze){return so(Pn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Zu,"*":()=>[]}}))}const fm=t=>so(Hl(t)),mm=t=>so(Ud(t));function so(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Wu(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new bo(new Error(r.message))),i=!0;return i}var js=Fr;function Fr(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var h=0;h<this.d*this.d;h++){var f=c[3+h],_=c[3+h+1];r.push(f===_?null:c.subarray(f,_))}var v=c[3+r.length+1];this.keys=c.subarray(c[3+r.length],v),this.bboxes=c.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var b=0;b<this.d*this.d;b++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var T=i/e*t;this.min=-T,this.max=t+T}Fr.prototype.insert=function(t,e,i,r,c){this._forEachCell(e,i,r,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(c)},Fr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fr.prototype._insertCell=function(t,e,i,r,c,h){this.cells[c].push(h)},Fr.prototype.query=function(t,e,i,r,c){var h=this.min,f=this.max;if(t<=h&&e<=h&&f<=i&&f<=r&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,i,r,this._queryCell,_,{},c),_},Fr.prototype._queryCell=function(t,e,i,r,c,h,f,_){var v=this.cells[c];if(v!==null)for(var b=this.keys,T=this.bboxes,C=0;C<v.length;C++){var M=v[C];if(f[M]===void 0){var z=4*M;(_?_(T[z+0],T[z+1],T[z+2],T[z+3]):t<=T[z+2]&&e<=T[z+3]&&i>=T[z+0]&&r>=T[z+1])?(f[M]=!0,h.push(b[M])):f[M]=!1}}},Fr.prototype._forEachCell=function(t,e,i,r,c,h,f,_){for(var v=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(i),C=this._convertToCellCoord(r),M=v;M<=T;M++)for(var z=b;z<=C;z++){var k=this.d*z+M;if((!_||_(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&c.call(this,t,e,i,r,k,h,f,_))return}},Fr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Fr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Fr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,f=0;f<t.length;f++){var _=t[f];c[3+f]=h,c.set(_,h),h+=_.length}return c[3+t.length]=h,c.set(this.keys,h),c[3+t.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};const Kl={};function mt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Kl[e]={klass:t,omit:i.omit||[]}}mt(Object,"Object"),js.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},js.deserialize=function(t){return new js(t.buffer)},Object.defineProperty(js,"name",{value:"Grid"}),mt(js,"Grid"),mt(Ji,"Color"),mt(Error,"Error"),mt(hr,"AJAXError"),mt(qn,"ResolvedImage"),mt(no,"StylePropertyFunction"),mt(Ia,"StyleExpression",{omit:["_evaluator"]}),mt(jl,"ZoomDependentExpression"),mt(Ul,"ZoomConstantExpression"),mt(wr,"CompoundExpression",{omit:["_evaluate"]});for(const t in Fs)Kl[Fs[t]._classRegistryKey]||mt(Fs[t],`Expression${t}`);function Gd(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function qd(t){return L.ImageBitmap&&t instanceof L.ImageBitmap}function Oa(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gd(t)||qd(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof L.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Oa(r,e));return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const c=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const h in t)t.hasOwnProperty(h)&&(Kl[r].omit.indexOf(h)>=0||(c[h]=Oa(t[h],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}throw new Error("can't serialize object of type "+typeof t)}function So(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gd(t)||qd(t)||ArrayBuffer.isView(t)||t instanceof L.ImageData)return t;if(Array.isArray(t))return t.map(So);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=Kl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const c of Object.keys(t))c!=="$name"&&(r[c]=So(t[c]));return r}throw new Error("can't deserialize object of type "+typeof t)}class Zd{constructor(){this.first=!0}update(e,i){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const Wd=t=>t>=1536&&t<=1791,Ra=t=>t>=1872&&t<=1919,Hd=t=>t>=2208&&t<=2303,Hu=t=>t>=11904&&t<=12031,Xd=t=>t>=12032&&t<=12255,Xu=t=>t>=12272&&t<=12287,Ba=t=>t>=12288&&t<=12351,Yl=t=>t>=12352&&t<=12447,Fa=t=>t>=12448&&t<=12543,Jl=t=>t>=12544&&t<=12591,Ql=t=>t>=12704&&t<=12735,Kd=t=>t>=12736&&t<=12783,Yd=t=>t>=12784&&t<=12799,Ku=t=>t>=12800&&t<=13055,Jd=t=>t>=13056&&t<=13311,Qd=t=>t>=13312&&t<=19903,Yu=t=>t>=19968&&t<=40959,ec=t=>t>=40960&&t<=42127,ep=t=>t>=42128&&t<=42191,tp=t=>t>=44032&&t<=55215,ip=t=>t>=63744&&t<=64255,Ju=t=>t>=64336&&t<=65023,np=t=>t>=65040&&t<=65055,tc=t=>t>=65072&&t<=65103,Na=t=>t>=65104&&t<=65135,u=t=>t>=65136&&t<=65279,n=t=>t>=65280&&t<=65519;function l(t){for(const e of t)if(y(e.charCodeAt(0)))return!0;return!1}function p(t){for(const e of t)if(!m(e.charCodeAt(0)))return!1;return!0}function m(t){return!(Wd(t)||Ra(t)||Hd(t)||Ju(t)||u(t))}function y(t){return!(t!==746&&t!==747&&(t<4352||!(Ql(t)||Jl(t)||tc(t)&&!(t>=65097&&t<=65103)||ip(t)||Jd(t)||Hu(t)||Kd(t)||!(!Ba(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Qd(t)||Yu(t)||Ku(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||tp(t)||Yl(t)||Xu(t)||(e=>e>=12688&&e<=12703)(t)||Xd(t)||Yd(t)||Fa(t)&&t!==12540||!(!n(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Na(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||np(t)||(e=>e>=19904&&e<=19967)(t)||ec(t)||ep(t))))}function w(t){return!(y(t)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ba(e)||Fa(e)||(i=>i>=57344&&i<=63743)(e)||tc(e)||Na(e)||n(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function A(t){return t>=1424&&t<=2303||Ju(t)||u(t)}function S(t,e){return!(!e&&A(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=>i>=6016&&i<=6143)(t))}function P(t){for(const e of t)if(A(e.charCodeAt(0)))return!0;return!1}const D="deferred",R="loading",N="loaded";let W=null,$="unavailable",H=null;const q=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&($="error"),W&&W(t)};function V(){K.fire(new Ei("pluginStateChange",{pluginStatus:$,pluginURL:H}))}const K=new Qr,Z=function(){return $},oe=function(){if($!==D||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$=R,V(),H&&vr({url:H},t=>{t?q(t):($=N,V())})},ae={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$===N||ae.applyArabicShaping!=null,isLoading:()=>$===R,setState(t){$=t.pluginStatus,H=t.pluginURL},isParsed:()=>ae.applyArabicShaping!=null&&ae.processBidirectionalText!=null&&ae.processStyledBidirectionalText!=null,getPluginURL:()=>H};class te{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const c of i)if(!S(c.charCodeAt(0),r))return!1;return!0}(e,ae.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*i}}}class ce{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,c){if(io(r))return new no(r,c);if(Ma(r)){const h=Pa(r,c);if(h.result==="error")throw new Error(h.value.map(f=>`${f.key}: ${f.message}`).join(", "));return h.value}{let h=r;return typeof r=="string"&&c.type==="color"&&(h=Ji.parse(r)),{kind:"constant",evaluate:()=>h}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class be{constructor(e){this.property=e,this.value=new ce(e,void 0)}transitioned(e,i){return new Ae(this.property,this.value,i,gi({},e.transition,this.transition),e.now)}untransitioned(){return new Ae(this.property,this.value,null,{},0)}}class Pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return fn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new be(this._values[e].property)),this._values[e].value=new ce(this._values[e].property,i===null?void 0:fn(i))}getTransition(e){return fn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new be(this._values[e].property)),this._values[e].transition=fn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const r=new Ze(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].transitioned(e,i._values[c]);return r}untransitioned(){const e=new Ze(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ae{constructor(e,i,r,c,h){const f=c.delay||0,_=c.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const c=e.now||0,h=this.value.possiblyEvaluate(e,i,r),f=this.prior;if(f){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return f.possiblyEvaluate(e,i,r);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,r),h,Bi(_))}}return h}}class Ze{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const c=new Re(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,i,r);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _e{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return fn(this._values[e].value)}setValue(e,i){this._values[e]=new ce(this._values[e].property,i===null?void 0:fn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const c=new Re(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,i,r);return c}}class Be{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,c){return this.property.evaluate(this.value,this.parameters,e,i,r,c)}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class we{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const c=Rs[this.specification.type];return c?c(e,i,r):e}}class fe{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,c){return new Be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,c)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Be(this,{kind:"constant",value:void 0},e.parameters);const c=Rs[this.specification.type];return c?new Be(this,{kind:"constant",value:c(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,c,h,f){return e.kind==="constant"?e.value:e.evaluate(i,r,c,h,f)}}class st extends fe{possiblyEvaluate(e,i,r,c){if(e.value===void 0)return new Be(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const h=e.expression.evaluate(i,null,{},r,c),f=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,_=this._calculate(f,f,f,i);return new Be(this,{kind:"constant",value:_},i)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Be(this,{kind:"constant",value:h},i)}return new Be(this,e.expression,i)}evaluate(e,i,r,c,h,f){if(e.kind==="source"){const _=e.evaluate(i,r,c,h,f);return this._calculate(_,_,_,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},r,c),e.evaluate({zoom:Math.floor(i.zoom)},r,c),e.evaluate({zoom:Math.floor(i.zoom)+1},r,c),i):e.value}_calculate(e,i,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i,other:r}:{from:r,to:i,other:e}}interpolate(e){return e}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(i,null,{},r,c);return this._calculate(h,h,h,i)}return this._calculate(e.expression.evaluate(new te(Math.floor(i.zoom-1),i)),e.expression.evaluate(new te(Math.floor(i.zoom),i)),e.expression.evaluate(new te(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:r,to:i}}interpolate(e){return e}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,c){return!!e.expression.evaluate(i,null,{},r,c)}interpolate(){return!1}}class Je{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new te(0,{});for(const r in e){const c=e[r];c.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new ce(c,void 0),f=this.defaultTransitionablePropertyValues[r]=new be(c);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate(i)}}}function vt(t,e){return 256*(t=Ft(Math.floor(t),0,255))+Ft(Math.floor(e),0,255)}mt(fe,"DataDrivenProperty"),mt(we,"DataConstantProperty"),mt(st,"CrossFadedDataDrivenProperty"),mt(Ke,"CrossFadedProperty"),mt(tt,"ColorRampProperty");const kt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pt{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Et{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qe(t,e=1){let i=0,r=0;return{members:t.map(c=>{const h=kt[c.type].BYTES_PER_ELEMENT,f=i=Bt(i,Math.max(e,h)),_=c.components||1;return r=Math.max(r,h),i+=h*_,{name:c.name,type:c.type,components:_,offset:f}}),size:Bt(i,Math.max(r,e)),alignment:e}}function Bt(t,e){return Math.ceil(t/e)*e}class qt extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=r,e}}qt.prototype.bytesPerElement=4,mt(qt,"StructArrayLayout2i4");class Ti extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r)}emplace(e,i,r,c){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.int16[h+2]=c,e}}Ti.prototype.bytesPerElement=6,mt(Ti,"StructArrayLayout3i6");class Ai extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,c)}emplace(e,i,r,c,h){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=r,this.int16[f+2]=c,this.int16[f+3]=h,e}}Ai.prototype.bytesPerElement=8,mt(Ai,"StructArrayLayout4i8");class yi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,c,h,f,_)}emplace(e,i,r,c,h,f,_,v){const b=6*e,T=12*e,C=3*e;return this.int16[b+0]=i,this.int16[b+1]=r,this.uint8[T+4]=c,this.uint8[T+5]=h,this.uint8[T+6]=f,this.uint8[T+7]=_,this.float32[C+2]=v,e}}yi.prototype.bytesPerElement=12,mt(yi,"StructArrayLayout2i4ub1f12");class _n extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,c)}emplace(e,i,r,c,h){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=r,this.float32[f+2]=c,this.float32[f+3]=h,e}}_n.prototype.bytesPerElement=16,mt(_n,"StructArrayLayout4f16");class Fn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,r,c,h,f,_,v,b,T)}emplace(e,i,r,c,h,f,_,v,b,T,C){const M=10*e;return this.uint16[M+0]=i,this.uint16[M+1]=r,this.uint16[M+2]=c,this.uint16[M+3]=h,this.uint16[M+4]=f,this.uint16[M+5]=_,this.uint16[M+6]=v,this.uint16[M+7]=b,this.uint16[M+8]=T,this.uint16[M+9]=C,e}}Fn.prototype.bytesPerElement=20,mt(Fn,"StructArrayLayout10ui20");class Nr extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,r,c,h,f,_,v)}emplace(e,i,r,c,h,f,_,v,b){const T=8*e;return this.uint16[T+0]=i,this.uint16[T+1]=r,this.uint16[T+2]=c,this.uint16[T+3]=h,this.uint16[T+4]=f,this.uint16[T+5]=_,this.uint16[T+6]=v,this.uint16[T+7]=b,e}}Nr.prototype.bytesPerElement=16,mt(Nr,"StructArrayLayout8ui16");class ki extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,c,h,f)}emplace(e,i,r,c,h,f,_){const v=6*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.int16[v+2]=c,this.int16[v+3]=h,this.int16[v+4]=f,this.int16[v+5]=_,e}}ki.prototype.bytesPerElement=12,mt(ki,"StructArrayLayout6i12");class Gi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v,b,T,C,M){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,r,c,h,f,_,v,b,T,C,M)}emplace(e,i,r,c,h,f,_,v,b,T,C,M,z){const k=12*e;return this.int16[k+0]=i,this.int16[k+1]=r,this.int16[k+2]=c,this.int16[k+3]=h,this.uint16[k+4]=f,this.uint16[k+5]=_,this.uint16[k+6]=v,this.uint16[k+7]=b,this.int16[k+8]=T,this.int16[k+9]=C,this.int16[k+10]=M,this.int16[k+11]=z,e}}Gi.prototype.bytesPerElement=24,mt(Gi,"StructArrayLayout4i4ui4i24");class _i extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,c,h,f)}emplace(e,i,r,c,h,f,_){const v=10*e,b=5*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.int16[v+2]=c,this.float32[b+2]=h,this.float32[b+3]=f,this.float32[b+4]=_,e}}_i.prototype.bytesPerElement=20,mt(_i,"StructArrayLayout3i3f20");class nn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}nn.prototype.bytesPerElement=4,mt(nn,"StructArrayLayout1ul4");class Dn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v,b,T,C,M,z){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,r,c,h,f,_,v,b,T,C,M,z)}emplace(e,i,r,c,h,f,_,v,b,T,C,M,z,k){const B=20*e,j=10*e;return this.int16[B+0]=i,this.int16[B+1]=r,this.int16[B+2]=c,this.int16[B+3]=h,this.int16[B+4]=f,this.float32[j+3]=_,this.float32[j+4]=v,this.float32[j+5]=b,this.float32[j+6]=T,this.int16[B+14]=C,this.uint32[j+8]=M,this.uint16[B+18]=z,this.uint16[B+19]=k,e}}Dn.prototype.bytesPerElement=40,mt(Dn,"StructArrayLayout5i4f1i1ul2ui40");class Pi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,r,c,h,f,_)}emplace(e,i,r,c,h,f,_,v){const b=8*e;return this.int16[b+0]=i,this.int16[b+1]=r,this.int16[b+2]=c,this.int16[b+4]=h,this.int16[b+5]=f,this.int16[b+6]=_,this.int16[b+7]=v,e}}Pi.prototype.bytesPerElement=16,mt(Pi,"StructArrayLayout3i2i2i16");class Zn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,c,h)}emplace(e,i,r,c,h,f){const _=4*e,v=8*e;return this.float32[_+0]=i,this.float32[_+1]=r,this.float32[_+2]=c,this.int16[v+6]=h,this.int16[v+7]=f,e}}Zn.prototype.bytesPerElement=16,mt(Zn,"StructArrayLayout2f1f2i16");class is extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,c)}emplace(e,i,r,c,h){const f=12*e,_=3*e;return this.uint8[f+0]=i,this.uint8[f+1]=r,this.float32[_+1]=c,this.float32[_+2]=h,e}}is.prototype.bytesPerElement=12,mt(is,"StructArrayLayout2ub2f12");class Er extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r)}emplace(e,i,r,c){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=r,this.float32[h+2]=c,e}}Er.prototype.bytesPerElement=12,mt(Er,"StructArrayLayout3f12");class Nn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r)}emplace(e,i,r,c){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=r,this.uint16[h+2]=c,e}}Nn.prototype.bytesPerElement=6,mt(Nn,"StructArrayLayout3ui6");class Vs extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he){const re=this.length;return this.resize(re+1),this.emplace(re,e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he)}emplace(e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he,re){const Se=30*e,Te=15*e,ke=60*e;return this.int16[Se+0]=i,this.int16[Se+1]=r,this.int16[Se+2]=c,this.float32[Te+2]=h,this.float32[Te+3]=f,this.uint16[Se+8]=_,this.uint16[Se+9]=v,this.uint32[Te+5]=b,this.uint32[Te+6]=T,this.uint32[Te+7]=C,this.uint16[Se+16]=M,this.uint16[Se+17]=z,this.uint16[Se+18]=k,this.float32[Te+10]=B,this.float32[Te+11]=j,this.uint8[ke+48]=ee,this.uint8[ke+49]=le,this.uint8[ke+50]=Q,this.uint32[Te+13]=ne,this.int16[Se+28]=he,this.uint8[ke+58]=re,e}}Vs.prototype.bytesPerElement=60,mt(Vs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Co extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he,re,Se,Te,ke,We,De,Oe,Fe,je){const He=this.length;return this.resize(He+1),this.emplace(He,e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he,re,Se,Te,ke,We,De,Oe,Fe,je)}emplace(e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j,ee,le,Q,ne,he,re,Se,Te,ke,We,De,Oe,Fe,je,He){const Le=38*e,ot=19*e;return this.int16[Le+0]=i,this.int16[Le+1]=r,this.int16[Le+2]=c,this.float32[ot+2]=h,this.float32[ot+3]=f,this.int16[Le+8]=_,this.int16[Le+9]=v,this.int16[Le+10]=b,this.int16[Le+11]=T,this.int16[Le+12]=C,this.int16[Le+13]=M,this.uint16[Le+14]=z,this.uint16[Le+15]=k,this.uint16[Le+16]=B,this.uint16[Le+17]=j,this.uint16[Le+18]=ee,this.uint16[Le+19]=le,this.uint16[Le+20]=Q,this.uint16[Le+21]=ne,this.uint16[Le+22]=he,this.uint16[Le+23]=re,this.uint16[Le+24]=Se,this.uint16[Le+25]=Te,this.uint16[Le+26]=ke,this.uint16[Le+27]=We,this.uint16[Le+28]=De,this.uint32[ot+15]=Oe,this.float32[ot+16]=Fe,this.float32[ot+17]=je,this.float32[ot+18]=He,e}}Co.prototype.bytesPerElement=76,mt(Co,"StructArrayLayout3i2f6i15ui1ul3f76");class wn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}wn.prototype.bytesPerElement=4,mt(wn,"StructArrayLayout1f4");class Ur extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,c,h)}emplace(e,i,r,c,h,f){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=r,this.float32[_+2]=c,this.float32[_+3]=h,this.float32[_+4]=f,e}}Ur.prototype.bytesPerElement=20,mt(Ur,"StructArrayLayout5f20");class Io extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,c)}emplace(e,i,r,c,h){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=r,this.uint16[f+3]=c,this.uint16[f+4]=h,e}}Io.prototype.bytesPerElement=12,mt(Io,"StructArrayLayout1ul3ui12");class Tr extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,e}}Tr.prototype.bytesPerElement=4,mt(Tr,"StructArrayLayout2ui4");class Qu extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Qu.prototype.bytesPerElement=2,mt(Qu,"StructArrayLayout1ui2");class rp extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=r,e}}rp.prototype.bytesPerElement=8,mt(rp,"StructArrayLayout2f8");class xy extends Pt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}xy.prototype.size=12;class by extends ki{get(e){return new xy(this,e)}}mt(by,"FillExtrusionExtArray");class wy extends Pt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wy.prototype.size=40;class _m extends Dn{get(e){return new wy(this,e)}}mt(_m,"CollisionBoxArray");class Ey extends Pt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ey.prototype.size=60;class Ty extends Vs{get(e){return new Ey(this,e)}}mt(Ty,"PlacedSymbolArray");class Ay extends Pt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ay.prototype.size=76;class Sy extends Co{get(e){return new Ay(this,e)}}mt(Sy,"SymbolInstanceArray");class Cy extends wn{getoffsetX(e){return this.float32[1*e+0]}}mt(Cy,"GlyphOffsetArray");class Iy extends Ti{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}mt(Iy,"SymbolLineVertexArray");class My extends Pt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}My.prototype.size=12;class Py extends Io{get(e){return new My(this,e)}}mt(Py,"FeatureIndexArray");class Dy extends Pt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Dy.prototype.size=4;class Ly extends Tr{get(e){return new Dy(this,e)}}mt(Ly,"FillExtrusionCentroidArray");class zy extends Pt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}zy.prototype.size=12;class ky extends ki{get(e){return new zy(this,e)}}mt(ky,"CircleGlobeExtArray");const OE=Qe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),RE=Qe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ic={exports:{}},Oy={exports:{}};Oy.exports=function(t,e){var i,r,c,h,f,_,v,b;for(r=t.length-(i=3&t.length),c=e,f=3432918353,_=461845907,b=0;b<r;)v=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,c=27492+(65535&(h=5*(65535&(c=(c^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*_+(((v>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(v=0,i){case 3:v^=(255&t.charCodeAt(b+2))<<16;case 2:v^=(255&t.charCodeAt(b+1))<<8;case 1:c^=v=(65535&(v=(v=(65535&(v^=255&t.charCodeAt(b)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*_+(((v>>>16)*_&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Ry={exports:{}};Ry.exports=function(t,e){for(var i,r=t.length,c=e^r,h=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++h;switch(r){case 3:c^=(255&t.charCodeAt(h+2))<<16;case 2:c^=(255&t.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var By=Oy.exports,BE=Ry.exports;ic.exports=By,ic.exports.murmur3=By,ic.exports.murmur2=BE;class op{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,c){this.ids.push(Fy(e)),this.positions.push(i,r,c)}getPositions(e){const i=Fy(e);let r=0,c=this.ids.length-1;for(;r<c;){const f=r+c>>1;this.ids[f]>=i?c=f:r=f+1}const h=[];for(;this.ids[r]===i;)h.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return h}static serialize(e,i){const r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return gm(r,c,0,r.length-1),i&&i.push(r.buffer,c.buffer),{ids:r,positions:c}}static deserialize(e){const i=new op;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Fy(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ic.exports(String(t))}function gm(t,e,i,r){for(;i<r;){const c=t[i+r>>1];let h=i-1,f=r+1;for(;;){do h++;while(t[h]<c);do f--;while(t[f]>c);if(h>=f)break;sp(t,h,f),sp(e,3*h,3*f),sp(e,3*h+1,3*f+1),sp(e,3*h+2,3*f+2)}f-i<r-f?(gm(t,e,i,f),i=f+1):(gm(t,e,f+1,r),r=f)}}function sp(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}mt(op,"FeaturePositionMap");class ns{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class ap extends ns{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ny extends ns{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Uy extends ns{constructor(e){super(e),this.current=Ji.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const FE=new Float32Array(16),NE=new Float32Array(9),UE=new Float32Array(4);function ym(t){return[vt(255*t.r,255*t.g),vt(255*t.b,255*t.a)]}class eh{constructor(e,i,r){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=r}setUniform(e,i,r,c,h){i.set(e,h,c.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Uy(e):new ap(e)}}class nc{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,r,c,h){const f=h==="u_pattern_to"||h==="u_dash_to"?this.patternTo:h==="u_pattern_from"||h==="u_dash_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&i.set(e,h,f)}getBinding(e,i){return i==="u_pattern_from"||i==="u_pattern_to"||i==="u_dash_from"||i==="u_dash_to"?new Ny(e):new ap(e)}}class rs{constructor(e,i,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,r,c,h,f){const _=this.paintVertexArray.length,v=this.expression.evaluate(new te(0),i,{},h,c,f);this.paintVertexArray.resize(e),this._setPaintValue(_,e,v)}updatePaintArray(e,i,r,c,h){const f=this.expression.evaluate({zoom:0},r,c,void 0,h);this._setPaintValue(e,i,f)}_setPaintValue(e,i,r){if(this.type==="color"){const c=ym(r);for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(e,i,r,c,h,f){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=r,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,r,c,h,f){const _=this.expression.evaluate(new te(this.zoom),i,{},h,c,f),v=this.expression.evaluate(new te(this.zoom+1),i,{},h,c,f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,_,v)}updatePaintArray(e,i,r,c,h){const f=this.expression.evaluate({zoom:this.zoom},r,c,void 0,h),_=this.expression.evaluate({zoom:this.zoom+1},r,c,void 0,h);this._setPaintValue(e,i,f,_)}_setPaintValue(e,i,r,c){if(this.type==="color"){const h=ym(r),f=ym(c);for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,h[0],h[1],f[0],f[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,c,h){const f=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,_=Ft(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(e,h,_)}getBinding(e,i){return new ap(e)}}class $s{constructor(e,i,r,c,h,f,_){this.expression=e,this.type=r,this.useIntegerZoom=c,this.zoom=h,this.layerId=_,this.paintVertexAttributes=(r==="array"?RE:OE).members;for(let v=0;v<i.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,r){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,c,h,f){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],f)}_setPaintValues(e,i,r,c){if(!c||!r)return;const{min:h,mid:f,max:_}=r,v=c[h],b=c[f],T=c[_];if(v&&b&&T)for(let C=e;C<i;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,b,v),this._setPaintValue(this.zoomOutPaintVertexArray,C,b,T)}_setPaintValue(e,i,r,c){e.emplace(i,r.tl[0],r.tl[1],r.br[0],r.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],r.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Gs{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!r(h))continue;const f=e.paint.get(h);if(!(f instanceof Be&&Ns(f.property.specification)))continue;const _=VE(h,e.type),v=f.value,b=f.property.specification.type,T=f.property.useIntegerZoom,C=f.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven",z=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||z)if(v.kind==="source"||z||M){const k=jy(h,b,"source");this.binders[h]=M?new $s(v,_,b,T,i,k,e.id):new rs(v,_,b,k),c.push(`/a_${h}`)}else{const k=jy(h,b,"composite");this.binders[h]=new ao(v,_,b,T,i,k),c.push(`/z_${h}`)}else this.binders[h]=M?new nc(v.value,_):new eh(v.value,_,b),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof rs||i instanceof ao?i.maxValue:0}populatePaintArrays(e,i,r,c,h,f){for(const _ in this.binders){const v=this.binders[_];(v instanceof rs||v instanceof ao||v instanceof $s)&&v.populatePaintArray(e,i,r,c,h,f)}}setConstantPatternPositions(e,i){for(const r in this.binders){const c=this.binders[r];c instanceof nc&&c.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,r,c,h,f){let _=!1;for(const v in e){const b=i.getPositions(v);for(const T of b){const C=r.feature(T.index);for(const M in this.binders){const z=this.binders[M];if((z instanceof rs||z instanceof ao||z instanceof $s)&&z.expression.isStateDependent===!0){const k=c.paint.get(M);z.expression=k.value,z.updatePaintArray(T.start,T.end,C,e[v],h,f),_=!0}}}}return _}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof eh||r instanceof nc)&&e.push(...r.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof rs||r instanceof ao||r instanceof $s)for(let c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof eh||r instanceof nc||r instanceof ao)for(const c of r.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof eh||c instanceof nc||c instanceof ao)for(const h of c.uniformNames)i.push({name:h,property:r,binding:c.getBinding(e,h)})}return i}setUniforms(e,i,r,c,h){for(const{name:f,property:_,binding:v}of r)this.binders[_].setUniform(e,v,h,c.get(_),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const r=this.binders[i];if(e&&r instanceof $s){const c=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(r instanceof rs||r instanceof ao)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof rs||r instanceof ao||r instanceof $s)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof rs||i instanceof ao||i instanceof $s)&&i.destroy()}}}class Ua{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Gs(c,i,r);this.needsUpload=!1,this._featureMap=new op,this._bufferOffset=0}populatePaintArrays(e,i,r,c,h,f,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,i,c,h,f,_);i.id!==void 0&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,c,h){for(const f of r)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,c,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function VE(t,e){return jE[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const $E={"line-pattern":{source:Fn,composite:Fn},"fill-pattern":{source:Fn,composite:Fn},"fill-extrusion-pattern":{source:Fn,composite:Fn},"line-dasharray":{source:Nr,composite:Nr}},GE={color:{source:rp,composite:_n},number:{source:wn,composite:rp}};function jy(t,e,i){const r=$E[t];return r&&r[i]||GE[e][i]}mt(eh,"ConstantBinder"),mt(nc,"CrossFadedConstantBinder"),mt(rs,"SourceExpressionBinder"),mt($s,"CrossFadedCompositeBinder"),mt(ao,"CompositeExpressionBinder"),mt(Gs,"ProgramConfiguration",{omit:["_buffers"]}),mt(Ua,"ProgramConfigurationSet");const lp="-transition";class lo extends Qr{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new _e(i.layout)),i.paint)){this._transitionablePaint=new Pe(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Re(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){i!=null&&this._validate(mm,`layers.${this.id}.layout.${e}`,e,i,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Yi(e,lp)?this._transitionablePaint.getTransition(e.slice(0,-lp.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(i!=null&&this._validate(fm,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(Yi(e,lp))return this._transitionablePaint.setTransition(e.slice(0,-lp.length),i||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||h||this._handleOverridablePaintPropertyUpdate(e,_,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),In(e,(i,r)=>!(i===void 0||r==="layout"&&!Object.keys(i).length||r==="paint"&&!Object.keys(i).length))}_validate(e,i,r,c,h={}){return(!h||h.validate!==!1)&&Wu(this,e.call($d,{key:i,layerType:this.type,objectKey:r,value:c,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Be&&Ns(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=$l(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qE=Qe([{name:"a_pos",components:2,type:"Int16"}],4),ZE=Qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ln{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,c){let h=this.segments[this.segments.length-1];return e>ln.MAX_VERTEX_ARRAY_LENGTH&&se(`Max vertices per segment is ${ln.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ln.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,c){return new ln([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])}}ln.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt(ln,"SegmentVector");var Rt=8192;class qs{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof fi?new fi(e.lng,e.lat):fi.convert(e),this}setSouthWest(e){return this._sw=e instanceof fi?new fi(e.lng,e.lat):fi.convert(e),this}extend(e){const i=this._sw,r=this._ne;let c,h;if(e instanceof fi)c=e,h=e;else{if(!(e instanceof qs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qs.convert(e)):this.extend(fi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(fi.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return i||r?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),r.lng=Math.max(h.lng,r.lng),r.lat=Math.max(h.lat,r.lat)):(this._sw=new fi(c.lng,c.lat),this._ne=new fi(h.lng,h.lat)),this}getCenter(){return new fi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fi(this.getWest(),this.getNorth())}getSouthEast(){return new fi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=fi.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&c}static convert(e){return!e||e instanceof qs?e:new qs(e)}}const cp=63710088e-1;class fi{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fi(Jt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,c=e.lat*i,h=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return cp*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new qs(new fi(this.lng-r,this.lat-i),new fi(this.lng+r,this.lat+i))}static convert(e){if(e instanceof fi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new fi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new fi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vy=2*Math.PI*cp;function vm(t){return Vy*Math.cos(t*Math.PI/180)}function Mo(t){return(180+t)/360}function Po(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function jr(t,e){return t/vm(e)}function Ar(t){return 360*t-180}function Ln(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function $y(t,e){return t*vm(Ln(e))}const Do=85.051129;function Gy(t){return 1/Math.cos(t*Math.PI/180)}class rc{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=fi.convert(e);return new rc(Mo(r.lng),Po(r.lat),jr(i,r.lat))}toLngLat(){return new fi(Ar(this.x),Ln(this.y))}toAltitude(){return $y(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Vy*Gy(Ln(this.y))}}function xm(t,e,i,r,c,h,f,_,v){const b=(e+r)/2,T=(i+c)/2,C=new Ce(b,T);_(C),function(M,z,k,B,j,ee){const le=k-j,Q=B-ee;return Math.abs((B-z)*le-(k-M)*Q)/Math.hypot(le,Q)}(C.x,C.y,h.x,h.y,f.x,f.y)>=v?(xm(t,e,i,b,T,h,C,_,v),xm(t,b,T,r,c,C,f,_,v)):t.push(f)}function qy(t,e,i){let r=t[0],c=r.x,h=r.y;e(r);const f=[r];for(let _=1;_<t.length;_++){const v=t[_],{x:b,y:T}=v;e(v),xm(f,c,h,b,T,r,v,e,i),c=b,h=T,r=v}return f}function bm(t,e,i,r){if(r(e,i)){const c=e.add(i)._mult(.5);bm(t,e,c,r),bm(t,c,i,r)}else t.push(i)}function WE(t,e){let i=t[0];const r=[i];for(let c=1;c<t.length;c++){const h=t[c];bm(r,i,h,e),i=h}return r}const wm=Math.pow(2,14)-1,Zy=-wm-1;function HE(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=Ft(i,Zy,wm),t.y=Ft(r,Zy,wm),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&se("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function os(t,e,i){const r=t.loadGeometry(),c=t.extent,h=Rt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:_,x:v,y:b,projection:T}=i,C=M=>{const z=Ar((e.x+M.x/c)/f),k=Ln((e.y+M.y/c)/f),B=T.project(z,k);M.x=(B.x*_-v)*c,M.y=(B.y*_-b)*c};for(let M=0;M<r.length;M++)if(t.type!==1)r[M]=qy(r[M],C,1);else{const z=[];for(const k of r[M])k.x<0||k.x>=c||k.y<0||k.y>=c||(C(k),z.push(k));r[M]=z}}for(const f of r)for(const _ of f)HE(_,h);return r}function ja(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?os(t):[]}}function up(t,e,i,r,c){t.emplaceBack(2*e+(r+1)/2,2*i+(c+1)/2)}function hp(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Em{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new qt,this.indexArray=new Nn,this.segments=new ln,this.programConfigurations=new Ua(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,c){const h=this.layers[0],f=[];let _=null;h.type==="circle"&&(_=h.layout.get("circle-sort-key"));for(const{feature:b,id:T,index:C,sourceLayerIndex:M}of e){const z=this.layers[0]._featureFilter.needGeometry,k=ja(b,z);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),k,r))continue;const B=_?_.evaluate(k,{},r):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:C,geometry:z?k.geometry:os(b,r,c),patterns:{},sortKey:B};f.push(j)}_&&f.sort((b,T)=>b.sortKey-T.sortKey);let v=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new ky,v=c.projection);for(const b of f){const{geometry:T,index:C,sourceLayerIndex:M}=b,z=e[C].feature;this.addFeature(b,T,C,i.availableImages,r,v),i.featureIndex.insert(z,T,C,M,this.index)}}update(e,i,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ZE.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,c,h,f){for(const _ of i)for(const v of _){const b=v.x,T=v.y;if(b<0||b>=Rt||T<0||T>=Rt)continue;if(f){const z=f.projectTilePoint(b,T,h),k=f.upVector(h,b,T),B=this.globeExtVertexArray;hp(B,z,k),hp(B,z,k),hp(B,z,k),hp(B,z,k)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=C.vertexLength;up(this.layoutVertexArray,b,T,-1,-1),up(this.layoutVertexArray,b,T,1,-1),up(this.layoutVertexArray,b,T,1,1),up(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c,h)}}function Wy(t,e){for(let i=0;i<t.length;i++)if(Va(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Va(t,e[i]))return!0;return!!Tm(t,e)}function XE(t,e,i){return!!Va(t,e)||!!Am(e,t,i)}function Hy(t,e){if(t.length===1)return Ky(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let c=0;c<r.length;c++)if(Va(t,r[c]))return!0}for(let i=0;i<t.length;i++)if(Ky(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Tm(t,e[i]))return!0;return!1}function KE(t,e,i){if(t.length>1){if(Tm(t,e))return!0;for(let r=0;r<e.length;r++)if(Am(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Am(t[r],e,i))return!0;return!1}function Tm(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],c=t[i+1];for(let h=0;h<e.length-1;h++)if(YE(r,c,e[h],e[h+1]))return!0}return!1}function YE(t,e,i,r){return me(t,i,r)!==me(e,i,r)&&me(t,e,i)!==me(t,e,r)}function Am(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let c=1;c<e.length;c++)if(Xy(t,e[c-1],e[c])<r)return!0;return!1}function Xy(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const c=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function Ky(t,e){let i,r,c,h=!1;for(let f=0;f<t.length;f++){i=t[f];for(let _=0,v=i.length-1;_<i.length;v=_++)r=i[_],c=i[v],r.y>e.y!=c.y>e.y&&e.x<(c.x-r.x)*(e.y-r.y)/(c.y-r.y)+r.x&&(h=!h)}return h}function Va(t,e){let i=!1;for(let r=0,c=t.length-1;r<t.length;c=r++){const h=t[r],f=t[c];h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(i=!i)}return i}function Yy(t,e,i,r,c){for(const f of t)if(e<=f.x&&i<=f.y&&r>=f.x&&c>=f.y)return!0;const h=[new Ce(e,i),new Ce(e,c),new Ce(r,c),new Ce(r,i)];if(t.length>2){for(const f of h)if(Va(t,f))return!0}for(let f=0;f<t.length-1;f++)if(JE(t[f],t[f+1],h))return!0;return!1}function JE(t,e,i){const r=i[0],c=i[2];if(t.x<r.x&&e.x<r.x||t.x>c.x&&e.x>c.x||t.y<r.y&&e.y<r.y||t.y>c.y&&e.y>c.y)return!1;const h=me(t,e,i[0]);return h!==me(t,e,i[1])||h!==me(t,e,i[2])||h!==me(t,e,i[3])}function oc(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function dp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Jy(t,e,i,r,c){if(!e[0]&&!e[1])return t;const h=Ce.convert(e)._mult(c);i==="viewport"&&h._rotate(-r);const f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(h));return f}function Qy(t,e,i,r){const c=Ce.convert(t)._mult(r);return e==="viewport"&&c._rotate(-i),c}mt(Em,"CircleBucket",{omit:["layers"]});const QE=new Je({"circle-sort-key":new fe(ze.layout_circle["circle-sort-key"])});var eT={paint:new Je({"circle-radius":new fe(ze.paint_circle["circle-radius"]),"circle-color":new fe(ze.paint_circle["circle-color"]),"circle-blur":new fe(ze.paint_circle["circle-blur"]),"circle-opacity":new fe(ze.paint_circle["circle-opacity"]),"circle-translate":new we(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new we(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new we(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new we(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fe(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fe(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fe(ze.paint_circle["circle-stroke-opacity"])}),layout:QE},pp=1e-6,dr=typeof Float32Array<"u"?Float32Array:Array;function ev(){var t=new dr(9);return dr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function tv(t,e,i){var r=e[0],c=e[1],h=e[2],f=e[3],_=e[4],v=e[5],b=e[6],T=e[7],C=e[8],M=i[0],z=i[1],k=i[2],B=i[3],j=i[4],ee=i[5],le=i[6],Q=i[7],ne=i[8];return t[0]=M*r+z*f+k*b,t[1]=M*c+z*_+k*T,t[2]=M*h+z*v+k*C,t[3]=B*r+j*f+ee*b,t[4]=B*c+j*_+ee*T,t[5]=B*h+j*v+ee*C,t[6]=le*r+Q*f+ne*b,t[7]=le*c+Q*_+ne*T,t[8]=le*h+Q*v+ne*C,t}function Lo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sm(t,e){var i=e[0],r=e[1],c=e[2],h=e[3],f=e[4],_=e[5],v=e[6],b=e[7],T=e[8],C=e[9],M=e[10],z=e[11],k=e[12],B=e[13],j=e[14],ee=e[15],le=i*_-r*f,Q=i*v-c*f,ne=i*b-h*f,he=r*v-c*_,re=r*b-h*_,Se=c*b-h*v,Te=T*B-C*k,ke=T*j-M*k,We=T*ee-z*k,De=C*j-M*B,Oe=C*ee-z*B,Fe=M*ee-z*j,je=le*Fe-Q*Oe+ne*De+he*We-re*ke+Se*Te;return je?(t[0]=(_*Fe-v*Oe+b*De)*(je=1/je),t[1]=(c*Oe-r*Fe-h*De)*je,t[2]=(B*Se-j*re+ee*he)*je,t[3]=(M*re-C*Se-z*he)*je,t[4]=(v*We-f*Fe-b*ke)*je,t[5]=(i*Fe-c*We+h*ke)*je,t[6]=(j*ne-k*Se-ee*Q)*je,t[7]=(T*Se-M*ne+z*Q)*je,t[8]=(f*Oe-_*We+b*Te)*je,t[9]=(r*We-i*Oe-h*Te)*je,t[10]=(k*re-B*ne+ee*le)*je,t[11]=(C*ne-T*re-z*le)*je,t[12]=(_*ke-f*De-v*Te)*je,t[13]=(i*De-r*ke+c*Te)*je,t[14]=(B*Q-k*he-j*le)*je,t[15]=(T*he-C*Q+M*le)*je,t):null}function sc(t,e,i){var r=e[0],c=e[1],h=e[2],f=e[3],_=e[4],v=e[5],b=e[6],T=e[7],C=e[8],M=e[9],z=e[10],k=e[11],B=e[12],j=e[13],ee=e[14],le=e[15],Q=i[0],ne=i[1],he=i[2],re=i[3];return t[0]=Q*r+ne*_+he*C+re*B,t[1]=Q*c+ne*v+he*M+re*j,t[2]=Q*h+ne*b+he*z+re*ee,t[3]=Q*f+ne*T+he*k+re*le,t[4]=(Q=i[4])*r+(ne=i[5])*_+(he=i[6])*C+(re=i[7])*B,t[5]=Q*c+ne*v+he*M+re*j,t[6]=Q*h+ne*b+he*z+re*ee,t[7]=Q*f+ne*T+he*k+re*le,t[8]=(Q=i[8])*r+(ne=i[9])*_+(he=i[10])*C+(re=i[11])*B,t[9]=Q*c+ne*v+he*M+re*j,t[10]=Q*h+ne*b+he*z+re*ee,t[11]=Q*f+ne*T+he*k+re*le,t[12]=(Q=i[12])*r+(ne=i[13])*_+(he=i[14])*C+(re=i[15])*B,t[13]=Q*c+ne*v+he*M+re*j,t[14]=Q*h+ne*b+he*z+re*ee,t[15]=Q*f+ne*T+he*k+re*le,t}function th(t,e,i){var r,c,h,f,_,v,b,T,C,M,z,k,B=i[0],j=i[1],ee=i[2];return e===t?(t[12]=e[0]*B+e[4]*j+e[8]*ee+e[12],t[13]=e[1]*B+e[5]*j+e[9]*ee+e[13],t[14]=e[2]*B+e[6]*j+e[10]*ee+e[14],t[15]=e[3]*B+e[7]*j+e[11]*ee+e[15]):(c=e[1],h=e[2],f=e[3],_=e[4],v=e[5],b=e[6],T=e[7],C=e[8],M=e[9],z=e[10],k=e[11],t[0]=r=e[0],t[1]=c,t[2]=h,t[3]=f,t[4]=_,t[5]=v,t[6]=b,t[7]=T,t[8]=C,t[9]=M,t[10]=z,t[11]=k,t[12]=r*B+_*j+C*ee+e[12],t[13]=c*B+v*j+M*ee+e[13],t[14]=h*B+b*j+z*ee+e[14],t[15]=f*B+T*j+k*ee+e[15]),t}function $a(t,e,i){var r=i[0],c=i[1],h=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Cm(t,e,i){var r=Math.sin(i),c=Math.cos(i),h=e[4],f=e[5],_=e[6],v=e[7],b=e[8],T=e[9],C=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*c+b*r,t[5]=f*c+T*r,t[6]=_*c+C*r,t[7]=v*c+M*r,t[8]=b*c-h*r,t[9]=T*c-f*r,t[10]=C*c-_*r,t[11]=M*c-v*r,t}function fp(t,e,i){var r=Math.sin(i),c=Math.cos(i),h=e[0],f=e[1],_=e[2],v=e[3],b=e[8],T=e[9],C=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c-b*r,t[1]=f*c-T*r,t[2]=_*c-C*r,t[3]=v*c-M*r,t[8]=h*r+b*c,t[9]=f*r+T*c,t[10]=_*r+C*c,t[11]=v*r+M*c,t}function iv(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nv(t,e,i){var r,c,h,f=i[0],_=i[1],v=i[2],b=Math.hypot(f,_,v);return b<pp?null:(f*=b=1/b,_*=b,v*=b,r=Math.sin(e),c=Math.cos(e),t[0]=f*f*(h=1-c)+c,t[1]=_*f*h+v*r,t[2]=v*f*h-_*r,t[3]=0,t[4]=f*_*h-v*r,t[5]=_*_*h+c,t[6]=v*_*h+f*r,t[7]=0,t[8]=f*v*h+_*r,t[9]=_*v*h-f*r,t[10]=v*v*h+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var tT=sc;function Im(){var t=new dr(3);return dr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function rv(t){var e=new dr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ih(t){return Math.hypot(t[0],t[1],t[2])}function ac(t,e,i){var r=new dr(3);return r[0]=t,r[1]=e,r[2]=i,r}function ss(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Mm(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function ov(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function nh(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function rh(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Sr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function oh(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Wn(t,e){var i=e[0],r=e[1],c=e[2],h=i*i+r*r+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t}function Vr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Pm(t,e,i){var r=e[0],c=e[1],h=e[2],f=i[0],_=i[1],v=i[2];return t[0]=c*v-h*_,t[1]=h*f-r*v,t[2]=r*_-c*f,t}function cn(t,e,i){var r=e[0],c=e[1],h=e[2],f=i[3]*r+i[7]*c+i[11]*h+i[15];return t[0]=(i[0]*r+i[4]*c+i[8]*h+i[12])/(f=f||1),t[1]=(i[1]*r+i[5]*c+i[9]*h+i[13])/f,t[2]=(i[2]*r+i[6]*c+i[10]*h+i[14])/f,t}function sv(t,e,i){var r=i[0],c=i[1],h=i[2],f=e[0],_=e[1],v=e[2],b=c*v-h*_,T=h*f-r*v,C=r*_-c*f,M=c*C-h*T,z=h*b-r*C,k=r*T-c*b,B=2*i[3];return T*=B,C*=B,z*=2,k*=2,t[0]=f+(b*=B)+(M*=2),t[1]=_+T+z,t[2]=v+C+k,t}var sh,co=Mm,iT=ov,nT=ih;function av(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function lv(t,e){var i=e[0],r=e[1],c=e[2],h=e[3],f=i*i+r*r+c*c+h*h;return f>0&&(f=1/Math.sqrt(f)),t[0]=i*f,t[1]=r*f,t[2]=c*f,t[3]=h*f,t}function Ga(t,e,i){var r=e[0],c=e[1],h=e[2],f=e[3];return t[0]=i[0]*r+i[4]*c+i[8]*h+i[12]*f,t[1]=i[1]*r+i[5]*c+i[9]*h+i[13]*f,t[2]=i[2]*r+i[6]*c+i[10]*h+i[14]*f,t[3]=i[3]*r+i[7]*c+i[11]*h+i[15]*f,t}function cv(){var t=new dr(4);return dr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function uv(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function hv(t,e,i){i*=.5;var r=e[0],c=e[1],h=e[2],f=e[3],_=Math.sin(i),v=Math.cos(i);return t[0]=r*v+f*_,t[1]=c*v+h*_,t[2]=h*v-c*_,t[3]=f*v-r*_,t}function dv(t,e,i){i*=.5;var r=e[0],c=e[1],h=e[2],f=e[3],_=Math.sin(i),v=Math.cos(i);return t[0]=r*v-h*_,t[1]=c*v+f*_,t[2]=h*v+r*_,t[3]=f*v-c*_,t}Im(),sh=new dr(4),dr!=Float32Array&&(sh[0]=0,sh[1]=0,sh[2]=0,sh[3]=0);var rT=lv;Im(),ac(1,0,0),ac(0,1,0),cv(),cv(),ev();class Dm{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const c=Vr(i,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return r[0]=this.pos[0]+this.dir[0]*h,r[1]=this.pos[1]+this.dir[1]*h,r[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,r){if(function(z,k){var B=z[0],j=z[1],ee=z[2],le=k[0],Q=k[1],ne=k[2];return Math.abs(B-le)<=pp*Math.max(1,Math.abs(B),Math.abs(le))&&Math.abs(j-Q)<=pp*Math.max(1,Math.abs(j),Math.abs(Q))&&Math.abs(ee-ne)<=pp*Math.max(1,Math.abs(ee),Math.abs(ne))}(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[c,h,f]=this.dir,_=this.pos[0]-e[0],v=this.pos[1]-e[1],b=this.pos[2]-e[2],T=c*c+h*h+f*f,C=2*(_*c+v*h+b*f),M=C*C-4*T*(_*_+v*v+b*b-i*i);if(M<0){const z=Math.max(-C/2,0),k=_+c*z,B=v+h*z,j=b+f*z,ee=Math.hypot(k,B,j);return r[0]=k*i/ee,r[1]=B*i/ee,r[2]=j*i/ee,!1}{const z=(-C-Math.sqrt(M))/(2*T);if(z<0){const k=Math.hypot(_,v,b);return r[0]=_*i/k,r[1]=v*i/k,r[2]=b*i/k,!1}return r[0]=_+c*z,r[1]=v+h*z,r[2]=b+f*z,!0}}}class Lm{constructor(e,i,r,c,h){this.TL=e,this.TR=i,this.BR=r,this.BL=c,this.horizon=h}static fromInvProjectionMatrix(e,i,r){const c=[-1,1,1],h=[1,1,1],f=[1,-1,1],_=[-1,-1,1],v=cn(c,c,e),b=cn(h,h,e),T=cn(f,f,e),C=cn(_,_,e);return new Lm(v,b,T,C,i/r)}}class zm{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,c){const h=Math.pow(2,r),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const b=Ga([],v,e),T=1/b[3]/i*h;return function(C,M,z){return C[0]=M[0]*z[0],C[1]=M[1]*z[1],C[2]=M[2]*z[2],C[3]=M[3]*z[3],C}(b,b,[T,T,c?1/b[3]:T,T])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const b=Wn([],Pm([],co([],f[v[0]],f[v[1]]),co([],f[v[2]],f[v[1]]))),T=-Vr(b,f[v[1]]);return b.concat(T)});return new zm(f,_)}}class Hn{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const c of e)nh(i,i,c),rh(r,r,c);return new Hn(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let c=0;c<r.length;++c)cn(r[c],r[c],i);return Hn.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=Sr([],ss([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=rv(this.min),c=rv(this.max);for(let h=0;h<i.length;h++)r[h]=i[h]?this.min[h]:this.center[h],c[h]=i[h]?this.center[h]:this.max[h];return c[2]=this.max[2],new Hn(r,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let c=0;c<e.planes.length;c++){const h=e.planes[c];let f=0;for(let _=0;_<i.length;_++)f+=Vr(h,i[_])+h[3]>=0;if(f===0)return 0;f!==i.length&&(r=!1)}if(r)return 2;for(let c=0;c<3;c++){let h=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){const v=e.points[_][c]-this.min[c];h=Math.min(h,v),f=Math.max(f,v)}if(f<0||h>this.max[c]-this.min[c])return 0}return 1}}function pv(t,e,i,r,c,h,f,_,v){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(v*=t.pixelToTileUnitsFactor);const b=t.tileID.canonical,T=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const M of C){const z=M.add(_),k=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(z.x,z.y,!0):0,B=i.projection.projectTilePoint(z.x,z.y,b);if(k>0){const Q=i.projection.upVector(b,z.x,z.y);B.x+=Q[0]*T*k,B.y+=Q[1]*T*k,B.z+=Q[2]*T*k}const j=h?z:oT(B.x,B.y,B.z,r),ee=h?t.tilespaceRays.map(Q=>aT(Q,k)):t.queryGeometry.screenGeometry,le=Ga([],[B.x,B.y,B.z,1],r);if(!f&&h?v*=le[3]/i.cameraToCenterDistance:f&&!h&&(v*=i.cameraToCenterDistance/le[3]),h){const Q=Ln((M.y/Rt+b.y)/(1<<b.z));v/=i.projection.pixelsPerMeter(Q,1)/jr(1,Q)}if(XE(ee,j,v))return!0}return!1}function oT(t,e,i,r){const c=Ga([],[t,e,i,1],r);return new Ce(c[0]/c[3],c[1]/c[3])}const fv=ac(0,0,0),sT=ac(0,0,1);function aT(t,e){const i=Im();return fv[2]=e,t.intersectsPlane(fv,sT,i),new Ce(i[0],i[1])}class mv extends Em{}function _v(t,{width:e,height:i},r,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=c,t}function gv(t,e,i){const{width:r,height:c}=e;r===t.width&&c===t.height||(km(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,c)},i),t.width=r,t.height=c,t.data=e.data)}function km(t,e,i,r,c,h){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||i.x>t.width-c.width||i.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||r.x>e.width-c.width||r.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=t.data,_=e.data;for(let v=0;v<c.height;v++){const b=((i.y+v)*t.width+i.x)*h,T=((r.y+v)*e.width+r.x)*h;for(let C=0;C<c.width*h;C++)_[T+C]=f[b+C]}return e}mt(mv,"HeatmapBucket",{omit:["layers"]});class as{constructor(e,i){_v(this,e,1,i)}resize(e){gv(this,new as(e),1)}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,c,h){km(e,i,r,c,h,1)}}class pr{constructor(e,i){_v(this,e,4,i)}resize(e){gv(this,new pr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,c,h){km(e,i,r,c,h,4)}}mt(as,"AlphaImage"),mt(pr,"RGBAImage");var lT={paint:new Je({"heatmap-radius":new fe(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fe(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new we(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tt(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new we(ze.paint_heatmap["heatmap-opacity"])})};function Om(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,c=t.image||new pr({width:i,height:r}),h=(f,_,v)=>{e[t.evaluationKey]=v;const b=t.expression.evaluate(e);c.data[f+_+0]=Math.floor(255*b.r/b.a),c.data[f+_+1]=Math.floor(255*b.g/b.a),c.data[f+_+2]=Math.floor(255*b.b/b.a),c.data[f+_+3]=Math.floor(255*b.a)};if(t.clips)for(let f=0,_=0;f<r;++f,_+=4*i)for(let v=0,b=0;v<i;v++,b+=4){const T=v/(i-1),{start:C,end:M}=t.clips[f];h(_,b,C*(1-T)+M*T)}else for(let f=0,_=0;f<i;f++,_+=4)h(0,_,f/(i-1));return c}var cT={paint:new Je({"hillshade-illumination-direction":new we(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new we(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new we(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new we(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new we(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new we(ze.paint_hillshade["hillshade-accent-color"])})};const uT=Qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:hT}=uT;var ah={exports:{}};function mp(t,e,i){i=i||2;var r,c,h,f,_,v,b,T=e&&e.length,C=T?e[0]*i:t.length,M=yv(t,0,C,i,!0),z=[];if(!M||M.next===M.prev)return z;if(T&&(M=function(B,j,ee,le){var Q,ne,he,re=[];for(Q=0,ne=j.length;Q<ne;Q++)(he=yv(B,j[Q]*le,Q<ne-1?j[Q+1]*le:B.length,le,!1))===he.next&&(he.steiner=!0),re.push(vT(he));for(re.sort(_T),Q=0;Q<re.length;Q++)ee=gT(re[Q],ee);return ee}(t,e,M,i)),t.length>80*i){r=h=t[0],c=f=t[1];for(var k=i;k<C;k+=i)(_=t[k])<r&&(r=_),(v=t[k+1])<c&&(c=v),_>h&&(h=_),v>f&&(f=v);b=(b=Math.max(h-r,f-c))!==0?32767/b:0}return lh(M,z,i,r,c,b,0),z}function yv(t,e,i,r,c){var h,f;if(c===Fm(t,e,i,r)>0)for(h=e;h<i;h+=r)f=bv(h,t[h],t[h+1],f);else for(h=i-r;h>=e;h-=r)f=bv(h,t[h],t[h+1],f);return f&&_p(f,f.next)&&(uh(f),f=f.next),f}function qa(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!_p(r,r.next)&&rn(r.prev,r,r.next)!==0)r=r.next;else{if(uh(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function lh(t,e,i,r,c,h,f){if(t){!f&&h&&function(T,C,M,z){var k=T;do k.z===0&&(k.z=Rm(k.x,k.y,C,M,z)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==T);k.prevZ.nextZ=null,k.prevZ=null,function(B){var j,ee,le,Q,ne,he,re,Se,Te=1;do{for(ee=B,B=null,ne=null,he=0;ee;){for(he++,le=ee,re=0,j=0;j<Te&&(re++,le=le.nextZ);j++);for(Se=Te;re>0||Se>0&&le;)re!==0&&(Se===0||!le||ee.z<=le.z)?(Q=ee,ee=ee.nextZ,re--):(Q=le,le=le.nextZ,Se--),ne?ne.nextZ=Q:B=Q,Q.prevZ=ne,ne=Q;ee=le}ne.nextZ=null,Te*=2}while(he>1)}(k)}(t,r,c,h);for(var _,v,b=t;t.prev!==t.next;)if(_=t.prev,v=t.next,h?pT(t,r,c,h):dT(t))e.push(_.i/i|0),e.push(t.i/i|0),e.push(v.i/i|0),uh(t),t=v.next,b=v.next;else if((t=v)===b){f?f===1?lh(t=fT(qa(t),e,i),e,i,r,c,h,2):f===2&&mT(t,e,i,r,c,h):lh(qa(t),e,i,r,c,h,1);break}}}function dT(t){var e=t.prev,i=t,r=t.next;if(rn(e,i,r)>=0)return!1;for(var c=e.x,h=i.x,f=r.x,_=e.y,v=i.y,b=r.y,T=c<h?c<f?c:f:h<f?h:f,C=_<v?_<b?_:b:v<b?v:b,M=c>h?c>f?c:f:h>f?h:f,z=_>v?_>b?_:b:v>b?v:b,k=r.next;k!==e;){if(k.x>=T&&k.x<=M&&k.y>=C&&k.y<=z&&lc(c,_,h,v,f,b,k.x,k.y)&&rn(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function pT(t,e,i,r){var c=t.prev,h=t,f=t.next;if(rn(c,h,f)>=0)return!1;for(var _=c.x,v=h.x,b=f.x,T=c.y,C=h.y,M=f.y,z=_<v?_<b?_:b:v<b?v:b,k=T<C?T<M?T:M:C<M?C:M,B=_>v?_>b?_:b:v>b?v:b,j=T>C?T>M?T:M:C>M?C:M,ee=Rm(z,k,e,i,r),le=Rm(B,j,e,i,r),Q=t.prevZ,ne=t.nextZ;Q&&Q.z>=ee&&ne&&ne.z<=le;){if(Q.x>=z&&Q.x<=B&&Q.y>=k&&Q.y<=j&&Q!==c&&Q!==f&&lc(_,T,v,C,b,M,Q.x,Q.y)&&rn(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ne.x>=z&&ne.x<=B&&ne.y>=k&&ne.y<=j&&ne!==c&&ne!==f&&lc(_,T,v,C,b,M,ne.x,ne.y)&&rn(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;Q&&Q.z>=ee;){if(Q.x>=z&&Q.x<=B&&Q.y>=k&&Q.y<=j&&Q!==c&&Q!==f&&lc(_,T,v,C,b,M,Q.x,Q.y)&&rn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ne&&ne.z<=le;){if(ne.x>=z&&ne.x<=B&&ne.y>=k&&ne.y<=j&&ne!==c&&ne!==f&&lc(_,T,v,C,b,M,ne.x,ne.y)&&rn(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function fT(t,e,i){var r=t;do{var c=r.prev,h=r.next.next;!_p(c,h)&&vv(c,r,r.next,h)&&ch(c,h)&&ch(h,c)&&(e.push(c.i/i|0),e.push(r.i/i|0),e.push(h.i/i|0),uh(r),uh(r.next),r=t=h),r=r.next}while(r!==t);return qa(r)}function mT(t,e,i,r,c,h){var f=t;do{for(var _=f.next.next;_!==f.prev;){if(f.i!==_.i&&xT(f,_)){var v=xv(f,_);return f=qa(f,f.next),v=qa(v,v.next),lh(f,e,i,r,c,h,0),void lh(v,e,i,r,c,h,0)}_=_.next}f=f.next}while(f!==t)}function _T(t,e){return t.x-e.x}function gT(t,e){var i=function(c,h){var f,_=h,v=c.x,b=c.y,T=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){var C=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(C<=v&&C>T&&(T=C,f=_.x<_.next.x?_:_.next,C===v))return f}_=_.next}while(_!==h);if(!f)return null;var M,z=f,k=f.x,B=f.y,j=1/0;_=f;do v>=_.x&&_.x>=k&&v!==_.x&&lc(b<B?v:T,b,k,B,b<B?T:v,b,_.x,_.y)&&(M=Math.abs(b-_.y)/(v-_.x),ch(_,c)&&(M<j||M===j&&(_.x>f.x||_.x===f.x&&yT(f,_)))&&(f=_,j=M)),_=_.next;while(_!==z);return f}(t,e);if(!i)return e;var r=xv(i,t);return qa(r,r.next),qa(i,i.next)}function yT(t,e){return rn(t.prev,t,e.prev)<0&&rn(e.next,t,t.next)<0}function Rm(t,e,i,r,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vT(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function lc(t,e,i,r,c,h,f,_){return(c-f)*(e-_)>=(t-f)*(h-_)&&(t-f)*(r-_)>=(i-f)*(e-_)&&(i-f)*(h-_)>=(c-f)*(r-_)}function xT(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==r.i&&c.next.i!==r.i&&vv(c,c.next,i,r))return!0;c=c.next}while(c!==i);return!1}(t,e)&&(ch(t,e)&&ch(e,t)&&function(i,r){var c=i,h=!1,f=(i.x+r.x)/2,_=(i.y+r.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==i);return h}(t,e)&&(rn(t.prev,t,e.prev)||rn(t,e.prev,e))||_p(t,e)&&rn(t.prev,t,t.next)>0&&rn(e.prev,e,e.next)>0)}function rn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _p(t,e){return t.x===e.x&&t.y===e.y}function vv(t,e,i,r){var c=yp(rn(t,e,i)),h=yp(rn(t,e,r)),f=yp(rn(i,r,t)),_=yp(rn(i,r,e));return c!==h&&f!==_||!(c!==0||!gp(t,i,e))||!(h!==0||!gp(t,r,e))||!(f!==0||!gp(i,t,r))||!(_!==0||!gp(i,e,r))}function gp(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function yp(t){return t>0?1:t<0?-1:0}function ch(t,e){return rn(t.prev,t,t.next)<0?rn(t,e,t.next)>=0&&rn(t,t.prev,e)>=0:rn(t,e,t.prev)<0||rn(t,t.next,e)<0}function xv(t,e){var i=new Bm(t.i,t.x,t.y),r=new Bm(e.i,e.x,e.y),c=t.next,h=e.prev;return t.next=e,e.prev=t,i.next=c,c.prev=i,r.next=i,i.prev=r,h.next=r,r.prev=h,r}function bv(t,e,i,r){var c=new Bm(t,e,i);return r?(c.next=r.next,c.prev=r,r.next.prev=c,r.next=c):(c.prev=c,c.next=c),c}function uh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Bm(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fm(t,e,i,r){for(var c=0,h=e,f=i-r;h<i;h+=r)c+=(t[f]-t[h])*(t[h+1]+t[f+1]),f=h;return c}function bT(t,e,i,r,c){wv(t,e,i||0,r||t.length-1,c||wT)}function wv(t,e,i,r,c){for(;r>i;){if(r-i>600){var h=r-i+1,f=e-i+1,_=Math.log(h),v=.5*Math.exp(2*_/3),b=.5*Math.sqrt(_*v*(h-v)/h)*(f-h/2<0?-1:1);wv(t,e,Math.max(i,Math.floor(e-f*v/h+b)),Math.min(r,Math.floor(e+(h-f)*v/h+b)),c)}var T=t[e],C=i,M=r;for(hh(t,i,e),c(t[r],T)>0&&hh(t,i,r);C<M;){for(hh(t,C,M),C++,M--;c(t[C],T)<0;)C++;for(;c(t[M],T)>0;)M--}c(t[i],T)===0?hh(t,i,M):hh(t,++M,r),M<=e&&(i=M+1),e<=M&&(r=M-1)}}function hh(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function wT(t,e){return t<e?-1:t>e?1:0}function Nm(t,e){const i=t.length;if(i<=1)return[t];const r=[];let c,h;for(let f=0;f<i;f++){const _=Me(t[f]);_!==0&&(t[f].area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(c&&r.push(c),c=[t[f]]):c.push(t[f]))}if(c&&r.push(c),e>1)for(let f=0;f<r.length;f++)r[f].length<=e||(bT(r[f],e,1,r[f].length-1,ET),r[f]=r[f].slice(0,e));return r}function ET(t,e){return e.area-t.area}function Um(t,e,i){const r=i.patternDependencies;let c=!1;for(const h of e){const f=h.paint.get(`${t}-pattern`);f.isConstant()||(c=!0);const _=f.constantOr(null);_&&(c=!0,r[_.to]=!0,r[_.from]=!0)}return c}function jm(t,e,i,r,c){const h=c.patternDependencies;for(const f of e){const _=f.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let v=_.evaluate({zoom:r-1},i,{},c.availableImages),b=_.evaluate({zoom:r},i,{},c.availableImages),T=_.evaluate({zoom:r+1},i,{},c.availableImages);v=v&&v.name?v.name:v,b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,h[v]=!0,h[b]=!0,h[T]=!0,i.patterns[f.id]={min:v,mid:b,max:T}}}return i}ah.exports=mp,ah.exports.default=mp,mp.deviation=function(t,e,i,r){var c=e&&e.length,h=Math.abs(Fm(t,0,c?e[0]*i:t.length,i));if(c)for(var f=0,_=e.length;f<_;f++)h-=Math.abs(Fm(t,e[f]*i,f<_-1?e[f+1]*i:t.length,i));var v=0;for(f=0;f<r.length;f+=3){var b=r[f]*i,T=r[f+1]*i,C=r[f+2]*i;v+=Math.abs((t[b]-t[C])*(t[T+1]-t[b+1])-(t[b]-t[T])*(t[C+1]-t[b+1]))}return h===0&&v===0?0:Math.abs((v-h)/h)},mp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,c=0;c<t.length;c++){for(var h=0;h<t[c].length;h++)for(var f=0;f<e;f++)i.vertices.push(t[c][h][f]);c>0&&i.holes.push(r+=t[c-1].length)}return i};class vp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qt,this.indexArray=new Nn,this.indexArray2=new Tr,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new ln,this.segments2=new ln,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,c){this.hasPattern=Um("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:_,id:v,index:b,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,M=ja(_,C);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),M,r))continue;const z=h?h.evaluate(M,{},r,i.availableImages):void 0,k={id:v,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:C?M.geometry:os(_,r,c),patterns:{},sortKey:z};f.push(k)}h&&f.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of f){const{geometry:v,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){const C=jm("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(_,v,b,r,{},i.availableImages);i.featureIndex.insert(e[b].feature,v,b,T,this.index)}}update(e,i,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,c)}addFeatures(e,i,r,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,c,h,f=[]){for(const _ of Nm(i,500)){let v=0;for(const k of _)v+=k.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=b.vertexLength,C=[],M=[];for(const k of _){if(k.length===0)continue;k!==_[0]&&M.push(C.length/2);const B=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),j=B.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(j+k.length-1,j),C.push(k[0].x),C.push(k[0].y);for(let ee=1;ee<k.length;ee++)this.layoutVertexArray.emplaceBack(k[ee].x,k[ee].y),this.indexArray2.emplaceBack(j+ee-1,j+ee),C.push(k[ee].x),C.push(k[ee].y);B.vertexLength+=k.length,B.primitiveLength+=k.length}const z=ah.exports(C,M);for(let k=0;k<z.length;k+=3)this.indexArray.emplaceBack(T+z[k],T+z[k+1],T+z[k+2]);b.vertexLength+=v,b.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,f,c)}}mt(vp,"FillBucket",{omit:["layers","patternFeatures"]});const TT=new Je({"fill-sort-key":new fe(ze.layout_fill["fill-sort-key"])});var AT={paint:new Je({"fill-antialias":new we(ze.paint_fill["fill-antialias"]),"fill-opacity":new fe(ze.paint_fill["fill-opacity"]),"fill-color":new fe(ze.paint_fill["fill-color"]),"fill-outline-color":new fe(ze.paint_fill["fill-outline-color"]),"fill-translate":new we(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new we(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new st(ze.paint_fill["fill-pattern"])}),layout:TT};const ST=Qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),CT=Qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IT=Qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MT}=ST;var xp={},PT=Ce,Ev=cc;function cc(t,e,i,r,c){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=c,t.readFields(DT,this,e)}function DT(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,c){for(var h=r.readVarint()+r.pos;r.pos<h;){var f=c._keys[r.readVarint()],_=c._values[r.readVarint()];c.properties[f]=_}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function LT(t){for(var e,i,r=0,c=0,h=t.length,f=h-1;c<h;f=c++)r+=((i=t[f]).x-(e=t[c]).x)*(e.y+i.y);return r}cc.types=["Unknown","Point","LineString","Polygon"],cc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,c=0,h=0,f=0,_=[];t.pos<i;){if(c<=0){var v=t.readVarint();r=7&v,c=v>>3}if(c--,r===1||r===2)h+=t.readSVarint(),f+=t.readSVarint(),r===1&&(e&&_.push(e),e=[]),e.push(new PT(h,f));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&_.push(e),_},cc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,c=0,h=0,f=1/0,_=-1/0,v=1/0,b=-1/0;t.pos<e;){if(r<=0){var T=t.readVarint();i=7&T,r=T>>3}if(r--,i===1||i===2)(c+=t.readSVarint())<f&&(f=c),c>_&&(_=c),(h+=t.readSVarint())<v&&(v=h),h>b&&(b=h);else if(i!==7)throw new Error("unknown command "+i)}return[f,v,_,b]},cc.prototype.toGeoJSON=function(t,e,i){var r,c,h=this.extent*Math.pow(2,i),f=this.extent*t,_=this.extent*e,v=this.loadGeometry(),b=cc.types[this.type];function T(z){for(var k=0;k<z.length;k++){var B=z[k];z[k]=[360*(B.x+f)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+_)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(r=0;r<v.length;r++)C[r]=v[r][0];T(v=C);break;case 2:for(r=0;r<v.length;r++)T(v[r]);break;case 3:for(v=function(z){var k=z.length;if(k<=1)return[z];for(var B,j,ee=[],le=0;le<k;le++){var Q=LT(z[le]);Q!==0&&(j===void 0&&(j=Q<0),j===Q<0?(B&&ee.push(B),B=[z[le]]):B.push(z[le]))}return B&&ee.push(B),ee}(v),r=0;r<v.length;r++)for(c=0;c<v[r].length;c++)T(v[r][c])}v.length===1?v=v[0]:b="Multi"+b;var M={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(M.id=this.id),M};var zT=Ev,Tv=Av;function Av(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(kT,this,e),this.length=this._features.length}function kT(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var c=null,h=r.readVarint()+r.pos;r.pos<h;){var f=r.readVarint()>>3;c=f===1?r.readString():f===2?r.readFloat():f===3?r.readDouble():f===4?r.readVarint64():f===5?r.readVarint():f===6?r.readSVarint():f===7?r.readBoolean():null}return c}(i))}Av.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new zT(this._pbf,e,this.extent,this._keys,this._values)};var OT=Tv;function RT(t,e,i){if(t===3){var r=new OT(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Vm=xp.VectorTile=function(t,e){this.layers=t.readFields(RT,{},e)},bp=xp.VectorTileFeature=Ev;function wp(t,e,i,r){const c=[],h=r===0?(f,_,v,b,T,C)=>{f.push(new Ce(C,v+(C-_)/(b-_)*(T-v)))}:(f,_,v,b,T,C)=>{f.push(new Ce(_+(C-v)/(T-v)*(b-_),C))};for(const f of t){const _=[];for(const v of f){if(v.length<=2)continue;const b=[];for(let M=0;M<v.length-1;M++){const z=v[M].x,k=v[M].y,B=v[M+1].x,j=v[M+1].y,ee=r===0?z:k,le=r===0?B:j;ee<e?le>e&&h(b,z,k,B,j,e):ee>i?le<i&&h(b,z,k,B,j,i):b.push(v[M]),le<e&&ee>=e&&h(b,z,k,B,j,e),le>i&&ee<=i&&h(b,z,k,B,j,i)}let T=v[v.length-1];const C=r===0?T.x:T.y;C>=e&&C<=i&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&c.push(_)}return c}xp.VectorTileLayer=Tv;const BT=bp.types,FT=Math.pow(2,13);function dh(t,e,i,r,c,h,f,_){t.emplaceBack((e<<1)+f,(i<<1)+h,(Math.floor(r*FT)<<1)+c,Math.round(_))}function ph(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Sv{constructor(){this.acc=new Ce(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ce(e.x,e.y),this.max=new Ce(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,c=this.max;e.x<r.x?r.x=e.x:e.x>c.x&&(c.x=e.x),e.y<r.y?r.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===Rt)&&e.x===i.x)!=((e.y===0||e.y===Rt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,ai(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Rt!=e.x>Rt&&this.addBorderIntersection(1,ai(i.y,e.y,(Rt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ai(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Rt!=e.y>Rt&&this.addBorderIntersection(3,ai(i.x,e.x,(Rt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return e!==0?this.acc.div(e)._round():new Ce(0,0)}span(){return new Ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class fh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ai,this.centroidVertexArray=new Ly,this.indexArray=new Nn,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new ln,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,c){this.features=[],this.hasPattern=Um("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const f=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*f/(f*f+1)/Rt/(1<<h.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:f,index:_,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,T=ja(h,b);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),T,r))continue;const C={id:f,sourceLayerIndex:v,index:_,geometry:b?T.geometry:os(h,r,c),properties:h.properties,type:h.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(jm("fill-extrusion",this.layers,C,this.zoom,i)):this.addFeature(C,C.geometry,_,r,{},i.availableImages,c),i.featureIndex.insert(h,C.geometry,_,v,this.index,M)}this.sortBorders()}addFeatures(e,i,r,c,h){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,i,r,c,h)}this.sortBorders()}update(e,i,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,IT.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,CT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,c,h,f,_){const v=[new Ce(0,0),new Ce(Rt,Rt)],b=_.projection,T=b.name==="globe",C=this.enableTerrain&&!T?new Sv:null,M=BT[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new by);const z=Nm(i,500);for(let ee=z.length-1;ee>=0;ee--){const le=z[ee];(le.length===0||(k=le[0]).every(Q=>Q.x<=0)||k.every(Q=>Q.x>=Rt)||k.every(Q=>Q.y<=0)||k.every(Q=>Q.y>=Rt))&&z.splice(ee,1)}var k;let B;if(T)B=zv(z,v,c);else{B=[];for(const ee of z)B.push({polygon:ee,bounds:v})}const j=M?this.edgeRadius:0;for(const{polygon:ee,bounds:le}of B){let Q=0,ne=0;for(const re of ee)M&&!re[0].equals(re[re.length-1])&&re.push(re[0]),ne+=M?re.length-1:re.length;const he=this.segments.prepareSegment((M?5:4)*ne,this.layoutVertexArray,this.indexArray);if(M){const re=[],Se=[];Q=he.vertexLength;for(const ke of ee){let We,De;ke.length&&ke!==ee[0]&&Se.push(re.length/2),We=ke[1].sub(ke[0])._perp()._unit();for(let Oe=1;Oe<ke.length;Oe++){const Fe=ke[Oe],je=ke[Oe===ke.length-1?1:Oe+1];let{x:He,y:Le}=Fe;if(j){De=je.sub(Fe)._perp()._unit();const ot=We.add(De)._unit(),Dt=j*Math.min(4,1/(We.x*ot.x+We.y*ot.y));He+=Dt*ot.x,Le+=Dt*ot.y,We=De}dh(this.layoutVertexArray,He,Le,0,0,1,1,0),he.vertexLength++,re.push(Fe.x,Fe.y),T&&ph(this.layoutVertexExtArray,b.projectTilePoint(He,Le,c),b.upVector(c,He,Le))}}const Te=ah.exports(re,Se);for(let ke=0;ke<Te.length;ke+=3)this.indexArray.emplaceBack(Q+Te[ke],Q+Te[ke+2],Q+Te[ke+1]),he.primitiveLength++}for(const re of ee){C&&re.length&&C.startRing(re[0]);let Se,Te,ke,We=re.length>4&&Pv(re[re.length-2],re[0],re[1]),De=j?NT(re[re.length-2],re[0],re[1],j):0;Te=re[1].sub(re[0])._perp()._unit();let Oe=!0;for(let Fe=1,je=0;Fe<re.length;Fe++){let He=re[Fe-1],Le=re[Fe];const ot=re[Fe===re.length-1?1:Fe+1];if(C&&M&&C.currentPolyCount.top++,Mv(Le,He,le)){j&&(Te=ot.sub(Le)._perp()._unit(),Oe=!Oe);continue}C&&C.append(Le,He);const Dt=Le.sub(He)._perp(),ht=Dt.x/(Math.abs(Dt.x)+Math.abs(Dt.y)),yt=Dt.y>0?1:0,at=He.dist(Le);if(je+at>32768&&(je=0),j){ke=ot.sub(Le)._perp()._unit();let ri=Iv(He,Le,ot,Cv(Te,ke),j);isNaN(ri)&&(ri=0);const Ut=Le.sub(He)._unit();He=He.add(Ut.mult(De))._round(),Le=Le.add(Ut.mult(-ri))._round(),De=ri,Te=ke}const zt=he.vertexLength,jt=re.length>4&&Pv(He,Le,ot);let $t=Dv(je,We,Oe);if(dh(this.layoutVertexArray,He.x,He.y,ht,yt,0,0,$t),dh(this.layoutVertexArray,He.x,He.y,ht,yt,0,1,$t),je+=at,$t=Dv(je,jt,!Oe),We=jt,dh(this.layoutVertexArray,Le.x,Le.y,ht,yt,0,0,$t),dh(this.layoutVertexArray,Le.x,Le.y,ht,yt,0,1,$t),he.vertexLength+=4,this.indexArray.emplaceBack(zt+0,zt+1,zt+2),this.indexArray.emplaceBack(zt+1,zt+3,zt+2),he.primitiveLength+=2,j){const ri=Q+(Fe===1?re.length-2:Fe-2),Ut=Fe===1?Q:ri+1;if(this.indexArray.emplaceBack(zt+1,ri,zt+3),this.indexArray.emplaceBack(ri,Ut,zt+3),he.primitiveLength+=2,Se===void 0&&(Se=zt),!Mv(ot,re[Fe],le)){const Ui=Fe===re.length-1?Se:he.vertexLength;this.indexArray.emplaceBack(zt+2,zt+3,Ui),this.indexArray.emplaceBack(zt+3,Ui+1,Ui),this.indexArray.emplaceBack(zt+3,Ut,Ui+1),he.primitiveLength+=3}Oe=!Oe}if(T){const ri=this.layoutVertexExtArray,Ut=b.projectTilePoint(He.x,He.y,c),Ui=b.projectTilePoint(Le.x,Le.y,c),Zt=b.upVector(c,He.x,He.y),Qt=b.upVector(c,Le.x,Le.y);ph(ri,Ut,Zt),ph(ri,Ut,Zt),ph(ri,Ui,Qt),ph(ri,Ui,Qt)}}M&&(Q+=re.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const ee=C.borders,le=this.featuresOnBorder.push(C)-1;for(let Q=0;Q<4;Q++)ee[Q][0]!==Number.MAX_VALUE&&this.borders[Q].push(le)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,f,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let c,h;if(e)if(e.y!==0){const _=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(_.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(_.y/10))}else c=Math.ceil(7*(e.x+450)),h=0;else c=0,h=+r;let f=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const _ of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*_.edges+_.top);for(let v=0;v<_.top;v++)this.centroidVertexArray.emplace(f++,c,h);for(let v=0;v<2*_.edges;v++)this.centroidVertexArray.emplace(f++,0,h),this.centroidVertexArray.emplace(f++,c,h)}}}function Cv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function NT(t,e,i,r){const c=e.sub(t)._perp()._unit(),h=i.sub(e)._perp()._unit();return Iv(t,e,i,Cv(c,h),r)}function Iv(t,e,i,r,c){const h=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,c*h/r)}function Mv(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Pv(t,e,i){if(t.x<0||t.x>=Rt||e.x<0||e.x>=Rt||i.x<0||i.x>=Rt)return!1;const r=i.sub(e),c=r.perp(),h=t.sub(e);return(r.x*h.x+r.y*h.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(h.x*h.x+h.y*h.y))>-.866&&c.x*h.x+c.y*h.y<0}function Dv(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function Lv(){const t=Math.PI/32,e=Math.tan(t),i=cp;return i*Math.sqrt(1+2*e*e)-i}function zv(t,e,i){const r=1<<i.z,c=Ar(i.x/r),h=Ar((i.x+1)/r),f=Ln(i.y/r),_=Ln((i.y+1)/r);return function(v,b,T,C,M=0,z){const k=[];if(!v.length||!T||!C)return k;const B=(re,Se)=>{for(const Te of re)k.push({polygon:Te,bounds:Se})},j=Math.ceil(Math.log2(T)),ee=Math.ceil(Math.log2(C)),le=j-ee,Q=[];for(let re=0;re<Math.abs(le);re++)Q.push(le>0?0:1);for(let re=0;re<Math.min(j,ee);re++)Q.push(0),Q.push(1);let ne=v;if(ne=wp(ne,b[0].y-M,b[1].y+M,1),ne=wp(ne,b[0].x-M,b[1].x+M,0),!ne.length)return k;const he=[];for(Q.length?he.push({polygons:ne,bounds:b,depth:0}):B(ne,b);he.length;){const re=he.pop(),Se=re.depth,Te=Q[Se],ke=re.bounds[0],We=re.bounds[1],De=Te===0?ke.x:ke.y,Oe=Te===0?We.x:We.y,Fe=z?z(Te,De,Oe):.5*(De+Oe),je=wp(re.polygons,De-M,Fe+M,Te),He=wp(re.polygons,Fe-M,Oe+M,Te);if(je.length){const Le=[ke,new Ce(Te===0?Fe:We.x,Te===1?Fe:We.y)];Q.length>Se+1?he.push({polygons:je,bounds:Le,depth:Se+1}):B(je,Le)}if(He.length){const Le=[new Ce(Te===0?Fe:ke.x,Te===1?Fe:ke.y),We];Q.length>Se+1?he.push({polygons:He,bounds:Le,depth:Se+1}):B(He,Le)}}return k}(t,e,Math.ceil((h-c)/11.25),Math.ceil((f-_)/11.25),1,(v,b,T)=>{if(v===0)return .5*(b+T);{const C=Ln((i.y+b/Rt)/r);return(Po(.5*(Ln((i.y+T/Rt)/r)+C))*r-i.y)*Rt}})}mt(fh,"FillExtrusionBucket",{omit:["layers","features"]}),mt(Sv,"PartMetadata");const UT=new Je({"fill-extrusion-edge-radius":new we(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jT={paint:new Je({"fill-extrusion-opacity":new we(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fe(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new we(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new we(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new st(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fe(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fe(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new we(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new we(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new we(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:UT};function kv(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Ep{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=mh(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=function(h,f,_){var v=kv(256*h,256*(f=Math.pow(2,_)-f-1),_),b=kv(256*(h+1),256*(f+1),_);return v[0]+","+v[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),c=function(h,f,_){let v,b="";for(let T=h;T>0;T--)v=1<<T-1,b+=(f&v?1:0)+(_&v?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ov{constructor(e,i){this.wrap=e,this.canonical=i,this.key=mh(e,i.z,i.z,i.x,i.y)}}class Xn{constructor(e,i,r,c,h){this.overscaledZ=e,this.wrap=i,this.canonical=new Ep(r,+c,+h),this.key=i===0&&e===r?this.canonical.key:mh(i,e,r,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Xn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return mh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return mh(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Xn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new Xn(i,this.wrap,i,r,c),new Xn(i,this.wrap,i,r+1,c),new Xn(i,this.wrap,i,r,c+1),new Xn(i,this.wrap,i,r+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ov(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function mh(t,e,i,r,c){const h=1<<Math.min(i,22);let f=h*(c%h)+r%h;return t&&i<22&&(f+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}mt(Ep,"CanonicalTileID"),mt(Xn,"OverscaledTileID",{omit:["projMatrix"]});class uc extends Ce{constructor(e,i,r){super(e,i),this.z=r}}function _h(t,e){return t.x*e.x+t.y*e.y}function Rv(t,e){if(t.length===1){let i=0;const r=e[i++];let c;for(;!c||r.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const h=e[i],f=t[0],_=c.sub(r),v=h.sub(r),b=f.sub(r),T=_h(_,_),C=_h(_,v),M=_h(v,v),z=_h(b,_),k=_h(b,v),B=T*M-C*C,j=(M*z-C*k)/B,ee=(T*k-C*z)/B,le=r.z*(1-j-ee)+c.z*j+h.z*ee;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function Bv(t,e,i,r,c,h,f,_){const v=f*c.getElevationAt(t,e,!0,!0),b=h[0]!==0,T=b?h[1]===0?f*(h[0]/7-450):f*function(C,M,z){const k=Math.floor(M[0]/8),B=Math.floor(M[1]/8),j=10*(M[0]-8*k),ee=10*(M[1]-8*B),le=C.getElevationAt(k,B,!0,!0),Q=C.getMeterToDEM(z),ne=Math.floor(.5*(j*Q-1)),he=Math.floor(.5*(ee*Q-1)),re=C.tileCoordToPixel(k,B),Se=2*ne+1,Te=2*he+1,ke=function(He,Le,ot,Dt,ht){return[He.getElevationAtPixel(Le,ot,!0),He.getElevationAtPixel(Le+ht,ot,!0),He.getElevationAtPixel(Le,ot+ht,!0),He.getElevationAtPixel(Le+Dt,ot+ht,!0)]}(C,re.x-ne,re.y-he,Se,Te),We=Math.abs(ke[0]-ke[1]),De=Math.abs(ke[2]-ke[3]),Oe=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),Fe=Math.min(.25,.5*Q*(We+De)/Se),je=Math.min(.25,.5*Q*Oe/Te);return le+Math.max(Fe*j,je*ee)}(c,h,_):v;return{base:v+(i===0)?-1:i,top:b?Math.max(T+r,v+i+2):v+r}}const VT=Qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$T}=VT,GT=Qe([{name:"a_packed",components:4,type:"Float32"}]),{members:qT}=GT,ZT=bp.types,WT=Math.cos(Math.PI/180*37.5);class Tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new yi,this.layoutVertexArray2=new _n,this.indexArray=new Nn,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new ln,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,c){this.hasPattern=Um("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:T,id:C,index:M,sourceLayerIndex:z}of e){const k=this.layers[0]._featureFilter.needGeometry,B=ja(T,k);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),B,r))continue;const j=h?h.evaluate(B,{},r):void 0,ee={id:C,properties:T.properties,type:T.type,sourceLayerIndex:z,index:M,geometry:k?B.geometry:os(T,r,c),patterns:{},sortKey:j};f.push(ee)}h&&f.sort((T,C)=>T.sortKey-C.sortKey);const{lineAtlas:_,featureIndex:v}=i,b=this.addConstantDashes(_);for(const T of f){const{geometry:C,index:M,sourceLayerIndex:z}=T;if(b&&this.addFeatureDashes(T,_),this.hasPattern){const k=jm("line",this.layers,T,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(T,C,M,r,_.positions,i.availableImages);v.insert(e[M].feature,C,M,z,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const c=r.paint.get("line-dasharray").value,h=r.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")i=!0;else{const f=h.value,_=c.value;if(!_)continue;e.addDash(_.from,f),e.addDash(_.to,f),_.other&&e.addDash(_.other,f)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(h.kind==="constant"&&f.kind==="constant")continue;let _,v,b,T,C,M;if(h.kind==="constant"){const j=h.value;if(!j)continue;_=j.other||j.to,v=j.to,b=j.from}else _=h.evaluate({zoom:r-1},e),v=h.evaluate({zoom:r},e),b=h.evaluate({zoom:r+1},e);f.kind==="constant"?T=C=M=f.value:(T=f.evaluate({zoom:r-1},e),C=f.evaluate({zoom:r},e),M=f.evaluate({zoom:r+1},e)),i.addDash(_,T),i.addDash(v,C),i.addDash(b,M);const z=i.getKey(_,T),k=i.getKey(v,C),B=i.getKey(b,M);e.patterns[c.id]={min:z,mid:k,max:B}}}update(e,i,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,c)}addFeatures(e,i,r,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$T),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,c,h,f){const _=this.layers[0].layout,v=_.get("line-join").evaluate(e,{}),b=_.get("line-cap").evaluate(e,{}),T=_.get("line-miter-limit"),C=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of i)this.addLine(M,e,v,b,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,f,c)}addLine(e,i,r,c,h,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=ZT[i.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(_?3:2))return;r==="bevel"&&(h=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let M,z,k,B,j;this.e1=this.e2=-1,_&&(M=e[v-2],j=e[b].sub(M)._unit()._perp());for(let ee=b;ee<v;ee++){if(k=ee===v-1?_?e[b+1]:void 0:e[ee+1],k&&e[ee].equals(k))continue;j&&(B=j),M&&(z=M),M=e[ee],j=k?k.sub(M)._unit()._perp():B,B=B||j;let le=B.add(j);le.x===0&&le.y===0||le._unit();const Q=B.x*j.x+B.y*j.y,ne=le.x*j.x+le.y*j.y,he=ne!==0?1/ne:1/0,re=2*Math.sqrt(2-2*ne),Se=ne<WT&&z&&k,Te=B.x*j.y-B.y*j.x>0;if(Se&&ee>b){const De=M.dist(z);if(De>2*T){const Oe=M.sub(M.sub(z)._mult(T/De)._round());this.updateDistance(z,Oe),this.addCurrentVertex(Oe,B,0,0,C),z=Oe}}const ke=z&&k;let We=ke?r:_?"butt":c;if(ke&&We==="round"&&(he<f?We="miter":he<=2&&(We="fakeround")),We==="miter"&&he>h&&(We="bevel"),We==="bevel"&&(he>2&&(We="flipbevel"),he<h&&(We="miter")),z&&this.updateDistance(z,M),We==="miter")le._mult(he),this.addCurrentVertex(M,le,0,0,C);else if(We==="flipbevel"){if(he>100)le=j.mult(-1);else{const De=he*B.add(j).mag()/B.sub(j).mag();le._perp()._mult(De*(Te?-1:1))}this.addCurrentVertex(M,le,0,0,C),this.addCurrentVertex(M,le.mult(-1),0,0,C)}else if(We==="bevel"||We==="fakeround"){const De=-Math.sqrt(he*he-1),Oe=Te?De:0,Fe=Te?0:De;if(z&&this.addCurrentVertex(M,B,Oe,Fe,C),We==="fakeround"){const je=Math.round(180*re/Math.PI/20);for(let He=1;He<je;He++){let Le=He/je;if(Le!==.5){const Dt=Le-.5;Le+=Le*Dt*(Le-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*Dt*Dt+(.848013+Q*(.215638*Q-1.06021)))}const ot=j.sub(B)._mult(Le)._add(B)._unit()._mult(Te?-1:1);this.addHalfVertex(M,ot.x,ot.y,!1,Te,0,C)}}k&&this.addCurrentVertex(M,j,-Oe,-Fe,C)}else if(We==="butt")this.addCurrentVertex(M,le,0,0,C);else if(We==="square"){const De=z?1:-1;z||this.addCurrentVertex(M,le,De,De,C),this.addCurrentVertex(M,le,0,0,C),z&&this.addCurrentVertex(M,le,De,De,C)}else We==="round"&&(z&&(this.addCurrentVertex(M,B,0,0,C),this.addCurrentVertex(M,B,1,1,C,!0)),k&&(this.addCurrentVertex(M,j,-1,-1,C,!0),this.addCurrentVertex(M,j,0,0,C)));if(Se&&ee<v-1){const De=M.dist(k);if(De>2*T){const Oe=M.add(k.sub(M)._mult(T/De)._round());this.updateDistance(M,Oe),this.addCurrentVertex(Oe,j,0,0,C),M=Oe}}}}addCurrentVertex(e,i,r,c,h,f=!1){const _=i.y*c-i.x,v=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,f,!1,r,h),this.addHalfVertex(e,_,v,f,!0,-c,h)}addHalfVertex({x:e,y:i},r,c,h,f,_,v){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(f?1:0),Math.round(63*r)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),f?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}mt(Tp,"LineBucket",{omit:["layers","patternFeatures"]});const HT=new Je({"line-cap":new fe(ze.layout_line["line-cap"]),"line-join":new fe(ze.layout_line["line-join"]),"line-miter-limit":new we(ze.layout_line["line-miter-limit"]),"line-round-limit":new we(ze.layout_line["line-round-limit"]),"line-sort-key":new fe(ze.layout_line["line-sort-key"])});var Fv={paint:new Je({"line-opacity":new fe(ze.paint_line["line-opacity"]),"line-color":new fe(ze.paint_line["line-color"]),"line-translate":new we(ze.paint_line["line-translate"]),"line-translate-anchor":new we(ze.paint_line["line-translate-anchor"]),"line-width":new fe(ze.paint_line["line-width"]),"line-gap-width":new fe(ze.paint_line["line-gap-width"]),"line-offset":new fe(ze.paint_line["line-offset"]),"line-blur":new fe(ze.paint_line["line-blur"]),"line-dasharray":new st(ze.paint_line["line-dasharray"]),"line-pattern":new st(ze.paint_line["line-pattern"]),"line-gradient":new tt(ze.paint_line["line-gradient"]),"line-trim-offset":new we(ze.paint_line["line-trim-offset"])}),layout:HT};const Nv=new class extends fe{possiblyEvaluate(t,e){return e=new te(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=gi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Fv.paint.properties["line-width"].specification);function Uv(t,e){return e>0?e+2*t:t}Nv.useIntegerZoom=!0;const XT=Qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KT=Qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),YT=Qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const JT=Qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),QT=Qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jv=Qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),e2=Qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qe([{name:"triangle",components:3,type:"Uint16"}]),Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Qe([{type:"Float32",name:"offsetX"}]),Qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var zn=24;const zo=128;function $m(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new te(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:c}=i;let h=0;for(;h<r.length&&r[h]<=t;)h++;h=Math.max(0,h-1);let f=h;for(;f<r.length&&r[f]<t+1;)f++;f=Math.min(r.length-1,f);const _=r[h],v=r[f];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:v,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:v,minSize:i.evaluate(new te(_)),maxSize:i.evaluate(new te(v)),interpolationType:c}}}function Ap(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:c}){return t.kind==="source"?r/zo:t.kind==="composite"?ai(r/zo,c/zo,i):e}function hc(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:f}=t,_=c?Ft(Rr.interpolationFactor(c,e,h,f),0,1):0;t.kind==="camera"?r=ai(t.minSize,t.maxSize,_):i=_}return{uSizeT:i,uSize:r}}var t2=Object.freeze({__proto__:null,getSizeData:$m,evaluateSizeForFeature:Ap,evaluateSizeForZoom:hc,SIZE_PACK_FACTOR:zo});function i2(t,e,i){return t.sections.forEach(r=>{r.text=function(c,h,f){const _=h.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),ae.applyArabicShaping&&(c=ae.applyArabicShaping(c)),c}(r.text,e,i)}),t}const gh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function n2(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function r2(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var yh=Di,Vv=function(t,e,i,r,c){var h,f,_=8*c-r-1,v=(1<<_)-1,b=v>>1,T=-7,C=i?c-1:0,M=i?-1:1,z=t[e+C];for(C+=M,h=z&(1<<-T)-1,z>>=-T,T+=_;T>0;h=256*h+t[e+C],C+=M,T-=8);for(f=h&(1<<-T)-1,h>>=-T,T+=r;T>0;f=256*f+t[e+C],C+=M,T-=8);if(h===0)h=1-b;else{if(h===v)return f?NaN:1/0*(z?-1:1);f+=Math.pow(2,r),h-=b}return(z?-1:1)*f*Math.pow(2,h-r)},$v=function(t,e,i,r,c,h){var f,_,v,b=8*h-c-1,T=(1<<b)-1,C=T>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=r?0:h-1,k=r?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=T):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+C>=1?M/v:M*Math.pow(2,1-C))*v>=2&&(f++,v/=2),f+C>=T?(_=0,f=T):f+C>=1?(_=(e*v-1)*Math.pow(2,c),f+=C):(_=e*Math.pow(2,C-1)*Math.pow(2,c),f=0));c>=8;t[i+z]=255&_,z+=k,_/=256,c-=8);for(f=f<<c|_,b+=c;b>0;t[i+z]=255&f,z+=k,f/=256,b-=8);t[i+z-k]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Di(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Di.Varint=0,Di.Fixed64=1,Di.Bytes=2,Di.Fixed32=5;var Gm=4294967296,Gv=1/Gm,qv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ls(t){return t.type===Di.Bytes?t.readVarint()+t.pos:t.pos+1}function dc(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Zv(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var c=i.pos-1;c>=t;c--)i.buf[c+r]=i.buf[c]}function o2(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function s2(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function a2(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function l2(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function c2(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function u2(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function h2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function d2(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function p2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Sp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pc(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Wv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function f2(t,e,i){e.glyphs=[],t===1&&i.readMessage(m2,e)}function m2(t,e,i){if(t===3){const{id:r,bitmap:c,width:h,height:f,left:_,top:v,advance:b}=i.readMessage(_2,{});e.glyphs.push({id:r,bitmap:new as({width:h+6,height:f+6},c),metrics:{width:h,height:f,left:_,top:v,advance:b}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function _2(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}function qm(t){let e=0,i=0;for(const f of t)e+=f.w*f.h,i=Math.max(i,f.w);t.sort((f,_)=>_.h-f.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,h=0;for(const f of t)for(let _=r.length-1;_>=0;_--){const v=r[_];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,h=Math.max(h,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===v.w&&f.h===v.h){const b=r.pop();_<r.length&&(r[_]=b)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(r.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:c,h,fill:e/(c*h)||0}}Di.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),c=r>>3,h=this.pos;this.type=7&r,t(c,e,this),this.pos===h&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Wv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sp(this.buf,this.pos)+Sp(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readSFixed64:function(){var t=Sp(this.buf,this.pos)+Wv(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readFloat:function(){var t=Vv(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Vv(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(c,h,f){var _,v,b=f.buf;if(_=(112&(v=b[f.pos++]))>>4,v<128||(_|=(127&(v=b[f.pos++]))<<3,v<128)||(_|=(127&(v=b[f.pos++]))<<10,v<128)||(_|=(127&(v=b[f.pos++]))<<17,v<128)||(_|=(127&(v=b[f.pos++]))<<24,v<128)||(_|=(1&(v=b[f.pos++]))<<31,v<128))return dc(c,_,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&qv?function(i,r,c){return qv.decode(i.subarray(r,c))}(this.buf,e,t):function(i,r,c){for(var h="",f=r;f<c;){var _,v,b,T=i[f],C=null,M=T>239?4:T>223?3:T>191?2:1;if(f+M>c)break;M===1?T<128&&(C=T):M===2?(192&(_=i[f+1]))==128&&(C=(31&T)<<6|63&_)<=127&&(C=null):M===3?(v=i[f+2],(192&(_=i[f+1]))==128&&(192&v)==128&&((C=(15&T)<<12|(63&_)<<6|63&v)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(v=i[f+2],b=i[f+3],(192&(_=i[f+1]))==128&&(192&v)==128&&(192&b)==128&&((C=(15&T)<<18|(63&_)<<12|(63&v)<<6|63&b)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,h+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),h+=String.fromCharCode(C),f+=M}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Di.Bytes)return t.push(this.readVarint(e));var i=ls(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Di.Bytes)return t.push(this.readSVarint());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Di.Bytes)return t.push(this.readBoolean());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Di.Bytes)return t.push(this.readFloat());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Di.Bytes)return t.push(this.readDouble());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Di.Bytes)return t.push(this.readFixed32());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Di.Bytes)return t.push(this.readSFixed32());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Di.Bytes)return t.push(this.readFixed64());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Di.Bytes)return t.push(this.readSFixed64());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Di.Varint)for(;this.buf[this.pos++]>127;);else if(e===Di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Di.Fixed32)this.pos+=4;else{if(e!==Di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pc(this.buf,-1&t,this.pos),pc(this.buf,Math.floor(t*Gv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pc(this.buf,-1&t,this.pos),pc(this.buf,Math.floor(t*Gv),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,c;if(e>=0?(r=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(h,f,_){_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,_.buf[_.pos]=127&(h>>>=7)}(r,0,i),function(h,f){var _=(7&h)<<4;f.buf[f.pos++]|=_|((h>>>=3)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h)))))}(c,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,c,h){for(var f,_,v=0;v<c.length;v++){if((f=c.charCodeAt(v))>55295&&f<57344){if(!_){f>56319||v+1===c.length?(r[h++]=239,r[h++]=191,r[h++]=189):_=f;continue}if(f<56320){r[h++]=239,r[h++]=191,r[h++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(r[h++]=239,r[h++]=191,r[h++]=189,_=null);f<128?r[h++]=f:(f<2048?r[h++]=f>>6|192:(f<65536?r[h++]=f>>12|224:(r[h++]=f>>18|240,r[h++]=f>>12&63|128),r[h++]=f>>6&63|128),r[h++]=63&f|128)}return h}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Zv(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),$v(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$v(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Zv(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Di.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,o2,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,s2,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,c2,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,a2,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,l2,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,u2,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,h2,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,d2,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,p2,e)},writeBytesField:function(t,e){this.writeTag(t,Di.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Di.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Di.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Di.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Di.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Di.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Zm{constructor(e,{pixelRatio:i,version:r,stretchX:c,stretchY:h,content:f}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=h,this.content=f,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hv{constructor(e,i){const r={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,r,h),this.addImages(i,c,h);const{w:f,h:_}=qm(h),v=new pr({width:f||1,height:_||1});for(const b in e){const T=e[b],C=r[b].paddedRect;pr.copy(T.data,v,{x:0,y:0},{x:C.x+1,y:C.y+1},T.data)}for(const b in i){const T=i[b],C=c[b].paddedRect,M=C.x+1,z=C.y+1,k=T.data.width,B=T.data.height;pr.copy(T.data,v,{x:0,y:0},{x:M,y:z},T.data),pr.copy(T.data,v,{x:0,y:B-1},{x:M,y:z-1},{width:k,height:1}),pr.copy(T.data,v,{x:0,y:0},{x:M,y:z+B},{width:k,height:1}),pr.copy(T.data,v,{x:k-1,y:0},{x:M-1,y:z},{width:1,height:B}),pr.copy(T.data,v,{x:0,y:0},{x:M+k,y:z},{width:1,height:B})}this.image=v,this.iconPositions=r,this.patternPositions=c}addImages(e,i,r){for(const c in e){const h=e[c],f={x:0,y:0,w:h.data.width+2,h:h.data.height+2};r.push(f),i[c]=new Zm(f,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,h]=e.tl;r.update(i.data,void 0,{x:c,y:h})}}mt(Zm,"ImagePosition"),mt(Hv,"ImageAtlas");const Cr={horizontal:1,vertical:2,horizontalOnly:3};class vh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new vh;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new vh;return i.imageName=e,i}}class fc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new fc;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?r.addImageSection(h):r.addTextSection(h,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let c="";for(let h=0;h<i.length;h++){const f=i.charCodeAt(h+1)||null,_=i.charCodeAt(h-1)||null;c+=!r&&(f&&w(f)&&!gh[i[h+1]]||_&&w(_)&&!gh[i[h-1]])||!gh[i[h]]?i[h]:gh[i[h]]}return c}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Cp[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Cp[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new fc;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(vh.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void se("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(vh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):se("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wm(t,e,i,r,c,h,f,_,v,b,T,C,M,z,k){const B=fc.fromFeature(t,c);C===Cr.vertical&&B.verticalizePunctuation(M);let j=[];const ee=function(re,Se,Te,ke,We,De){if(!re)return[];const Oe=[],Fe=function(ot,Dt,ht,yt,at,zt){let jt=0;for(let $t=0;$t<ot.length();$t++){const ri=ot.getSection($t);jt+=Xv(ot.getCharCode($t),ri,yt,at,Dt,zt)}return jt/Math.max(1,Math.ceil(jt/ht))}(re,Se,Te,ke,We,De),je=re.text.indexOf("​")>=0;let He=0;for(let ot=0;ot<re.length();ot++){const Dt=re.getSection(ot),ht=re.getCharCode(ot);if(Cp[ht]||(He+=Xv(ht,Dt,ke,We,Se,De)),ot<re.length()-1){const yt=!((Le=ht)<11904||!(Ql(Le)||Jl(Le)||tc(Le)||ip(Le)||Jd(Le)||Hu(Le)||Kd(Le)||Ba(Le)||Qd(Le)||Yu(Le)||Ku(Le)||n(Le)||Yl(Le)||Xu(Le)||Xd(Le)||Yd(Le)||Fa(Le)||np(Le)||ep(Le)||ec(Le)));(g2[ht]||yt||Dt.imageName)&&Oe.push(Yv(ot+1,He,Fe,Oe,y2(ht,re.getCharCode(ot+1),yt&&je),!1))}}var Le;return Jv(Yv(re.length(),He,Fe,Oe,0,!0))}(B,b,h,e,r,z),{processBidirectionalText:le,processStyledBidirectionalText:Q}=ae;if(le&&B.sections.length===1){const re=le(B.toString(),ee);for(const Se of re){const Te=new fc;Te.text=Se,Te.sections=B.sections;for(let ke=0;ke<Se.length;ke++)Te.sectionIndex.push(0);j.push(Te)}}else if(Q){const re=Q(B.text,B.sectionIndex,ee);for(const Se of re){const Te=new fc;Te.text=Se[0],Te.sectionIndex=Se[1],Te.sections=B.sections,j.push(Te)}}else j=function(re,Se){const Te=[],ke=re.text;let We=0;for(const De of Se)Te.push(re.substring(We,De)),We=De;return We<ke.length&&Te.push(re.substring(We,ke.length)),Te}(B,ee);const ne=[],he={positionedLines:ne,text:B.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(re,Se,Te,ke,We,De,Oe,Fe,je,He,Le,ot){let Dt=0,ht=0,yt=0;const at=Fe==="right"?1:Fe==="left"?0:.5;let zt=!1;for(const Zt of We){const Qt=Zt.getSections();for(const Si of Qt){if(Si.imageName)continue;const Oi=Se[Si.fontStack];if(Oi&&(zt=Oi.ascender!==void 0&&Oi.descender!==void 0,!zt))break}if(!zt)break}let jt=0;for(const Zt of We){Zt.trim();const Qt=Zt.getMaxScale(),Si=(Qt-1)*zn,Oi={positionedGlyphs:[],lineOffset:0};re.positionedLines[jt]=Oi;const Li=Oi.positionedGlyphs;let Ri=0;if(!Zt.length()){ht+=De,++jt;continue}let ji=0,Xi=0;for(let xi=0;xi<Zt.length();xi++){const un=Zt.getSection(xi),on=Zt.getSectionIndex(xi),li=Zt.getCharCode(xi);let qi=un.scale,gn=null,Ci=null,Qi=null,Un=zn,Tn=0;const An=!(je===Cr.horizontal||!Le&&!y(li)||Le&&(Cp[li]||($t=li,Wd($t)||Ra($t)||Hd($t)||Ju($t)||u($t))));if(un.imageName){const Kn=ke[un.imageName];if(!Kn)continue;Qi=un.imageName,re.iconsInText=re.iconsInText||!0,Ci=Kn.paddedRect;const Sn=Kn.displaySize;qi=qi*zn/ot,gn={width:Sn[0],height:Sn[1],left:1,top:-3,advance:An?Sn[1]:Sn[0],localGlyph:!1},Tn=zt?-gn.height*qi:Qt*zn-17-Sn[1]*qi,Un=gn.advance;const hs=(An?Sn[0]:Sn[1])*qi-zn*Qt;hs>0&&hs>Ri&&(Ri=hs)}else{const Kn=Te[un.fontStack];if(!Kn)continue;Kn[li]&&(Ci=Kn[li]);const Sn=Se[un.fontStack];if(!Sn)continue;const hs=Sn.glyphs[li];if(!hs)continue;if(gn=hs.metrics,Un=li!==8203?zn:0,zt){const Ec=Sn.ascender!==void 0?Math.abs(Sn.ascender):0,Dh=Sn.descender!==void 0?Math.abs(Sn.descender):0,Lh=(Ec+Dh)*qi;ji<Lh&&(ji=Lh,Xi=(Ec-Dh)/2*qi),Tn=-Ec*qi}else Tn=(Qt-qi)*zn-17}An?(re.verticalizable=!0,Li.push({glyph:li,imageName:Qi,x:Dt,y:ht+Tn,vertical:An,scale:qi,localGlyph:gn.localGlyph,fontStack:un.fontStack,sectionIndex:on,metrics:gn,rect:Ci}),Dt+=Un*qi+He):(Li.push({glyph:li,imageName:Qi,x:Dt,y:ht+Tn,vertical:An,scale:qi,localGlyph:gn.localGlyph,fontStack:un.fontStack,sectionIndex:on,metrics:gn,rect:Ci}),Dt+=gn.advance*qi+He)}Li.length!==0&&(yt=Math.max(Dt-He,yt),zt?Qv(Li,at,Ri,Xi,De*Qt/2):Qv(Li,at,Ri,0,De/2)),Dt=0;const En=De*Qt+Ri;Oi.lineOffset=Math.max(Ri,Si),ht+=En,++jt}var $t;const ri=ht,{horizontalAlign:Ut,verticalAlign:Ui}=Hm(Oe);(function(Zt,Qt,Si,Oi,Li,Ri){const ji=(Qt-Si)*Li,Xi=-Ri*Oi;for(const En of Zt)for(const xi of En.positionedGlyphs)xi.x+=ji,xi.y+=Xi})(re.positionedLines,at,Ut,Ui,yt,ri),re.top+=-Ui*ri,re.bottom=re.top+ri,re.left+=-Ut*yt,re.right=re.left+yt,re.hasBaseline=zt}(he,e,i,r,j,f,_,v,C,b,M,k),!function(re){for(const Se of re)if(Se.positionedGlyphs.length!==0)return!1;return!0}(ne)&&he}const Cp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},g2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xv(t,e,i,r,c,h){if(e.imageName){const f=r[e.imageName];return f?f.displaySize[0]*e.scale*zn/h+c:0}{const f=i[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+c:0}}function Kv(t,e,i,r){const c=Math.pow(t-e,2);return r?t<e?c/2:2*c:c+Math.abs(i)*i}function y2(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function Yv(t,e,i,r,c,h){let f=null,_=Kv(e,i,c,h);for(const v of r){const b=Kv(e-v.x,i,c,h)+v.badness;b<=_&&(f=v,_=b)}return{index:t,x:e,priorBreak:f,badness:_}}function Jv(t){return t?Jv(t.priorBreak).concat(t.index):[]}function Hm(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Qv(t,e,i,r,c){if(!(e||i||r||c))return;const h=t.length-1,f=t[h],_=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=h;v++)t[v].x-=_,t[v].y+=i+r+c}function v2(t,e,i){const{horizontalAlign:r,verticalAlign:c}=Hm(i),h=e[0]-t.displaySize[0]*r,f=e[1]-t.displaySize[1]*c;return{image:t,top:f,bottom:f+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function ex(t,e,i,r,c,h){const f=t.image;let _;if(f.content){const j=f.content,ee=f.pixelRatio||1;_=[j[0]/ee,j[1]/ee,f.displaySize[0]-j[2]/ee,f.displaySize[1]-j[3]/ee]}const v=e.left*h,b=e.right*h;let T,C,M,z;i==="width"||i==="both"?(z=c[0]+v-r[3],C=c[0]+b+r[1]):(z=c[0]+(v+b-f.displaySize[0])/2,C=z+f.displaySize[0]);const k=e.top*h,B=e.bottom*h;return i==="height"||i==="both"?(T=c[1]+k-r[0],M=c[1]+B+r[2]):(T=c[1]+(k+B-f.displaySize[1])/2,M=T+f.displaySize[1]),{image:f,top:T,right:C,bottom:M,left:z,collisionPadding:_}}class cs extends Ce{constructor(e,i,r,c,h){super(e,i),this.angle=c,this.z=r,h!==void 0&&(this.segment=h)}clone(){return new cs(this.x,this.y,this.z,this.angle,this.segment)}}function tx(t,e,i,r,c){if(e.segment===void 0)return!0;let h=e,f=e.segment+1,_=0;for(;_>-i/2;){if(f--,f<0)return!1;_-=t[f].dist(h),h=t[f]}_+=t[f].dist(t[f+1]),f++;const v=[];let b=0;for(;_<i/2;){const T=t[f],C=t[f+1];if(!C)return!1;let M=t[f-1].angleTo(T)-T.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:_,angleDelta:M}),b+=M;_-v[0].distance>r;)b-=v.shift().angleDelta;if(b>c)return!1;f++,_+=T.dist(C)}return!0}function ix(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function nx(t,e,i){return t?.6*e*i:0}function rx(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function x2(t,e,i,r,c,h){const f=nx(i,c,h),_=rx(i,r)*h;let v=0;const b=ix(t)/2;for(let T=0;T<t.length-1;T++){const C=t[T],M=t[T+1],z=C.dist(M);if(v+z>b){const k=(b-v)/z,B=ai(C.x,M.x,k),j=ai(C.y,M.y,k),ee=new cs(B,j,0,M.angleTo(C),T);return!f||tx(t,ee,_,f,e)?ee:void 0}v+=z}}function b2(t,e,i,r,c,h,f,_,v){const b=nx(r,h,f),T=rx(r,c),C=T*f,M=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-C<e/4&&(e=C+e/4),ox(t,M?e/2*_%e:(T/2+2*h)*f*_%e,e,b,i,C,M,!1,v)}function ox(t,e,i,r,c,h,f,_,v){const b=h/2,T=ix(t);let C=0,M=e-i,z=[];for(let k=0;k<t.length-1;k++){const B=t[k],j=t[k+1],ee=B.dist(j),le=j.angleTo(B);for(;M+i<C+ee;){M+=i;const Q=(M-C)/ee,ne=ai(B.x,j.x,Q),he=ai(B.y,j.y,Q);if(ne>=0&&ne<v&&he>=0&&he<v&&M-b>=0&&M+b<=T){const re=new cs(ne,he,0,le,k);re._round(),r&&!tx(t,re,h,r,c)||z.push(re)}}C+=ee}return _||z.length||f||(z=ox(t,C/2,i,r,c,h,f,!0,v)),z}function sx(t,e,i,r,c){const h=[];for(let f=0;f<t.length;f++){const _=t[f];let v;for(let b=0;b<_.length-1;b++){let T=_[b],C=_[b+1];T.x<e&&C.x<e||(T.x<e?T=new Ce(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x<e&&(C=new Ce(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y<i&&C.y<i||(T.y<i?T=new Ce(T.x+(i-T.y)/(C.y-T.y)*(C.x-T.x),i)._round():C.y<i&&(C=new Ce(T.x+(i-T.y)/(C.y-T.y)*(C.x-T.x),i)._round()),T.x>=r&&C.x>=r||(T.x>=r?T=new Ce(r,T.y+(r-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x>=r&&(C=new Ce(r,T.y+(r-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y>=c&&C.y>=c||(T.y>=c?T=new Ce(T.x+(c-T.y)/(C.y-T.y)*(C.x-T.x),c)._round():C.y>=c&&(C=new Ce(T.x+(c-T.y)/(C.y-T.y)*(C.x-T.x),c)._round()),v&&T.equals(v[v.length-1])||(v=[T],h.push(v)),v.push(C)))))}}return h}mt(cs,"Anchor");const xh=1e20;function ax(t,e,i,r,c,h,f,_,v){for(let b=e;b<e+r;b++)lx(t,i*h+b,h,c,f,_,v);for(let b=i;b<i+c;b++)lx(t,b*h+e,1,r,f,_,v)}function lx(t,e,i,r,c,h,f){h[0]=0,f[0]=-xh,f[1]=xh,c[0]=t[e];for(let _=1,v=0,b=0;_<r;_++){c[_]=t[e+_*i];const T=_*_;do{const C=h[v];b=(c[_]-c[C]+T-C*C)/(_-C)/2}while(b<=f[v]&&--v>-1);v++,h[v]=_,f[v]=b,f[v+1]=xh}for(let _=0,v=0;_<r;_++){for(;f[v+1]<_;)v++;const b=h[v],T=_-b;t[e+_*i]=c[b]+T*T}}const Xm={none:0,ideographs:1,all:2};class mc{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const c in e)for(const h of e[c])r.push({stack:c,id:h});ei(r,({stack:c,id:h},f)=>{let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=_.glyphs[h];if(v!==void 0)return void f(null,{stack:c,id:h,glyph:v});if(v=this._tinySDF(_,c,h),v)return _.glyphs[h]=v,void f(null,{stack:c,id:h,glyph:v});const b=Math.floor(h/256);if(256*b>65535)return void f(new Error("glyphs > 65535 not supported"));if(_.ranges[b])return void f(null,{stack:c,id:h,glyph:v});let T=_.requests[b];T||(T=_.requests[b]=[],mc.loadGlyphRange(c,b,this.url,this.requestManager,(C,M)=>{if(M){_.ascender=M.ascender,_.descender=M.descender;for(const z in M.glyphs)this._doesCharSupportLocalGlyph(+z)||(_.glyphs[+z]=M.glyphs[+z]);_.ranges[b]=!0}for(const z of T)z(C,M);delete _.requests[b]})),T.push((C,M)=>{C?f(C):M&&f(null,{stack:c,id:h,glyph:M.glyphs[h]||null})})},(c,h)=>{if(c)i(c);else if(h){const f={};for(const{stack:_,id:v,glyph:b}of h)f[_]===void 0&&(f[_]={}),f[_].glyphs===void 0&&(f[_].glyphs={}),f[_].glyphs[v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},f[_].ascender=this.entries[_].ascender,f[_].descender=this.entries[_].descender;i(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Xm.none&&(this.localGlyphMode===Xm.all?!!this.localFontFamily:!!this.localFontFamily&&(Yu(e)||tp(e)||Yl(e)||Fa(e)||Ba(e)))}_tinySDF(e,i,r){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(r))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),h=e.tinySDF=new mc.TinySDF({fontFamily:c,fontWeight:B,fontSize:48,buffer:6,radius:16}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][r])return this.localGlyphs[h.fontWeight][r];const f=String.fromCharCode(r),{data:_,width:v,height:b,glyphWidth:T,glyphHeight:C,glyphLeft:M,glyphTop:z,glyphAdvance:k}=h.draw(f);return this.localGlyphs[h.fontWeight][r]={id:r,bitmap:new as({width:v,height:b},_),metrics:{width:T/2,height:C/2,left:M/2,top:z/2-27,advance:k/2,localGlyph:!0}}}}function cx(t,e,i,r){const c=[],h=t.image,f=h.pixelRatio,_=h.paddedRect.w-2,v=h.paddedRect.h-2,b=t.right-t.left,T=t.bottom-t.top,C=h.stretchX||[[0,_]],M=h.stretchY||[[0,v]],z=(De,Oe)=>De+Oe[1]-Oe[0],k=C.reduce(z,0),B=M.reduce(z,0),j=_-k,ee=v-B;let le=0,Q=k,ne=0,he=B,re=0,Se=j,Te=0,ke=ee;if(h.content&&r){const De=h.content;le=Ip(C,0,De[0]),ne=Ip(M,0,De[1]),Q=Ip(C,De[0],De[2]),he=Ip(M,De[1],De[3]),re=De[0]-le,Te=De[1]-ne,Se=De[2]-De[0]-Q,ke=De[3]-De[1]-he}const We=(De,Oe,Fe,je)=>{const He=Mp(De.stretch-le,Q,b,t.left),Le=Pp(De.fixed-re,Se,De.stretch,k),ot=Mp(Oe.stretch-ne,he,T,t.top),Dt=Pp(Oe.fixed-Te,ke,Oe.stretch,B),ht=Mp(Fe.stretch-le,Q,b,t.left),yt=Pp(Fe.fixed-re,Se,Fe.stretch,k),at=Mp(je.stretch-ne,he,T,t.top),zt=Pp(je.fixed-Te,ke,je.stretch,B),jt=new Ce(He,ot),$t=new Ce(ht,ot),ri=new Ce(ht,at),Ut=new Ce(He,at),Ui=new Ce(Le/f,Dt/f),Zt=new Ce(yt/f,zt/f),Qt=e*Math.PI/180;if(Qt){const Li=Math.sin(Qt),Ri=Math.cos(Qt),ji=[Ri,-Li,Li,Ri];jt._matMult(ji),$t._matMult(ji),Ut._matMult(ji),ri._matMult(ji)}const Si=De.stretch+De.fixed,Oi=Oe.stretch+Oe.fixed;return{tl:jt,tr:$t,bl:Ut,br:ri,tex:{x:h.paddedRect.x+1+Si,y:h.paddedRect.y+1+Oi,w:Fe.stretch+Fe.fixed-Si,h:je.stretch+je.fixed-Oi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ui,pixelOffsetBR:Zt,minFontScaleX:Se/f/b,minFontScaleY:ke/f/T,isSDF:i}};if(r&&(h.stretchX||h.stretchY)){const De=ux(C,j,k),Oe=ux(M,ee,B);for(let Fe=0;Fe<De.length-1;Fe++){const je=De[Fe],He=De[Fe+1];for(let Le=0;Le<Oe.length-1;Le++)c.push(We(je,Oe[Le],He,Oe[Le+1]))}}else c.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:v+1}));return c}function Ip(t,e,i){let r=0;for(const c of t)r+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return r}function ux(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[c,h]of t){const f=r[r.length-1];r.push({fixed:c-f.stretch,stretch:f.stretch}),r.push({fixed:c-f.stretch,stretch:f.stretch+(h-c)})}return r.push({fixed:e+1,stretch:i}),r}function Mp(t,e,i,r){return t/e*i+r}function Pp(t,e,i,r){return t-e*i/r}function w2(t,e,i,r){const c=e+t.positionedLines[r].lineOffset;return r===0?i+c/2:i+(c+(e+t.positionedLines[r-1].lineOffset))/2}mc.loadGlyphRange=function(t,e,i,r,c){const h=256*e,f=h+255,_=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${h}-${f}`),$i.Glyphs);vr(_,(v,b)=>{if(v)c(v);else if(b){const T={},C=function(M){return new yh(M).readFields(f2,{})}(b);for(const M of C.glyphs)T[M.id]=M;c(null,{glyphs:T,ascender:C.ascender,descender:C.descender})}})},mc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const _=this.size=t+4*e,v=this._createCanvas(_),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${h} ${t}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(t),f=Math.ceil(i),_=Math.min(this.size-this.buffer,Math.ceil(h-c)),v=Math.min(this.size-this.buffer,f+Math.ceil(r)),b=_+2*this.buffer,T=v+2*this.buffer,C=Math.max(b*T,0),M=new Uint8ClampedArray(C),z={data:M,width:b,height:T,glyphWidth:_,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||v===0)return z;const{ctx:k,buffer:B,gridInner:j,gridOuter:ee}=this;k.clearRect(B,B,_,v),k.fillText(t,B,B+f);const le=k.getImageData(B,B,_,v);ee.fill(xh,0,C),j.fill(0,0,C);for(let Q=0;Q<v;Q++)for(let ne=0;ne<_;ne++){const he=le.data[4*(Q*_+ne)+3]/255;if(he===0)continue;const re=(Q+B)*b+ne+B;if(he===1)ee[re]=0,j[re]=xh;else{const Se=.5-he;ee[re]=Se>0?Se*Se:0,j[re]=Se<0?Se*Se:0}}ax(ee,0,0,b,T,b,this.f,this.v,this.z),ax(j,B,B,_,v,b,this.f,this.v,this.z);for(let Q=0;Q<C;Q++){const ne=Math.sqrt(ee[Q])-Math.sqrt(j[Q]);M[Q]=Math.round(255-255*(ne/this.radius+this.cutoff))}return z}};class E2{constructor(e=[],i=T2){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,c=i[e];for(;e>0;){const h=e-1>>1,f=i[h];if(r(c,f)>=0)break;i[e]=f,e=h}i[e]=c}_down(e){const{data:i,compare:r}=this,c=this.length>>1,h=i[e];for(;e<c;){let f=1+(e<<1),_=i[f];const v=f+1;if(v<this.length&&r(i[v],_)<0&&(f=v,_=i[v]),r(_,h)>=0)break;i[e]=_,e=f}i[e]=h}}function T2(t,e){return t<e?-1:t>e?1:0}function A2(t,e=1,i=!1){let r=1/0,c=1/0,h=-1/0,f=-1/0;const _=t[0];for(let z=0;z<_.length;z++){const k=_[z];(!z||k.x<r)&&(r=k.x),(!z||k.y<c)&&(c=k.y),(!z||k.x>h)&&(h=k.x),(!z||k.y>f)&&(f=k.y)}const v=Math.min(h-r,f-c);let b=v/2;const T=new E2([],S2);if(v===0)return new Ce(r,c);for(let z=r;z<h;z+=v)for(let k=c;k<f;k+=v)T.push(new _c(z+b,k+b,b,t));let C=function(z){let k=0,B=0,j=0;const ee=z[0];for(let le=0,Q=ee.length,ne=Q-1;le<Q;ne=le++){const he=ee[le],re=ee[ne],Se=he.x*re.y-re.x*he.y;B+=(he.x+re.x)*Se,j+=(he.y+re.y)*Se,k+=3*Se}return new _c(B/k,j/k,0,z)}(t),M=T.length;for(;T.length;){const z=T.pop();(z.d>C.d||!C.d)&&(C=z,i&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-C.d<=e||(b=z.h/2,T.push(new _c(z.p.x-b,z.p.y-b,b,t)),T.push(new _c(z.p.x+b,z.p.y-b,b,t)),T.push(new _c(z.p.x-b,z.p.y+b,b,t)),T.push(new _c(z.p.x+b,z.p.y+b,b,t)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function S2(t,e){return e.max-t.max}function _c(t,e,i,r){this.p=new Ce(t,e),this.h=i,this.d=function(c,h){let f=!1,_=1/0;for(let v=0;v<h.length;v++){const b=h[v];for(let T=0,C=b.length,M=C-1;T<C;M=T++){const z=b[T],k=b[M];z.y>c.y!=k.y>c.y&&c.x<(k.x-z.x)*(c.y-z.y)/(k.y-z.y)+z.x&&(f=!f),_=Math.min(_,Xy(c,z,k))}}return(f?1:-1)*Math.sqrt(_)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Km=Number.POSITIVE_INFINITY,C2=Math.sqrt(2);function hx(t,e){return e[1]!==Km?function(i,r,c){let h=0,f=0;switch(r=Math.abs(r),c=Math.abs(c),i){case"top-right":case"top-left":case"top":f=c-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-c}switch(i){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}return[h,f]}(t,e[0],e[1]):function(i,r){let c=0,h=0;r<0&&(r=0);const f=r/C2;switch(i){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-r;break;case"top":h=r-7}switch(i){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=r;break;case"right":c=-r}return[c,h]}(t,e[0])}function I2(t,e,i,r,c,h,f,_,v,b){t.createArrays(),t.tilePixelRatio=Rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const T=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,M={};if(t.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:j}=t.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new te(B),_),C["text-size"].possiblyEvaluate(new te(j),_)]}if(t.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:j}=t.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new te(B),_),C["icon-size"].possiblyEvaluate(new te(j),_)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new te(v+1),_),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new te(v+1),_),M.textMaxSize=C["text-size"].possiblyEvaluate(new te(18),_);const z=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",k=T.get("text-size");for(const B of t.features){const j=T.get("text-font").evaluate(B,{},_).join(","),ee=k.evaluate(B,{},_),le=M.layoutTextSize.evaluate(B,{},_),Q=(M.layoutIconSize.evaluate(B,{},_),{horizontal:{},vertical:void 0}),ne=B.text;let he,re=[0,0];if(ne){const ke=ne.toString(),We=T.get("text-letter-spacing").evaluate(B,{},_)*zn,De=T.get("text-line-height").evaluate(B,{},_)*zn,Oe=p(ke)?We:0,Fe=T.get("text-anchor").evaluate(B,{},_),je=T.get("text-variable-anchor");if(!je){const ht=T.get("text-radial-offset").evaluate(B,{},_);re=ht?hx(Fe,[ht*zn,Km]):T.get("text-offset").evaluate(B,{},_).map(yt=>yt*zn)}let He=z?"center":T.get("text-justify").evaluate(B,{},_);const Le=T.get("symbol-placement")==="point",ot=Le?T.get("text-max-width").evaluate(B,{},_)*zn:1/0,Dt=ht=>{t.allowVerticalPlacement&&l(ke)&&(Q.vertical=Wm(ne,e,i,c,j,ot,De,Fe,ht,Oe,re,Cr.vertical,!0,le,ee))};if(!z&&je){const ht=He==="auto"?je.map(at=>Ym(at)):[He];let yt=!1;for(let at=0;at<ht.length;at++){const zt=ht[at];if(!Q.horizontal[zt])if(yt)Q.horizontal[zt]=Q.horizontal[0];else{const jt=Wm(ne,e,i,c,j,ot,De,"center",zt,Oe,re,Cr.horizontal,!1,le,ee);jt&&(Q.horizontal[zt]=jt,yt=jt.positionedLines.length===1)}}Dt("left")}else{if(He==="auto"&&(He=Ym(Fe)),Le||T.get("text-writing-mode").indexOf("horizontal")>=0||!l(ke)){const ht=Wm(ne,e,i,c,j,ot,De,Fe,He,Oe,re,Cr.horizontal,!1,le,ee);ht&&(Q.horizontal[He]=ht)}Dt(Le?"left":He)}}let Se=!1;if(B.icon&&B.icon.name){const ke=r[B.icon.name];ke&&(he=v2(c[B.icon.name],T.get("icon-offset").evaluate(B,{},_),T.get("icon-anchor").evaluate(B,{},_)),Se=ke.sdf,t.sdfIcons===void 0?t.sdfIcons=ke.sdf:t.sdfIcons!==ke.sdf&&se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Te=px(Q.horizontal)||Q.vertical;t.iconsInText||(t.iconsInText=!!Te&&Te.iconsInText),(Te||he)&&M2(t,B,Q,he,r,M,le,0,re,Se,f,_,b)}h&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)}function Ym(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function M2(t,e,i,r,c,h,f,_,v,b,T,C,M){let z=h.textMaxSize.evaluate(e,{},C);z===void 0&&(z=f);const k=t.layers[0].layout,B=k.get("icon-offset").evaluate(e,{},C),j=px(i.horizontal)||i.vertical,ee=M.name==="globe",le=f/24,Q=t.tilePixelRatio*z/24,ne=(Oe=t.overscaling,t.zoom>18&&Oe>2&&(Oe>>=1),Math.max(Rt/(512*Oe),1)*k.get("symbol-spacing")),he=k.get("text-padding")*t.tilePixelRatio,re=k.get("icon-padding")*t.tilePixelRatio,Se=_t(k.get("text-max-angle")),Te=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",ke=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",We=k.get("symbol-placement"),De=ne/2;var Oe;const Fe=k.get("icon-text-fit");let je;r&&Fe!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(je=ex(r,i.vertical,Fe,k.get("icon-text-fit-padding"),B,le)),j&&(r=ex(r,j,Fe,k.get("icon-text-fit-padding"),B,le)));const He=(Le,ot,Dt)=>{if(ot.x<0||ot.x>=Rt||ot.y<0||ot.y>=Rt)return;let ht=null;if(ee){const{x:yt,y:at,z:zt}=M.projectTilePoint(ot.x,ot.y,Dt);ht={anchor:new cs(yt,at,zt,0,void 0),up:M.upVector(Dt,ot.x,ot.y)}}(function(yt,at,zt,jt,$t,ri,Ut,Ui,Zt,Qt,Si,Oi,Li,Ri,ji,Xi,En,xi,un,on,li,qi,gn,Ci,Qi){const Un=yt.addToLineVertexArray(at,jt);let Tn,An,Kn,Sn,hs,Ec,Dh,Lh=0,Yx=0,Jx=0,Qx=0,p_=-1,f_=-1;const Fo={};let e0=ic.exports("");const Xa=zt?zt.anchor:at;let m_=0,__=0;if(Zt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[m_,__]=Zt.layout.get("text-offset").evaluate(li,{},Qi).map(fr=>fr*zn):(m_=Zt.layout.get("text-radial-offset").evaluate(li,{},Qi)*zn,__=Km),yt.allowVerticalPlacement&&$t.vertical){const fr=$t.vertical;if(ji)Ec=Jm(fr),Ui&&(Dh=Jm(Ui));else{const mr=Zt.layout.get("text-rotate").evaluate(li,{},Qi)+90;Kn=Dp(Qt,Xa,at,Si,Oi,Li,fr,Ri,mr,Xi),Ui&&(Sn=Dp(Qt,Xa,at,Si,Oi,Li,Ui,xi,mr))}}if(ri){const fr=Zt.layout.get("icon-rotate").evaluate(li,{},Qi),mr=Zt.layout.get("icon-text-fit")!=="none",zh=cx(ri,fr,gn,mr),y_=Ui?cx(Ui,fr,gn,mr):void 0;An=Dp(Qt,Xa,at,Si,Oi,Li,ri,xi,fr),Lh=4*zh.length;const t0=yt.iconSizeData;let Ka=null;t0.kind==="source"?(Ka=[zo*Zt.layout.get("icon-size").evaluate(li,{},Qi)],Ka[0]>Zs&&se(`${yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):t0.kind==="composite"&&(Ka=[zo*qi.compositeIconSizes[0].evaluate(li,{},Qi),zo*qi.compositeIconSizes[1].evaluate(li,{},Qi)],(Ka[0]>Zs||Ka[1]>Zs)&&se(`${yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,zh,Ka,on,un,li,!1,zt,at,Un.lineStartIndex,Un.lineLength,-1,Ci,Qi),p_=yt.icon.placedSymbolArray.length-1,y_&&(Yx=4*y_.length,yt.addSymbols(yt.icon,y_,Ka,on,un,li,Cr.vertical,zt,at,Un.lineStartIndex,Un.lineLength,-1,Ci,Qi),f_=yt.icon.placedSymbolArray.length-1)}for(const fr in $t.horizontal){const mr=$t.horizontal[fr];Tn||(e0=ic.exports(mr.text),ji?hs=Jm(mr):Tn=Dp(Qt,Xa,at,Si,Oi,Li,mr,Ri,Zt.layout.get("text-rotate").evaluate(li,{},Qi),Xi));const zh=mr.positionedLines.length===1;if(Jx+=dx(yt,zt,at,mr,Ut,Zt,ji,li,Xi,Un,$t.vertical?Cr.horizontal:Cr.horizontalOnly,zh?Object.keys($t.horizontal):[fr],Fo,p_,qi,Ci,Qi),zh)break}$t.vertical&&(Qx+=dx(yt,zt,at,$t.vertical,Ut,Zt,ji,li,Xi,Un,Cr.vertical,["vertical"],Fo,f_,qi,Ci,Qi));let Js=-1;const g_=(fr,mr)=>fr?Math.max(fr,mr):mr;Js=g_(hs,Js),Js=g_(Ec,Js),Js=g_(Dh,Js);const aA=Js>-1?1:0;yt.glyphOffsetArray.length>=Hs.MAX_GLYPHS&&se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),li.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,li.sortKey),yt.symbolInstances.emplaceBack(Xa.x,Xa.y,Xa.z,at.x,at.y,Fo.right>=0?Fo.right:-1,Fo.center>=0?Fo.center:-1,Fo.left>=0?Fo.left:-1,Fo.vertical>=0?Fo.vertical:-1,p_,f_,e0,Tn!==void 0?Tn:yt.collisionBoxArray.length,Tn!==void 0?Tn+1:yt.collisionBoxArray.length,Kn!==void 0?Kn:yt.collisionBoxArray.length,Kn!==void 0?Kn+1:yt.collisionBoxArray.length,An!==void 0?An:yt.collisionBoxArray.length,An!==void 0?An+1:yt.collisionBoxArray.length,Sn||yt.collisionBoxArray.length,Sn?Sn+1:yt.collisionBoxArray.length,Si,Jx,Qx,Lh,Yx,aA,0,m_,__,Js)})(t,ot,ht,Le,i,r,c,je,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,he,Te,v,0,re,ke,B,e,h,b,T,C)};if(We==="line")for(const Le of sx(e.geometry,0,0,Rt,Rt)){const ot=b2(Le,ne,Se,i.vertical||j,r,24,Q,t.overscaling,Rt);for(const Dt of ot){const ht=j;ht&&P2(t,ht.text,De,Dt)||He(Le,Dt,C)}}else if(We==="line-center"){for(const Le of e.geometry)if(Le.length>1){const ot=x2(Le,Se,i.vertical||j,r,24,Q);ot&&He(Le,ot,C)}}else if(e.type==="Polygon")for(const Le of Nm(e.geometry,0)){const ot=A2(Le,16);He(Le[0],new cs(ot.x,ot.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Le of e.geometry)He(Le,new cs(Le[0].x,Le[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Le of e.geometry)for(const ot of Le)He([ot],new cs(ot.x,ot.y,0,0,void 0),C)}const Zs=32640;function dx(t,e,i,r,c,h,f,_,v,b,T,C,M,z,k,B,j){const ee=function(ne,he,re,Se,Te,ke,We,De){const Oe=[];if(he.positionedLines.length===0)return Oe;const Fe=Se.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,je=function(ht){const yt=ht[0],at=ht[1],zt=yt*at;return zt>0?[yt,-at]:zt<0?[-yt,at]:yt===0?[at,yt]:[at,-yt]}(re);let He=Math.abs(he.top-he.bottom);for(const ht of he.positionedLines)He-=ht.lineOffset;const Le=he.positionedLines.length,ot=He/Le;let Dt=he.top-re[1];for(let ht=0;ht<Le;++ht){const yt=he.positionedLines[ht];Dt=w2(he,ot,Dt,ht);for(const at of yt.positionedGlyphs){if(!at.rect)continue;const zt=at.rect||{};let jt=4,$t=!0,ri=1,Ut=0;if(at.imageName){const Ci=We[at.imageName];if(!Ci)continue;if(Ci.sdf){se("SDF images are not supported in formatted text and will be ignored.");continue}$t=!1,ri=Ci.pixelRatio,jt=1/ri}const Ui=(Te||De)&&at.vertical,Zt=at.metrics.advance*at.scale/2,Qt=at.metrics,Si=at.rect;if(Si===null)continue;De&&he.verticalizable&&(Ut=at.imageName?Zt-at.metrics.width*at.scale/2:0);const Oi=Te?[at.x+Zt,at.y]:[0,0];let Li=[0,0],Ri=[0,0],ji=!1;Te||(Ui?(Ri=[at.x+Zt+je[0],at.y+je[1]-Ut],ji=!0):Li=[at.x+Zt+re[0],at.y+re[1]-Ut]);const Xi=Si.w*at.scale/(ri*(at.localGlyph?2:1)),En=Si.h*at.scale/(ri*(at.localGlyph?2:1));let xi,un,on,li;if(Ui){const Ci=at.y-Dt,Qi=new Ce(-Zt,Zt-Ci),Un=-Math.PI/2,Tn=new Ce(...Ri);xi=new Ce(-Zt+Li[0],Li[1]),xi._rotateAround(Un,Qi)._add(Tn),xi.x+=-Ci+Zt,xi.y-=(Qt.left-jt)*at.scale;const An=at.imageName?Qt.advance*at.scale:zn*at.scale,Kn=String.fromCharCode(at.glyph);n2(Kn)?xi.x+=(1-jt)*at.scale:r2(Kn)?xi.x+=An-Qt.height*at.scale+(-jt-1)*at.scale:xi.x+=at.imageName||Qt.width+2*jt===Si.w&&Qt.height+2*jt===Si.h?(An-En)/2:(An-(Qt.height+2*jt)*at.scale)/2,un=new Ce(xi.x,xi.y-Xi),on=new Ce(xi.x+En,xi.y),li=new Ce(xi.x+En,xi.y-Xi)}else{const Ci=(Qt.left-jt)*at.scale-Zt+Li[0],Qi=(-Qt.top-jt)*at.scale+Li[1],Un=Ci+Xi,Tn=Qi+En;xi=new Ce(Ci,Qi),un=new Ce(Un,Qi),on=new Ce(Ci,Tn),li=new Ce(Un,Tn)}if(Fe){let Ci;Ci=Te?new Ce(0,0):ji?new Ce(je[0],je[1]):new Ce(re[0],re[1]),xi._rotateAround(Fe,Ci),un._rotateAround(Fe,Ci),on._rotateAround(Fe,Ci),li._rotateAround(Fe,Ci)}const qi=new Ce(0,0),gn=new Ce(0,0);Oe.push({tl:xi,tr:un,bl:on,br:li,tex:zt,writingMode:he.writingMode,glyphOffset:Oi,sectionIndex:at.sectionIndex,isSDF:$t,pixelOffsetTL:qi,pixelOffsetBR:gn,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,r,v,h,f,_,c,t.allowVerticalPlacement),le=t.textSizeData;let Q=null;le.kind==="source"?(Q=[zo*h.layout.get("text-size").evaluate(_,{},j)],Q[0]>Zs&&se(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(Q=[zo*k.compositeTextSizes[0].evaluate(_,{},j),zo*k.compositeTextSizes[1].evaluate(_,{},j)],(Q[0]>Zs||Q[1]>Zs)&&se(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ee,Q,v,f,_,T,e,i,b.lineStartIndex,b.lineLength,z,B,j);for(const ne of C)M[ne]=t.text.placedSymbolArray.length-1;return 4*ee.length}function px(t){for(const e in t)return t[e];return null}function Dp(t,e,i,r,c,h,f,_,v,b){let T=f.top,C=f.bottom,M=f.left,z=f.right;const k=f.collisionPadding;if(k&&(M-=k[0],T-=k[1],z+=k[2],C+=k[3]),v){const B=new Ce(M,T),j=new Ce(z,T),ee=new Ce(M,C),le=new Ce(z,C),Q=_t(v);let ne=new Ce(0,0);b&&(ne=new Ce(b[0],b[1])),B._rotateAround(Q,ne),j._rotateAround(Q,ne),ee._rotateAround(Q,ne),le._rotateAround(Q,ne),M=Math.min(B.x,j.x,ee.x,le.x),z=Math.max(B.x,j.x,ee.x,le.x),T=Math.min(B.y,j.y,ee.y,le.y),C=Math.max(B.y,j.y,ee.y,le.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,T,z,C,_,r,c,h),t.length-1}function Jm(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function P2(t,e,i,r){const c=t.compareText;if(e in c){const h=c[e];for(let f=h.length-1;f>=0;f--)if(r.dist(h[f])<i)return!0}else c[e]=[];return c[e].push(r),!1}const D2=Qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fx}=D2,mx=Qe([{name:"a_pos_3",components:3,type:"Int16"}]);var bh=Qe([{name:"a_pos",type:"Int16",components:2}]);const us=Rt/Math.PI/2,Qm=2*jr(1,0)*us*Math.PI,gc=64,yc=[gc,32,16],uo=-us,ho=us,L2=[new Hn([uo,uo,uo],[ho,ho,ho]),new Hn([uo,uo,uo],[0,0,ho]),new Hn([0,uo,uo],[ho,0,ho]),new Hn([uo,0,uo],[0,ho,ho]),new Hn([0,0,uo],[ho,ho,ho])];function _x(t,e,i,r=!0){const c=Sr([],t._camera.position,t.worldSize),h=[e,i,1,1];Ga(h,h,t.pixelMatrixInverse),av(h,h,1/h[3]);const f=Wn([],co([],h,c)),_=t.globeMatrix,v=[_[12],_[13],_[14]],b=co([],v,c),T=ih(b),C=Wn([],b),M=t.worldSize/(2*Math.PI),z=Vr(C,f),k=Math.asin(M/T);if(k<Math.acos(z)){if(!r)return null;const We=[],De=[];Sr(We,f,T/z),Wn(De,co(De,We,b)),Wn(f,ss(f,b,Sr(f,De,Math.tan(k)*T)))}const B=[];new Dm(c,f).closestPointOnSphere(v,M,B);const j=Wn([],rt(_,0)),ee=Wn([],rt(_,1)),le=Wn([],rt(_,2)),Q=Vr(j,B),ne=Vr(ee,B),he=Vr(le,B),re=It(Math.asin(-ne/M));let Se=It(Math.atan2(Q,he));Se=t.center.lng+function(We,De){const Oe=(De-We+180)%360-180;return Oe<-180?Oe+360:Oe}(t.center.lng,Se);const Te=Mo(Se),ke=Ft(Po(re),0,1);return new rc(Te,ke)}class z2{constructor(e,i,r){this.a=co([],e,r),this.b=co([],i,r),this.center=r;const c=Wn([],this.a),h=Wn([],this.b);this.angle=Math.acos(Vr(c,h))}}function e_(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,c,h,f){const _=Math.sin(h);return r*(Math.sin((1-f)*h)/_)+c*(Math.sin(f*h)/_)}(t.a[e],t.b[e],t.angle,Ft(i,0,1))+t.center[e]}function ko(t){if(t.z<=1)return L2[t.z+2*t.y+t.x];const e=t_(Lp(t));return Hn.fromPoints(e)}function Za(t,e,i){return Sr(t,t,1-i),oh(t,t,e,i)}function gx(t,e){const i=xc(e.zoom);if(i===0)return ko(t);const r=Lp(t),c=t_(r),h=Mo(r.getWest())*e.worldSize,f=Mo(r.getEast())*e.worldSize,_=Po(r.getNorth())*e.worldSize,v=Po(r.getSouth())*e.worldSize,b=[h,_,0],T=[f,_,0],C=[h,v,0],M=[f,v,0],z=Sm([],e.globeMatrix);return cn(b,b,z),cn(T,T,z),cn(C,C,z),cn(M,M,z),c[0]=Za(c[0],C,i),c[1]=Za(c[1],M,i),c[2]=Za(c[2],T,i),c[3]=Za(c[3],b,i),Hn.fromPoints(c)}function yx(t,e,i){for(const r of t)cn(r,r,e),Sr(r,r,i)}function k2(t,e,i){const r=e/t.worldSize,c=t.globeMatrix;if(i.z<=1){const Te=ko(i).getCorners();return yx(Te,c,r),Hn.fromPoints(Te)}const h=Lp(i),f=t_(h);yx(f,c,r);const _=Number.MAX_VALUE,v=[-_,-_,-_],b=[_,_,_];if(h.contains(t.center)){for(const We of f)nh(b,b,We),rh(v,v,We);v[2]=0;const Te=t.point,ke=[Te.x*r,Te.y*r,0];return nh(b,b,ke),rh(v,v,ke),new Hn(b,v)}const T=[c[12]*r,c[13]*r,c[14]*r],C=h.getCenter(),M=Ft(t.center.lat,-85.051129,Do),z=Ft(C.lat,-85.051129,Do),k=Mo(t.center.lng),B=Po(M);let j=k-Mo(C.lng);const ee=B-Po(z);j>.5?j-=1:j<-.5&&(j+=1);let le=0;Math.abs(j)>Math.abs(ee)?le=j>=0?1:3:(le=ee>=0?0:2,oh(T,T,[c[4]*r,c[5]*r,c[6]*r],-Math.sin(_t(ee>=0?h.getSouth():h.getNorth()))*us));const Q=f[le],ne=f[(le+1)%4],he=new z2(Q,ne,T),re=[e_(he,0)||Q[0],e_(he,1)||Q[1],e_(he,2)||Q[2]],Se=xc(t.zoom);if(Se>0){const Te=function({x:We,y:De,z:Oe},Fe,je,He,Le){const ot=1/(1<<Oe);let Dt=We*ot,ht=Dt+ot,yt=De*ot,at=yt+ot,zt=0;const jt=(Dt+ht)/2-He;return jt>.5?zt=-1:jt<-.5&&(zt=1),Dt=((Dt+zt)*Fe-(He*=Fe))*je+He,ht=((ht+zt)*Fe-He)*je+He,yt=(yt*Fe-(Le*=Fe))*je+Le,at=(at*Fe-Le)*je+Le,[[Dt,at,0],[ht,at,0],[ht,yt,0],[Dt,yt,0]]}(i,e,t._pixelsPerMercatorPixel,k,B);for(let We=0;We<f.length;We++)Za(f[We],Te[We],Se);const ke=ss([],Te[le],Te[(le+1)%4]);Sr(ke,ke,.5),Za(re,ke,Se)}for(const Te of f)nh(b,b,Te),rh(v,v,Te);return b[2]=Math.min(Q[2],ne[2]),nh(b,b,re),rh(v,v,re),new Hn(b,v)}function Lp({x:t,y:e,z:i}){const r=1/(1<<i),c=new fi(Ar(t*r),Ln((e+1)*r)),h=new fi(Ar((t+1)*r),Ln(e*r));return new qs(c,h)}function t_(t){const e=_t(t.getNorth()),i=_t(t.getSouth()),r=Math.cos(e),c=Math.cos(i),h=Math.sin(e),f=Math.sin(i),_=t.getWest(),v=t.getEast();return[vc(c,f,_),vc(c,f,v),vc(r,h,v),vc(r,h,_)]}function vc(t,e,i,r=us){return i=_t(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function wh(t,e,i){return vc(Math.cos(_t(t)),Math.sin(_t(t)),e,i)}function Eh(t,e,i,r){const c=1<<i.z,h=(t/Rt+i.x)/c;return wh(Ln((e/Rt+i.y)/c),Ar(h),r)}function zp({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const vx=new Float64Array(16);function Th(t){const e=zp(t),i=iv(vx,[e,e,e]);return th(i,i,((r=[])[0]=-(c=t.min)[0],r[1]=-c[1],r[2]=-c[2],r));var r,c}function i_(t){const e=(r=t.min,(i=vx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const c=1/zp(t);return $a(e,e,[c,c,c])}function xx(t,e,i,r,c){const h=function(v){const b=Rt/(2*Math.PI);return v/(2*Math.PI)/b}(i),f=[t,e,-i/(2*Math.PI)],_=Lo(new Float64Array(16));return th(_,_,f),$a(_,_,[h,h,h]),Cm(_,_,_t(-c)),fp(_,_,_t(-r)),_}function xc(t){return ui(5,6,t)}function bx(t,e){const i=wh(e.lat,e.lng),r=function(k){const B=wh(k._center.lat,k._center.lng);let j=Pm([],ac(0,1,0),B);const ee=nv([],-k.angle,B);j=cn(j,j,ee),nv(ee,-k._pitch,j);const le=Wn([],B);return Sr(le,le,k.cameraToCenterDistance/k.pixelsPerMeter*Qm),cn(le,le,ee),ss([],B,le)}(t);return f=(c=Mm([],r,i))[0],_=c[1],v=c[2],b=(h=i)[0],T=h[1],C=h[2],z=(M=Math.sqrt(f*f+_*_+v*v)*Math.sqrt(b*b+T*T+C*C))&&Vr(c,h)/M,Math.acos(Math.min(Math.max(z,-1),1));var c,h,f,_,v,b,T,C,M,z}const wx=_t(85),O2=Math.cos(wx),R2=Math.sin(wx);function Ex(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),h=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),f=Math.sin(t._pitch)*h+c;return Math.min(1.01*f,c*(1/t._horizonShift))}function Wa(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,c=(t.x+1)*i,h=t.y*i,f=(t.y+1)*i,_=Ar(r),v=Ar(c),b=Ln(h),T=Ln(f),C=e.project(_,b),M=e.project(v,b),z=e.project(v,T),k=e.project(_,T);let B=Math.min(C.x,M.x,z.x,k.x),j=Math.min(C.y,M.y,z.y,k.y),ee=Math.max(C.x,M.x,z.x,k.x),le=Math.max(C.y,M.y,z.y,k.y);const Q=i/16;function ne(re,Se,Te,ke,We,De){const Oe=(Te+We)/2,Fe=(ke+De)/2,je=e.project(Ar(Oe),Ln(Fe)),He=Math.max(0,B-je.x,j-je.y,je.x-ee,je.y-le);B=Math.min(B,je.x),ee=Math.max(ee,je.x),j=Math.min(j,je.y),le=Math.max(le,je.y),He>Q&&(ne(re,je,Te,ke,Oe,Fe),ne(je,Se,Oe,Fe,We,De))}ne(C,M,r,h,c,h),ne(M,z,c,h,c,f),ne(z,k,c,f,r,f),ne(k,C,r,f,r,h),B-=Q,j-=Q,ee+=Q,le+=Q;const he=1/Math.max(ee-B,le-j);return{scale:he,x:B*he,y:j*he,x2:ee*he,y2:le*he,projection:e}}const B2=Lo(new Float32Array(16));class Ws{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new fi(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return jr(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return Ex(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,c){const h=e.horizonLineFromTop(!1),f=new Ce(i,Math.max(h,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,i,r){const c=new Ce(i,r);if(e.elevation)return e.elevation.pointCoordinate(c);{const h=this.pointCoordinate(e,c.x,c.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return B2}createTileMatrix(e,i,r){let c,h,f;const _=r.canonical,v=Lo(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Wa(_,this);c=1,h=b.x+r.wrap*b.scale,f=b.y,$a(v,v,[c/b.scale,c/b.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(_.z),h=(_.x+Math.pow(2,_.z)*r.wrap)*c,f=_.y*c;return th(v,v,[h,f,0]),$a(v,v,[c/Rt,c/Rt,1]),v}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class F2 extends Ws{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(_t(i));this.n=(c+Math.sin(_t(r)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c,r0:h}=this,f=_t(e-this.center[0]),_=_t(i),v=Math.sqrt(c-2*r*Math.sin(_))/r;return{x:v*Math.sin(f*r),y:v*Math.cos(f*r)-h,z:0}}unproject(e,i){const{n:r,c,r0:h}=this,f=h+i;let _=Math.atan2(e,Math.abs(f))*Math.sign(f);f*r<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));const v=_t(this.center[0])*r;_=Jt(_,-Math.PI-v,Math.PI-v);const b=Ft(It(_/r)+this.center[0],-180,180),T=Math.asin(Ft((c-(e*e+f*f)*r*r)/(2*r),-1,1)),C=Ft(It(T),-85.051129,Do);return new fi(b,C)}}const Ah=1.340264,Sh=-.081106,Ch=893e-6,Ih=.003796,kp=Math.sqrt(3)/2;class N2 extends Ws{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(kp*Math.sin(i)),c=r*r,h=c*c*c;return{x:.5*(e*Math.cos(r)/(kp*(Ah+3*Sh*c+h*(7*Ch+9*Ih*c)))/Math.PI+.5),y:1-.5*(r*(Ah+Sh*c+h*(Ch+Ih*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,c=r*r,h=c*c*c;for(let T,C,M,z=0;z<12&&(C=r*(Ah+Sh*c+h*(Ch+Ih*c))-i,M=Ah+3*Sh*c+h*(7*Ch+9*Ih*c),T=C/M,r=Ft(r-T,-Math.PI/3,Math.PI/3),c=r*r,h=c*c*c,!(Math.abs(T)<1e-12));++z);const f=kp*e*(Ah+3*Sh*c+h*(7*Ch+9*Ih*c))/Math.cos(r),_=Math.asin(Math.sin(r)/kp),v=Ft(180*f/Math.PI,-180,180),b=Ft(180*_/Math.PI,-85.051129,Do);return new fi(v,b)}}class U2 extends Ws{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),c=Ft(360*(.5-i),-85.051129,Do);return new fi(r,c)}}const bc=Math.PI/2;function Op(t){return Math.tan((bc+t)/2)}class j2 extends Ws{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let c=_t(i),h=_t(r);this.southernCenter=c+h<0,this.southernCenter&&(c=-c,h=-h);const f=Math.cos(c),_=Op(c);this.n=c===h?Math.sin(c):Math.log(f/Math.cos(h))/Math.log(Op(h)/_),this.f=f*Math.pow(Op(c),this.n)/this.n}project(e,i){i=_t(i),this.southernCenter&&(i=-i),e=_t(e-this.center[0]);const r=1e-6,{n:c,f:h}=this;h>0?i<-bc+r&&(i=-bc+r):i>bc-r&&(i=bc-r);const f=h/Math.pow(Op(i),c);let _=f*Math.sin(c*e),v=h-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:_,y:this.southernCenter?v:1-v,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:c}=this,h=c-i,f=Math.sign(h),_=Math.sign(r)*Math.sqrt(e*e+h*h);let v=Math.atan2(e,Math.abs(h))*f;h*r<0&&(v-=Math.PI*Math.sign(e)*f);const b=Ft(It(v/r)+this.center[0],-180,180),T=Ft(It(2*Math.atan(Math.pow(c/_,1/r))-bc),-85.051129,Do);return new fi(b,this.southernCenter?-T:T)}}class Tx extends Ws{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Mo(e),y:Po(i),z:0}}unproject(e,i){const r=Ar(e),c=Ln(i);return new fi(r,c)}}const Ax=_t(Do);class V2 extends Ws{project(e,i){const r=(i=_t(i))*i,c=r*r;return{x:.5*((e=_t(e))*(.8707-.131979*r+c*(c*(.003971*r-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+c*(.028874*r-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,c=25,h=0,f=r*r;do{f=r*r;const b=f*f;h=(r*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-i)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),r=Ft(r-h,-Ax,Ax)}while(Math.abs(h)>1e-6&&--c>0);f=r*r;const _=Ft(It(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=It(r);return new fi(_,v)}}const Sx=_t(Do);class $2 extends Ws{project(e,i){i=_t(i),e=_t(e);const r=Math.cos(i),c=2/Math.PI,h=Math.acos(r*Math.cos(e/2)),f=Math.sin(h)/h,_=.5*(e*c+2*r*Math.sin(e/2)/f)||0,v=.5*(i+Math.sin(i)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,h=25;const f=1e-6;let _=0,v=0;do{const b=Math.cos(c),T=Math.sin(c),C=2*T*b,M=T*T,z=b*b,k=Math.cos(r/2),B=Math.sin(r/2),j=2*k*B,ee=B*B,le=1-z*k*k,Q=le?1/le:0,ne=le?Math.acos(b*k)*Math.sqrt(1/le):0,he=.5*(2*ne*b*B+2*r/Math.PI)-e,re=.5*(ne*T+c)-i,Se=.5*Q*(z*ee+ne*b*k*M)+1/Math.PI,Te=Q*(j*C/4-ne*T*B),ke=.125*Q*(C*B-ne*T*z*j),We=.5*Q*(M*k+ne*ee*b)+.5,De=Te*ke-We*Se;_=(re*Te-he*We)/De,v=(he*ke-re*Se)/De,r=Ft(r-_,-Math.PI,Math.PI),c=Ft(c-v,-Sx,Sx)}while((Math.abs(_)>f||Math.abs(v)>f)&&--h>0);return new fi(It(r),It(c))}}class Cx extends Ws{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_t(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:c}=this;return{x:_t(e)*c*r+.5,y:-Math.sin(_t(i))/c*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:c}=this,h=-(i-.5)/r,f=Ft(It((e-.5)/r)/c,-180,180),_=Math.asin(Ft(h*c,-1,1)),v=Ft(It(_),-85.051129,Do);return new fi(f,v)}}class G2 extends Tx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,r){const c=Eh(e,i,r);return cn(c,c,Th(ko(r))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i){const r=wh(i.lat,i.lng),c=Wn([],r),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;oh(r,r,c,jr(1,0)*Rt*h);const f=Lo(new Float64Array(16));return sc(f,e.pixelMatrix,e.globeMatrix),cn(r,r,f),new Ce(r[0],r[1])}pixelsPerMeter(e,i){return jr(1,0)*i}pixelSpaceConversion(e,i,r){const c=jr(1,e)*i,h=ai(jr(1,45)*i,c,r);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,r){const c=i_(ko(r.canonical));return sc(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:r}=e,c=Th(ko(i));return fp(c,c,_t(r.lng)),Cm(c,c,_t(r.lat)),$a(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,r,c){return _x(e,i,r,!0)||new rc(0,0)}pointCoordinate3D(e,i,r){const c=this.pointCoordinate(e,i,r,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!_x(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,h){const f=c.cameraToCenterDistance,_=c._centerAltitude*h,v=c._camera,b=c._camera.forward(),T=ss([],Sr([],b,-f),[0,0,_]),C=c.worldSize/(2*Math.PI),M=[0,0,-C],z=c.width/c.height,k=Math.tan(c.fovAboveCenter),B=Sr([],v.up(),k),j=Sr([],v.right(),k*z),ee=Wn([],ss([],ss([],b,B),j)),le=[];let Q;if(new Dm(T,ee).closestPointOnSphere(M,C,le)){const ne=ss([],le,M),he=co([],ne,T);Q=Math.cos(c.fovAboveCenter)*ih(he)}else{const ne=co([],T,M),he=co([],M,T);Wn(he,he);const re=ih(ne)-C;Q=Math.sqrt(re*(re+2*C));const Se=Math.acos(Q/(C+re))-Math.acos(Vr(b,he));Q*=Math.cos(Se)}return 1.01*Q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=xc(e.zoom);if(r>0){const c=Ex(e,jr(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ai(i,c+h*(1-Math.cos(f)),Math.pow(r,10))}return i}upVector(e,i,r){return Eh(i,r,e,1)}upVectorScale(e){return{metersToTile:Qm*zp(ko(e))}}}function Ix(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Tx(t);case"equirectangular":return new U2(t);case"naturalEarth":return new V2(t);case"equalEarth":return new N2(t);case"winkelTripel":return new $2(t);case"albers":return i?new Cx(t):new F2(t);case"lambertConformalConic":return i?new Cx(t):new j2(t);case"globe":return new G2(t)}throw new Error(`Invalid projection name: ${t.name}`)}const q2=bp.types,Z2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rp(t,e,i,r,c,h,f,_,v,b,T,C,M){const z=_?Math.min(Zs,Math.round(_[0])):0,k=_?Math.min(Zs,Math.round(_[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*c),h,f,(z<<1)+(v?1:0),k,16*b,16*T,256*C,256*M)}function Bp(t,e,i,r,c,h,f){t.emplaceBack(e,i,r,c,h,f)}function Fp(t,e,i,r,c){t.emplaceBack(e,i,r,c),t.emplaceBack(e,i,r,c),t.emplaceBack(e,i,r,c),t.emplaceBack(e,i,r,c)}function W2(t){for(const e of t.sections)if(P(e.text))return!0;return!1}class n_{constructor(e){this.layoutVertexArray=new Gi,this.indexArray=new Nn,this.programConfigurations=e,this.segments=new ln,this.dynamicLayoutVertexArray=new _n,this.opacityVertexArray=new nn,this.placedSymbolArray=new Ty,this.globeExtVertexArray=new _i}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,r,c){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,YT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Z2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KT.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}mt(n_,"SymbolBuffers");class r_{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new ln,this.collisionVertexArray=new is,this.collisionVertexArrayExt=new Er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,JT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,QT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mt(r_,"CollisionBuffers");class Hs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Lo([]),this.placementViewportMatrix=Lo([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$m(this.zoom,i["text-size"]),this.iconSizeData=$m(this.zoom,i["icon-size"]);const r=this.layers[0].layout,c=r.get("symbol-sort-key"),h=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(f=>Cr[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new n_(new Ua(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new n_(new Ua(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Cy,this.lineVertexArray=new Iy,this.symbolInstances=new Sy}calculateGlyphDependencies(e,i,r,c,h){for(let f=0;f<e.length;f++)if(i[e.charCodeAt(f)]=!0,c&&h){const _=gh[e.charAt(f)];_&&(i[_.charCodeAt(0)]=!0)}}populate(e,i,r,c){const h=this.layers[0],f=h.layout,_=this.projection.name==="globe",v=f.get("text-font"),b=f.get("text-field"),T=f.get("icon-image"),C=(b.value.kind!=="constant"||b.value.value instanceof Bn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=f.get("symbol-sort-key");if(this.features=[],!C&&!M)return;const k=i.iconDependencies,B=i.glyphDependencies,j=i.availableImages,ee=new te(this.zoom);for(const{feature:le,id:Q,index:ne,sourceLayerIndex:he}of e){const re=h._featureFilter.needGeometry,Se=ja(le,re);if(!h._featureFilter.filter(ee,Se,r))continue;if(re||(Se.geometry=os(le,r,c)),_&&le.type!==1&&r.z<=5){const De=Se.geometry,Oe=.98078528056,Fe=(je,He)=>Vr(Eh(je.x,je.y,r,1),Eh(He.x,He.y,r,1))<Oe;for(let je=0;je<De.length;je++)De[je]=WE(De[je],Fe)}let Te,ke;if(C){const De=h.getValueAndResolveTokens("text-field",Se,r,j),Oe=Bn.factory(De);W2(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||Z()==="unavailable"||this.hasRTLText&&ae.isParsed())&&(Te=i2(Oe,h,Se))}if(M){const De=h.getValueAndResolveTokens("icon-image",Se,r,j);ke=De instanceof qn?De:qn.fromString(De)}if(!Te&&!ke)continue;const We=this.sortFeaturesByKey?z.evaluate(Se,{},r):void 0;if(this.features.push({id:Q,text:Te,icon:ke,index:ne,sourceLayerIndex:he,geometry:Se.geometry,properties:le.properties,type:q2[le.type],sortKey:We}),ke&&(k[ke.name]=!0),Te){const De=v.evaluate(Se,{},r).join(","),Oe=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Cr.vertical)>=0;for(const Fe of Te.sections)if(Fe.image)k[Fe.image.name]=!0;else{const je=l(Te.toString()),He=Fe.fontStack||De,Le=B[He]=B[He]||{};this.calculateGlyphDependencies(Fe.text,Le,Oe,this.allowVerticalPlacement,je)}}}f.get("symbol-placement")==="line"&&(this.features=function(le){const Q={},ne={},he=[];let re=0;function Se(De){he.push(le[De]),re++}function Te(De,Oe,Fe){const je=ne[De];return delete ne[De],ne[Oe]=je,he[je].geometry[0].pop(),he[je].geometry[0]=he[je].geometry[0].concat(Fe[0]),je}function ke(De,Oe,Fe){const je=Q[Oe];return delete Q[Oe],Q[De]=je,he[je].geometry[0].shift(),he[je].geometry[0]=Fe[0].concat(he[je].geometry[0]),je}function We(De,Oe,Fe){const je=Fe?Oe[0][Oe[0].length-1]:Oe[0][0];return`${De}:${je.x}:${je.y}`}for(let De=0;De<le.length;De++){const Oe=le[De],Fe=Oe.geometry,je=Oe.text?Oe.text.toString():null;if(!je){Se(De);continue}const He=We(je,Fe),Le=We(je,Fe,!0);if(He in ne&&Le in Q&&ne[He]!==Q[Le]){const ot=ke(He,Le,Fe),Dt=Te(He,Le,he[ot].geometry);delete Q[He],delete ne[Le],ne[We(je,he[Dt].geometry,!0)]=Dt,he[ot].geometry=null}else He in ne?Te(He,Le,Fe):Le in Q?ke(He,Le,Fe):(Se(De),Q[He]=re-1,ne[Le]=re-1)}return he.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,Q)=>le.sortKey-Q.sortKey)}update(e,i,r,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ix(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length,c=e.segment;if(c!==void 0){let h=e.dist(i[c+1]),f=e.dist(i[c]);const _={};for(let v=c+1;v<i.length;v++)_[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:h},v<i.length-1&&(h+=i[v+1].dist(i[v]));for(let v=c||0;v>=0;v--)_[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,c,h,f,_,v,b,T,C,M,z,k){const B=e.indexArray,j=e.layoutVertexArray,ee=e.globeExtVertexArray,le=e.segments.prepareSegment(4*i.length,j,B,this.canOverlap?f.sortKey:void 0),Q=this.glyphOffsetArray.length,ne=le.vertexLength,he=this.allowVerticalPlacement&&_===Cr.vertical?Math.PI/2:0,re=f.text&&f.text.sections;for(let Te=0;Te<i.length;Te++){const{tl:ke,tr:We,bl:De,br:Oe,tex:Fe,pixelOffsetTL:je,pixelOffsetBR:He,minFontScaleX:Le,minFontScaleY:ot,glyphOffset:Dt,isSDF:ht,sectionIndex:yt}=i[Te],at=le.vertexLength,zt=Dt[1];if(Rp(j,b.x,b.y,ke.x,zt+ke.y,Fe.x,Fe.y,r,ht,je.x,je.y,Le,ot),Rp(j,b.x,b.y,We.x,zt+We.y,Fe.x+Fe.w,Fe.y,r,ht,He.x,je.y,Le,ot),Rp(j,b.x,b.y,De.x,zt+De.y,Fe.x,Fe.y+Fe.h,r,ht,je.x,He.y,Le,ot),Rp(j,b.x,b.y,Oe.x,zt+Oe.y,Fe.x+Fe.w,Fe.y+Fe.h,r,ht,He.x,He.y,Le,ot),v){const jt=v.anchor,$t=v.up;Bp(ee,jt.x,jt.y,jt.z,$t[0],$t[1],$t[2]),Bp(ee,jt.x,jt.y,jt.z,$t[0],$t[1],$t[2]),Bp(ee,jt.x,jt.y,jt.z,$t[0],$t[1],$t[2]),Bp(ee,jt.x,jt.y,jt.z,$t[0],$t[1],$t[2]),Fp(e.dynamicLayoutVertexArray,jt.x,jt.y,jt.z,he)}else Fp(e.dynamicLayoutVertexArray,b.x,b.y,b.z,he);B.emplaceBack(at,at+1,at+2),B.emplaceBack(at+1,at+2,at+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),Te!==i.length-1&&yt===i[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,f,f.index,{},z,k,re&&re[yt])}const Se=v?v.anchor:b;e.placedSymbolArray.emplaceBack(Se.x,Se.y,Se.z,b.x,b.y,Q,this.glyphOffsetArray.length-Q,ne,T,C,b.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],_,0,!1,0,M,0)}_commitLayoutVertex(e,i,r,c,h,f,_){e.emplaceBack(i,r,c,h,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,r,c,h,f,_){const v=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),b=v.vertexLength,T=_.tileAnchorX,C=_.tileAnchorY;for(let z=0;z<4;z++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,c,h,f,T,C,new Ce(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,h,f,T,C,new Ce(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,h,f,T,C,new Ce(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,c,h,f,T,C,new Ce(e.x1,e.y2)),v.vertexLength+=4;const M=r.indexArray;M.emplaceBack(b,b+1),M.emplaceBack(b+1,b+2),M.emplaceBack(b+2,b+3),M.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,c,h,f){for(let _=c;_<h;_++){const v=r.get(_),b=this.getSymbolInstanceTextSize(e,f,i,_);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,r,c,h,f){for(let _=c;_<h;_++){const v=r.get(_),b=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new r_(Pi,jv.members,Tr),this.iconCollisionBox=new r_(Pi,jv.members,Tr);const r=hc(this.iconSizeData,e),c=hc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(r,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(r,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,i,r,c){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),f=Ap(this.textSizeData,e,h)/zn;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,r){const c=this.icon.placedSymbolArray.get(r),h=Ap(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,c,h,f){for(let _=c;_<h;_++){const v=r.get(_),b=this.getSymbolInstanceTextSize(e,f,i,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding)}}_updateIconDebugCollisionBoxes(e,i,r,c,h,f){for(let _=c;_<h;_++){const v=r.get(_),b=this.getSymbolInstanceIconSize(e,i,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,v.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=hc(this.iconSizeData,e),c=hc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(r,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,c,h,f,_,v,b){const T={};for(let C=i;C<r;C++){const M=e.get(C);T.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.textFeatureIndex=M.featureIndex;break}for(let C=c;C<h;C++){const M=e.get(C);T.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalTextFeatureIndex=M.featureIndex;break}for(let C=f;C<_;C++){const M=e.get(C);T.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.iconFeatureIndex=M.featureIndex;break}for(let C=v;C<b;C++){const M=e.get(C);T.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalIconFeatureIndex=M.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),c=r.vertexStartIndex+4*r.numGlyphs;for(let h=r.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),c=[],h=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const v=this.symbolInstances.get(_);c.push(0|Math.round(i*v.tileAnchorX+r*v.tileAnchorY)),h.push(v.featureIndex)}return f.sort((_,v)=>c[_]-c[v]||h[v]-h[_]),f}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((c,h,f)=>{c>=0&&f.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}mt(Hs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hs.MAX_GLYPHS=65535,Hs.addDynamicAttributes=Fp;const H2=new Je({"symbol-placement":new we(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new we(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new we(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fe(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new we(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new we(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new we(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new we(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new we(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new fe(ze.layout_symbol["icon-size"]),"icon-text-fit":new we(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new we(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new fe(ze.layout_symbol["icon-image"]),"icon-rotate":new fe(ze.layout_symbol["icon-rotate"]),"icon-padding":new we(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new we(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new fe(ze.layout_symbol["icon-offset"]),"icon-anchor":new fe(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new we(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new we(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new we(ze.layout_symbol["text-rotation-alignment"]),"text-field":new fe(ze.layout_symbol["text-field"]),"text-font":new fe(ze.layout_symbol["text-font"]),"text-size":new fe(ze.layout_symbol["text-size"]),"text-max-width":new fe(ze.layout_symbol["text-max-width"]),"text-line-height":new fe(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new fe(ze.layout_symbol["text-letter-spacing"]),"text-justify":new fe(ze.layout_symbol["text-justify"]),"text-radial-offset":new fe(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new we(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new fe(ze.layout_symbol["text-anchor"]),"text-max-angle":new we(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new we(ze.layout_symbol["text-writing-mode"]),"text-rotate":new fe(ze.layout_symbol["text-rotate"]),"text-padding":new we(ze.layout_symbol["text-padding"]),"text-keep-upright":new we(ze.layout_symbol["text-keep-upright"]),"text-transform":new fe(ze.layout_symbol["text-transform"]),"text-offset":new fe(ze.layout_symbol["text-offset"]),"text-allow-overlap":new we(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new we(ze.layout_symbol["text-ignore-placement"]),"text-optional":new we(ze.layout_symbol["text-optional"])});var o_={paint:new Je({"icon-opacity":new fe(ze.paint_symbol["icon-opacity"]),"icon-color":new fe(ze.paint_symbol["icon-color"]),"icon-halo-color":new fe(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new fe(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fe(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new we(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new we(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new fe(ze.paint_symbol["text-opacity"]),"text-color":new fe(ze.paint_symbol["text-color"],{runtimeType:Lr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new fe(ze.paint_symbol["text-halo-color"]),"text-halo-width":new fe(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new fe(ze.paint_symbol["text-halo-blur"]),"text-translate":new we(ze.paint_symbol["text-translate"]),"text-translate-anchor":new we(ze.paint_symbol["text-translate-anchor"])}),layout:H2};class Mx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ps,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt(Mx,"FormatSectionOverride",{omit:["defaultValue"]});class Np extends lo{constructor(e){super(e,o_)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const c=[];for(const h of r)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,c){const h=this.layout.get(e).evaluate(i,{},r,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ma(f.value)||!h?h:function(_,v){return v.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(i.properties,h)}createBucket(e){return new Hs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of o_.paint.overridableProperties){if(!Np.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new Mx(i),c=new Ia(r,i.property.specification);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new Ul("source",c):new jl("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Be(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Np.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),c=o_.paint.properties[i];let h=!1;const f=_=>{for(const v of _)if(c.overrides&&c.overrides.hasOverride(v))return void(h=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Bn)f(r.value.value.sections);else if(r.value.kind==="source"){const _=b=>{h||(b instanceof wa&&an(b.value)===Ls?f(b.value.sections):b instanceof Eo?f(b.sections):b.eachChild(_))},v=r.value;v._styleExpression&&_(v._styleExpression.expression)}return h}getProgramConfiguration(e){return new Gs(this,e)}}var X2={paint:new Je({"background-color":new we(ze.paint_background["background-color"]),"background-pattern":new Ke(ze.paint_background["background-pattern"]),"background-opacity":new we(ze.paint_background["background-opacity"])})},K2={paint:new Je({"raster-opacity":new we(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new we(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new we(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new we(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new we(ze.paint_raster["raster-saturation"]),"raster-contrast":new we(ze.paint_raster["raster-contrast"]),"raster-resampling":new we(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new we(ze.paint_raster["raster-fade-duration"])})};class Y2 extends lo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var J2={paint:new Je({"sky-type":new we(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new we(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new we(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new we(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new we(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new tt(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new we(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new we(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new we(ze.paint_sky["sky-opacity"])})};function s_(t,e,i){const r=[0,0,1],c=uv([]);return dv(c,c,i?-_t(t)+Math.PI:_t(t)),hv(c,c,-_t(e)),sv(r,r,c),Wn(r,r)}const Q2={circle:class extends lo{constructor(t){super(t,eT)}createBucket(t){return new Em(t)}queryRadius(t){const e=t;return oc("circle-radius",this,e)+oc("circle-stroke-width",this,e)+dp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,c,h,f,_){const v=Qy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return pv(t,r,h,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,b)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Gs(this,t)}},heatmap:class extends lo{createBucket(t){return new mv(t)}constructor(t){super(t,lT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Om({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return oc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,c,h,f,_){const v=this.paint.get("heatmap-radius").evaluate(e,i);return pv(t,r,h,f,_,!0,!0,new Ce(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Gs(this,t)}},hillshade:class extends lo{constructor(t){super(t,cT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends lo{constructor(t){super(t,AT)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Gs(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new vp(t)}queryRadius(){return dp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,c,h){return!t.queryGeometry.isAboveHorizon&&Hy(Jy(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends lo{constructor(t){super(t,jT)}createBucket(t){return new fh(t)}queryRadius(){return dp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Gs(this,t)}queryIntersectsFeature(t,e,i,r,c,h,f,_,v){const b=Qy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],z=_&&h.elevation,k=h.elevation?h.elevation.exaggeration():1,B=t.tile.getBucket(this);if(z&&B instanceof fh){const ne=B.centroidVertexArray,he=v+1;if(he<ne.length){const re=ne.get(he);M[0]=re.a_centroid_pos0,M[1]=re.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;h.projection.name==="globe"&&(r=zv([r],[new Ce(0,0),new Ce(Rt,Rt)],t.tileID.canonical).map(ne=>ne.polygon).flat());const j=z?_:null,[ee,le]=function(ne,he,re,Se,Te,ke,We,De,Oe,Fe,je){return ne.projection.name==="globe"?function(He,Le,ot,Dt,ht,yt,at,zt,jt,$t,ri){const Ut=[],Ui=[],Zt=He.projection.upVectorScale(ri,He.center.lat,He.worldSize).metersToTile,Qt=[0,0,0,1],Si=[0,0,0,1],Oi=(Ri,ji,Xi,En)=>{Ri[0]=ji,Ri[1]=Xi,Ri[2]=En,Ri[3]=1},Li=Lv();ot>0&&(ot+=Li),Dt+=Li;for(const Ri of Le){const ji=[],Xi=[];for(const En of Ri){const xi=En.x+ht.x,un=En.y+ht.y,on=He.projection.projectTilePoint(xi,un,ri),li=He.projection.upVector(ri,En.x,En.y);let qi=ot,gn=Dt;if(at){const Ci=Bv(xi,un,ot,Dt,at,zt,jt,$t);qi+=Ci.base,gn+=Ci.top}ot!==0?Oi(Qt,on.x+li[0]*Zt*qi,on.y+li[1]*Zt*qi,on.z+li[2]*Zt*qi):Oi(Qt,on.x,on.y,on.z),Oi(Si,on.x+li[0]*Zt*gn,on.y+li[1]*Zt*gn,on.z+li[2]*Zt*gn),cn(Qt,Qt,yt),cn(Si,Si,yt),ji.push(new uc(Qt[0],Qt[1],Qt[2])),Xi.push(new uc(Si[0],Si[1],Si[2]))}Ut.push(ji),Ui.push(Xi)}return[Ut,Ui]}(ne,he,re,Se,Te,ke,We,De,Oe,Fe,je):We?function(He,Le,ot,Dt,ht,yt,at,zt,jt){const $t=[],ri=[],Ut=[0,0,0,1];for(const Ui of He){const Zt=[],Qt=[];for(const Si of Ui){const Oi=Si.x+Dt.x,Li=Si.y+Dt.y,Ri=Bv(Oi,Li,Le,ot,yt,at,zt,jt);Ut[0]=Oi,Ut[1]=Li,Ut[2]=Ri.base,Ut[3]=1,Ga(Ut,Ut,ht),Ut[3]=Math.max(Ut[3],1e-5);const ji=new uc(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Ut[0]=Oi,Ut[1]=Li,Ut[2]=Ri.top,Ut[3]=1,Ga(Ut,Ut,ht),Ut[3]=Math.max(Ut[3],1e-5);const Xi=new uc(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Zt.push(ji),Qt.push(Xi)}$t.push(Zt),ri.push(Qt)}return[$t,ri]}(he,re,Se,Te,ke,We,De,Oe,Fe):function(He,Le,ot,Dt,ht){const yt=[],at=[],zt=ht[8]*Le,jt=ht[9]*Le,$t=ht[10]*Le,ri=ht[11]*Le,Ut=ht[8]*ot,Ui=ht[9]*ot,Zt=ht[10]*ot,Qt=ht[11]*ot;for(const Si of He){const Oi=[],Li=[];for(const Ri of Si){const ji=Ri.x+Dt.x,Xi=Ri.y+Dt.y,En=ht[0]*ji+ht[4]*Xi+ht[12],xi=ht[1]*ji+ht[5]*Xi+ht[13],un=ht[2]*ji+ht[6]*Xi+ht[14],on=ht[3]*ji+ht[7]*Xi+ht[15],li=En+zt,qi=xi+jt,gn=un+$t,Ci=Math.max(on+ri,1e-5),Qi=En+Ut,Un=xi+Ui,Tn=un+Zt,An=Math.max(on+Qt,1e-5);Oi.push(new uc(li/Ci,qi/Ci,gn/Ci)),Li.push(new uc(Qi/An,Un/An,Tn/An))}yt.push(Oi),at.push(Li)}return[yt,at]}(he,re,Se,Te,ke)}(h,r,C,T,b,f,j,M,k,h.center.lat,t.tileID.canonical),Q=t.queryGeometry;return function(ne,he,re){let Se=1/0;Hy(re,he)&&(Se=Rv(re,he[0]));for(let Te=0;Te<he.length;Te++){const ke=he[Te],We=ne[Te];for(let De=0;De<ke.length-1;De++){const Oe=ke[De],Fe=[Oe,ke[De+1],We[De+1],We[De],Oe];Wy(re,Fe)&&(Se=Math.min(Se,Rv(re,Fe)))}}return Se!==1/0&&Se}(ee,le,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends lo{constructor(t){super(t,Fv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Os,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Nv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Tp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Gs(this,t)}queryRadius(t){const e=t,i=Uv(oc("line-width",this,e),oc("line-gap-width",this,e)),r=oc("line-offset",this,e);return i/2+Math.abs(r)+dp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,c,h){if(t.queryGeometry.isAboveHorizon)return!1;const f=Jy(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*Uv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),v=this.paint.get("line-offset").evaluate(e,i);return v&&(r=function(b,T){const C=[],M=new Ce(0,0);for(let z=0;z<b.length;z++){const k=b[z],B=[];for(let j=0;j<k.length;j++){const ee=k[j-1],le=k[j],Q=k[j+1],ne=j===0?M:le.sub(ee)._unit()._perp(),he=j===k.length-1?M:Q.sub(le)._unit()._perp(),re=ne._add(he)._unit();re._mult(1/(re.x*he.x+re.y*he.y)),B.push(re._mult(T)._add(le))}C.push(B)}return C}(r,v*t.pixelToTileUnitsFactor)),function(b,T,C){for(let M=0;M<T.length;M++){const z=T[M];if(b.length>=3){for(let k=0;k<z.length;k++)if(Va(b,z[k]))return!0}if(KE(b,z,C))return!0}return!1}(f,r,_)}isTileClipped(){return!0}},symbol:Np,background:class extends lo{constructor(t){super(t,X2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends lo{constructor(t){super(t,K2)}getProgramIds(){return["raster"]}},sky:class extends lo{constructor(t){super(t,J2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Om({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),c=!r,h=t.style.light,f=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&se("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?s_(f.azimuthal,90-f.polar,e):s_(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return s_(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Mh{constructor(e,i,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,r){const{width:c,height:h}=e,{context:f}=this,{gl:_}=f,{HTMLImageElement:v,HTMLCanvasElement:b,HTMLVideoElement:T,ImageData:C,ImageBitmap:M}=L;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===c&&this.size[1]===h){const{x:z,y:k}=r||{x:0,y:0};e instanceof v||e instanceof b||e instanceof T||e instanceof C||M&&e instanceof M?_.texSubImage2D(_.TEXTURE_2D,0,z,k,_.RGBA,_.UNSIGNED_BYTE,e):_.texSubImage2D(_.TEXTURE_2D,0,z,k,c,h,_.RGBA,_.UNSIGNED_BYTE,e.data)}else this.size=[c,h],e instanceof v||e instanceof b||e instanceof T||e instanceof C||M&&e instanceof M?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,e):_.texImage2D(_.TEXTURE_2D,0,this.format,c,h,0,this.format,_.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class eA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class tA{constructor(){this.tasks={},this.taskQueue=[],Hi(["process"],this),this.invoker=new eA(this.process),this.nextId=0}add(e,i){const r=this.nextId++,c=function({type:h,isSymbolTile:f,zoom:_}){return _=_||0,h==="message"?0:h!=="maybePrepare"||f?h!=="parseTile"||f?h==="parseTile"&&f?300-_:h==="maybePrepare"&&f?400-_:500:200-_:100-_}(i);if(c===0){$e();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:c,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){$e();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const h=this.tasks[this.taskQueue[c]];h.priority<i&&(i=h.priority,e=c)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Px{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const iA=["tile","layer","source","sourceLayer","state"];class Dx{constructor(e,i,r,c,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of iA)this[i]!==void 0&&(e[i]=this[i]);return e}}const $r=32,Oo=33,Xs=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,c=0,h=0,f=0,_=0;for(1&e?c=h=f=$r:i=r=_=$r;(e>>=1)>1;){const b=i+c>>1,T=r+h>>1;1&e?(c=i,h=r,i=f,r=_):(i=c,r=h,c=f,h=_),f=b,_=T}const v=4*t;Xs[v+0]=i,Xs[v+1]=r,Xs[v+2]=c,Xs[v+3]=h}const Ro=new Uint16Array(2178),Ks=new Uint8Array(1089),Up=new Uint16Array(1089);function Lx(t){return t===0?-.03125:t===32?.03125:0}var zx=Qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const kx={type:2,extent:Rt,loadGeometry:()=>[[new Ce(0,0),new Ce(8193,0),new Ce(8193,8193),new Ce(0,8193),new Ce(0,0)]]};class a_{constructor(e,i,r,c,h){this.tileID=e,this.uid=Ki(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<hi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Wa(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,h){const f={};if(!h)return f;for(const _ of c){const v=_.layerIds.map(b=>h.getLayer(b)).filter(Boolean);if(v.length!==0){_.layers=v,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>v.filter(T=>T.id===b)[0]));for(const b of v)f[b.id]=_}}return f}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Hs){if(this.hasSymbolBuckets=!0,!r)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Hs&&h.hasRTLText){this.hasRTLText=!0,ae.isLoading()||ae.isLoaded()||Z()!=="deferred"||oe();break}}this.queryPadding=0;for(const c in this.buckets){const h=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new _m}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const c=this.buckets[r];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mh(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mh(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mh(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,c,h,f,_,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:f,params:h,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const c=r.loadVTLayers(),h=i?i.sourceLayer:"",f=c._geojsonTileLayer||c[h];if(!f)return;const _=$l(i&&i.filter),{z:v,x:b,y:T}=this.tileID.canonical,C={z:v,x:b,y:T};for(let M=0;M<f.length;M++){const z=f.feature(M);if(_.needGeometry){const j=ja(z,!0);if(!_.filter(new te(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!_.filter(new te(this.tileID.overscaledZ),z))continue;const k=r.getId(z,h),B=new Dx(z,v,b,T,k);B.tile=C,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Xe(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let c=!1;if(this.expirationTime>r)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const h=this.expirationTime-i;h?this.expirationTime=r+Math.max(h,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const h in this.buckets){if(!i.style.hasLayer(h))continue;const f=this.buckets[h],_=f.layers[0].sourceLayer||"_geojsonTileLayer",v=r[_],b=e[_];if(!v||!b||Object.keys(b).length===0)continue;if(f.update(b,v,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Tp||f instanceof vp){const C=i.style._getSourceCache(f.layers[0].source);i._terrain&&i._terrain.enabled&&C&&f.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(C.id,this.tileID)}const T=i&&i.style&&i.style.getLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<hi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=hi.now()+e}setTexture(e,i){const r=i.context,c=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Mh(r,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,i){const r={};for(const c of i)r[c]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const c=this.dependencies[r];if(c){for(const h of i)if(c[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=os(kx,this.tileID.canonical,this.tileTransform)[0],c=new qt,h=new Qu;for(let f=0;f<r.length;f++){const{x:_,y:v}=r[f];c.emplaceBack(_,v),h.emplaceBack(f)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(c,bh.members),this._tileDebugSegments=ln.simpleSegment(0,0,c.length,h.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=os(kx,this.tileID.canonical,this.tileTransform)[0];let c,h;if(this.isRaster){const f=function(_,v){const b=Wa(_,v),T=Math.pow(2,_.z);for(let j=0;j<Oo;j++)for(let ee=0;ee<Oo;ee++){const le=Ar((_.x+(ee+Lx(ee))/$r)/T),Q=Ln((_.y+(j+Lx(j))/$r)/T),ne=v.project(le,Q),he=j*Oo+ee;Ro[2*he+0]=Math.round((ne.x*b.scale-b.x)*Rt),Ro[2*he+1]=Math.round((ne.y*b.scale-b.y)*Rt)}Ks.fill(0),Up.fill(0);for(let j=2045;j>=0;j--){const ee=4*j,le=Xs[ee+0],Q=Xs[ee+1],ne=Xs[ee+2],he=Xs[ee+3],re=le+ne>>1,Se=Q+he>>1,Te=re+Se-Q,ke=Se+le-re,We=Q*Oo+le,De=he*Oo+ne,Oe=Se*Oo+re,Fe=Math.hypot((Ro[2*We+0]+Ro[2*De+0])/2-Ro[2*Oe+0],(Ro[2*We+1]+Ro[2*De+1])/2-Ro[2*Oe+1])>=16;if(Ks[Oe]=Ks[Oe]||(Fe?1:0),j<1022){const je=(Q+ke>>1)*Oo+(le+Te>>1),He=(he+ke>>1)*Oo+(ne+Te>>1);Ks[Oe]=Ks[Oe]||Ks[je]||Ks[He]}}const C=new Ai,M=new Nn;let z=0;function k(j,ee){const le=ee*Oo+j;return Up[le]===0&&(C.emplaceBack(Ro[2*le+0],Ro[2*le+1],j*Rt/$r,ee*Rt/$r),Up[le]=++z),Up[le]-1}function B(j,ee,le,Q,ne,he){const re=j+le>>1,Se=ee+Q>>1;if(Math.abs(j-ne)+Math.abs(ee-he)>1&&Ks[Se*Oo+re])B(ne,he,j,ee,re,Se),B(le,Q,ne,he,re,Se);else{const Te=k(j,ee),ke=k(le,Q),We=k(ne,he);M.emplaceBack(Te,ke,We)}}return B(0,0,$r,$r,$r,0),B($r,$r,0,0,0,$r),{vertices:C,indices:M}}(this.tileID.canonical,i);c=f.vertices,h=f.indices}else{c=new Ai,h=new Nn;for(const{x:_,y:v}of r)c.emplaceBack(_,v,0,0);const f=ah.exports(c.int16,void 0,4);for(let _=0;_<f.length;_+=3)h.emplaceBack(f[_],f[_+1],f[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,zx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=ln.simpleSegment(0,0,c.length,h.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const c=this.tileID.canonical,h=Th(gx(c,i)),f=xc(i.zoom);let _;f>0&&(_=Sm(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,i,h,_,f),this._makeGlobeTileDebugTextBuffer(e,c,i,h,_,f)}_globePoint(e,i,r,c,h,f,_){let v=Eh(e,i,r);if(f){const b=1<<r.z,T=Mo(c.center.lng),C=Po(c.center.lat),M=(r.x+.5)/b-T;let z=0;M>.5?z=-1:M<-.5&&(z=1);let k=(e/Rt+r.x)/b+z,B=(i/Rt+r.y)/b;k=(k-T)*c._pixelsPerMercatorPixel+T,B=(B-C)*c._pixelsPerMercatorPixel+C;const j=[k*c.worldSize,B*c.worldSize,0];cn(j,j,f),v=Za(v,j,_)}return cn(v,v,h)}_makeGlobeTileDebugBorderBuffer(e,i,r,c,h,f){const _=new qt,v=new Qu,b=new Ti,T=(M,z,k,B,j)=>{const ee=(k-M)/(j-1),le=(B-z)/(j-1),Q=_.length;for(let ne=0;ne<j;ne++){const he=M+ne*ee,re=z+ne*le;_.emplaceBack(he,re);const Se=this._globePoint(he,re,i,r,c,h,f);b.emplaceBack(Se[0],Se[1],Se[2]),v.emplaceBack(Q+ne)}},C=Rt;T(0,0,C,0,16),T(C,0,C,C,16),T(C,C,0,C,16),T(0,C,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(_,bh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,mx.members),this._tileDebugSegments=ln.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugTextBuffer(e,i,r,c,h,f){const _=new qt,v=new Nn,b=new Ti,T=25;v.reserve(32),_.reserve(T),b.reserve(T);const C=(M,z)=>T*M+z;for(let M=0;M<T;M++){const z=2048*M;for(let k=0;k<T;k++){const B=2048*k;_.emplaceBack(B,z);const j=this._globePoint(B,z,i,r,c,h,f);b.emplaceBack(j[0],j[1],j[2])}}for(let M=0;M<4;M++)for(let z=0;z<4;z++){const k=C(M,z),B=C(M,z+1),j=C(M+1,z),ee=C(M+1,z+1);v.emplaceBack(k,B,j),v.emplaceBack(j,B,ee)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(v),this._tileDebugTextBuffer=e.createVertexBuffer(_,bh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(b,mx.members),this._tileDebugTextSegments=ln.simpleSegment(0,0,T,32)}}class nA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},gi(this.stateChanges[e][c],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==c&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const h in this.state[e][c])r[h]||(this.deletedStates[e][c][h]=null)}else for(const h in r)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][h]===null&&delete this.deletedStates[e][c][h]}removeFeatureState(e,i,r){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][r]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(r in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][r]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),c=gi({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][i];if(h===null)return{};for(const f in h)delete c[f]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const h={};for(const f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),gi(this.state[c][f],this.stateChanges[c][f]),h[f]=this.state[c][f];r[c]=h}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const h={};if(this.deletedStates[c]===null)for(const f in this.state[c])h[f]={},this.state[c][f]={};else for(const f in this.deletedStates[c]){if(this.deletedStates[c][f]===null)this.state[c][f]={};else for(const _ of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][_];h[f]=this.state[c][f]}r[c]=r[c]||{},gi(r[c],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const c in e)e[c].setFeatureState(r,i)}}class Ox{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Rx(t,e,i,r){let c=0,h=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(r[f])<1e-15){if(i[f]<t[f]||i[f]>e[f])return null}else{const _=1/r[f];let v=(t[f]-i[f])*_,b=(e[f]-i[f])*_;if(v>b){const T=v;v=b,b=T}if(v>c&&(c=v),b<h&&(h=b),c>h)return null}return c}function Bx(t,e,i,r,c,h,f,_,v,b,T){const C=r-t,M=c-e,z=h-i,k=f-t,B=_-e,j=v-i,ee=T[1]*j-T[2]*B,le=T[2]*k-T[0]*j,Q=T[0]*B-T[1]*k,ne=C*ee+M*le+z*Q;if(Math.abs(ne)<1e-15)return null;const he=1/ne,re=b[0]-t,Se=b[1]-e,Te=b[2]-i,ke=(re*ee+Se*le+Te*Q)*he;if(ke<0||ke>1)return null;const We=Se*z-Te*M,De=Te*C-re*z,Oe=re*M-Se*C,Fe=(T[0]*We+T[1]*De+T[2]*Oe)*he;return Fe<0||ke+Fe>1?null:(k*We+B*De+j*Oe)*he}function Fx(t,e,i){return(t-e)/(i-e)}function Nx(t,e,i,r,c,h,f,_,v){const b=1<<i,T=h-r,C=f-c,M=(t+1)/b*T+r,z=(e+0)/b*C+c,k=(e+1)/b*C+c;_[0]=(t+0)/b*T+r,_[1]=z,v[0]=M,v[1]=k}class Ux{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(h){const f=Math.ceil(Math.log2(h.dim/8)),_=[];let v=Math.ceil(Math.pow(2,f));const b=1/v,T=(z,k,B,j,ee)=>{const le=j?1:0,Q=(z+1)*B-le,ne=k*B,he=(k+1)*B-le;ee[0]=z*B,ee[1]=ne,ee[2]=Q,ee[3]=he};let C=new Ox(v);const M=[];for(let z=0;z<v*v;z++){T(z%v,Math.floor(z/v),b,!1,M);const k=Ys(M[0],M[1],h),B=Ys(M[2],M[1],h),j=Ys(M[2],M[3],h),ee=Ys(M[0],M[3],h);C.minimums.push(Math.min(k,B,j,ee)),C.maximums.push(Math.max(k,B,j,ee)),C.leaves.push(1)}for(_.push(C),v/=2;v>=1;v/=2){const z=_[_.length-1];C=new Ox(v);for(let k=0;k<v*v;k++){T(k%v,Math.floor(k/v),2,!0,M);const B=z.getElevation(M[0],M[1]),j=z.getElevation(M[2],M[1]),ee=z.getElevation(M[2],M[3]),le=z.getElevation(M[0],M[3]),Q=z.isLeaf(M[0],M[1]),ne=z.isLeaf(M[2],M[1]),he=z.isLeaf(M[2],M[3]),re=z.isLeaf(M[0],M[3]),Se=Math.min(B.min,j.min,ee.min,le.min),Te=Math.max(B.max,j.max,ee.max,le.max),ke=Q&&ne&&he&&re;C.maximums.push(Te),C.minimums.push(Se),C.leaves.push(Te-Se<=5&&ke?1:0)}_.push(C)}return _}(this.dem),r=i.length-1,c=i[r];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,c,h,f,_=1){return Rx([e,i,-100],[r,c,this.maximums[0]*_],h,f)}raycast(e,i,r,c,h,f,_=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,i,r,c,h,f,_);if(v==null)return null;const b=[],T=[],C=[],M=[],z=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:k,t:B,nodex:j,nodey:ee,depth:le}=z.pop();if(this.leaves[k]){Nx(j,ee,le,e,i,r,c,C,M);const ne=1<<le,he=(j+0)/ne,re=(j+1)/ne,Se=(ee+0)/ne,Te=(ee+1)/ne,ke=Ys(he,Se,this.dem)*_,We=Ys(re,Se,this.dem)*_,De=Ys(re,Te,this.dem)*_,Oe=Ys(he,Te,this.dem)*_,Fe=Bx(C[0],C[1],ke,M[0],C[1],We,M[0],M[1],De,h,f),je=Bx(M[0],M[1],De,C[0],M[1],Oe,C[0],C[1],ke,h,f),He=Math.min(Fe!==null?Fe:Number.MAX_VALUE,je!==null?je:Number.MAX_VALUE);if(He!==Number.MAX_VALUE)return He;{const Le=oh([],h,f,B);if(jx(ke,We,Oe,De,Fx(Le[0],C[0],M[0]),Fx(Le[1],C[1],M[1]))>=Le[2])return B}continue}let Q=0;for(let ne=0;ne<this._siblingOffset.length;ne++){Nx((j<<1)+this._siblingOffset[ne][0],(ee<<1)+this._siblingOffset[ne][1],le+1,e,i,r,c,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[k]+ne]*_;const he=Rx(C,M,h,f);if(he!=null){const re=he;b[ne]=re;let Se=!1;for(let Te=0;Te<Q&&!Se;Te++)re>=b[T[Te]]&&(T.splice(Te,0,ne),Se=!0);Se||(T[Q]=ne),Q++}}for(let ne=0;ne<Q;ne++){const he=T[ne];z.push({idx:this.childOffsets[k]+he,t:b[he],nodex:(j<<1)+this._siblingOffset[he][0],nodey:(ee<<1)+this._siblingOffset[he][1],depth:le+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,c,h){if(e[c].isLeaf(i,r)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const f=c-1,_=e[f];let v=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){const C=2*i+this._siblingOffset[T][0],M=2*r+this._siblingOffset[T][1],z=_.getElevation(C,M),k=_.isLeaf(C,M),B=this._addNode(z.min,z.max,k);k&&(v|=1<<T),b||(b=B)}for(let T=0;T<this._siblingOffset.length;T++)v&1<<T||this._construct(e,2*i+this._siblingOffset[T][0],2*r+this._siblingOffset[T][1],f,b+T)}}function jx(t,e,i,r,c,h){return ai(ai(t,i,h),ai(e,r,h),c)}function Ys(t,e,i){const r=i.dim,c=Ft(t*r-.5,0,r-1),h=Ft(e*r-.5,0,r-1),f=Math.floor(c),_=Math.floor(h),v=Math.min(f+1,r-1),b=Math.min(_+1,r-1);return jx(i.get(f,_),i.get(v,_),i.get(f,b),i.get(v,b),c-f,h-_)}const Vx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class jp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,c=!1,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return se(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=c,!c){for(let v=0;v<f;v++)_[this._idx(-1,v)]=_[this._idx(0,v)],_[this._idx(f,v)]=_[this._idx(f-1,v)],_[this._idx(v,-1)]=_[this._idx(v,0)],_[this._idx(v,f)]=_[this._idx(v,f-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(f,-1)]=_[this._idx(f-1,0)],_[this._idx(-1,f)]=_[this._idx(0,f-1)],_[this._idx(f,f)]=_[this._idx(f-1,f-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ux(this)}get(e,i,r=!1){r&&(e=Ft(e,-1,this.dim),i=Ft(i,-1,this.dim));const c=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return Vx[e]}get unpackVector(){return Vx[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,r){return(256*e*256+256*i+r)/10-1e4}_unpackTerrarium(e,i,r){return 256*e+i+r/256-32768}static pack(e,i){const r=[0,0,0,0],c=jp.getUnpackVector(i);let h=Math.floor((e+c[3])/c[2]);return r[2]=h%256,h=Math.floor(h/256),r[1]=h%256,h=Math.floor(h/256),r[0]=h,r}getPixels(){return new pr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,h=i*this.dim+this.dim,f=r*this.dim,_=r*this.dim+this.dim;switch(i){case-1:c=h-1;break;case 1:h=c+1}switch(r){case-1:f=_-1;break;case 1:_=f+1}const v=-i*this.dim,b=-r*this.dim;for(let T=f;T<_;T++)for(let C=c;C<h;C++){const M=4*this._idx(C,T),z=4*this._idx(C+v,T+b);this.pixels[M+0]=e.pixels[z+0],this.pixels[M+1]=e.pixels[z+1],this.pixels[M+2]=e.pixels[z+2],this.pixels[M+3]=e.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}mt(jp,"DEMData"),mt(Ux,"DemMinMaxQuadTree",{omit:["dem"]});class rA{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const h={value:i,timeout:void 0};if(r!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},r)),this.data[c].push(h),this.order.push(c),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,c=i===void 0?0:this.data[r].indexOf(i),h=this.data[r][c];return this.data[r].splice(c,1),h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(h.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const c of this.data[r])e(c.value)||i.push(c);for(const r of i)this.remove(r.value.tileID,r)}}class wc{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}wc.ReadOnly=!1,wc.ReadWrite=!0,wc.disabled=new wc(519,wc.ReadOnly,[0,1]);const l_=7680;class c_{constructor(e,i,r,c,h,f){this.test=e,this.ref=i,this.mask=r,this.fail=c,this.depthFail=h,this.pass=f}}c_.disabled=new c_({func:519,mask:0},0,0,l_,l_,l_);class Bo{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}Bo.Replace=[1,0],Bo.disabled=new Bo(Bo.Replace,Ji.transparent,[!1,!1,!1,!1]),Bo.unblended=new Bo(Bo.Replace,Ji.transparent,[!0,!0,!0,!0]),Bo.alphaBlended=new Bo([1,771],Ji.transparent,[!0,!0,!0,!0]);const u_=1029,h_=2305;class po{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}po.disabled=new po(!1,u_,h_),po.backCCW=new po(!0,u_,h_),po.backCW=new po(!0,u_,2304),po.frontCW=new po(!0,1028,2304),po.frontCCW=new po(!0,1028,h_);class Ha extends Qr{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new rA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new nA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Wi(this._tiles).map(e=>e.tileID).sort($x).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,c)=>{const h=r.tileID,f=c.tileID,_=new Ce(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),v=new Ce(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-f.overscaledZ||v.y-_.y||v.x-_.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort($x).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new bo(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=hi.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ei("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const h=i[c];if(e.neighboringTiles&&e.neighboringTiles[h]){const f=this.getTileByID(h);r(e,f),r(f,e)}}function r(c,h){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=h.tileID.canonical.x-c.tileID.canonical.x;const _=h.tileID.canonical.y-c.tileID.canonical.y,v=Math.pow(2,c.tileID.canonical.z),b=h.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),h.dem&&c.dem&&(c.dem.backfillBorder(h.dem,f,_),c.neighboringTiles&&c.neighboringTiles[b]&&(c.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,c){for(const h in this._tiles){let f=this._tiles[h];if(c[h]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>r)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(_=b)}let v=_;for(;v.overscaledZ>i;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){c[_.key]=_;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const c=e.scaledTo(r),h=this._getLoadedTile(c);if(h)return h}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,h=Math.floor(r*c*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const c in this._tiles){const h=this._tiles[c];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+i),r[h.tileID.key]=h}this._tiles=r;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(_=>new Xn(_.canonical.z,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(_=>this._source.hasTile(_)))):c=[];const h=this._updateRetainedTiles(c);if(Gx(this._source.type)&&c.length!==0){const _={},v={},b=Object.keys(h);for(const C of b){const M=h[C],z=this._tiles[C];if(!z||z.fadeEndTime&&z.fadeEndTime<=hi.now())continue;const k=this.findLoadedParent(M,Math.max(M.overscaledZ-Ha.maxOverzooming,this._source.minzoom));k&&(this._addTile(k.tileID),_[k.tileID.key]=k.tileID),v[C]=M}const T=c[c.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(h[C]||!M.hasData())continue;let z=M.tileID;for(;z.overscaledZ>T;){z=z.scaledTo(z.overscaledZ-1);const k=this._tiles[z.key];if(k&&k.hasData()&&v[z.key]){h[C]=M.tileID;break}}}for(const C in _)h[C]||(this._coveredTiles[C]=!0,h[C]=_[C])}for(const _ in h)this._tiles[_].clearFadeHold();const f=function(_,v){const b=[];for(const T in _)T in v||b.push(T);return b}(this._tiles,h);for(const _ of f){const v=this._tiles[_];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+_)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const r={},c=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),h=e[0].overscaledZ,f=Math.max(h-Ha.maxOverzooming,this._source.minzoom),_=Math.max(h+Ha.maxUnderzooming,this._source.minzoom),v={};for(const b of e){const T=this._addTile(b);i[b.key]=b,T.hasData()||c<this._source.maxzoom&&(v[b.key]=b)}this._retainLoadedChildren(v,c,_,i);for(const b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const M=b.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){i[M.key]=M;continue}}else{const M=b.children(this._source.maxzoom);if(i[M[0].key]&&i[M[1].key]&&i[M[2].key]&&i[M[3].key])continue}let C=T.wasRequested();for(let M=b.overscaledZ-1;M>=f;--M){const z=b.scaledTo(M);if(r[z.key]||(r[z.key]=!0,T=this.getTile(z),!T&&C&&(T=this._addTile(z)),T&&(i[z.key]=z,C=T.wasRequested(),T.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){r=this._loadedParentTiles[c.key];break}i.push(c.key);const h=c.scaledTo(c.overscaledZ-1);if(r=this._getLoadedTile(h),r)break;c=h}for(const h of i)this._loadedParentTiles[h]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=Boolean(i);if(!r){const c=this.map?this.map.painter:null;i=new a_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new Ei("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const c=[],h=this.transform;if(!h)return c;const f=h.projection.name==="globe",_=Mo(h.center.lng);for(const v in this._tiles){const b=this._tiles[v];if(r&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(f){const C=b.tileID.canonical;if(C.z===0){const M=[Math.abs(Ft(_,...Ph(C,-1))-_),Math.abs(Ft(_,...Ph(C,1))-_)];T=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Ft(_,...Ph(C,-1))-_),Math.abs(Ft(_,...Ph(C,0))-_),Math.abs(Ft(_,...Ph(C,1))-_)];T=[M.indexOf(Math.min(...M))-1]}}else T=[0];for(const C of T){const M=e.containsTile(b,h,i,C);M&&c.push(M)}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Gx(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=hi.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const c=this._tiles[e];c&&c.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){const r=new Map,c=Array.isArray(e)?e:[e],h=this.map.painter.terrain,f=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const v=_.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of v)r.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}ei(Array.from(r.values()),(_,v)=>{const b=new a_(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),v(T,b)})},i)}}function $x(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Gx(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Ph(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ha.maxOverzooming=10,Ha.maxUnderzooming=3;class Vp{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const c=r||e.findDEMTileFor(i);if(!c||!c.dem)return;const h=c.dem,f=c.tileID,_=1<<i.canonical.z-f.canonical.z;return new Vp(c,c.tileSize/Rt/_,[(i.canonical.x/_-f.canonical.x)*h.dim,(i.canonical.y/_-f.canonical.y)*h.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(r);return new Ce(c,h)}getElevationAt(e,i,r,c){const h=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],_=Math.floor(h),v=Math.floor(f),b=this._dem;return c=!!c,r?ai(ai(b.get(_,v,c),b.get(_,v+1,c),f-v),ai(b.get(_+1,v,c),b.get(_+1,v+1,c),f-v),h-_):b.get(_,v,c)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*jr(1,e)*this._dem.stride}}class qx{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new js(Rt,16,0),this.featureIndexArray=new Py,this.promoteId=i}insert(e,i,r,c,h,f=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,h,f);const v=this.grid;for(let b=0;b<i.length;b++){const T=i[b],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const z=T[M];C[0]=Math.min(C[0],z.x),C[1]=Math.min(C[1],z.y),C[2]=Math.max(C[2],z.x),C[3]=Math.max(C[3],z.y)}C[0]<Rt&&C[1]<Rt&&C[2]>=0&&C[3]>=0&&v.insert(_,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vm(new yh(this.rawTileData)).layers,this.sourceLayerCoder=new Px(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,c){this.loadVTLayers();const h=e.params||{},f=$l(h.filter),_=e.tileResult,v=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(k,B,j,ee)=>Yy(_.bufferedTilespaceGeometry,k,B,j,ee));T.sort(oA);let C=null;v.elevation&&T.length>0&&(C=Vp.create(v.elevation,this.tileID));const M={};let z;for(let k=0;k<T.length;k++){const B=T[k];if(B===z)continue;z=B;const j=this.featureIndexArray.get(B);let ee=null;this.loadMatchingFeature(M,j,f,h.layers,h.availableImages,i,r,c,(le,Q,ne,he=0)=>(ee||(ee=os(le,this.tileID.canonical,e.tileTransform)),Q.queryIntersectsFeature(_,le,ne,ee,this.z,e.transform,e.pixelPosMatrix,C,he)))}return M}loadMatchingFeature(e,i,r,c,h,f,_,v,b){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:z}=i,k=this.bucketLayerIDs[C];if(c&&!function(le,Q){for(let ne=0;ne<le.length;ne++)if(Q.indexOf(le[ne])>=0)return!0;return!1}(c,k))return;const B=this.sourceLayerCoder.decode(M),j=this.vtLayers[B].feature(T);if(r.needGeometry){const le=ja(j,!0);if(!r.filter(new te(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!r.filter(new te(this.tileID.overscaledZ),j))return;const ee=this.getId(j,B);for(let le=0;le<k.length;le++){const Q=k[le];if(c&&c.indexOf(Q)<0)continue;const ne=f[Q];if(!ne)continue;let he={};ee!==void 0&&v&&(he=v.getState(ne.sourceLayer||"_geojsonTileLayer",ee));const re=gi({},_[Q]);re.paint=Zx(re.paint,ne.paint,j,he,h),re.layout=Zx(re.layout,ne.layout,j,he,h);const Se=!b||b(j,ne,he,z);if(!Se)continue;const Te=new Dx(j,this.z,this.x,this.y,ee);Te.layer=re;let ke=e[Q];ke===void 0&&(ke=e[Q]=[]),ke.push({featureIndex:T,feature:Te,intersectionZ:Se})}}lookupSymbolFeatures(e,i,r,c,h,f,_,v){const b={};this.loadVTLayers();const T=$l(h);for(const C of e)this.loadMatchingFeature(b,{bucketIndex:r,sourceLayerIndex:c,featureIndex:C,layoutVertexArrayOffset:0},T,f,_,v,i);return b}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(r),h=this.vtFeatures[c];if(h[i])return h[i];const f=this.vtLayers[c].feature(i);return h[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(r=e.properties[c]),typeof r=="boolean"&&(r=Number(r))}return r}}function Zx(t,e,i,r,c){return pn(t,(h,f)=>{const _=e instanceof Re?e.get(f):null;return _&&_.evaluate?_.evaluate(i,r,c):_})}function oA(t,e){return e-t}mt(qx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Wx{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new as({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=dn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const c=[];let h=e.length%2==1?-e[e.length-1]*r:0,f=e[0]*r,_=!0;c.push({left:h,right:f,isDash:_,zeroLength:e[0]===0});let v=e[0];for(let b=1;b<e.length;b++){_=!_;const T=e[b];h=v*r,v+=T,f=v*r,c.push({left:h,right:f,isDash:_,zeroLength:T===0})}return c}addRoundDash(e,i,r){const c=i/2;for(let h=-r;h<=r;h++){const f=this.width*(this.nextRow+r+h);let _=0,v=e[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++_]);const T=Math.abs(b-v.left),C=Math.abs(b-v.right),M=Math.min(T,C);let z;const k=h/r*(c+1);if(v.isDash){const B=c-Math.abs(k);z=Math.sqrt(M*M+B*B)}else z=c-Math.sqrt(M*M+k*k);this.image.data[f+b]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,i){for(let v=e.length-1;v>=0;--v){const b=e[v],T=e[v+1];b.zeroLength?e.splice(v,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(v,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const h=this.width*this.nextRow;let f=0,_=e[f];for(let v=0;v<this.width;v++){v/_.right>1&&(_=e[++f]);const b=Math.abs(v-_.left),T=Math.abs(v-_.right),C=Math.min(b,T);this.image.data[h+v]=Math.max(0,Math.min(255,(_.isDash?C:-C)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const c=i==="round",h=c?7:0,f=2*h+1;if(this.nextRow+f>this.height)return se("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(se("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){const T=this.width/_,C=this.getDashRanges(e,this.width,T);c?this.addRoundDash(C,T,h):this.addRegularDash(C,i==="square"?.5*T:0)}const v=this.nextRow+h;this.nextRow+=f;const b={tl:[v,h],br:[_,0]};return this.positions[r]=b,b}}mt(Wx,"LineAtlas");class Hx{constructor(e){const i={},r=[];for(const _ in e){const v=e[_],b=i[_]={};for(const T in v.glyphs){const C=v.glyphs[+T];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,z={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};r.push(z),b[T]=z}}const{w:c,h}=qm(r),f=new as({width:c||1,height:h||1});for(const _ in e){const v=e[_];for(const b in v.glyphs){const T=v.glyphs[+b];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const C=i[_][b],M=T.metrics.localGlyph?2:1;as.copy(T.bitmap,f,{x:0,y:0},{x:C.x+M,y:C.y+M},T.bitmap)}}this.image=f,this.positions=i}}mt(Hx,"GlyphAtlas");class sA{constructor(e){this.tileID=new Xn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Wa(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,c,h){this.status="parsing",this.data=e,this.collisionBoxArray=new _m;const f=new Px(Object.keys(e.layers).sort()),_=new qx(this.tileID,this.promoteId);_.bucketLayerIDs=[];const v={},b=new Wx(256,256),T={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:r},C=i.familiesBySource[this.source];for(const he in C){const re=e.layers[he];if(!re)continue;let Se=!1,Te=!1;for(const De of C[he])De[0].type==="symbol"?Se=!0:Te=!0;if(this.isSymbolTile===!0&&!Se||this.isSymbolTile===!1&&!Te)continue;re.version===1&&se(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ke=f.encode(he),We=[];for(let De=0;De<re.length;De++){const Oe=re.feature(De),Fe=_.getId(Oe,he);We.push({feature:Oe,id:Fe,index:De,sourceLayerIndex:ke})}for(const De of C[he]){const Oe=De[0];this.isSymbolTile!==void 0&&Oe.type==="symbol"!==this.isSymbolTile||Oe.minzoom&&this.zoom<Math.floor(Oe.minzoom)||Oe.maxzoom&&this.zoom>=Oe.maxzoom||Oe.visibility!=="none"&&(d_(De,this.zoom,r),(v[Oe.id]=Oe.createBucket({index:_.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(We,T,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(De.map(Fe=>Fe.id)))}}let M,z,k,B;b.trim();const j={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=pn(T.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(ee).length?c.send("getGlyphs",{uid:this.uid,stacks:ee},(he,re)=>{M||(M=he,z=re,ne.call(this))},void 0,!1,j):z={};const le=Object.keys(T.iconDependencies);le.length?c.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(he,re)=>{M||(M=he,k=re,ne.call(this))},void 0,!1,j):k={};const Q=Object.keys(T.patternDependencies);function ne(){if(M)return h(M);if(z&&k&&B){const he=new Hx(z),re=new Hv(k,B);for(const Se in v){const Te=v[Se];Te instanceof Hs?(d_(Te.layers,this.zoom,r),I2(Te,z,he.positions,k,re.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof Tp||Te instanceof vp||Te instanceof fh)&&(d_(Te.layers,this.zoom,r),Te.addFeatures(T,this.tileID.canonical,re.patternPositions,r,this.tileTransform))}this.status="done",h(null,{buckets:Wi(v).filter(Se=>!Se.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:b,imageAtlas:re,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?k:null,glyphPositions:this.returnDependencies?he.positions:null})}}Q.length?c.send("getImages",{icons:Q,source:this.source,tileID:this.tileID,type:"patterns"},(he,re)=>{M||(M=he,B=re,ne.call(this))},void 0,!1,j):B={},ne.call(this)}}function d_(t,e,i){const r=new te(e);for(const c of t)c.recalculate(r,i)}class Xx{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,c){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[f,_]=h.result;return this.scheduler?this.scheduler.add(()=>{c(f,_)},i):c(f,_),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=r((f,_)=>{h.result=[f,_];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,_)},i):v(f,_);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(f=>f!==c),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function Kx(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const h=vr(t.request,(f,_,v,b)=>{f?c(f):_&&c(null,{vectorTile:i?void 0:new Vm(new yh(_)),rawData:_,cacheControl:v,expires:b})});return()=>{h.cancel(),c()}},e)}o.ARRAY_TYPE=dr,o.AUTH_ERR_MSG=As,o.Aabb=Hn,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Hi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$e()?t:L,this.scheduler=new tA}send(t,e,i,r,c=!1,h){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=h,this.callbacks[f]=i);const _=gt(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:t,hasCallback:!!i,targetMapId:r,mustQueue:c,sourceMapId:this.mapId,data:Oa(e,_)},_),{cancel:()=>{i&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||$e()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(So(e.error)):i(null,So(e.data)))}else{const i=gt(this.globalScope)?void 0:[],r=e.hasCallback?(h,f)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:h?Oa(h):null,data:Oa(f,i)},i)}:h=>{},c=So(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,r);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],c.source)[h[1]](c,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Ep,o.Color=Ji,o.ColorMode=Bo,o.CullFaceMode=po,o.DEMData=jp,o.DataConstantProperty=we,o.DedupedRequest=Xx,o.DepthMode=wc,o.EXTENT=Rt,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,c=Math.floor(t.x),h=Math.floor((t.x-c)*r),f=Math.floor(t.y*r),_=this.findDEMTileFor(new Xn(i,c,i,h,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const c=r.getSource().maxzoom,h=1<<c,f=Math.floor(t.x),_=t.x-f,v=new Xn(c,f,c,Math.floor(_*h),Math.floor(t.y*h)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const T=b.dem,C=1<<b.tileID.canonical.z,M=(_*C-b.tileID.canonical.x)*T.dim,z=(t.y*C-b.tileID.canonical.y)*T.dim,k=Math.floor(M),B=Math.floor(z);return(i?this.exaggeration():1)*ai(ai(T.get(k,B),T.get(k,B+1),z-B),ai(T.get(k+1,B),T.get(k+1,B+1),z-B),M-k)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new rc(t.wrap+(t.canonical.x+e/Rt)/r,(t.canonical.y+i/Rt)/r))}getAtTileOffsetFunc(t,e,i,r){return c=>{const h=this.getAtTileOffset(t,c.x,c.y),f=r.upVector(t.canonical,c.x,c.y);return Sr(f,f,h*r.upVectorScale(t.canonical,e,i).metersToTile),f}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const c=Vp.create(this,t,r);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,c=1<<t.canonical.z-r.canonical.z;let h=t.canonical.x/c-r.canonical.x,f=t.canonical.y/c-r.canonical.y,_=0;for(let v=0;v<t.canonical.z-r.canonical.z&&!i.leaves[_];v++){h*=2,f*=2;const b=2*Math.floor(f)+Math.floor(h);_=i.childOffsets[_]+b,h%=1,f%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=bo,o.EvaluationParameters=te,o.Event=Ei,o.Evented=Qr,o.FillExtrusionBucket=fh,o.Frustum=zm,o.FrustumCorners=Lm,o.GLOBE_METERS_TO_ECEF=Qm,o.GLOBE_RADIUS=us,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new qt,i=new Nn,r=65;for(let c=0;c<r;c++)for(let h=0;h<r;h++)e.emplaceBack(h,c);this._gridSegments=[];for(let c=0,h=0;c<yc.length;c++){const f=yc[c];for(let v=0;v<f;v++)for(let b=0;b<64;b++){const T=v*r+b;i.emplaceBack(T+1,T,T+r),i.emplaceBack(T+r,T+r+1,T+1)}const _=64*f*2;this._gridSegments.push(ln.simpleSegment(0,h,(f+1)*r,_)),h+=_}this._gridBuffer=t.createVertexBuffer(e,bh.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new Nn;for(let c=0;c<=gc;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Ur,r=new Ur;this._poleSegments=[];for(let c=0,h=0;c<5;c++){const f=360/(1<<c);i.emplaceBack(0,-us,0,.5,0),r.emplaceBack(0,-us,0,.5,1);for(let _=0;_<=gc;_++){const v=_/gc,b=ai(0,f,v),[T,C,M]=vc(O2,R2,b,us);i.emplaceBack(T,C,M,v,0),r.emplaceBack(T,C,M,v,1)}this._poleSegments.push(ln.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,fx,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,fx,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Tr,r=gc,c=r+1;this._wireframeSegments=[];for(let h=0,f=0;h<yc.length;h++){const _=yc[h];for(let b=0;b<_;b++)for(let T=0;T<r;T++){const C=b*c+T;i.emplaceBack(C,C+1),i.emplaceBack(C,C+c),i.emplaceBack(C,C+c+1)}const v=_*r*3;this._wireframeSegments.push(ln.simpleSegment(0,f,(_+1)*c,v)),f+=v}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=mc,o.ImagePosition=Zm,o.LivePerformanceUtils=Ue,o.LngLat=fi,o.LngLatBounds=qs,o.LocalGlyphMode=Xm,o.MAX_MERCATOR_LATITUDE=Do,o.MercatorCoordinate=rc,o.ONE_EM=zn,o.OverscaledTileID=Xn,o.PerformanceMarkers=Ee,o.Properties=Je,o.RGBAImage=pr,o.Ray=Dm,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ut,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!xr(t))return t;const i=$n(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!xr(t))return t;const i=$n(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!xr(t))return t;const c=$n(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),r&&c.params.push(`worldview=${r}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const c=$n(t);return xr(t)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||r)):(c.path+=`${e}${i}`,Wo(c))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!xr(t))return t;const r=$n(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&r.authority!=="raster"&&i===512?"@2x":""}${de.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${J.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${J.TILE_URL_VERSION}${r.path}`);const c=this._customAccessToken||function(h){for(const f of h){const _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(r.params)||J.ACCESS_TOKEN;return J.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,c)}canonicalizeTileURL(t,e){const i=$n(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${J.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${J.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(r+=`?${c.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&xr(e),r=[];for(const c of t.tiles||[])Ss(c)?r.push(this.canonicalizeTileURL(c,i)):r.push(c);return r}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=$n(J.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(r.path!=="/"&&(t.path=`${r.path}${t.path}`),!J.REQUIRE_ACCESS_TOKEN)return Wo(t);if(e=e||J.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Wo(t)}},o.ResourceType=$i,o.SegmentVector=ln,o.SourceCache=Ha,o.StencilMode=c_,o.StructArrayLayout1ui2=Qu,o.StructArrayLayout2f1f2i16=Zn,o.StructArrayLayout2i4=qt,o.StructArrayLayout2ui4=Tr,o.StructArrayLayout3f12=Er,o.StructArrayLayout3ui6=Nn,o.StructArrayLayout4i8=Ai,o.StructArrayLayout5f20=Ur,o.Texture=Mh,o.Tile=a_,o.Transitionable=Pe,o.Uniform1f=ap,o.Uniform1i=class extends ns{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends ns{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends ns{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=Ny,o.UniformColor=Uy,o.UniformMatrix2f=class extends ns{constructor(t){super(t),this.current=UE}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends ns{constructor(t){super(t),this.current=NE}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends ns{constructor(t){super(t),this.current=FE}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=Ov,o.ValidationError=pt,o.VectorTileFeature=bp,o.VectorTileWorkerSource=class extends Qr{constructor(t,e,i,r,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||Kx,this.loading={},this.loaded={},this.deduped=new Xx(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,c=r&&r.collectResourceTiming,h=this.loading[i]=new sA(t);h.abort=this.loadVectorData(t,(f,_)=>{const v=!this.loading[i];if(delete this.loading[i],v||f||!_)return h.status="done",v||(this.loaded[i]=h),e(f);const b=_.rawData,T={};_.expires&&(T.expires=_.expires),_.cacheControl&&(T.cacheControl=_.cacheControl),h.vectorTile=_.vectorTile||new Vm(new yh(b));const C=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,z)=>{if(M||!z)return e(M);const k={};if(c){const B=Mt(r);B.length>0&&(k.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,gi({rawTileData:b.slice(0)},z,T,k))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[i]=h})}reloadTile(t,e){const i=this.loaded,r=t.uid,c=this;if(i&&i[r]){const h=i[r];h.showCollisionBoxes=t.showCollisionBoxes,h.enableTerrain=!!t.enableTerrain,h.projection=t.projection,h.tileTransform=Wa(t.tileID.canonical,t.projection);const f=(_,v)=>{const b=h.reloadCallback;b&&(delete h.reloadCallback,h.parse(h.vectorTile,c.layerIndex,this.availableImages,c.actor,b)),e(_,v)};h.status==="parsing"?h.reloadCallback=f:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},o.WritingMode=Cr,o.ZoomHistory=Zd,o.add=ss,o.addDynamicAttributes=Fp,o.adjoint=function(t,e){var i=e[0],r=e[1],c=e[2],h=e[3],f=e[4],_=e[5],v=e[6],b=e[7],T=e[8];return t[0]=f*T-_*b,t[1]=c*b-r*T,t[2]=r*_-c*f,t[3]=_*v-h*T,t[4]=i*T-c*v,t[5]=c*h-i*_,t[6]=h*b-f*v,t[7]=r*v-i*b,t[8]=i*f-r*h,t},o.asyncAll=ei,o.bezier=bi,o.bindAll=Hi,o.boundsAttributes=zx,o.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const c=Jt(r-1,-1,t.length-1),h=Jt(r+1,-1,t.length-1),f=t[r],_=t[h],v=t[c].sub(f).unit(),b=_.sub(f).unit(),T=b.angleWithSep(v.x,v.y),C=v.add(b).unit().mult(-1*e/Math.sin(T/2));i.push(f.add(C))}return i},o.cacheEntryPossiblyAdded=function(t){Fi++,Fi>Nt&&(t.getActor().send("enforceCacheSizeLimit",Ct),Fi=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,c=xx(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return sc(c,c,i_(ko(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:c}=t._center;return xx(e,i,t.worldSize,r,c)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/jr(1,t.center.lat),r=Lo(new Float64Array(16));return th(r,r,[t.point.x,t.point.y,0]),$a(r,r,[i,i,e]),Float32Array.from(r)},o.circumferenceAtLatitude=vm,o.clamp=Ft,o.clearTileCache=function(t){if(!Wt())return;const e=L.caches.delete(Ye);t&&e.catch(t).then(()=>t())},o.clipLine=sx,o.clone=function(t){var e=new dr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=fn,o.collisionCircleLayout=e2,o.config=J,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new dr(16);return dr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=ev,o.createExpression=es,o.createLayout=Qe,o.createStyleLayer=function(t){return t.type==="custom"?new Y2(t):new Q2[t.type](t)},o.cross=Pm,o.degToRad=_t,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=Vr,o.earthRadius=cp,o.ease=hn,o.easeCubicInOut=Bi,o.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),c=Math.atan2(t,i),h=.5*Math.PI-Math.acos(-e/r);return new fi(It(c),It(h))},o.emitValidationErrors=Wu,o.endsWith=Yi,o.enforceCacheSizeLimit=function(t){ni(),bt&&bt.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},o.evaluateSizeForFeature=Ap,o.evaluateSizeForZoom=hc,o.evaluateVariableOffset=hx,o.evented=K,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=hi,o.exported$1=de,o.extend=gi,o.extend$1=eo,o.fillExtrusionHeightLift=Lv,o.filterObject=In,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],r=e[1],c=e[2],h=e[3],f=i+i,_=r+r,v=c+c,b=i*f,T=r*f,C=r*_,M=c*f,z=c*_,k=c*v,B=h*f,j=h*_,ee=h*v;return t[0]=1-C-k,t[1]=T+ee,t[2]=M-j,t[3]=0,t[4]=T-ee,t[5]=1-b-k,t[6]=z+B,t[7]=0,t[8]=M+j,t[9]=z-B,t[10]=1-b-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=iv,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return mi[e]},o.getAABBPointSquareDist=function(t,e,i){let r=0;for(let c=0;c<2;++c){const h=i?i[c]:0;t[c]>h&&(r+=(t[c]-h)*(t[c]-h)),e[c]<h&&(r+=(h-e[c])*(h-e[c]))}return r},o.getAnchorAlignment=Hm,o.getAnchorJustification=Ym,o.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,c=-1/0;for(const h of t)e=Math.min(e,h.x),i=Math.min(i,h.y),r=Math.max(r,h.x),c=Math.max(c,h.y);return{min:new Ce(e,i),max:new Ce(r,c)}},o.getColumn=rt,o.getGridMatrix=function(t,e,i,r){const c=e.getNorth(),h=e.getSouth(),f=e.getWest(),_=e.getEast(),v=1<<t.z,b=_-f,T=c-h,C=b/gc,M=-T/yc[i],z=[0,C,0,M,0,0,c,f,0];if(t.z>0){const k=180/r;tv(z,z,[k/b+1,0,0,0,k/T+1,0,-.5*k/C,.5*k/M,1])}return z[2]=v,z[5]=t.x,z[8]=t.y,z},o.getImage=Ts,o.getJSON=function(t,e){return Vn(gi(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=80.051129;t=Ft(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(_t(t))),3);return Math.round(i*(yc.length-1))},o.getMapSessionAPI=ye,o.getPerformanceMeasurement=Mt,o.getProjection=Ix,o.getRTLTextPluginStatus=Z,o.getReferrer=Yr,o.getTilePoint=function(t,{x:e,y:i},r=0){return new Ce(((e-r)*t.scale-t.x)*Rt,(i*t.scale-t.y)*Rt)},o.getTileVec3=function(t,e,i=0){return ac(((e.x-i)*t.scale-t.x)*Rt,(e.y*t.scale-t.y)*Rt,$y(e.z,e.y))},o.getVideo=function(t,e){const i=L.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const c=L.document.createElement("source");mn(t[r])||(i.crossOrigin="Anonymous"),c.src=t[r],i.appendChild(c)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=Lo(new Float64Array(16));return sc(i,t.pixelMatrix,t.globeMatrix),cn(e,e,i),new Ce(e[0],e[1])},o.globeDenormalizeECEF=i_,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return cn(i,i,Th(ko(e.canonical))),cn(i,i,t),i},o.globeNormalizeECEF=Th,o.globePixelsToTileUnits=function(t,e){return Rt/(512*Math.pow(2,t))*zp(ko(e))},o.globePoleMatrixForTile=function(t,e,i){const r=Lo(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return fp(r,i.globeMatrix,c),Float32Array.from(r)},o.globeTileBounds=ko,o.globeTiltAtLngLat=bx,o.globeToMercatorTransition=xc,o.globeUseCustomAntiAliasing=function(t,e,i){const r=xc(i.zoom),c=t.style.map._antialias,h=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!c&&!f&&h},o.identity=Lo,o.identity$1=uv,o.invert=Sm,o.isFullscreen=function(){return!!L.document.fullscreenElement||!!L.document.webkitFullscreenElement},o.isLngLatBehindGlobe=function(t,e){return bx(t,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(t){return pe.has(t)},o.isMapboxURL=xr,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!gt(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Ln,o.latLngToECEF=wh,o.len=nT,o.length=ih,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=Ar,o.loadVectorTile=Kx,o.makeRequest=Vn,o.mapValue=function(t,e,i,r,c){return Ft((t-e)/(i-e)*(c-r)+r,r,c)},o.mercatorScale=Gy,o.mercatorXfromLng=Mo,o.mercatorYfromLat=Po,o.mercatorZfromAltitude=jr,o.mul=tT,o.mul$1=iT,o.multiply=sc,o.multiply$1=tv,o.multiply$2=ov,o.nextPowerOfTwo=dn,o.normalize=Wn,o.normalize$1=rT,o.normalize$2=lv,o.number=ai,o.ortho=function(t,e,i,r,c,h,f){var _=1/(e-i),v=1/(r-c),b=1/(h-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+i)*_,t[13]=(c+r)*v,t[14]=(f+h)*b,t[15]=1,t},o.pbf=yh,o.perspective=function(t,e,i,r,c){var h,f=1/Math.tan(e/2);return t[0]=f/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+r)*(h=1/(r-c)),t[14]=2*c*r*h):(t[10]=-1,t[14]=-2*r),t},o.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const c=e[r];c in t&&(i[c]=t[c])}return i},o.plugin=ae,o.pointGeometry=Ce,o.polygonContainsPoint=Va,o.polygonIntersectsBox=Yy,o.polygonIntersectsPolygon=Wy,o.polygonizeBounds=function(t,e,i=0,r=!0){const c=new Ce(i,i),h=t.sub(c),f=e.add(c),_=[h,new Ce(f.x,h.y),f,new Ce(h.x,f.y)];return r&&_.push(h.clone()),_},o.posAttributes=bh,o.postMapLoadEvent=X,o.postPerformanceEvent=ue,o.postTurnstileEvent=O,o.potpack=qm,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=It,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:$,pluginURL:H}),K.on("pluginStateChange",t),t},o.removeAuthState=function(t){pe.delete(t)},o.renderColorRamp=Om,o.resample=qy,o.rotateX=Cm,o.rotateX$1=hv,o.rotateY=fp,o.rotateY$1=dv,o.rotateZ=function(t,e,i){var r=Math.sin(i),c=Math.cos(i),h=e[0],f=e[1],_=e[2],v=e[3],b=e[4],T=e[5],C=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c+b*r,t[1]=f*c+T*r,t[2]=_*c+C*r,t[3]=v*c+M*r,t[4]=b*c-h*r,t[5]=T*c-f*r,t[6]=C*c-_*r,t[7]=M*c-v*r,t},o.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],c=e[1],h=e[2],f=e[3],_=Math.sin(i),v=Math.cos(i);return t[0]=r*v+c*_,t[1]=c*v-r*_,t[2]=h*v+f*_,t[3]=f*v-h*_,t},o.scale=$a,o.scale$1=av,o.scale$2=Sr,o.scaleAndAdd=oh,o.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},o.setCacheLimits=function(t,e){Ct=t,Nt=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if($===D||$===R||$===N)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=hi.resolveURL(t),$=D,W=e,V(),i||oe()},o.smoothstep=ui,o.spec=ze,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},o.storeAuthState=function(t,e){e?pe.add(t):pe.delete(t)},o.sub=co,o.subtract=Mm,o.symbolSize=t2,o.tileAABB=function(t,e,i,r,c,h,f,_,v){if(v.name==="globe")return k2(t,e,new Ep(i,r,c));const b=Wa({z:i,x:r,y:c},v);return new Hn([(h+b.x/b.scale)*e,e*(b.y/b.scale),f],[(h+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},o.tileCornersToBounds=Lp,o.tileTransform=Wa,o.transformMat3=function(t,e,i){var r=e[0],c=e[1],h=e[2];return t[0]=r*i[0]+c*i[3]+h*i[6],t[1]=r*i[1]+c*i[4]+h*i[7],t[2]=r*i[2]+c*i[5]+h*i[8],t},o.transformMat4=cn,o.transformMat4$1=Ga,o.transformQuat=sv,o.transitionTileAABBinECEF=gx,o.translate=th,o.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=q,o.uniqueId=Ki,o.updateGlobeVertexNormal=function(t,e,i,r,c){const h=5*e+2;t.float32[h+0]=i,t.float32[h+1]=r,t.float32[h+2]=c},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>so(za(t)),o.validateFog=t=>so(Vd(t)),o.validateLayer=t=>so($u(t)),o.validateLight=t=>so(ka(t)),o.validateSource=t=>so(Xl(t)),o.validateStyle=$d,o.validateTerrain=t=>so(Gu(t)),o.values=Wi,o.vectorTile=xp,o.version=U,o.warnOnce=se,o.window=L,o.wrap=Jt}),E(["./shared"],function(o){function L(Y){if(typeof Y=="number"||typeof Y=="boolean"||typeof Y=="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let F="[";for(const X of Y)F+=`${L(X)},`;return`${F}]`}let O="{";for(const F of Object.keys(Y).sort())O+=`${F}:${L(Y[F])},`;return`${O}}`}function U(Y){let O="";for(const F of o.refProperties)O+=`/${L(Y[F])}`;return O}class G{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,F){for(const ie of O)this._layerConfigs[ie.id]=ie,(this._layers[ie.id]=o.createStyleLayer(ie)).compileFilter(),this.keyCache[ie.id]&&delete this.keyCache[ie.id];for(const ie of F)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const X=function(ie,ue){const ve={};for(let pe=0;pe<ie.length;pe++){const Ee=ue&&ue[ie[pe].id]||U(ie[pe]);ue&&(ue[ie[pe].id]=Ee);let Ue=ve[Ee];Ue||(Ue=ve[Ee]=[]),Ue.push(ie[pe])}const ye=[];for(const pe in ve)ye.push(ve[pe]);return ye}(o.values(this._layerConfigs),this.keyCache);for(const ie of X){const ue=ie.map(dt=>this._layers[dt.id]),ve=ue[0];if(ve.visibility==="none")continue;const ye=ve.source||"";let pe=this.familiesBySource[ye];pe||(pe=this.familiesBySource[ye]={});const Ee=ve.sourceLayer||"_geojsonTileLayer";let Ue=pe[Ee];Ue||(Ue=pe[Ee]=[]),Ue.push(ue)}}}class J{loadTile(O,F){const{uid:X,encoding:ie,rawImageData:ue,padding:ve,buildQuadTree:ye}=O,pe=o.window.ImageBitmap&&ue instanceof o.window.ImageBitmap?this.getImageData(ue,ve):ue;F(null,new o.DEMData(X,pe,ie,ve<1,ye))}getImageData(O,F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const X=this.offscreenCanvasContext.getImageData(-F,-F,O.width+2*F,O.height+2*F);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),X}}var de=function Y(O,F){var X,ie=O&&O.type;if(ie==="FeatureCollection")for(X=0;X<O.features.length;X++)Y(O.features[X],F);else if(ie==="GeometryCollection")for(X=0;X<O.geometries.length;X++)Y(O.geometries[X],F);else if(ie==="Feature")Y(O.geometry,F);else if(ie==="Polygon")xe(O.coordinates,F);else if(ie==="MultiPolygon")for(X=0;X<O.coordinates.length;X++)xe(O.coordinates[X],F);return O};function xe(Y,O){if(Y.length!==0){ge(Y[0],O);for(var F=1;F<Y.length;F++)ge(Y[F],!O)}}function ge(Y,O){for(var F=0,X=0,ie=0,ue=Y.length,ve=ue-1;ie<ue;ve=ie++){var ye=(Y[ie][0]-Y[ve][0])*(Y[ve][1]+Y[ie][1]),pe=F+ye;X+=Math.abs(F)>=Math.abs(ye)?F-pe+ye:ye-pe+F,F=pe}F+X>=0!=!!O&&Y.reverse()}const Ie=o.VectorTileFeature.prototype.toGeoJSON;class Ne{constructor(O){this._feature=O,this.extent=o.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(this._feature.type===1){const O=[];for(const F of this._feature.geometry)O.push([new o.pointGeometry(F[0],F[1])]);return O}{const O=[];for(const F of this._feature.geometry){const X=[];for(const ie of F)X.push(new o.pointGeometry(ie[0],ie[1]));O.push(X)}return O}}toGeoJSON(O,F,X){return Ie.call(this,O,F,X)}}class et{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=O.length,this._features=O}feature(O){return new Ne(this._features[O])}}var ut={exports:{}},Ve=o.pointGeometry,ft=o.vectorTile.VectorTileFeature,Ce=xt;function xt(Y,O){this.options=O||{},this.features=Y,this.length=Y.length}function Gt(Y,O){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=O||4096}xt.prototype.feature=function(Y){return new Gt(this.features[Y],this.options.extent)},Gt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var O=0;O<Y.length;O++){for(var F=Y[O],X=[],ie=0;ie<F.length;ie++)X.push(new Ve(F[ie][0],F[ie][1]));this.geometry.push(X)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,O=1/0,F=-1/0,X=1/0,ie=-1/0,ue=0;ue<Y.length;ue++)for(var ve=Y[ue],ye=0;ye<ve.length;ye++){var pe=ve[ye];O=Math.min(O,pe.x),F=Math.max(F,pe.x),X=Math.min(X,pe.y),ie=Math.max(ie,pe.y)}return[O,X,F,ie]},Gt.prototype.toGeoJSON=ft.prototype.toGeoJSON;var At=o.pbf,_t=Ce;function It(Y){var O=new At;return function(F,X){for(var ie in F.layers)X.writeMessage(3,mi,F.layers[ie])}(Y,O),O.finish()}function mi(Y,O){var F;O.writeVarintField(15,Y.version||1),O.writeStringField(1,Y.name||""),O.writeVarintField(5,Y.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Y.length;F++)X.feature=Y.feature(F),O.writeMessage(2,Bi,X);var ie=X.keys;for(F=0;F<ie.length;F++)O.writeStringField(3,ie[F]);var ue=X.values;for(F=0;F<ue.length;F++)O.writeMessage(4,Jt,ue[F])}function Bi(Y,O){var F=Y.feature;F.id!==void 0&&O.writeVarintField(1,F.id),O.writeMessage(2,bi,Y),O.writeVarintField(3,F.type),O.writeMessage(4,ui,F)}function bi(Y,O){var F=Y.feature,X=Y.keys,ie=Y.values,ue=Y.keycache,ve=Y.valuecache;for(var ye in F.properties){var pe=F.properties[ye],Ee=ue[ye];if(pe!==null){Ee===void 0&&(X.push(ye),ue[ye]=Ee=X.length-1),O.writeVarint(Ee);var Ue=typeof pe;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(pe=JSON.stringify(pe));var dt=Ue+":"+pe,qe=ve[dt];qe===void 0&&(ie.push(pe),ve[dt]=qe=ie.length-1),O.writeVarint(qe)}}}function hn(Y,O){return(O<<3)+(7&Y)}function Ft(Y){return Y<<1^Y>>31}function ui(Y,O){for(var F=Y.loadGeometry(),X=Y.type,ie=0,ue=0,ve=F.length,ye=0;ye<ve;ye++){var pe=F[ye],Ee=1;X===1&&(Ee=pe.length),O.writeVarint(hn(1,Ee));for(var Ue=X===3?pe.length-1:pe.length,dt=0;dt<Ue;dt++){dt===1&&X!==1&&O.writeVarint(hn(2,Ue-1));var qe=pe[dt].x-ie,Mt=pe[dt].y-ue;O.writeVarint(Ft(qe)),O.writeVarint(Ft(Mt)),ie+=qe,ue+=Mt}X===3&&O.writeVarint(hn(7,1))}}function Jt(Y,O){var F=typeof Y;F==="string"?O.writeStringField(1,Y):F==="boolean"?O.writeBooleanField(7,Y):F==="number"&&(Y%1!=0?O.writeDoubleField(3,Y):Y<0?O.writeSVarintField(6,Y):O.writeVarintField(5,Y))}function ei(Y,O,F,X,ie,ue){if(ie-X<=F)return;const ve=X+ie>>1;Wi(Y,O,ve,X,ie,ue%2),ei(Y,O,F,X,ve-1,ue+1),ei(Y,O,F,ve+1,ie,ue+1)}function Wi(Y,O,F,X,ie,ue){for(;ie>X;){if(ie-X>600){const Ee=ie-X+1,Ue=F-X+1,dt=Math.log(Ee),qe=.5*Math.exp(2*dt/3),Mt=.5*Math.sqrt(dt*qe*(Ee-qe)/Ee)*(Ue-Ee/2<0?-1:1);Wi(Y,O,F,Math.max(X,Math.floor(F-Ue*qe/Ee+Mt)),Math.min(ie,Math.floor(F+(Ee-Ue)*qe/Ee+Mt)),ue)}const ve=O[2*F+ue];let ye=X,pe=ie;for(gi(Y,O,X,F),O[2*ie+ue]>ve&&gi(Y,O,X,ie);ye<pe;){for(gi(Y,O,ye,pe),ye++,pe--;O[2*ye+ue]<ve;)ye++;for(;O[2*pe+ue]>ve;)pe--}O[2*X+ue]===ve?gi(Y,O,X,pe):(pe++,gi(Y,O,pe,ie)),pe<=F&&(X=pe+1),F<=pe&&(ie=pe-1)}}function gi(Y,O,F,X){yn(Y,F,X),yn(O,2*F,2*X),yn(O,2*F+1,2*X+1)}function yn(Y,O,F){const X=Y[O];Y[O]=Y[F],Y[F]=X}function Ki(Y,O,F,X){const ie=Y-F,ue=O-X;return ie*ie+ue*ue}ut.exports=It,ut.exports.fromVectorTileJs=It,ut.exports.fromGeojsonVt=function(Y,O){O=O||{};var F={};for(var X in Y)F[X]=new _t(Y[X].features,O),F[X].name=X,F[X].version=O.version,F[X].extent=O.extent;return It({layers:F})},ut.exports.GeoJSONWrapper=_t;const xn=Y=>Y[0],dn=Y=>Y[1];class vn{constructor(O,F=xn,X=dn,ie=64,ue=Float64Array){this.nodeSize=ie,this.points=O;const ve=O.length<65536?Uint16Array:Uint32Array,ye=this.ids=new ve(O.length),pe=this.coords=new ue(2*O.length);for(let Ee=0;Ee<O.length;Ee++)ye[Ee]=Ee,pe[2*Ee]=F(O[Ee]),pe[2*Ee+1]=X(O[Ee]);ei(ye,pe,ie,0,ye.length-1,0)}range(O,F,X,ie){return function(ue,ve,ye,pe,Ee,Ue,dt){const qe=[0,ue.length-1,0],Mt=[];let St,Tt;for(;qe.length;){const Ot=qe.pop(),Ht=qe.pop(),hi=qe.pop();if(Ht-hi<=dt){for(let Ei=hi;Ei<=Ht;Ei++)St=ve[2*Ei],Tt=ve[2*Ei+1],St>=ye&&St<=Ee&&Tt>=pe&&Tt<=Ue&&Mt.push(ue[Ei]);continue}const Lt=Math.floor((hi+Ht)/2);St=ve[2*Lt],Tt=ve[2*Lt+1],St>=ye&&St<=Ee&&Tt>=pe&&Tt<=Ue&&Mt.push(ue[Lt]);const wi=(Ot+1)%2;(Ot===0?ye<=St:pe<=Tt)&&(qe.push(hi),qe.push(Lt-1),qe.push(wi)),(Ot===0?Ee>=St:Ue>=Tt)&&(qe.push(Lt+1),qe.push(Ht),qe.push(wi))}return Mt}(this.ids,this.coords,O,F,X,ie,this.nodeSize)}within(O,F,X){return function(ie,ue,ve,ye,pe,Ee){const Ue=[0,ie.length-1,0],dt=[],qe=pe*pe;for(;Ue.length;){const Mt=Ue.pop(),St=Ue.pop(),Tt=Ue.pop();if(St-Tt<=Ee){for(let wi=Tt;wi<=St;wi++)Ki(ue[2*wi],ue[2*wi+1],ve,ye)<=qe&&dt.push(ie[wi]);continue}const Ot=Math.floor((Tt+St)/2),Ht=ue[2*Ot],hi=ue[2*Ot+1];Ki(Ht,hi,ve,ye)<=qe&&dt.push(ie[Ot]);const Lt=(Mt+1)%2;(Mt===0?ve-pe<=Ht:ye-pe<=hi)&&(Ue.push(Tt),Ue.push(Ot-1),Ue.push(Lt)),(Mt===0?ve+pe>=Ht:ye+pe>=hi)&&(Ue.push(Ot+1),Ue.push(St),Ue.push(Lt))}return dt}(this.ids,this.coords,O,F,X,this.nodeSize)}}const Hi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Yi=Math.fround||(pn=new Float32Array(1),Y=>(pn[0]=+Y,pn[0]));var pn;class In{constructor(O){this.options=nt(Object.create(Hi),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:F,minZoom:X,maxZoom:ie,nodeSize:ue}=this.options;F&&console.time("total time");const ve=`prepare ${O.length} points`;F&&console.time(ve),this.points=O;let ye=[];for(let pe=0;pe<O.length;pe++)O[pe].geometry&&ye.push(ur(O[pe],pe));this.trees[ie+1]=new vn(ye,gt,lt,ue,Float32Array),F&&console.timeEnd(ve);for(let pe=ie;pe>=X;pe--){const Ee=+Date.now();ye=this._cluster(ye,pe),this.trees[pe]=new vn(ye,gt,lt,ue,Float32Array),F&&console.log("z%d: %d clusters in %dms",pe,ye.length,+Date.now()-Ee)}return F&&console.timeEnd("total time"),this}getClusters(O,F){let X=((O[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,O[1]));let ue=O[2]===180?180:((O[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)X=-180,ue=180;else if(X>ue){const Ue=this.getClusters([X,ie,180,ve],F),dt=this.getClusters([-180,ie,ue,ve],F);return Ue.concat(dt)}const ye=this.trees[this._limitZoom(F)],pe=ye.range(Me(X),$e(ve),Me(ue),$e(ie)),Ee=[];for(const Ue of pe){const dt=ye.points[Ue];Ee.push(dt.numPoints?se(dt):this.points[dt.index])}return Ee}getChildren(O){const F=this._getOriginId(O),X=this._getOriginZoom(O),ie="No cluster with the specified id.",ue=this.trees[X];if(!ue)throw new Error(ie);const ve=ue.points[F];if(!ve)throw new Error(ie);const ye=this.options.radius/(this.options.extent*Math.pow(2,X-1)),pe=ue.within(ve.x,ve.y,ye),Ee=[];for(const Ue of pe){const dt=ue.points[Ue];dt.parentId===O&&Ee.push(dt.numPoints?se(dt):this.points[dt.index])}if(Ee.length===0)throw new Error(ie);return Ee}getLeaves(O,F,X){const ie=[];return this._appendLeaves(ie,O,F=F||10,X=X||0,0),ie}getTile(O,F,X){const ie=this.trees[this._limitZoom(O)],ue=Math.pow(2,O),{extent:ve,radius:ye}=this.options,pe=ye/ve,Ee=(X-pe)/ue,Ue=(X+1+pe)/ue,dt={features:[]};return this._addTileFeatures(ie.range((F-pe)/ue,Ee,(F+1+pe)/ue,Ue),ie.points,F,X,ue,dt),F===0&&this._addTileFeatures(ie.range(1-pe/ue,Ee,1,Ue),ie.points,ue,X,ue,dt),F===ue-1&&this._addTileFeatures(ie.range(0,Ee,pe/ue,Ue),ie.points,-1,X,ue,dt),dt.features.length?dt:null}getClusterExpansionZoom(O){let F=this._getOriginZoom(O)-1;for(;F<=this.options.maxZoom;){const X=this.getChildren(O);if(F++,X.length!==1)break;O=X[0].properties.cluster_id}return F}_appendLeaves(O,F,X,ie,ue){const ve=this.getChildren(F);for(const ye of ve){const pe=ye.properties;if(pe&&pe.cluster?ue+pe.point_count<=ie?ue+=pe.point_count:ue=this._appendLeaves(O,pe.cluster_id,X,ie,ue):ue<ie?ue++:O.push(ye),O.length===X)break}return ue}_addTileFeatures(O,F,X,ie,ue,ve){for(const ye of O){const pe=F[ye],Ee=pe.numPoints;let Ue,dt,qe;if(Ee)Ue=me(pe),dt=pe.x,qe=pe.y;else{const Tt=this.points[pe.index];Ue=Tt.properties,dt=Me(Tt.geometry.coordinates[0]),qe=$e(Tt.geometry.coordinates[1])}const Mt={type:1,geometry:[[Math.round(this.options.extent*(dt*ue-X)),Math.round(this.options.extent*(qe*ue-ie))]],tags:Ue};let St;Ee?St=pe.id:this.options.generateId?St=pe.index:this.points[pe.index].id&&(St=this.points[pe.index].id),St!==void 0&&(Mt.id=St),ve.features.push(Mt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,F){const X=[],{radius:ie,extent:ue,reduce:ve,minPoints:ye}=this.options,pe=ie/(ue*Math.pow(2,F));for(let Ee=0;Ee<O.length;Ee++){const Ue=O[Ee];if(Ue.zoom<=F)continue;Ue.zoom=F;const dt=this.trees[F+1],qe=dt.within(Ue.x,Ue.y,pe),Mt=Ue.numPoints||1;let St=Mt;for(const Tt of qe){const Ot=dt.points[Tt];Ot.zoom>F&&(St+=Ot.numPoints||1)}if(St>Mt&&St>=ye){let Tt=Ue.x*Mt,Ot=Ue.y*Mt,Ht=ve&&Mt>1?this._map(Ue,!0):null;const hi=(Ee<<5)+(F+1)+this.points.length;for(const Lt of qe){const wi=dt.points[Lt];if(wi.zoom<=F)continue;wi.zoom=F;const Ei=wi.numPoints||1;Tt+=wi.x*Ei,Ot+=wi.y*Ei,wi.parentId=hi,ve&&(Ht||(Ht=this._map(Ue,!0)),ve(Ht,this._map(wi)))}Ue.parentId=hi,X.push(fn(Tt/St,Ot/St,hi,St,Ht))}else if(X.push(Ue),St>1)for(const Tt of qe){const Ot=dt.points[Tt];Ot.zoom<=F||(Ot.zoom=F,X.push(Ot))}}return X}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,F){if(O.numPoints)return F?nt({},O.properties):O.properties;const X=this.points[O.index].properties,ie=this.options.map(X);return F&&ie===X?nt({},ie):ie}}function fn(Y,O,F,X,ie){return{x:Yi(Y),y:Yi(O),zoom:1/0,id:F,parentId:-1,numPoints:X,properties:ie}}function ur(Y,O){const[F,X]=Y.geometry.coordinates;return{x:Yi(Me(F)),y:Yi($e(X)),zoom:1/0,index:O,parentId:-1}}function se(Y){return{type:"Feature",id:Y.id,properties:me(Y),geometry:{type:"Point",coordinates:[(O=Y.x,360*(O-.5)),Xe(Y.y)]}};var O}function me(Y){const O=Y.numPoints,F=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return nt(nt({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:O,point_count_abbreviated:F})}function Me(Y){return Y/360+.5}function $e(Y){const O=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return F<0?0:F>1?1:F}function Xe(Y){const O=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function nt(Y,O){for(const F in O)Y[F]=O[F];return Y}function gt(Y){return Y.x}function lt(Y){return Y.y}function rt(Y,O,F,X){for(var ie,ue=X,ve=F-O>>1,ye=F-O,pe=Y[O],Ee=Y[O+1],Ue=Y[F],dt=Y[F+1],qe=O+3;qe<F;qe+=3){var Mt=Ye(Y[qe],Y[qe+1],pe,Ee,Ue,dt);if(Mt>ue)ie=qe,ue=Mt;else if(Mt===ue){var St=Math.abs(qe-ve);St<ye&&(ie=qe,ye=St)}}ue>X&&(ie-O>3&&rt(Y,O,ie,X),Y[ie+2]=ue,F-ie>3&&rt(Y,ie,F,X))}function Ye(Y,O,F,X,ie,ue){var ve=ie-F,ye=ue-X;if(ve!==0||ye!==0){var pe=((Y-F)*ve+(O-X)*ye)/(ve*ve+ye*ye);pe>1?(F=ie,X=ue):pe>0&&(F+=ve*pe,X+=ye*pe)}return(ve=Y-F)*ve+(ye=O-X)*ye}function bt(Y,O,F,X){var ie={id:Y===void 0?null:Y,type:O,geometry:F,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var ve=ue.geometry,ye=ue.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")wt(ue,ve);else if(ye==="Polygon"||ye==="MultiLineString")for(var pe=0;pe<ve.length;pe++)wt(ue,ve[pe]);else if(ye==="MultiPolygon")for(pe=0;pe<ve.length;pe++)for(var Ee=0;Ee<ve[pe].length;Ee++)wt(ue,ve[pe][Ee])}(ie),ie}function wt(Y,O){for(var F=0;F<O.length;F+=3)Y.minX=Math.min(Y.minX,O[F]),Y.minY=Math.min(Y.minY,O[F+1]),Y.maxX=Math.max(Y.maxX,O[F]),Y.maxY=Math.max(Y.maxY,O[F+1])}function Ct(Y,O,F,X){if(O.geometry){var ie=O.geometry.coordinates,ue=O.geometry.type,ve=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),ye=[],pe=O.id;if(F.promoteId?pe=O.properties[F.promoteId]:F.generateId&&(pe=X||0),ue==="Point")Nt(ie,ye);else if(ue==="MultiPoint")for(var Ee=0;Ee<ie.length;Ee++)Nt(ie[Ee],ye);else if(ue==="LineString")Wt(ie,ye,ve,!1);else if(ue==="MultiLineString"){if(F.lineMetrics){for(Ee=0;Ee<ie.length;Ee++)Wt(ie[Ee],ye=[],ve,!1),Y.push(bt(pe,"LineString",ye,O.properties));return}ni(ie,ye,ve,!1)}else if(ue==="Polygon")ni(ie,ye,ve,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(Ee=0;Ee<O.geometry.geometries.length;Ee++)Ct(Y,{id:pe,geometry:O.geometry.geometries[Ee],properties:O.properties},F,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ee=0;Ee<ie.length;Ee++){var Ue=[];ni(ie[Ee],Ue,ve,!0),ye.push(Ue)}}Y.push(bt(pe,ue,ye,O.properties))}}function Nt(Y,O){O.push(si(Y[0])),O.push(Fi(Y[1])),O.push(0)}function Wt(Y,O,F,X){for(var ie,ue,ve=0,ye=0;ye<Y.length;ye++){var pe=si(Y[ye][0]),Ee=Fi(Y[ye][1]);O.push(pe),O.push(Ee),O.push(0),ye>0&&(ve+=X?(ie*Ee-pe*ue)/2:Math.sqrt(Math.pow(pe-ie,2)+Math.pow(Ee-ue,2))),ie=pe,ue=Ee}var Ue=O.length-3;O[2]=1,rt(O,0,Ue,F),O[Ue+2]=1,O.size=Math.abs(ve),O.start=0,O.end=O.size}function ni(Y,O,F,X){for(var ie=0;ie<Y.length;ie++){var ue=[];Wt(Y[ie],ue,F,X),O.push(ue)}}function si(Y){return Y/360+.5}function Fi(Y){var O=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return F<0?0:F>1?1:F}function $i(Y,O,F,X,ie,ue,ve,ye){if(X/=O,ue>=(F/=O)&&ve<X)return Y;if(ve<F||ue>=X)return null;for(var pe=[],Ee=0;Ee<Y.length;Ee++){var Ue=Y[Ee],dt=Ue.geometry,qe=Ue.type,Mt=ie===0?Ue.minX:Ue.minY,St=ie===0?Ue.maxX:Ue.maxY;if(Mt>=F&&St<X)pe.push(Ue);else if(!(St<F||Mt>=X)){var Tt=[];if(qe==="Point"||qe==="MultiPoint")hr(dt,Tt,F,X,ie);else if(qe==="LineString")Yr(dt,Tt,F,X,ie,!1,ye.lineMetrics);else if(qe==="MultiLineString")vr(dt,Tt,F,X,ie,!1);else if(qe==="Polygon")vr(dt,Tt,F,X,ie,!0);else if(qe==="MultiPolygon")for(var Ot=0;Ot<dt.length;Ot++){var Ht=[];vr(dt[Ot],Ht,F,X,ie,!0),Ht.length&&Tt.push(Ht)}if(Tt.length){if(ye.lineMetrics&&qe==="LineString"){for(Ot=0;Ot<Tt.length;Ot++)pe.push(bt(Ue.id,qe,Tt[Ot],Ue.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(Tt.length===1?(qe="LineString",Tt=Tt[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=Tt.length===3?"Point":"MultiPoint"),pe.push(bt(Ue.id,qe,Tt,Ue.tags))}}}return pe.length?pe:null}function hr(Y,O,F,X,ie){for(var ue=0;ue<Y.length;ue+=3){var ve=Y[ue+ie];ve>=F&&ve<=X&&(O.push(Y[ue]),O.push(Y[ue+1]),O.push(Y[ue+2]))}}function Yr(Y,O,F,X,ie,ue,ve){for(var ye,pe,Ee=Vn(Y),Ue=ie===0?Rn:Jr,dt=Y.start,qe=0;qe<Y.length-3;qe+=3){var Mt=Y[qe],St=Y[qe+1],Tt=Y[qe+2],Ot=Y[qe+3],Ht=Y[qe+4],hi=ie===0?Mt:St,Lt=ie===0?Ot:Ht,wi=!1;ve&&(ye=Math.sqrt(Math.pow(Mt-Ot,2)+Math.pow(St-Ht,2))),hi<F?Lt>F&&(pe=Ue(Ee,Mt,St,Ot,Ht,F),ve&&(Ee.start=dt+ye*pe)):hi>X?Lt<X&&(pe=Ue(Ee,Mt,St,Ot,Ht,X),ve&&(Ee.start=dt+ye*pe)):mn(Ee,Mt,St,Tt),Lt<F&&hi>=F&&(pe=Ue(Ee,Mt,St,Ot,Ht,F),wi=!0),Lt>X&&hi<=X&&(pe=Ue(Ee,Mt,St,Ot,Ht,X),wi=!0),!ue&&wi&&(ve&&(Ee.end=dt+ye*pe),O.push(Ee),Ee=Vn(Y)),ve&&(dt+=ye)}var Ei=Y.length-3;Mt=Y[Ei],St=Y[Ei+1],Tt=Y[Ei+2],(hi=ie===0?Mt:St)>=F&&hi<=X&&mn(Ee,Mt,St,Tt),Ei=Ee.length-3,ue&&Ei>=3&&(Ee[Ei]!==Ee[0]||Ee[Ei+1]!==Ee[1])&&mn(Ee,Ee[0],Ee[1],Ee[2]),Ee.length&&O.push(Ee)}function Vn(Y){var O=[];return O.size=Y.size,O.start=Y.start,O.end=Y.end,O}function vr(Y,O,F,X,ie,ue){for(var ve=0;ve<Y.length;ve++)Yr(Y[ve],O,F,X,ie,ue,!1)}function mn(Y,O,F,X){Y.push(O),Y.push(F),Y.push(X)}function Rn(Y,O,F,X,ie,ue){var ve=(ue-O)/(X-O);return Y.push(ue),Y.push(F+(ie-F)*ve),Y.push(1),ve}function Jr(Y,O,F,X,ie,ue){var ve=(ue-F)/(ie-F);return Y.push(O+(X-O)*ve),Y.push(ue),Y.push(1),ve}function xo(Y,O){for(var F=[],X=0;X<Y.length;X++){var ie,ue=Y[X],ve=ue.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")ie=Ts(ue.geometry,O);else if(ve==="MultiLineString"||ve==="Polygon"){ie=[];for(var ye=0;ye<ue.geometry.length;ye++)ie.push(Ts(ue.geometry[ye],O))}else if(ve==="MultiPolygon")for(ie=[],ye=0;ye<ue.geometry.length;ye++){for(var pe=[],Ee=0;Ee<ue.geometry[ye].length;Ee++)pe.push(Ts(ue.geometry[ye][Ee],O));ie.push(pe)}F.push(bt(ue.id,ve,ie,ue.tags))}return F}function Ts(Y,O){var F=[];F.size=Y.size,Y.start!==void 0&&(F.start=Y.start,F.end=Y.end);for(var X=0;X<Y.length;X+=3)F.push(Y[X]+O,Y[X+1],Y[X+2]);return F}function As(Y,O){if(Y.transformed)return Y;var F,X,ie,ue=1<<Y.z,ve=Y.x,ye=Y.y;for(F=0;F<Y.features.length;F++){var pe=Y.features[F],Ee=pe.geometry,Ue=pe.type;if(pe.geometry=[],Ue===1)for(X=0;X<Ee.length;X+=2)pe.geometry.push(xr(Ee[X],Ee[X+1],O,ue,ve,ye));else for(X=0;X<Ee.length;X++){var dt=[];for(ie=0;ie<Ee[X].length;ie+=2)dt.push(xr(Ee[X][ie],Ee[X][ie+1],O,ue,ve,ye));pe.geometry.push(dt)}}return Y.transformed=!0,Y}function xr(Y,O,F,X,ie,ue){return[Math.round(F*(Y*X-ie)),Math.round(F*(O*X-ue))]}function Ss(Y,O,F,X,ie){for(var ue=O===ie.maxZoom?0:ie.tolerance/((1<<O)*ie.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:X,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<Y.length;ye++){ve.numFeatures++,gl(ve,Y[ye],ue,ie);var pe=Y[ye].minX,Ee=Y[ye].minY,Ue=Y[ye].maxX,dt=Y[ye].maxY;pe<ve.minX&&(ve.minX=pe),Ee<ve.minY&&(ve.minY=Ee),Ue>ve.maxX&&(ve.maxX=Ue),dt>ve.maxY&&(ve.maxY=dt)}return ve}function gl(Y,O,F,X){var ie=O.geometry,ue=O.type,ve=[];if(ue==="Point"||ue==="MultiPoint")for(var ye=0;ye<ie.length;ye+=3)ve.push(ie[ye]),ve.push(ie[ye+1]),Y.numPoints++,Y.numSimplified++;else if(ue==="LineString")Cs(ve,ie,Y,F,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(ye=0;ye<ie.length;ye++)Cs(ve,ie[ye],Y,F,ue==="Polygon",ye===0);else if(ue==="MultiPolygon")for(var pe=0;pe<ie.length;pe++){var Ee=ie[pe];for(ye=0;ye<Ee.length;ye++)Cs(ve,Ee[ye],Y,F,!0,ye===0)}if(ve.length){var Ue=O.tags||null;if(ue==="LineString"&&X.lineMetrics){for(var dt in Ue={},O.tags)Ue[dt]=O.tags[dt];Ue.mapbox_clip_start=ie.start/ie.size,Ue.mapbox_clip_end=ie.end/ie.size}var qe={geometry:ve,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:Ue};O.id!==null&&(qe.id=O.id),Y.features.push(qe)}}function Cs(Y,O,F,X,ie,ue){var ve=X*X;if(X>0&&O.size<(ie?ve:X))F.numPoints+=O.length/3;else{for(var ye=[],pe=0;pe<O.length;pe+=3)(X===0||O[pe+2]>ve)&&(F.numSimplified++,ye.push(O[pe]),ye.push(O[pe+1])),F.numPoints++;ie&&function(Ee,Ue){for(var dt=0,qe=0,Mt=Ee.length,St=Mt-2;qe<Mt;St=qe,qe+=2)dt+=(Ee[qe]-Ee[St])*(Ee[qe+1]+Ee[St+1]);if(dt>0===Ue)for(qe=0,Mt=Ee.length;qe<Mt/2;qe+=2){var Tt=Ee[qe],Ot=Ee[qe+1];Ee[qe]=Ee[Mt-2-qe],Ee[qe+1]=Ee[Mt-1-qe],Ee[Mt-2-qe]=Tt,Ee[Mt-1-qe]=Ot}}(ye,ue),Y.push(ye)}}function Is(Y,O){var F=(O=this.options=function(ie,ue){for(var ve in ue)ie[ve]=ue[ve];return ie}(Object.create(this.options),O)).debug;if(F&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(ie,ue){var ve=[];if(ie.type==="FeatureCollection")for(var ye=0;ye<ie.features.length;ye++)Ct(ve,ie.features[ye],ue,ye);else Ct(ve,ie.type==="Feature"?ie:{geometry:ie},ue);return ve}(Y,O);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(ie,ue){var ve=ue.buffer/ue.extent,ye=ie,pe=$i(ie,1,-1-ve,ve,0,-1,2,ue),Ee=$i(ie,1,1-ve,2+ve,0,-1,2,ue);return(pe||Ee)&&(ye=$i(ie,1,-ve,1+ve,0,-1,2,ue)||[],pe&&(ye=xo(pe,1).concat(ye)),Ee&&(ye=ye.concat(xo(Ee,-1)))),ye}(X,O),X.length&&this.splitTile(X,0,0,0),F&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $n(Y,O,F){return 32*((1<<Y)*F+O)+Y}function Wo(Y,O){const F=Y.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const X=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!X)return O(null,null);const ie=new et(X.features);let ue=ut.exports(ie);ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),O(null,{vectorTile:ie,rawData:ue.buffer})}Is.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Is.prototype.splitTile=function(Y,O,F,X,ie,ue,ve){for(var ye=[Y,O,F,X],pe=this.options,Ee=pe.debug;ye.length;){X=ye.pop(),F=ye.pop(),O=ye.pop(),Y=ye.pop();var Ue=1<<O,dt=$n(O,F,X),qe=this.tiles[dt];if(!qe&&(Ee>1&&console.time("creation"),qe=this.tiles[dt]=Ss(Y,O,F,X,pe),this.tileCoords.push({z:O,x:F,y:X}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,F,X,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));var Mt="z"+O;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(qe.source=Y,ie){if(O===pe.maxZoom||O===ie)continue;var St=1<<ie-O;if(F!==Math.floor(ue/St)||X!==Math.floor(ve/St))continue}else if(O===pe.indexMaxZoom||qe.numPoints<=pe.indexMaxPoints)continue;if(qe.source=null,Y.length!==0){Ee>1&&console.time("clipping");var Tt,Ot,Ht,hi,Lt,wi,Ei=.5*pe.buffer/pe.extent,bo=.5-Ei,Qr=.5+Ei,ze=1+Ei;Tt=Ot=Ht=hi=null,Lt=$i(Y,Ue,F-Ei,F+Qr,0,qe.minX,qe.maxX,pe),wi=$i(Y,Ue,F+bo,F+ze,0,qe.minX,qe.maxX,pe),Y=null,Lt&&(Tt=$i(Lt,Ue,X-Ei,X+Qr,1,qe.minY,qe.maxY,pe),Ot=$i(Lt,Ue,X+bo,X+ze,1,qe.minY,qe.maxY,pe),Lt=null),wi&&(Ht=$i(wi,Ue,X-Ei,X+Qr,1,qe.minY,qe.maxY,pe),hi=$i(wi,Ue,X+bo,X+ze,1,qe.minY,qe.maxY,pe),wi=null),Ee>1&&console.timeEnd("clipping"),ye.push(Tt||[],O+1,2*F,2*X),ye.push(Ot||[],O+1,2*F,2*X+1),ye.push(Ht||[],O+1,2*F+1,2*X),ye.push(hi||[],O+1,2*F+1,2*X+1)}}},Is.prototype.getTile=function(Y,O,F){var X=this.options,ie=X.extent,ue=X.debug;if(Y<0||Y>24)return null;var ve=1<<Y,ye=$n(Y,O=(O%ve+ve)%ve,F);if(this.tiles[ye])return As(this.tiles[ye],ie);ue>1&&console.log("drilling down to z%d-%d-%d",Y,O,F);for(var pe,Ee=Y,Ue=O,dt=F;!pe&&Ee>0;)Ee--,Ue=Math.floor(Ue/2),dt=Math.floor(dt/2),pe=this.tiles[$n(Ee,Ue,dt)];return pe&&pe.source?(ue>1&&console.log("found parent tile z%d-%d-%d",Ee,Ue,dt),ue>1&&console.time("drilling down"),this.splitTile(pe.source,Ee,Ue,dt,Y,O,F),ue>1&&console.timeEnd("drilling down"),this.tiles[ye]?As(this.tiles[ye],ie):null):null};class ga extends o.VectorTileWorkerSource{constructor(O,F,X,ie,ue){super(O,F,X,ie,Wo),ue&&(this.loadGeoJSON=ue)}loadData(O,F){const X=O&&O.request,ie=X&&X.collectResourceTiming;this.loadGeoJSON(O,(ue,ve)=>{if(ue||!ve)return F(ue);if(typeof ve!="object")return F(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{de(ve,!0);try{if(O.filter){const pe=o.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));ve={type:"FeatureCollection",features:ve.features.filter(Ue=>pe.value.evaluate({zoom:0},Ue))}}this._geoJSONIndex=O.cluster?new In(function({superclusterOptions:pe,clusterProperties:Ee}){if(!Ee||!pe)return pe;const Ue={},dt={},qe={accumulated:null,zoom:0},Mt={properties:null},St=Object.keys(Ee);for(const Tt of St){const[Ot,Ht]=Ee[Tt],hi=o.createExpression(Ht),Lt=o.createExpression(typeof Ot=="string"?[Ot,["accumulated"],["get",Tt]]:Ot);Ue[Tt]=hi.value,dt[Tt]=Lt.value}return pe.map=Tt=>{Mt.properties=Tt;const Ot={};for(const Ht of St)Ot[Ht]=Ue[Ht].evaluate(qe,Mt);return Ot},pe.reduce=(Tt,Ot)=>{Mt.properties=Ot;for(const Ht of St)qe.accumulated=Tt[Ht],Tt[Ht]=dt[Ht].evaluate(qe,Mt)},pe}(O)).load(ve.features):function(pe,Ee){return new Is(pe,Ee)}(ve,O.geojsonVtOptions)}catch(pe){return F(pe)}this.loaded={};const ye={};if(ie){const pe=o.getPerformanceMeasurement(X);pe&&(ye.resourceTiming={},ye.resourceTiming[O.source]=JSON.parse(JSON.stringify(pe)))}F(null,ye)}})}reloadTile(O,F){const X=this.loaded;return X&&X[O.uid]?super.reloadTile(O,F):this.loadTile(O,F)}loadGeoJSON(O,F){if(O.request)o.getJSON(O.request,F);else{if(typeof O.data!="string")return F(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return F(null,JSON.parse(O.data))}catch{return F(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(X){F(X)}}getClusterChildren(O,F){try{F(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(X){F(X)}}getClusterLeaves(O,F){try{F(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(X){F(X)}}}class Ho{constructor(O){this.self=O,this.actor=new o.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:ga},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,X)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=X},this.self.registerRTLTextPlugin=F=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=F.applyArabicShaping,o.plugin.processBidirectionalText=F.processBidirectionalText,o.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}clearCaches(O,F,X){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],X()}checkIfReady(O,F,X){X()}setReferrer(O,F){this.referrer=F}spriteLoaded(O,F){this.isSpriteLoaded[O]=F;for(const X in this.workerSources[O]){const ie=this.workerSources[O][X];for(const ue in ie)ie[ue]instanceof o.VectorTileWorkerSource&&(ie[ue].isSpriteLoaded=F,ie[ue].fire(new o.Event("isSpriteLoaded")))}}setImages(O,F,X){this.availableImages[O]=F;for(const ie in this.workerSources[O]){const ue=this.workerSources[O][ie];for(const ve in ue)ue[ve].availableImages=F}X()}enableTerrain(O,F,X){this.terrain=F,X()}setProjection(O,F){this.projections[O]=o.getProjection(F)}setLayers(O,F,X){this.getLayerIndex(O).replace(F),X()}updateLayers(O,F,X){this.getLayerIndex(O).update(F.layers,F.removedIds),X()}loadTile(O,F,X){const ie=this.enableTerrain?o.extend({enableTerrain:this.terrain},F):F;ie.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,F.type,F.source).loadTile(ie,X)}loadDEMTile(O,F,X){const ie=this.enableTerrain?o.extend({buildQuadTree:this.terrain},F):F;this.getDEMWorkerSource(O,F.source).loadTile(ie,X)}reloadTile(O,F,X){const ie=this.enableTerrain?o.extend({enableTerrain:this.terrain},F):F;ie.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,F.type,F.source).reloadTile(ie,X)}abortTile(O,F,X){this.getWorkerSource(O,F.type,F.source).abortTile(F,X)}removeTile(O,F,X){this.getWorkerSource(O,F.type,F.source).removeTile(F,X)}removeSource(O,F,X){if(!this.workerSources[O]||!this.workerSources[O][F.type]||!this.workerSources[O][F.type][F.source])return;const ie=this.workerSources[O][F.type][F.source];delete this.workerSources[O][F.type][F.source],ie.removeSource!==void 0?ie.removeSource(F,X):X()}loadWorkerSource(O,F,X){try{this.self.importScripts(F.url),X()}catch(ie){X(ie.toString())}}syncRTLPluginState(O,F,X){try{o.plugin.setState(F);const ie=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ie!=null){this.self.importScripts(ie);const ue=o.plugin.isParsed();X(ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ie}`),ue)}}catch(ie){X(ie.toString())}}getAvailableImages(O){let F=this.availableImages[O];return F||(F=[]),F}getLayerIndex(O){let F=this.layerIndexes[O];return F||(F=this.layerIndexes[O]=new G),F}getWorkerSource(O,F,X){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][F]||(this.workerSources[O][F]={}),!this.workerSources[O][F][X]){const ie={send:(ue,ve,ye,pe,Ee,Ue)=>{this.actor.send(ue,ve,ye,O,Ee,Ue)},scheduler:this.actor.scheduler};this.workerSources[O][F][X]=new this.workerSourceTypes[F](ie,this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])}return this.workerSources[O][F][X]}getDEMWorkerSource(O,F){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][F]||(this.demWorkerSources[O][F]=new J),this.demWorkerSources[O][F]}enforceCacheSizeLimit(O,F){o.enforceCacheSizeLimit(F)}getWorkerPerformanceMetrics(O,F,X){X(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ho(self)),Ho}),E(["./shared"],function(o){function L(u,n){if(Array.isArray(u)){if(!Array.isArray(n)||u.length!==n.length)return!1;for(let l=0;l<u.length;l++)if(!L(u[l],n[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&n!==null){if(typeof n!="object"||Object.keys(u).length!==Object.keys(n).length)return!1;for(const l in u)if(!L(u[l],n[l]))return!1;return!0}return u===n}var U=G;function G(u){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,m,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{m=new Worker(w),p=!0}catch{p=!1}return m&&m.terminate(),URL.revokeObjectURL(w),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var m=p.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===p.width}()?(J[l=n&&n.failIfMajorPerformanceCaveat]===void 0&&(J[l]=function(p){var m,y=function(w){var A=document.createElement("canvas"),S=Object.create(G.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=w,A.getContext("webgl",S)||A.getContext("experimental-webgl",S)}(p);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(l)),J[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(u)}var J={};function de(u,n,l){const p=o.window.document.createElement(u);return n!==void 0&&(p.className=n),l&&l.appendChild(p),p}function xe(u,n,l){const p=o.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(n))p.setAttributeNS(null,m,n[m]);return l&&l.appendChild(p),p}G.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ge=o.window.document&&o.window.document.documentElement.style,Ie=ge&&ge.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ne;function et(){ge&&Ie&&(Ne=ge[Ie],ge[Ie]="none")}function ut(){ge&&Ie&&(ge[Ie]=Ne)}function Ve(u){u.preventDefault(),u.stopPropagation(),o.window.removeEventListener("click",Ve,!0)}function ft(){o.window.addEventListener("click",Ve,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ve,!0)},0)}function Ce(u,n){const l=u.getBoundingClientRect();return At(u,l,n)}function xt(u,n){const l=u.getBoundingClientRect(),p=[];for(let m=0;m<n.length;m++)p.push(At(u,l,n[m]));return p}function Gt(u){return o.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function At(u,n,l){const p=u.offsetWidth===n.width?1:u.offsetWidth/n.width;return new o.pointGeometry((l.clientX-n.left)*p,(l.clientY-n.top)*p)}function _t(u,n){var l=n[0],p=n[1],m=n[2],y=n[3],w=l*y-m*p;return w?(u[0]=y*(w=1/w),u[1]=-p*w,u[2]=-m*w,u[3]=l*w,u):null}function It(u){const{userImage:n}=u;return!!(n&&n.render&&n.render())&&(u.data.replace(new Uint8Array(n.data.buffer)),!0)}class mi extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,l){if(!n)return!0;let p=0;for(const m of n){if(m[0]<p||m[1]<m[0]||l<m[1])return!1;p=m[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let p=!0;if(!this.isLoaded())for(const m of n)this.images[m]||(p=!1);this.isLoaded()||p?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const p={};for(const m of n){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?p[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],p=this.getImage(n);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new o.ImagePosition(m,p);this.patterns[n]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const y in this.patterns)n.push(this.patterns[y].bin);const{w:l,h:p}=o.potpack(n),m=this.atlasImage;m.resize({width:l||1,height:p||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],A=w.x+1,S=w.y+1,P=this.images[y].data,D=P.width,R=P.height;o.RGBAImage.copy(P,m,{x:0,y:0},{x:A,y:S},{width:D,height:R}),o.RGBAImage.copy(P,m,{x:0,y:R-1},{x:A,y:S-1},{width:D,height:1}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:A,y:S+R},{width:D,height:1}),o.RGBAImage.copy(P,m,{x:D-1,y:0},{x:A-1,y:S},{width:1,height:R}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:A+D,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];It(p)&&this.updateImage(l,p)}}}const Bi=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(u,n){return function([l,p,m]){const y=o.degToRad(p+90),w=o.degToRad(m);return{x:l*Math.cos(y)*Math.sin(w),y:l*Math.sin(y)*Math.sin(w),z:l*Math.cos(w),azimuthal:p,polar:m}}(u.expression.evaluate(n))}interpolate(u,n,l){return{x:o.number(u.x,n.x,l),y:o.number(u.y,n.y,l),z:o.number(u.z,n.z,l),azimuthal:o.number(u.azimuthal,n.azimuthal,l),polar:o.number(u.polar,n.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),bi="-transition";class hn extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(Bi),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(o.validateLight,n,l))for(const p in n){const m=n[p];o.endsWith(p,bi)?this._transitionable.setTransition(p.slice(0,-bi.length),m):this._transitionable.setValue(p,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Ft=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),ui="-transition";class Jt extends o.Evented{constructor(n,l){super(),this._transitionable=new o.Transitionable(Ft),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(n){for(const l in n){const p=n[l];o.endsWith(l,ui)?this._transitionable.setTransition(l.slice(0,-ui.length),p):this._transitionable.setValue(l,p)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function ei(u,n,l,p){const m=o.smoothstep(45,65,l),[y,w]=Wi(u,p),A=o.length(n);let S=1-Math.min(1,Math.exp((A-y)/(w-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*u.alpha}function Wi(u,n){const l=.5/Math.tan(.5*n);return[u.range[0]+l,u.range[1]+l]}const gi=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),yn="-transition";class Ki extends o.Evented{constructor(n,l){super(),this._transitionable=new o.Transitionable(gi),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const n=this._transform,l=n.projection.name==="globe",p=o.globeToMercatorTransition(n.zoom),m=this.properties.get("range"),y=[.5,3];return{range:l?[o.number(y[0],m[0],p),o.number(y[1],m[1],p)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(o.validateFog,n,l)){for(const p of Object.keys(o.spec.fog))n&&n[p]===void 0&&(n[p]=o.spec.fog[p].default);for(const p in n){const m=n[p];o.endsWith(p,yn)?this._transitionable.setTransition(p.slice(0,-yn.length),m):this._transitionable.setValue(p,m)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(p,m,y){const w=o.MercatorCoordinate.fromLngLat(m),A=y.elevation?y.elevation.getAtPointOrZero(w):0,S=[w.x,w.y,A];return o.transformMat4(S,S,y.mercatorFogMatrix),ei(p,S,y.pitch,y._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Wi(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class xn{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const p=this.workerPool.acquire(this.id);for(let m=0;m<p.length;m++){const y=new xn.Actor(p[m],l,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,p){o.asyncAll(this.actors,(m,y)=>{m.send(n,l,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dn(u,n,l){return n*(o.EXTENT/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}xn.Actor=o.Actor;class vn{constructor(n,l,p,m){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,l){let p,m;if(n instanceof o.pointGeometry||typeof n[0]=="number"){const y=o.pointGeometry.convert(n);p=[y],m=l.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(n[0]),w=o.pointGeometry.convert(n[1]);p=[y,w],m=o.polygonizeBounds(y,w).every(A=>l.isPointAboveHorizon(A))}return new vn(p,l.getCameraPoint(),m,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?m[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(l,p,n),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>p.y))+((y.x>l.x)+(y.x>p.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(n,l,p,m=0){const y=n.queryPadding/l._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let A=n.tileID.wrap+(w.unwrapped?m:0);const S=w.polygon.map(q=>o.getTilePoint(n.tileTransform,q,A));if(!o.polygonIntersectsBox(S,0,0,o.EXTENT,o.EXTENT))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const P=this.screenGeometryMercator.polygon.map(q=>o.getTileVec3(n.tileTransform,q,A)),D=P.map(q=>new o.pointGeometry(q[0],q[1])),R=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),N=o.getTileVec3(n.tileTransform,R,A),W=P.map(q=>{const V=o.sub(q,q,N);return o.normalize(V,V),new o.Ray(N,V)}),$=dn(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:W,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(H=o.getBounds(S),H.min.x=o.clamp(H.min.x,0,o.EXTENT),H.min.y=o.clamp(H.min.y,0,o.EXTENT),H.max.x=o.clamp(H.max.x,0,o.EXTENT),H.max.y=o.clamp(H.max.y,0,o.EXTENT),H),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:$};var H}_bufferedScreenMercator(n,l){const p=pn(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let m;return m=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[p]=m,m}}_bufferedCameraMercator(n,l){const p=pn(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let m;return m=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[p]=m,m}}_projectAndResample(n,l){const p=function(y,w){const A=o.multiply([],w.pixelMatrix,w.globeMatrix),S=[0,-o.GLOBE_RADIUS,0,1],P=[0,o.GLOBE_RADIUS,0,1],D=[0,0,0,1];o.transformMat4$1(S,S,A),o.transformMat4$1(P,P,A),o.transformMat4$1(D,D,A);const R=new o.pointGeometry(S[0]/S[3],S[1]/S[3]),N=new o.pointGeometry(P[0]/P[3],P[1]/P[3]),W=o.polygonContainsPoint(y,R)&&S[3]<D[3],$=o.polygonContainsPoint(y,N)&&P[3]<D[3];if(!W&&!$)return null;const H=function(ce,be,Pe){for(let Ae=1;Ae<ce.length;Ae++){const Ze=Yi(be.pointCoordinate3D(ce[Ae-1]).x),_e=Yi(be.pointCoordinate3D(ce[Ae]).x);if(Pe<0){if(Ze<_e)return{idx:Ae,t:-Ze/(_e-1-Ze)}}else if(_e<Ze)return{idx:Ae,t:(1-Ze)/(_e+1-Ze)}}return null}(y,w,W?-1:1);if(!H)return null;const{idx:q,t:V}=H;let K=q>1?Hi(y.slice(0,q),w):[],Z=q<y.length?Hi(y.slice(q),w):[];K=K.map(ce=>new o.pointGeometry(Yi(ce.x),ce.y)),Z=Z.map(ce=>new o.pointGeometry(Yi(ce.x),ce.y));const oe=[...K];oe.length===0&&oe.push(Z[Z.length-1]);const ae=o.number(oe[oe.length-1].y,(Z.length===0?K[0]:Z[0]).y,V);let te;return te=W?[new o.pointGeometry(0,ae),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,ae)]:[new o.pointGeometry(1,ae),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,ae)],oe.push(...te),Z.length===0?oe.push(K[0]):oe.push(...Z),{polygon:oe.map(ce=>new o.MercatorCoordinate(ce.x,ce.y)),unwrapped:!1}}(n,l);if(p)return p;const m=function(y,w){let A=!1,S=-1/0,P=0;for(let R=0;R<y.length-1;R++)y[R].x>S&&(S=y[R].x,P=R);for(let R=0;R<y.length-1;R++){const N=(P+R)%(y.length-1),W=y[N],$=y[N+1];Math.abs(W.x-$.x)>.5&&(W.x<$.x?(W.x+=1,N===0&&(y[y.length-1].x+=1)):($.x+=1,N+1===y.length-1&&(y[0].x+=1)),A=!0)}const D=o.mercatorXfromLng(w.center.lng);return A&&D<Math.abs(D-1)&&y.forEach(R=>{R.x-=1}),{polygon:y,unwrapped:A}}(Hi(n,l).map(y=>new o.pointGeometry(Yi(y.x),y.y)),l);return{polygon:m.polygon.map(y=>new o.MercatorCoordinate(y.x,y.y)),unwrapped:m.unwrapped}}}function Hi(u,n){return o.resample(u,l=>{const p=n.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Yi(u){return u<0?1+u%1:u%1}function pn(u){return 100*u|0}function In(u,n,l,p,m){const y=function(w,A){if(w)return m(w);if(A){u.url&&A.tiles&&u.tiles&&delete u.tiles;const S=o.pick(o.extend(A,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(S.vectorLayers=A.vector_layers,S.vectorLayerIds=S.vectorLayers.map(P=>P.id)),S.tiles=n.canonicalizeTileset(S,u.url),m(null,S)}};return u.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(u.url,null,l,p),o.ResourceType.Source),y):o.exported.frame(()=>y(null,u))}class fn{constructor(n,l,p){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),p=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=p&&n.x<y&&n.y>=m&&n.y<w}}class ur{constructor(n,l,p){this.context=n;const m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const se={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class me{constructor(n,l,p,m){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=m,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),n.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let p=0;p<this.attributes.length;p++){const m=l.attributes[this.attributes[p].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,l,p){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],w=l.attributes[y.name];w!==void 0&&n.vertexAttribPointer(w,y.components,n[se[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Me{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $e extends Me{getDefault(){return o.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Xe extends Me{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class nt extends Me{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class gt extends Me{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class lt extends Me{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class rt extends Me{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ye extends Me{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class bt extends Me{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class wt extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ct extends Me{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Nt extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class Wt extends Me{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ni extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class si extends Me{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Fi extends Me{getDefault(){return o.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class $i extends Me{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class hr extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class Yr extends Me{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Vn extends Me{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class vr extends Me{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class mn extends Me{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Rn extends Me{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Jr extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class xo extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ts extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class As extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class xr extends Me{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ss extends Me{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class gl extends Me{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Cs extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Is extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class $n extends Me{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Wo extends $n{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ga extends $n{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ho extends ga{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Y{constructor(n,l,p,m){this.context=n,this.width=l,this.height=p;const y=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Wo(n,y),m&&(this.depthAttachment=new ga(n,y))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&n.deleteRenderbuffer(p)}n.deleteFramebuffer(this.framebuffer)}}class O{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $e(this),this.clearDepth=new Xe(this),this.clearStencil=new nt(this),this.colorMask=new gt(this),this.depthMask=new lt(this),this.stencilMask=new rt(this),this.stencilFunc=new Ye(this),this.stencilOp=new bt(this),this.stencilTest=new wt(this),this.depthRange=new Ct(this),this.depthTest=new Nt(this),this.depthFunc=new Wt(this),this.blend=new ni(this),this.blendFunc=new si(this),this.blendColor=new Fi(this),this.blendEquation=new $i(this),this.cullFace=new hr(this),this.cullFaceSide=new Yr(this),this.frontFace=new Vn(this),this.program=new vr(this),this.activeTexture=new mn(this),this.viewport=new Rn(this),this.bindFramebuffer=new Jr(this),this.bindRenderbuffer=new xo(this),this.bindTexture=new Ts(this),this.bindVertexBuffer=new As(this),this.bindElementBuffer=new xr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ss(this),this.pixelStoreUnpack=new gl(this),this.pixelStoreUnpackPremultiplyAlpha=new Cs(this),this.pixelStoreUnpackFlipY=new Is(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new ur(this,n,l)}createVertexBuffer(n,l,p){return new me(this,n,l,p)}createRenderbuffer(n,l,p){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,n,l,p),this.bindRenderbuffer.set(null),y}createFramebuffer(n,l,p){return new Y(this,n,l,p)}clear({color:n,depth:l,stencil:p}){const m=this.gl;let y=0;n&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(y)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){L(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class F extends o.Evented{constructor(n,l,p,m){super(),this.id=n,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=In(this._options,this.map._requestManager,null,null,(n,l)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new fn(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const p=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(y,w,A,S)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):y?(n.state="errored",l(y)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:S}),n.setTexture(w,this.map.painter),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(n,l,p){n.setTexture(l,p)}static unloadTileData(n,l){n.texture&&l.saveTileTexture(n.texture)}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}}let X;function ie(u,n,l,p,m,y,w,A){const S=[u,l,m,n,p,y,1,1,1],P=[w,A,1],D=o.adjoint([],S),[R,N,W]=o.transformMat3(P,P,o.transpose(D,D));return o.multiply$1(S,[R,0,0,0,N,0,0,0,W],S)}class ue extends o.Evented{constructor(n,l,p,m){super(),this.id=n,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(n,l){this._loaded=l||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(p,m)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new o.ErrorEvent(p));else if(m){const{HTMLImageElement:y}=o.window;this.image=m instanceof y?o.exported.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const l=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let m=1/0,y=1/0,w=-1/0,A=-1/0;for(const R of p)m=Math.min(m,R.x),y=Math.min(y,R.y),w=Math.max(w,R.x),A=Math.max(A,R.y);const S=Math.max(w-m,A-y),P=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),D=Math.pow(2,P);return new o.CanonicalTileID(P,Math.floor((m+w)/2*D),Math.floor((y+A)/2*D))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const S in this.tiles){const P=this.tiles[S];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const l=o.tileTransform(this.tileID,this.map.transform.projection),[p,m,y,w]=this.coordinates.map(S=>{const P=l.projection.project(S[0],S[1]);return o.getTilePoint(l,P)._round()});this.perspectiveTransform=function(S,P,D,R,N,W,$,H,q,V){const K=ie(0,0,S,0,0,P,S,P),Z=ie(D,R,N,W,$,H,q,V);return o.multiply$1(Z,o.adjoint(K,K),Z),[Z[6]/Z[8]*S/o.EXTENT,Z[7]/Z[8]*P/o.EXTENT]}(this.width,this.height,p.x,p.y,m.x,m.y,w.x,w.y,y.x,y.y);const A=this._boundsArray=new o.StructArrayLayout4i8;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(m.x,m.y,o.EXTENT,0),A.emplaceBack(w.x,w.y,0,o.EXTENT),A.emplaceBack(y.x,y.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(A,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,l=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ve={vector:class extends o.Evented{constructor(u,n,l,p){if(super(),this.id=u,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(n,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=In(this._options,this.map._requestManager,n,l,(p,m)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.ErrorEvent(p))):m&&(o.extend(this,m),m.bounds&&(this.tileBounds=new fn(m.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(p)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const u=this.map.style._getSourceCaches(this.id);for(const n of u)n.clearTiles()})}setSourceProperty(u){u(),this.reload()}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(u,n){const l=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=n:u.request=u.actor.send("reloadTile",p,m.bind(this));else if(u.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",p,m.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},p,(w,A)=>{w||!A?m.call(this,w):(p.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},u.actor&&u.actor.send("loadTile",p,m.bind(this),void 0,!0))},!0);u.request={cancel:y}}function m(y,w){return delete u.request,u.aborted?n(null):y&&y.status!==404?n(y):(w&&w.resourceTiming&&(u.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&u.setExpiryData(w),u.loadVectorData(w,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:F,"raster-dem":class extends F{constructor(u,n,l,p){super(u,n,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(u,n){const l=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(m,y){m&&(u.state="errored",n(m)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",n(null))}u.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),function(m,y,w,A){if(delete u.request,u.aborted)u.state="unloaded",n(null);else if(m)u.state="errored",n(m);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:w,expires:A});const S=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(X==null&&(X=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),X),P=1-(y.width-o.prevPowerOfTwo(y.width))/2;P<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const D=S?y:o.exported.getImageData(y,P),R={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:P};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",R,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const n=u.canonical,l=Math.pow(2,n.z),p=(n.x-1+l)%l,m=n.x===0?u.wrap-1:u.wrap,y=(n.x+1+l)%l,w=n.x+1===l?u.wrap+1:u.wrap,A={};return A[new o.OverscaledTileID(u.overscaledZ,m,n.z,p,n.y).key]={backfilled:!1},A[new o.OverscaledTileID(u.overscaledZ,w,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(A[new o.OverscaledTileID(u.overscaledZ,m,n.z,p,n.y-1).key]={backfilled:!1},A[new o.OverscaledTileID(u.overscaledZ,u.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new o.OverscaledTileID(u.overscaledZ,w,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<l&&(A[new o.OverscaledTileID(u.overscaledZ,m,n.z,p,n.y+1).key]={backfilled:!1},A[new o.OverscaledTileID(u.overscaledZ,u.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new o.OverscaledTileID(u.overscaledZ,w,n.z,y,n.y+1).key]={backfilled:!1}),A}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends o.Evented{constructor(u,n,l,p){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*m,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*m,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},n),this}getClusterChildren(u,n){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},n),this}getClusterLeaves(u,n,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:n,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=o.extend({},this.workerOptions),n=this._data;typeof n=="string"?(u.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(m.resourceTiming=p.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,n){const l=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(l,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,m)=>(delete u.request,u.unloadVectorData(),u.aborted?n(null):p?n(p):(u.loadVectorData(m,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ue{constructor(u,n,l,p){super(u,n,l,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const n of u.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const n=this.video.seekable;u<n.start(0)||u>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,n=u.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(u,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ue,canvas:class extends ue{constructor(u,n,l,p){super(u,n,l,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends o.Evented{constructor(u,n,l,p){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fn(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:n,y:l,z:p}=u.canonical;return this._implementation.hasTile({x:n,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,n){const{x:l,y:p,z:m}=u.tileID.canonical,y=new o.window.AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:m},{signal:y.signal})).then(function(w){return delete u.request,u.aborted?(u.state="unloaded",n(null)):w===void 0?(u.state="errored",n(null)):w===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",n(null)):function(A){return A instanceof o.window.ImageData||A instanceof o.window.HTMLCanvasElement||A instanceof o.window.ImageBitmap||A instanceof o.window.HTMLImageElement}(w)?(this.loadTileData(u,w),u.state="loaded",void n(null)):(u.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(w=>{w.code!==20&&(u.state="errored",n(w))}),u.request.cancel=()=>y.abort()}loadTileData(u,n){F.loadTileData(u,n,this._map.painter)}unloadTileData(u){F.unloadTileData(u,this._map.painter)}unloadTile(u,n){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:l,y:p,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:m})}n()}abortTile(u,n){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ye=function(u,n,l,p){const m=new ve[n.type](u,n,l,p);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function pe(u,n){const l=o.identity([]);return o.scale(l,l,[.5*u.width,.5*-u.height,1]),o.translate(l,l,[1,-1,0]),o.multiply(l,l,u.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function Ee(u,n,l,p,m,y,w,A=!1){const S=u.tilesIn(p,w,A);S.sort(dt);const P=[];for(const R of S)P.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,l,u._state,R,m,y,pe(u.transform,R.tile.tileID),A)});const D=function(R){const N={},W={};for(const $ of R){const H=$.queryResults,q=$.wrappedTileID,V=W[q]=W[q]||{};for(const K in H){const Z=H[K],oe=V[K]=V[K]||{},ae=N[K]=N[K]||[];for(const te of Z)oe[te.featureIndex]||(oe[te.featureIndex]=!0,ae.push(te))}}return N}(P);for(const R in D)D[R].forEach(N=>{const W=N.feature,$=W.layer;$&&$.type!=="background"&&$.type!=="sky"&&(W.source=$.source,$["source-layer"]&&(W.sourceLayer=$["source-layer"]),W.state=W.id!==void 0?u.getFeatureState($["source-layer"],W.id):{})});return D}function Ue(u,n){const l=u.getRenderableIds().map(y=>u.getTileByID(y)),p=[],m={};for(let y=0;y<l.length;y++){const w=l[y],A=w.tileID.canonical.key;m[A]||(m[A]=!0,w.querySourceFeatures(p,n))}return p}function dt(u,n){const l=u.tileID,p=n.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function qe(){return Na.workerClass!=null?new Na.workerClass:new o.window.Worker(Na.workerUrl)}const Mt="mapboxgl_preloaded_worker_pool";class St{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<St.workerCount;)this.workers.push(new qe);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mt]}numActive(){return Object.keys(this.active).length}}let Tt;function Ot(){return Tt||(Tt=new St),Tt}function Ht(u,n){const l={};for(const p in u)p!=="ref"&&(l[p]=u[p]);return o.refProperties.forEach(p=>{p in n&&(l[p]=n[p])}),l}function hi(u){u=u.slice();const n=Object.create(null);for(let l=0;l<u.length;l++)n[u[l].id]=u[l];for(let l=0;l<u.length;l++)"ref"in u[l]&&(u[l]=Ht(u[l],n[u[l].ref]));return u}St.workerCount=2;const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function wi(u,n,l){l.push({command:Lt.addSource,args:[u,n[u]]})}function Ei(u,n,l){n.push({command:Lt.removeSource,args:[u]}),l[u]=!0}function bo(u,n,l,p){Ei(u,l,p),wi(u,n,l)}function Qr(u,n,l){let p;for(p in u[l])if(u[l].hasOwnProperty(p)&&p!=="data"&&!L(u[l][p],n[l][p]))return!1;for(p in n[l])if(n[l].hasOwnProperty(p)&&p!=="data"&&!L(u[l][p],n[l][p]))return!1;return!0}function ze(u,n,l,p,m,y){let w;for(w in n=n||{},u=u||{})u.hasOwnProperty(w)&&(L(u[w],n[w])||l.push({command:y,args:[p,w,n[w],m]}));for(w in n)n.hasOwnProperty(w)&&!u.hasOwnProperty(w)&&(L(u[w],n[w])||l.push({command:y,args:[p,w,n[w],m]}))}function eo(u){return u.id}function tn(u,n){return u[n.id]=n,u}class wo{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.clamp(n,0,1);let l=1,p=this._distances[l];const m=n*this.paddedLength+this.padding;for(;p<m&&l<this._distances.length;)p=this._distances[++l];const y=l-1,w=this._distances[y],A=p-w,S=A>0?(m-w)/A:0;return this.points[y].mult(1-S).add(this.points[l].mult(S))}}class ad{constructor(n,l,p){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(l/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,p,m,y){this._forEachCell(l,p,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(n,l,p,m){this._forEachCell(l-m,p-m,l+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(p),this.circles.push(m)}_insertBoxCell(n,l,p,m,y,w){this.boxCells[y].push(w)}_insertCircleCell(n,l,p,m,y,w){this.circleCells[y].push(w)}_query(n,l,p,m,y,w){if(p<0||n>this.width||m<0||l>this.height)return!y&&[];const A=[];if(n<=0&&l<=0&&this.width<=p&&this.height<=m){if(y)return!0;for(let S=0;S<this.boxKeys.length;S++)A.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const P=this.circles[3*S],D=this.circles[3*S+1],R=this.circles[3*S+2];A.push({key:this.circleKeys[S],x1:P-R,y1:D-R,x2:P+R,y2:D+R})}return w?A.filter(w):A}return this._forEachCell(n,l,p,m,this._queryCell,A,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?A.length>0:A}_queryCircle(n,l,p,m,y){const w=n-p,A=n+p,S=l-p,P=l+p;if(A<0||w>this.width||P<0||S>this.height)return!m&&[];const D=[];return this._forEachCell(w,S,A,P,this._queryCellCircle,D,{hitTest:m,circle:{x:n,y:l,radius:p},seenUids:{box:{},circle:{}}},y),m?D.length>0:D}query(n,l,p,m,y){return this._query(n,l,p,m,!1,y)}hitTest(n,l,p,m,y){return this._query(n,l,p,m,!0,y)}hitTestCircle(n,l,p,m){return this._queryCircle(n,l,p,!0,m)}_queryCell(n,l,p,m,y,w,A,S){const P=A.seenUids,D=this.boxCells[y];if(D!==null){const N=this.bboxes;for(const W of D)if(!P.box[W]){P.box[W]=!0;const $=4*W;if(n<=N[$+2]&&l<=N[$+3]&&p>=N[$+0]&&m>=N[$+1]&&(!S||S(this.boxKeys[W]))){if(A.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[W],x1:N[$],y1:N[$+1],x2:N[$+2],y2:N[$+3]})}}}const R=this.circleCells[y];if(R!==null){const N=this.circles;for(const W of R)if(!P.circle[W]){P.circle[W]=!0;const $=3*W;if(this._circleAndRectCollide(N[$],N[$+1],N[$+2],n,l,p,m)&&(!S||S(this.circleKeys[W]))){if(A.hitTest)return w.push(!0),!0;{const H=N[$],q=N[$+1],V=N[$+2];w.push({key:this.circleKeys[W],x1:H-V,y1:q-V,x2:H+V,y2:q+V})}}}}}_queryCellCircle(n,l,p,m,y,w,A,S){const P=A.circle,D=A.seenUids,R=this.boxCells[y];if(R!==null){const W=this.bboxes;for(const $ of R)if(!D.box[$]){D.box[$]=!0;const H=4*$;if(this._circleAndRectCollide(P.x,P.y,P.radius,W[H+0],W[H+1],W[H+2],W[H+3])&&(!S||S(this.boxKeys[$])))return w.push(!0),!0}}const N=this.circleCells[y];if(N!==null){const W=this.circles;for(const $ of N)if(!D.circle[$]){D.circle[$]=!0;const H=3*$;if(this._circlesCollide(W[H],W[H+1],W[H+2],P.x,P.y,P.radius)&&(!S||S(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(n,l,p,m,y,w,A,S){const P=this._convertToXCellCoord(n),D=this._convertToYCellCoord(l),R=this._convertToXCellCoord(p),N=this._convertToYCellCoord(m);for(let W=P;W<=R;W++)for(let $=D;$<=N;$++)if(y.call(this,n,l,p,m,this.xCellCount*$+W,w,A,S))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,p,m,y,w){const A=m-n,S=y-l,P=p+w;return P*P>A*A+S*S}_circleAndRectCollide(n,l,p,m,y,w,A){const S=(w-m)/2,P=Math.abs(n-(m+S));if(P>S+p)return!1;const D=(A-y)/2,R=Math.abs(l-(y+D));if(R>D+p)return!1;if(P<=S||R<=D)return!0;const N=P-S,W=R-D;return N*N+W*W<=p*p}}const Dr=Math.tan(85*Math.PI/180);function Ms(u,n,l,p,m,y,w){const A=o.create();if(l)if(y.name==="globe"){const S=o.calculateGlobeLabelMatrix(m,n);o.multiply(A,A,S)}else{const S=_t([],w);A[0]=S[0],A[1]=S[1],A[4]=S[2],A[5]=S[3],p||o.rotateZ(A,A,m.angle)}else o.multiply(A,m.labelPlaneMatrix,u);return A}function ld(u,n,l,p,m,y,w){const A=Ms(u,n,l,p,m,y,w);return y.name==="globe"&&l||(A[2]=A[6]=A[10]=A[14]=0),A}function Ps(u,n,l,p,m,y,w){if(l){if(y.name==="globe"){const A=Ms(u,n,l,p,m,y,w);return o.invert(A,A),o.multiply(A,u,A),A}{const A=o.clone(u),S=o.identity([]);return S[0]=w[0],S[1]=w[1],S[4]=w[2],S[5]=w[3],o.multiply(A,A,S),p||o.rotateZ(A,A,-m.angle),A}}return m.glCoordMatrix}function ct(u,n,l=0){const p=[u.x,u.y,l,1];l?o.transformMat4$1(p,p,n):yl(p,p,n);const m=p[3];return{point:[p[0]/m,p[1]/m,p[2]/m],signedDistanceFromCamera:m}}function Xt(u,n){const l=[u[0],u[1],u[2],1];o.transformMat4$1(l,l,n);const p=l[3];return{point:[l[0]/p,l[1]/p,l[2]/p],signedDistanceFromCamera:p}}function Kt(u,n){return Math.min(.5+u/n*.5,1.5)}function Lr(u,n){const l=u[0]/u[3],p=u[1]/u[3];return l>=-n[0]&&l<=n[0]&&p>=-n[1]&&p<=n[1]}function Ds(u,n,l,p,m,y,w,A,S,P){const D=l.transform,R=p?u.textSizeData:u.iconSizeData,N=o.evaluateSizeForZoom(R,l.transform.zoom),W=D.projection.name==="globe",$=[256/l.width*2+1,256/l.height*2+1],H=p?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;H.clear();let q=null;W&&(q=p?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const V=u.lineVertexArray,K=p?u.text.placedSymbolArray:u.icon.placedSymbolArray,Z=l.transform.width/l.transform.height;let oe=!1;for(let ae=0;ae<K.length;ae++){const te=K.get(ae);if(te.writingMode!==o.WritingMode.vertical||oe||ae!==0&&K.get(ae-1).writingMode===o.WritingMode.horizontal||(oe=!0),(te.hidden||te.writingMode===o.WritingMode.vertical)&&!oe){br(te.numGlyphs,H);continue}oe=!1;const ce=new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),be=S?S(ce):[0,0,0],Pe=D.projection.projectTilePoint(ce.x,ce.y,P.canonical),Ae=[Pe.x+be[0],Pe.y+be[1],Pe.z+be[2]],Ze=[...Ae,1];if(o.transformMat4$1(Ze,Ze,n),!Lr(Ze,$)){br(te.numGlyphs,H);continue}const _e=Kt(l.transform.cameraToCenterDistance,Ze[3]),Be=o.evaluateSizeForFeature(R,N,te),Re=w?Be/_e:Be*_e,we=ct(new o.pointGeometry(Ae[0],Ae[1]),m,Ae[2]);if(we.signedDistanceFromCamera<=0){br(te.numGlyphs,H);continue}let fe={};const st=w?null:S,Ke=Ls(te,Re,!1,A,n,m,y,u.glyphOffsetArray,V,H,q,we.point,ce,fe,Z,st,D.projection,P,w);oe=Ke.useVertical,st&&Ke.needsFlipping&&(fe={}),(Ke.notEnoughRoom||oe||Ke.needsFlipping&&Ls(te,Re,!0,A,n,m,y,u.glyphOffsetArray,V,H,q,we.point,ce,fe,Z,st,D.projection,P,w).notEnoughRoom)&&br(te.numGlyphs,H)}p?(u.text.dynamicLayoutVertexBuffer.updateData(H),q&&u.text.globeExtVertexBuffer.updateData(q)):(u.icon.dynamicLayoutVertexBuffer.updateData(H),q&&u.icon.globeExtVertexBuffer.updateData(q))}function Yt(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H){const q=A.glyphStartIndex+A.numGlyphs,V=A.lineStartIndex,K=A.lineStartIndex+A.lineLength,Z=n.getoffsetX(A.glyphStartIndex),oe=n.getoffsetX(q-1),ae=Ni(u*Z,l,p,m,y,w,A.segment,V,K,S,P,D,R,N,!0,W,$,H);if(!ae)return null;const te=Ni(u*oe,l,p,m,y,w,A.segment,V,K,S,P,D,R,N,!0,W,$,H);return te?{first:ae,last:te}:null}function ya(u,n,l,p){return u.writingMode===o.WritingMode.horizontal&&Math.abs(l.y-n.y)>Math.abs(l.x-n.x)*p?{useVertical:!0}:u.writingMode===o.WritingMode.vertical?n.y<l.y?{needsFlipping:!0}:null:u.flipState!==0&&function(m,y,w){const A=(y.x-m.x)*w;return A===0||Math.abs((y.y-m.y)/A)>Dr}(n,l,p)?u.flipState===1?{needsFlipping:!0}:null:n.x>l.x?{needsFlipping:!0}:null}function Ls(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H,q,V,K){const Z=n/24,oe=u.lineOffsetX*Z,ae=u.lineOffsetY*Z;let te=[];if(u.numGlyphs>1){const ce=u.glyphStartIndex+u.numGlyphs,be=u.lineStartIndex,Pe=u.lineStartIndex+u.lineLength,Ae=Yt(Z,A,oe,ae,l,R,N,u,S,y,W,H,!1,q,V,K);if(!Ae)return{notEnoughRoom:!0};const Ze=Xt(Ae.first.point,w).point,_e=Xt(Ae.last.point,w).point,Be=new o.pointGeometry(Ze[0],Ze[1]),Re=new o.pointGeometry(_e[0],_e[1]);if(p&&!l){const we=ya(u,Be,Re,$);if(u.flipState=we&&we.needsFlipping?1:2,we)return we}te=[Ae.first];for(let we=u.glyphStartIndex+1;we<ce-1;we++){const fe=Ni(Z*A.getoffsetX(we),oe,ae,l,R,N,u.segment,be,Pe,S,y,W,H,!1,!1,q,V,K);if(!fe)return{notEnoughRoom:!0};te.push(fe)}te.push(Ae.last)}else{if(p&&!l){const be=ct(N,m).point,Pe=u.lineStartIndex+u.segment+1,Ae=new o.pointGeometry(S.getx(Pe),S.gety(Pe)),Ze=ct(Ae,m),_e=Ze.signedDistanceFromCamera>0?Ze.point:ir(N,Ae,be,1,m,void 0,q,V.canonical),Be=ya(u,new o.pointGeometry(be[0],be[1]),new o.pointGeometry(_e[0],_e[1]),$);if(u.flipState=Be&&Be.needsFlipping?1:2,Be)return Be}const ce=Ni(Z*A.getoffsetX(u.glyphStartIndex),oe,ae,l,R,N,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,S,y,W,H,!1,!1,q,V,K);if(!ce)return{notEnoughRoom:!0};te=[ce]}if(D)for(const ce of te)o.updateGlobeVertexNormal(D,P.length+0,ce.up[0],ce.up[1],ce.up[2]),o.updateGlobeVertexNormal(D,P.length+1,ce.up[0],ce.up[1],ce.up[2]),o.updateGlobeVertexNormal(D,P.length+2,ce.up[0],ce.up[1],ce.up[2]),o.updateGlobeVertexNormal(D,P.length+3,ce.up[0],ce.up[1],ce.up[2]),o.addDynamicAttributes(P,ce.point[0],ce.point[1],ce.point[2],ce.angle);else for(const ce of te)o.addDynamicAttributes(P,ce.point[0],ce.point[1],ce.point[2],ce.angle);return{}}function zs(u,n,l,p,m){const y=p.projectTilePoint(u.x,u.y,n);if(!m)return ct(y,l,y.z);const w=m(u);return ct(new o.pointGeometry(y.x+w[0],y.y+w[1]),l,y.z+w[2])}function ir(u,n,l,p,m,y,w,A){const S=zs(u.add(u.sub(n)._unit()),A,m,w,y).point,P=o.sub([],l,S);return o.scaleAndAdd([],l,P,p/o.length(P))}function Ni(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H,q,V){const K=p?u-n:u+n;let Z=K>0?1:-1,oe=0;p&&(Z*=-1,oe=Math.PI),Z<0&&(oe+=Math.PI);let ae=Z>0?A+w:A+w+1,te=m,ce=m,be=0,Pe=0;const Ae=Math.abs(K),Ze=[],_e=[];let Be=y;const Re=()=>{const Qe=ae-Z;return be===0?y:new o.pointGeometry(P.getx(Qe),P.gety(Qe))},we=()=>{const Qe=Re();return ir(Qe,Be||Qe,ce,Ae-be+1,D,N,H,q.canonical)};for(;be+Pe<=Ae;){if(ae+=Z,ae<A||ae>=S)return null;if(ce=te,Ze.push(te),W&&_e.push(Be||Re()),te=R[ae],te===void 0){Be=new o.pointGeometry(P.getx(ae),P.gety(ae));const Qe=zs(Be,q.canonical,D,H,N);te=Qe.signedDistanceFromCamera>0?R[ae]=Qe.point:we()}else Be=null;be+=Pe,Pe=o.distance(ce,te)}Be=Be||new o.pointGeometry(P.getx(ae),P.gety(ae));const fe=Re();$&&N&&(R[ae]=te=R[ae]===void 0?te:we(),Pe=o.distance(ce,te));const st=(Ae-be)/Pe,Ke=Be.sub(fe).mult(st)._add(fe),tt=o.sub([],te,ce),Je=o.scaleAndAdd([],ce,tt,st);let vt=[0,0,1],kt=tt[0],Pt=tt[1];if(V&&(vt=H.upVector(q.canonical,Ke.x,Ke.y),vt[0]!==0||vt[1]!==0||vt[2]!==1)){const Qe=[1,0,0],Bt=[0,1,0];Qe[0]=vt[2],Qe[1]=0,Qe[2]=-vt[0],o.cross(Bt,vt,Qe),o.normalize(Qe,Qe),o.normalize(Bt,Bt),kt=o.dot(tt,Qe),Pt=o.dot(tt,Bt)}if(l){const Qe=o.cross([],vt,tt);o.normalize(Qe,Qe),o.scaleAndAdd(Je,Je,Qe,l*Z)}const Et=oe+Math.atan2(Pt,kt);return Ze.push(Je),W&&_e.push(Ke),{point:Je,angle:Et,path:Ze,tilePath:_e,up:vt}}const nm=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function br(u,n){for(let l=0;l<u;l++){const p=n.length;n.resize(p+4),n.float32.set(nm,4*p)}}function yl(u,n,l){const p=n[0],m=n[1];return u[0]=l[0]*p+l[4]*m+l[12],u[1]=l[1]*p+l[5]*m+l[13],u[3]=l[3]*p+l[7]*m+l[15],u}const Gn=100;class ou{constructor(n,l,p=new ad(n.width+200,n.height+200,25),m=new ad(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=m,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Gn,this.screenBottomBoundary=n.height+Gn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,p,m,y,w,A,S){let P=p.projectedAnchorX,D=p.projectedAnchorY,R=p.projectedAnchorZ;const N=p.elevation,W=p.tileID;if(N&&W){const ae=n.getProjection().upVector(W.canonical,p.tileAnchorX,p.tileAnchorY),te=n.getProjection().upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ae[0]*N*te,D+=ae[1]*N*te,R+=ae[2]*N*te}const $=this.projectAndGetPerspectiveRatio(A,[P,D,R],p.tileID,n.projection.name==="globe"||!!N||this.transform.pitch>0,n.getProjection()),H=w*$.perspectiveRatio,q=(p.x1*l+m.x-p.padding)*H+$.point.x,V=(p.y1*l+m.y-p.padding)*H+$.point.y,K=(p.x2*l+m.x+p.padding)*H+$.point.x,Z=(p.y2*l+m.y+p.padding)*H+$.point.y,oe=$.perspectiveRatio<=.55||$.occluded;return!this.isInsideGrid(q,V,K,Z)||!y&&this.grid.hitTest(q,V,K,Z,S)||oe?{box:[],offscreen:!1,occluded:$.occluded}:{box:[q,V,K,Z],offscreen:this.isOffscreen(q,V,K,Z),occluded:!1}}placeCollisionCircles(n,l,p,m,y,w,A,S,P,D,R,N,W,$,H){const q=[],V=this.transform.elevation,K=V?V.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,n.getProjection()):fe=>[0,0,0],Z=new o.pointGeometry(p.tileAnchorX,p.tileAnchorY),oe=n.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,H.canonical),ae=K(Z),te=[oe.x+ae[0],oe.y+ae[1],oe.z+ae[2]],ce=n.projection.name==="globe",be=this.projectAndGetPerspectiveRatio(A,[te[0],te[1],te[2]],H,ce||!!V||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:Pe}=be,Ae=(R?w/Pe:w*Pe)/o.ONE_EM,Ze=ct(new o.pointGeometry(te[0],te[1]),S,te[2]).point,_e=be.signedDistanceFromCamera>0?Yt(Ae,y,p.lineOffsetX*Ae,p.lineOffsetY*Ae,!1,Ze,Z,p,m,S,{},V&&!R?K:null,R&&!!V,n.getProjection(),H,R):null;let Be=!1,Re=!1,we=!0;if(_e&&!be.occluded){const fe=.5*W*Pe+$,st=new o.pointGeometry(-100,-100),Ke=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),tt=new wo,Je=_e.first,vt=_e.last;let kt=[];for(let Qe=Je.path.length-1;Qe>=1;Qe--)kt.push(Je.path[Qe]);for(let Qe=1;Qe<vt.path.length;Qe++)kt.push(vt.path[Qe]);const Pt=2.5*fe;if(P){const Qe=kt.map(V&&!ce?(Bt,qt)=>{const Ti=K(qt<Je.path.length-1?Je.tilePath[Je.path.length-1-qt]:vt.tilePath[qt-Je.path.length+2]);return Bt[2]=Ti[2],Xt(Bt,P)}:Bt=>Xt(Bt,P));kt=Qe.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:Qe.map(Bt=>Bt.point)}let Et=[];if(kt.length>0){const Qe=kt.map(yi=>new o.pointGeometry(yi[0],yi[1]));let Bt=1/0,qt=-1/0,Ti=1/0,Ai=-1/0;for(let yi=0;yi<Qe.length;yi++)Bt=Math.min(Bt,Qe[yi].x),Ti=Math.min(Ti,Qe[yi].y),qt=Math.max(qt,Qe[yi].x),Ai=Math.max(Ai,Qe[yi].y);Et=Bt>=st.x&&qt<=Ke.x&&Ti>=st.y&&Ai<=Ke.y?[Qe]:qt<st.x||Bt>Ke.x||Ai<st.y||Ti>Ke.y?[]:o.clipLine([Qe],st.x,st.y,Ke.x,Ke.y)}for(const Qe of Et){tt.reset(Qe,.25*fe);let Bt=0;Bt=tt.length<=.5*fe?1:Math.ceil(tt.paddedLength/Pt)+1;for(let qt=0;qt<Bt;qt++){const Ti=qt/Math.max(Bt-1,1),Ai=tt.lerp(Ti),yi=Ai.x+Gn,_n=Ai.y+Gn;q.push(yi,_n,fe,0);const Fn=yi-fe,Nr=_n-fe,ki=yi+fe,Gi=_n+fe;if(we=we&&this.isOffscreen(Fn,Nr,ki,Gi),Re=Re||this.isInsideGrid(Fn,Nr,ki,Gi),!l&&this.grid.hitTestCircle(yi,_n,fe,N)&&(Be=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!D&&Be||!Re?[]:q,offscreen:we,collisionDetected:Be,occluded:be.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,m=1/0,y=-1/0,w=-1/0;for(const D of n){const R=new o.pointGeometry(D.x+Gn,D.y+Gn);p=Math.min(p,R.x),m=Math.min(m,R.y),y=Math.max(y,R.x),w=Math.max(w,R.y),l.push(R)}const A=this.grid.query(p,m,y,w).concat(this.ignoredGrid.query(p,m,y,w)),S={},P={};for(const D of A){const R=D.key;if(S[R.bucketInstanceId]===void 0&&(S[R.bucketInstanceId]={}),S[R.bucketInstanceId][R.featureIndex])continue;const N=[new o.pointGeometry(D.x1,D.y1),new o.pointGeometry(D.x2,D.y1),new o.pointGeometry(D.x2,D.y2),new o.pointGeometry(D.x1,D.y2)];o.polygonIntersectsPolygon(l,N)&&(S[R.bucketInstanceId][R.featureIndex]=!0,P[R.bucketInstanceId]===void 0&&(P[R.bucketInstanceId]=[]),P[R.bucketInstanceId].push(R.featureIndex))}return P}insertCollisionBox(n,l,p,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:m,collisionGroupID:y},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,p,m,y){const w=l?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:m,collisionGroupID:y};for(let S=0;S<n.length;S+=4)w.insertCircle(A,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,l,p,m,y){const w=[l[0],l[1],l[2],1];let A=!1;if(l[2]||this.transform.pitch>0){o.transformMat4$1(w,w,n);const S=y.name==="globe";this.fogState&&p&&!S&&(A=function(P,D,R,N,W,$){const H=$.calculateFogTileMatrix(W),q=[D,R,N];return o.transformMat4(q,q,H),ei(P,q,$.pitch,$._fov)}(this.fogState,l[0],l[1],l[2],p.toUnwrapped(),this.transform)>.9)}else yl(w,w,n);return{point:new o.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Gn,(-w[1]/w[3]+1)/2*this.transform.height+Gn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:m&&w[2]>w[3]||A}}isOffscreen(n,l,p,m){return p<Gn||n>=this.screenRightBoundary||m<Gn||l>this.screenBottomBoundary}isInsideGrid(n,l,p,m){return p>=0&&n<this.gridRightBoundary&&m>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}function vl(u,n,l){const p=n.createTileMatrix(u,u.worldSize,l.toUnwrapped());return o.multiply(new Float32Array(16),u.projMatrix,p)}function xl(u,n,l){if(n.projection.name===l.projection.name)return u.projMatrix;const p=l.clone();return p.setProjection(n.projection),vl(p,n.getProjection(),u)}function va(u,n,l){return n.name===l.projection.name?u.projMatrix:vl(l,n,u)}class xa{constructor(n,l,p,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Xo{constructor(n,l,p,m,y,w=!1){this.text=new xa(n?n.text:null,l,p,y),this.icon=new xa(n?n.icon:null,l,m,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mn{constructor(n,l,p,m=!1){this.text=n,this.icon=l,this.skipFade=p,this.clipped=m}}class Ji{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class su{constructor(n,l,p,m,y){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=y}}class au{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[n]}}function Bn(u,n,l,p,m){const{horizontalAlign:y,verticalAlign:w}=o.getAnchorAlignment(u),A=-(y-.5)*n,S=-(w-.5)*l,P=o.evaluateVariableOffset(u,p);return new o.pointGeometry(A+P[0]*m,S+P[1]*m)}function qn(u,n,l,p,m){const y=new o.pointGeometry(u,n);return l&&y._rotate(p?m:-m),y}class cd{constructor(n,l,p,m,y){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new ou(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new au(p),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,p,m){const y=p.getBucket(l),w=p.latestFeatureIndex;if(!y||!w||l.id!==y.layerIds[0])return;const A=y.layers[0].layout,S=p.collisionBoxArray,P=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/o.EXTENT,R=p.tileID.toUnwrapped();this.transform.setProjection(y.projection);const N=(W=p.tileID,$=y.getProjection(),H=this.transform,$.name===this.projection?H.calculateProjMatrix(W.toUnwrapped()):vl(H,$,W));var W,$,H;const q=A.get("text-pitch-alignment")==="map",V=A.get("text-rotation-alignment")==="map";l.compileFilter();const K=l.dynamicFilter(),Z=l.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(p),ae=ld(N,p.tileID.canonical,q,V,this.transform,y.getProjection(),oe);let te=null;if(q){const Pe=Ps(N,p.tileID.canonical,q,V,this.transform,y.getProjection(),oe);te=o.multiply([],this.transform.labelPlaneMatrix,Pe)}let ce=null;K&&p.latestFeatureIndex&&(ce={unwrappedTileID:R,dynamicFilter:K,dynamicFilterNeedsFeature:Z,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new su(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,p.tileID);const be={bucket:y,layout:A,posMatrix:N,textLabelPlaneMatrix:ae,labelToScreenMatrix:te,clippingData:ce,scale:P,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const Pe of y.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:_e}=Pe;n.push({sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:_e,parameters:be})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:be})}attemptAnchorPlacement(n,l,p,m,y,w,A,S,P,D,R,N,W,$,H,q,V,K){const Z=[N.textOffset0,N.textOffset1],oe=Bn(n,p,m,Z,y),ae=this.collisionIndex.placeCollisionBox($,y,l,qn(oe.x,oe.y,w,A,this.transform.angle),R,S,P,D.predicate);if(q){const te=$.getSymbolInstanceIconSize(K,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,te,q,qn(oe.x,oe.y,w,A,this.transform.angle),R,S,P,D.predicate).box.length===0)return}if(ae.box.length>0){let te;return this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(te=this.prevPlacement.variableOffsets[N.crossTileID].anchor),this.variableOffsets[N.crossTileID]={textOffset:Z,width:p,height:m,anchor:n,textScale:y,prevAnchor:te},this.markUsedJustification($,n,N,H),$.allowVerticalPlacement&&(this.markUsedOrientation($,H,N),this.placedOrientations[N.crossTileID]=H),{shift:oe,placedGlyphBoxes:ae}}}placeLayerBucketPart(n,l,p,m){const{bucket:y,layout:w,posMatrix:A,textLabelPlaneMatrix:S,labelToScreenMatrix:P,clippingData:D,textPixelRatio:R,holdingForFade:N,collisionBoxArray:W,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:H,collisionGroup:q}=n.parameters,V=w.get("text-optional"),K=w.get("icon-optional"),Z=w.get("text-allow-overlap"),oe=w.get("icon-allow-overlap"),ae=w.get("text-rotation-alignment")==="map",te=w.get("text-pitch-alignment")==="map",ce=w.get("icon-text-fit")!=="none",be=w.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let Pe=Z&&(oe||!y.hasIconData()||K),Ae=oe&&(Z||!y.hasTextData()||V);!y.collisionArrays&&W&&y.deserializeCollisionBoxes(W),p&&m&&y.updateCollisionDebugBuffers(this.transform.zoom,W);const Ze=(_e,Be,Re)=>{if(D){const ki={zoom:this.transform.zoom,pitch:this.transform.pitch};let Gi=null;if(D.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[y.bucketInstanceId];Gi=D.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(ki,Gi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[_e.crossTileID]=new Mn(!1,!1,!1,!0),void(l[_e.crossTileID]=!0)}if(l[_e.crossTileID])return;if(N)return void(this.placements[_e.crossTileID]=new Mn(!1,!1,!1));let we=!1,fe=!1,st=!0,Ke=!1,tt=!1,Je=null,vt={box:null,offscreen:null,occluded:null},kt={box:null,offscreen:null,occluded:null},Pt=null,Et=null,Qe=null,Bt=0,qt=0,Ti=0;Re.textFeatureIndex?Bt=Re.textFeatureIndex:_e.useRuntimeCollisionCircles&&(Bt=_e.featureIndex),Re.verticalTextFeatureIndex&&(qt=Re.verticalTextFeatureIndex);const Ai=ki=>{ki.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||ki.elevation)&&(ki.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,ki.tileAnchorX,ki.tileAnchorY):0)},yi=Re.textBox;if(yi){Ai(yi);const ki=_i=>{let nn=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!_i&&this.prevPlacement){const Dn=this.prevPlacement.placedOrientations[_e.crossTileID];Dn&&(this.placedOrientations[_e.crossTileID]=Dn,nn=Dn,this.markUsedOrientation(y,nn,_e))}return nn},Gi=(_i,nn)=>{if(y.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const Dn of y.writingModes)if(Dn===o.WritingMode.vertical?(vt=nn(),kt=vt):vt=_i(),vt&&vt.box&&vt.box.length)break}else vt=_i()};if(w.get("text-variable-anchor")){let _i=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]){const Pi=this.prevPlacement.variableOffsets[_e.crossTileID];_i.indexOf(Pi.anchor)>0&&(_i=_i.filter(Zn=>Zn!==Pi.anchor),_i.unshift(Pi.anchor))}const nn=(Pi,Zn,is)=>{const Er=y.getSymbolInstanceTextSize($,_e,this.transform.zoom,Be),Nn=(Pi.x2-Pi.x1)*Er+2*Pi.padding,Vs=(Pi.y2-Pi.y1)*Er+2*Pi.padding,Co=ce&&!oe?Zn:null;Co&&Ai(Co);let wn={box:[],offscreen:!1,occluded:!1};const Ur=Z?2*_i.length:_i.length;for(let Io=0;Io<Ur;++Io){const Tr=this.attemptAnchorPlacement(_i[Io%_i.length],Pi,Nn,Vs,Er,ae,te,R,A,q,Io>=_i.length,_e,Be,y,is,Co,$,H);if(Tr&&(wn=Tr.placedGlyphBoxes,wn&&wn.box&&wn.box.length)){we=!0,Je=Tr.shift;break}}return wn};Gi(()=>nn(yi,Re.iconBox,o.WritingMode.horizontal),()=>{const Pi=Re.verticalTextBox;return Pi&&Ai(Pi),y.allowVerticalPlacement&&!(vt&&vt.box&&vt.box.length)&&_e.numVerticalGlyphVertices>0&&Pi?nn(Pi,Re.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),vt&&(we=vt.box,st=vt.offscreen,Ke=vt.occluded);const Dn=ki(vt&&vt.box);if(!we&&this.prevPlacement){const Pi=this.prevPlacement.variableOffsets[_e.crossTileID];Pi&&(this.variableOffsets[_e.crossTileID]=Pi,this.markUsedJustification(y,Pi.anchor,_e,Dn))}}else{const _i=(nn,Dn)=>{const Pi=y.getSymbolInstanceTextSize($,_e,this.transform.zoom,Be),Zn=this.collisionIndex.placeCollisionBox(y,Pi,nn,new o.pointGeometry(0,0),Z,R,A,q.predicate);return Zn&&Zn.box&&Zn.box.length&&(this.markUsedOrientation(y,Dn,_e),this.placedOrientations[_e.crossTileID]=Dn),Zn};Gi(()=>_i(yi,o.WritingMode.horizontal),()=>{const nn=Re.verticalTextBox;return y.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&nn?(Ai(nn),_i(nn,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ki(vt&&vt.box&&vt.box.length)}}if(Pt=vt,we=Pt&&Pt.box&&Pt.box.length>0,st=Pt&&Pt.offscreen,Ke=Pt&&Pt.occluded,_e.useRuntimeCollisionCircles){const ki=y.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),Gi=o.evaluateSizeForFeature(y.textSizeData,$,ki),_i=w.get("text-padding");Et=this.collisionIndex.placeCollisionCircles(y,Z,ki,y.lineVertexArray,y.glyphOffsetArray,Gi,A,S,P,p,te,q.predicate,_e.collisionCircleDiameter*Gi/o.ONE_EM,_i,this.retainedQueryData[y.bucketInstanceId].tileID),we=Z||Et.circles.length>0&&!Et.collisionDetected,st=st&&Et.offscreen,Ke=Et.occluded}if(Re.iconFeatureIndex&&(Ti=Re.iconFeatureIndex),Re.iconBox){const ki=Gi=>{Ai(Gi);const _i=ce&&Je?qn(Je.x,Je.y,ae,te,this.transform.angle):new o.pointGeometry(0,0),nn=y.getSymbolInstanceIconSize(H,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,nn,Gi,_i,oe,R,A,q.predicate)};kt&&kt.box&&kt.box.length&&Re.verticalIconBox?(Qe=ki(Re.verticalIconBox),fe=Qe.box.length>0):(Qe=ki(Re.iconBox),fe=Qe.box.length>0),st=st&&Qe.offscreen,tt=Qe.occluded}const _n=V||_e.numHorizontalGlyphVertices===0&&_e.numVerticalGlyphVertices===0,Fn=K||_e.numIconVertices===0;if(_n||Fn?Fn?_n||(fe=fe&&we):we=fe&&we:fe=we=fe&&we,we&&Pt&&Pt.box&&this.collisionIndex.insertCollisionBox(Pt.box,w.get("text-ignore-placement"),y.bucketInstanceId,kt&&kt.box&&qt?qt:Bt,q.ID),fe&&Qe&&this.collisionIndex.insertCollisionBox(Qe.box,w.get("icon-ignore-placement"),y.bucketInstanceId,Ti,q.ID),Et&&(we&&this.collisionIndex.insertCollisionCircles(Et.circles,w.get("text-ignore-placement"),y.bucketInstanceId,Bt,q.ID),p)){const ki=y.bucketInstanceId;let Gi=this.collisionCircleArrays[ki];Gi===void 0&&(Gi=this.collisionCircleArrays[ki]=new Ji);for(let _i=0;_i<Et.circles.length;_i+=4)Gi.circles.push(Et.circles[_i+0]),Gi.circles.push(Et.circles[_i+1]),Gi.circles.push(Et.circles[_i+2]),Gi.circles.push(Et.collisionDetected?1:0)}const Nr=y.projection.name!=="globe";Pe=Pe&&(Nr||!Ke),Ae=Ae&&(Nr||!tt),this.placements[_e.crossTileID]=new Mn(we||Pe,fe||Ae,st||y.justReloaded),l[_e.crossTileID]=!0};if(be){const _e=y.getSortedSymbolIndexes(this.transform.angle);for(let Be=_e.length-1;Be>=0;--Be){const Re=_e[Be];Ze(y.symbolInstances.get(Re),Re,y.collisionArrays[Re])}}else for(let _e=n.symbolInstanceStart;_e<n.symbolInstanceEnd;_e++)Ze(y.symbolInstances.get(_e),_e,y.collisionArrays[_e]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[y.bucketInstanceId];o.invert(_e.invProjMatrix,A),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(n,l,p,m){let y;y=m===o.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(l)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of w)A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=y>=0&&A!==y?0:p.crossTileID)}markUsedOrientation(n,l,p){const m=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,y=l===o.WritingMode.vertical?l:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex].filter(A=>A!==-1);for(const A of w)n.text.placedSymbolArray.get(A).placedOrientation=m;p.verticalPlacedTextSymbolIndex!==-1&&(n.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const m=l?l.symbolFadeChange(n):1,y=l?l.opacities:{},w=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const S in this.placements){const P=this.placements[S],D=y[S];D?(this.opacities[S]=new Xo(D,m,P.text,P.icon,null,P.clipped),p=p||P.text!==D.text.placed||P.icon!==D.icon.placed):(this.opacities[S]=new Xo(null,m,P.text,P.icon,P.skipFade,P.clipped),p=p||P.text||P.icon)}for(const S in y){const P=y[S];if(!this.opacities[S]){const D=new Xo(P,m,!1,!1);D.isHidden()||(this.opacities[S]=D,p=p||P.text.placed||P.icon.placed)}}for(const S in w)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=w[S]);for(const S in A)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=A[S]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const p={};for(const m of l){const y=m.getBucket(n);y&&m.latestFeatureIndex&&n.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,m.collisionBoxArray)}}updateBucketOpacities(n,l,p){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const m=n.layers[0].layout,y=!!n.layers[0].dynamicFilter(),w=new Xo(null,0,!1,!1,!0),A=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),P=m.get("text-variable-anchor"),D=m.get("text-rotation-alignment")==="map",R=m.get("text-pitch-alignment")==="map",N=m.get("icon-text-fit")!=="none",W=new Xo(null,0,A&&(S||!n.hasIconData()||m.get("icon-optional")),S&&(A||!n.hasTextData()||m.get("text-optional")),!0);!n.collisionArrays&&p&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(p);const $=(q,V,K)=>{for(let Z=0;Z<V/4;Z++)q.opacityVertexArray.emplaceBack(K)};let H=0;for(let q=0;q<n.symbolInstances.length;q++){const V=n.symbolInstances.get(q),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:Z,crossTileID:oe}=V;let ae=this.opacities[oe];l[oe]?ae=w:ae||(ae=W,this.opacities[oe]=ae),l[oe]=!0;const te=K>0||Z>0,ce=V.numIconVertices>0,be=this.placedOrientations[V.crossTileID],Pe=be===o.WritingMode.vertical,Ae=be===o.WritingMode.horizontal||be===o.WritingMode.horizontalOnly;if(!te&&!ce||ae.isHidden()||H++,te){const Ze=zr(ae.text);$(n.text,K,Pe?Eo:Ze),$(n.text,Z,Ae?Eo:Ze);const _e=ae.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(we=>{we>=0&&(n.text.placedSymbolArray.get(we).hidden=_e||Pe?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=_e||Ae?1:0);const Be=this.variableOffsets[V.crossTileID];Be&&this.markUsedJustification(n,Be.anchor,V,be);const Re=this.placedOrientations[V.crossTileID];Re&&(this.markUsedJustification(n,"left",V,Re),this.markUsedOrientation(n,Re,V))}if(ce){const Ze=zr(ae.icon);V.placedIconSymbolIndex>=0&&($(n.icon,V.numIconVertices,Pe?Eo:Ze),n.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=ae.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&($(n.icon,V.numVerticalIconVertices,Ae?Eo:Ze),n.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ze=n.collisionArrays[q];if(Ze){let _e=new o.pointGeometry(0,0),Be=!0;if(Ze.textBox||Ze.verticalTextBox){if(P){const we=this.variableOffsets[oe];we?(_e=Bn(we.anchor,we.width,we.height,we.textOffset,we.textScale),D&&_e._rotate(R?this.transform.angle:-this.transform.angle)):Be=!1}y&&(Be=!ae.clipped),Ze.textBox&&Ko(n.textCollisionBox.collisionVertexArray,ae.text.placed,!Be||Pe,_e.x,_e.y),Ze.verticalTextBox&&Ko(n.textCollisionBox.collisionVertexArray,ae.text.placed,!Be||Ae,_e.x,_e.y)}const Re=Be&&Boolean(!Ae&&Ze.verticalIconBox);Ze.iconBox&&Ko(n.iconCollisionBox.collisionVertexArray,ae.icon.placed,Re,N?_e.x:0,N?_e.y:0),Ze.verticalIconBox&&Ko(n.iconCollisionBox.collisionVertexArray,ae.icon.placed,!Re,N?_e.x:0,N?_e.y:0)}}}if(n.fullyClipped=H===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=q.invProjMatrix,n.placementViewportMatrix=q.viewportMatrix,n.collisionCircleArray=q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Ko(u,n,l,p,m){u.emplaceBack(n?1:0,l?1:0,p||0,m||0),u.emplaceBack(n?1:0,l?1:0,p||0,m||0),u.emplaceBack(n?1:0,l?1:0,p||0,m||0),u.emplaceBack(n?1:0,l?1:0,p||0,m||0)}const an=Math.pow(2,25),ba=Math.pow(2,24),lu=Math.pow(2,17),wa=Math.pow(2,16),bn=Math.pow(2,9),cu=Math.pow(2,8),uu=Math.pow(2,1);function zr(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const n=u.placed?1:0,l=Math.floor(127*u.opacity);return l*an+n*ba+l*lu+n*wa+l*bn+n*cu+l*uu+n}const Eo=0;class bl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,l,p,m,y){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(w,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,S)=>A.sortKey-S.sortKey));this._currentPartIndex<w.length;){const A=w[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,p,A.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class rm{constructor(n,l,p,m,y,w,A,S){this.placement=new cd(n,y,w,A,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(n,l,p){const m=o.exported.now(),y=()=>{const w=o.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[n[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=A)&&(!w.maxzoom||w.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new bl(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const hu=512/o.EXTENT/2;class ks{constructor(n,l,p){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let m=0;m<l.length;m++){const y=l.get(m),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,n)})}}getScaledCoordinates(n,l){const p=hu/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+n.tileAnchorX)*p),y:Math.floor((l.canonical.y*o.EXTENT+n.tileAnchorY)*p)}}findMatches(n,l,p){const m=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<n.length;y++){const w=n.get(y);if(w.crossTileID)continue;const A=this.indexedSymbolInstances[w.key];if(!A)continue;const S=this.getScaledCoordinates(w,l);for(const P of A)if(Math.abs(P.coord.x-S.x)<=m&&Math.abs(P.coord.y-S.y)<=m&&!p[P.crossTileID]){p[P.crossTileID]=!0,w.crossTileID=P.crossTileID;break}}}}class om{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ud{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const p in this.indexes){const m=this.indexes[p],y={};for(const w in m){const A=m[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),y[A.tileID.key]=A}this.indexes[p]=y}this.lng=n}addBucket(n,l,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const m=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>n.overscaledZ)for(const A in w){const S=w[A];S.tileID.isChildOf(n)&&S.findMatches(l.symbolInstances,n,m)}else{const A=w[n.scaledTo(Number(y)).key];A&&A.findMatches(l.symbolInstances,n,m)}}for(let y=0;y<l.symbolInstances.length;y++){const w=l.symbolInstances.get(y);w.crossTileID||(w.crossTileID=p.generate(),m[w.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new ks(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const p in l.indexedSymbolInstances)for(const m of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[n][m.crossTileID]}removeStaleBuckets(n){let l=!1;for(const p in this.indexes){const m=this.indexes[p];for(const y in m)n[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[y]),delete m[y],l=!0)}return l}}class Yo{constructor(){this.layerIndexes={},this.crossTileIDs=new om,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,p,m){let y=this.layerIndexes[n.id];y===void 0&&(y=this.layerIndexes[n.id]=new ud);let w=!1;const A={};m.name!=="globe"&&y.handleWrapJump(p);for(const S of l){const P=S.getBucket(n);P&&n.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,P,this.crossTileIDs)&&(w=!0),A[P.bucketInstanceId]=!0)}return y.removeStaleBuckets(A)&&(w=!0),w}pruneUnusedLayers(n){const l={};n.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const wr=(u,n)=>o.emitValidationErrors(u,n&&n.filter(l=>l.identifier!=="source.canvas")),wl=o.pick(Lt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),To=o.pick(Lt,["setCenter","setZoom","setBearing","setPitch"]),du={version:8,layers:[],sources:{}},El={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class kr extends o.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new xn(Ot(),this),this.imageManager=new mi,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Yo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const p=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange(m=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,w)=>{if(o.triggerPluginCompletionEvent(y),w&&w.every(A=>A))for(const A in p._sourceCaches){const S=p._sourceCaches[A],P=S.getSource().type;P!=="vector"&&P!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getSource(m.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const A=this._layers[w];A.source===y.id&&this._validateLayer(A)}})}loadURL(n,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const m=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(m,(y,w)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):w&&this._load(w,p)})}loadJSON(n,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(du,!1)}_updateLayerCount(n,l){const p=l?1:-1;n.is3D()&&(this._num3DLayers+=p),n.type==="circle"&&(this._numCircleLayers+=p),n.type==="symbol"&&(this._numSymbolLayers+=p)}_load(n,l){if(l&&wr(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=o.clone$1(n),this._updateMapProjection();for(const m in n.sources)this.addSource(m,n.sources[m],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const p=hi(this.stylesheet.layers);this._order=p.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of p)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new hn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(l,p,m){let y,w,A;const S=o.exported.devicePixelRatio>1?"@2x":"";let P=o.getJSON(p.transformRequest(p.normalizeSpriteURL(l,S,".json"),o.ResourceType.SpriteJSON),(N,W)=>{P=null,A||(A=N,y=W,R())}),D=o.getImage(p.transformRequest(p.normalizeSpriteURL(l,S,".png"),o.ResourceType.SpriteImage),(N,W)=>{D=null,A||(A=N,w=W,R())});function R(){if(A)m(A);else if(y&&w){const N=o.exported.getImageData(w),W={};for(const $ in y){const{width:H,height:q,x:V,y:K,sdf:Z,pixelRatio:oe,stretchX:ae,stretchY:te,content:ce}=y[$],be=new o.RGBAImage({width:H,height:q});o.RGBAImage.copy(N,be,{x:V,y:K},{x:0,y:0},{width:H,height:q}),W[$]={data:be,pixelRatio:oe,sdf:Z,stretchX:ae,stretchY:te,content:ce}}m(null,W)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(p)for(const m in p)this.imageManager.addImage(m,p[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const p=n.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const p of n){const m=this._layers[p];m.type!=="custom"&&l.push(m.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&El[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const w in this._updatedSources){const A=this._updatedSources[w];A==="reload"?this._reloadSource(w):A==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const p={};for(const m in this._sourceCaches){const y=this._sourceCaches[m];p[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];if(y.recalculate(n,this._availableImages),!y.isHidden(n.zoom)){const A=this._getLayerSourceCache(y);A&&(A.used=!0)}const w=this.map.painter;if(w){const A=y.getProgramIds();if(!A)continue;const S=y.getProgramConfiguration(n.zoom);for(const P of A)w.useProgram(P,S)}}for(const m in p){const y=this._sourceCaches[m];p[m]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),wr(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=hi(n.layers);const l=function(m,y){if(!m)return[{command:Lt.setStyle,args:[y]}];let w=[];try{if(!L(m.version,y.version))return[{command:Lt.setStyle,args:[y]}];L(m.center,y.center)||w.push({command:Lt.setCenter,args:[y.center]}),L(m.zoom,y.zoom)||w.push({command:Lt.setZoom,args:[y.zoom]}),L(m.bearing,y.bearing)||w.push({command:Lt.setBearing,args:[y.bearing]}),L(m.pitch,y.pitch)||w.push({command:Lt.setPitch,args:[y.pitch]}),L(m.sprite,y.sprite)||w.push({command:Lt.setSprite,args:[y.sprite]}),L(m.glyphs,y.glyphs)||w.push({command:Lt.setGlyphs,args:[y.glyphs]}),L(m.transition,y.transition)||w.push({command:Lt.setTransition,args:[y.transition]}),L(m.light,y.light)||w.push({command:Lt.setLight,args:[y.light]}),L(m.fog,y.fog)||w.push({command:Lt.setFog,args:[y.fog]}),L(m.projection,y.projection)||w.push({command:Lt.setProjection,args:[y.projection]});const A={},S=[];(function(R,N,W,$){let H;for(H in N=N||{},R=R||{})R.hasOwnProperty(H)&&(N.hasOwnProperty(H)||Ei(H,W,$));for(H in N)N.hasOwnProperty(H)&&(R.hasOwnProperty(H)?L(R[H],N[H])||(R[H].type==="geojson"&&N[H].type==="geojson"&&Qr(R,N,H)?W.push({command:Lt.setGeoJSONSourceData,args:[H,N[H].data]}):bo(H,N,W,$)):wi(H,N,W))})(m.sources,y.sources,S,A);const P=[];m.layers&&m.layers.forEach(R=>{R.source&&A[R.source]?w.push({command:Lt.removeLayer,args:[R.id]}):P.push(R)});let D=m.terrain;D&&A[D.source]&&(w.push({command:Lt.setTerrain,args:[void 0]}),D=void 0),w=w.concat(S),L(D,y.terrain)||w.push({command:Lt.setTerrain,args:[y.terrain]}),function(R,N,W){N=N||[];const $=(R=R||[]).map(eo),H=N.map(eo),q=R.reduce(tn,{}),V=N.reduce(tn,{}),K=$.slice(),Z=Object.create(null);let oe,ae,te,ce,be,Pe,Ae;for(oe=0,ae=0;oe<$.length;oe++)te=$[oe],V.hasOwnProperty(te)?ae++:(W.push({command:Lt.removeLayer,args:[te]}),K.splice(K.indexOf(te,ae),1));for(oe=0,ae=0;oe<H.length;oe++)te=H[H.length-1-oe],K[K.length-1-oe]!==te&&(q.hasOwnProperty(te)?(W.push({command:Lt.removeLayer,args:[te]}),K.splice(K.lastIndexOf(te,K.length-ae),1)):ae++,Pe=K[K.length-oe],W.push({command:Lt.addLayer,args:[V[te],Pe]}),K.splice(K.length-oe,0,te),Z[te]=!0);for(oe=0;oe<H.length;oe++)if(te=H[oe],ce=q[te],be=V[te],!Z[te]&&!L(ce,be))if(L(ce.source,be.source)&&L(ce["source-layer"],be["source-layer"])&&L(ce.type,be.type)){for(Ae in ze(ce.layout,be.layout,W,te,null,Lt.setLayoutProperty),ze(ce.paint,be.paint,W,te,null,Lt.setPaintProperty),L(ce.filter,be.filter)||W.push({command:Lt.setFilter,args:[te,be.filter]}),L(ce.minzoom,be.minzoom)&&L(ce.maxzoom,be.maxzoom)||W.push({command:Lt.setLayerZoomRange,args:[te,be.minzoom,be.maxzoom]}),ce)ce.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?ze(ce[Ae],be[Ae],W,te,Ae.slice(6),Lt.setPaintProperty):L(ce[Ae],be[Ae])||W.push({command:Lt.setLayerProperty,args:[te,Ae,be[Ae]]}));for(Ae in be)be.hasOwnProperty(Ae)&&!ce.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?ze(ce[Ae],be[Ae],W,te,Ae.slice(6),Lt.setPaintProperty):L(ce[Ae],be[Ae])||W.push({command:Lt.setLayerProperty,args:[te,Ae,be[Ae]]}))}else W.push({command:Lt.removeLayer,args:[te]}),Pe=K[K.lastIndexOf(te)+1],W.push({command:Lt.addLayer,args:[be,Pe]})}(P,y.layers,w)}catch(A){console.warn("Unable to compute style diff:",A),w=[{command:Lt.setStyle,args:[y]}]}return w}(this.serialize(),n).filter(m=>!(m.command in To));if(l.length===0)return!1;const p=l.filter(m=>!(m.command in wl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(m=>m.command).join(", ")}.`);return l.forEach(m=>{m.command!=="setTransition"&&m.command!=="setProjection"&&this[m.command].apply(this,m.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,l){return this.getImage(n)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,p={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateSource,`sources.${n}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const m=ye(n,l,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:m.serialize(),sourceId:n}));const y=w=>{const A=(w?"symbol:":"other:")+n,S=this._sourceCaches[A]=new o.SourceCache(A,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[n]=S,S.style=this,S.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(!l)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(n);for(const m of p)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}_getSources(){const n=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&n.push(p.getSource())}return n}addLayer(n,l,p={}){this._checkLoaded();const m=n.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(n.type==="custom"){if(wr(this,o.validateCustomStyleLayer(n)))return;y=o.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(m,n.source),n=o.clone$1(n),n=o.extend(n,{source:m})),this._validate(o.validateLayer,`layers.${m}`,n,{arrayIndex:-1},p))return;y=o.createStyleLayer(n),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const A=this._getLayerSourceCache(y);if(this._removedLayers[m]&&y.source&&A&&y.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",A.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const p=this._order.indexOf(n);this._order.splice(p,1);const m=l?this._order.indexOf(l):this._order.length;l&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,p){this._checkLoaded();const m=this.getLayer(n);m?m.minzoom===l&&m.maxzoom===p||(l!=null&&(m.minzoom=l),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,p={}){this._checkLoaded();const m=this.getLayer(n);if(m){if(!L(m.filter,l))return l==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,l,{layerType:m.type},p)||(m.filter=o.clone$1(l),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const l=this.getLayer(n);return l&&o.clone$1(l.filter)}setLayoutProperty(n,l,p,m={}){this._checkLoaded();const y=this.getLayer(n);y?L(y.getLayoutProperty(l),p)||(y.setLayoutProperty(l,p,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const p=this.getLayer(n);if(p)return p.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,p,m={}){this._checkLoaded();const y=this.getLayer(n);y?L(y.getPaintProperty(l),p)||(y.setPaintProperty(l,p,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){const p=this.getLayer(n);return p&&p.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const p=n.source,m=n.sourceLayer,y=this.getSource(p);if(!y)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=y.type;if(w==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(p);for(const S of A)S.setFeatureState(m,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const p=n.source,m=this.getSource(p);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const y=m.type,w=y==="vector"?n.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(p);for(const S of A)S.removeFeatureState(w,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,p=n.sourceLayer,m=this.getSource(l);if(m){if(m.type!=="vector"||p)return n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();n[p.id]||(n[p.id]=p.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=w=>this._layers[w].type==="fill-extrusion",p={},m=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(l(A)){p[A]=w;for(const S of n){const P=S[A];if(P)for(const D of P)m.push(D)}}}m.sort((w,A)=>A.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(l(A))for(let S=m.length-1;S>=0;S--){const P=m[S].feature;if(p[P.layer.id]<w)break;y.push(P),m.pop()}else for(const S of n){const P=S[A];if(P)for(const D of P)y.push(D.feature)}}return y}queryRenderedFeatures(n,l,p){l&&l.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const m={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of l.layers){const P=this._layers[S];if(!P)return this.fire(new o.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[P.source]=!0}}const y=[];l.availableImages=this._availableImages;const w=l&&l.layers?l.layers.some(S=>{const P=this.getLayer(S);return P&&P.is3D()}):this.has3DLayers(),A=vn.createFromScreenPoints(n,p);for(const S in this._sourceCaches){const P=this._sourceCaches[S].getSource().id;l.layers&&!m[P]||y.push(Ee(this._sourceCaches[S],this._layers,this._serializedLayers,A,l,p,w,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(S,P,D,R,N,W,$){const H={},q=W.queryRenderedSymbols(R),V=[];for(const K of Object.keys(q).map(Number))V.push($[K]);V.sort(dt);for(const K of V){const Z=K.featureIndex.lookupSymbolFeatures(q[K.bucketInstanceId],P,K.bucketIndex,K.sourceLayerIndex,N.filter,N.layers,N.availableImages,S);for(const oe in Z){const ae=H[oe]=H[oe]||[],te=Z[oe];te.sort((ce,be)=>{const Pe=K.featureSortOrder;if(Pe){const Ae=Pe.indexOf(ce.featureIndex);return Pe.indexOf(be.featureIndex)-Ae}return be.featureIndex-ce.featureIndex});for(const ce of te)ae.push(ce)}}for(const K in H)H[K].forEach(Z=>{const oe=Z.feature,ae=D(S[K]).getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ae});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(n,l){l&&l.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(n);let m=[];for(const y of p)m=m.concat(Ue(y,l));return m}addSourceType(n,l,p){return kr.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(kr.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const w in n)if(!L(n[w],p[w])){m=!0;break}if(!m)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,l),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof n.source=="object"){const p="terrain-dem-src";this.addSource(p,n.source),n=o.clone$1(n),n=o.extend(n,{source:p})}if(this._validate(o.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(n,l);else{const p=this.terrain,m=p.get();for(const y of Object.keys(o.spec.terrain))!n.hasOwnProperty(y)&&o.spec.terrain[y].default&&(n[y]=o.spec.terrain[y].default);for(const y in n)if(!L(n[y],m[y])){p.set(n),this.stylesheet.terrain=n;const w=this._setTransitionParameters({duration:0});p.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Ki(n,this.map.transform);this.stylesheet.fog=n;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(n).length===0&&l.set(n);for(const m in n)if(!L(n[m],p[m])){l.set(n),this.stylesheet.fog=n;const y=this._setTransitionParameters({duration:0});l.updateTransitions(y);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:o.exported.now(),transition:o.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const p=this.terrain=new Jt(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});p.updateTransitions(m)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,p,m,y={}){return(!y||y.validate!==!1)&&wr(this,n.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:p,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const p of l)p.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,p,m,y=!1){let w=!1,A=!1;const S={};for(const P of this._order){const D=this._layers[P];if(D.type!=="symbol")continue;if(!S[D.source]){const N=this._getLayerSourceCache(D);if(!N)continue;S[D.source]=N.getRenderableIds(!0).map(W=>N.getTileByID(W)).sort((W,$)=>$.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan($.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(D,S[D.source],n.center.lng,n.projection);w=w||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new rm(n,this._order,y,l,p,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),A=!0),w&&this.pauseablePlacement.placement.setStale()),A||w)for(const P of this._order){const D=this._layers[P];D.type==="symbol"&&this.placement.updateLayerOpacities(D,S[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const m=y=>{y&&y.setDependencies(l.tileID.key,l.type,l.icons)};m(this._otherSourceCaches[l.source]),m(this._symbolSourceCaches[l.source])}getGlyphs(n,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(n,l,p){return o.makeRequest(l,p)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this._getSourceCaches(n);return l.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}kr.getSourceType=function(u){return ve[u]},kr.setSourceType=function(u,n){ve[u]=n},kr.registerForPluginStateChange=o.registerForPluginStateChange;var hd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Tl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,pu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let fu={},mu={};const Jo=[];Or(hd,Jo),Or(dd,Jo),Or(pu,Jo),Or(pd,Jo),fu=di("",dd),mu=di(pd,pu);const _u=di(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),gu=hd,Al=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var yu={background:di(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:di("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:di(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:di(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:di(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:di(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:di(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Tl),skyboxGradient:di(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Tl),skyboxCapture:di(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:di(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Or(u,n){const l=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=p.split(" ");for(const y of m)n.includes(y)||n.push(y)}}function di(u,n){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),m={},y=[...Jo];return Or(u,y),Or(n,y),{fragmentSource:u=u.replace(l,(w,A,S,P,D)=>(m[D]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${S} ${P} ${D};
#else
uniform ${S} ${P} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${S} ${P} ${D} = u_${D};
#endif
`)),vertexSource:n=n.replace(l,(w,A,S,P,D)=>{const R=P==="float"?"vec2":"vec4",N=D.match(/color/)?"color":R;return m[D]?A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${R} a_${D};
varying ${S} ${P} ${D};
#else
uniform ${S} ${P} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${S} ${P} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${S} ${P} ${D} = u_${D};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${R} a_${D};
#else
uniform ${S} ${P} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${P} ${D} = a_${D};
#else
    ${S} ${P} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${P} ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${S} ${P} ${D} = u_${D};
#endif
`}),staticAttributes:p,usedDefines:y}}class Ea{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,p,m,y,w,A){this.context=n;let S=this.boundPaintVertexBuffers.length!==m.length;for(let D=0;!S&&D<m.length;D++)this.boundPaintVertexBuffers[D]!==m[D]&&(S=!0);let P=this.boundDynamicVertexBuffers.length!==A.length;for(let D=0;!P&&D<A.length;D++)this.boundDynamicVertexBuffers[D]!==A[D]&&(P=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||S||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(l,p,m,y,w,A);else{n.bindVertexArrayOES.set(this.vao);for(const D of A)D&&D.bind();y&&y.dynamicDraw&&y.bind()}}freshBind(n,l,p,m,y,w){let A;const S=n.numAttributes,P=this.context,D=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w;else{A=P.currentNumAttributes||0;for(let R=S;R<A;R++)D.disableVertexAttribArray(R)}l.enableAttributes(D,n),l.bind(),l.setVertexAttribPointers(D,n,y);for(const R of p)R.enableAttributes(D,n),R.bind(),R.setVertexAttribPointers(D,n,y);for(const R of w)R&&(R.enableAttributes(D,n),R.bind(),R.setVertexAttribPointers(D,n,y));m&&m.bind(),P.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Sl(u,n){const l=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new o.MercatorCoordinate(0,p/l).toLngLat().lat,new o.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Cl(u,n,l,p,m,y,w){const A=u.context,S=A.gl,P=l.fbo;if(!P)return;u.prepareDrawTile();const D=u.useProgram("hillshade");A.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment.get());const R=((H,q,V,K)=>{const Z=V.paint.get("hillshade-shadow-color"),oe=V.paint.get("hillshade-highlight-color"),ae=V.paint.get("hillshade-accent-color");let te=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(te-=H.transform.angle);const ce=!H.options.moving;return{u_matrix:K||H.transform.calculateProjMatrix(q.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Sl(0,q.tileID),u_light:[V.paint.get("hillshade-exaggeration"),te],u_shadow:Z,u_highlight:oe,u_accent:ae}})(u,l,p,u.terrain?n.projMatrix:null);u.prepareDrawProgram(A,D,n.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:W,tileBoundsSegments:$}=u.getTileBoundsBuffers(l);D.draw(A,S.TRIANGLES,m,y,w,o.CullFaceMode.disabled,R,p.id,N,W,$)}function Il(u,n,l){if(!n.needsDEMTextureUpload)return;const p=u.context,m=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||u.getTileTexture(l.stride);const y=l.getPixels();n.demTexture?n.demTexture.update(y,{premultiply:!1}):n.demTexture=new o.Texture(p,y,m.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function fd(u,n,l,p,m,y){const w=u.context,A=w.gl;if(!n.dem)return;const S=n.dem;if(w.activeTexture.set(A.TEXTURE1),Il(u,n,S),!n.demTexture)return;n.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const P=S.dim;w.activeTexture.set(A.TEXTURE0);let D=n.fbo;if(!D){const $=new o.Texture(w,{width:P,height:P,data:null},A.RGBA);$.bind(A.LINEAR,A.CLAMP_TO_EDGE),D=n.fbo=w.createFramebuffer(P,P,!0),D.colorAttachment.set($.texture)}w.bindFramebuffer.set(D.framebuffer),w.viewport.set([0,0,P,P]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:W}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(w,A.TRIANGLES,p,m,y,o.CullFaceMode.disabled,(($,H)=>{const q=H.stride,V=o.create();return o.ortho(V,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(V,V,[0,-o.EXTENT,0]),{u_matrix:V,u_image:1,u_dimension:[q,q],u_zoom:$.overscaledZ,u_unpack:H.unpackVector}})(n.tileID,S),l.id,R,N,W),n.needsHillshadePrepare=!1}const Ml=u=>({u_matrix:new o.UniformMatrix4f(u),u_image0:new o.Uniform1i(u),u_skirt_height:new o.Uniform1f(u)}),vu=(u,n)=>({u_matrix:u,u_image0:0,u_skirt_height:n}),Pl=(u,n,l,p,m,y,w,A,S,P,D,R,N,W)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:A,u_frustum_br:S,u_frustum_bl:P,u_globe_pos:D,u_globe_radius:R,u_viewport:N,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9)});function Ta(u,n){return u!=null&&n!=null&&!(!u.hasData()||!n.hasData())&&u.demTexture!=null&&n.demTexture!=null&&u.tileID.key!==n.tileID.key}const Ao=new class{constructor(){this.operations={}}newMorphing(u,n,l,p,m){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[u]={startTime:p,phase:0,duration:m,from:n,to:l,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const n=this.operations[u];return{from:n.from,to:n.to,phase:n.phase}}update(u){for(const n in this.operations){const l=this.operations[n];for(l.phase=(u-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,u)){delete this.operations[n];break}}}_nextOp(u,n){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=n,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Os={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ai(u,n){const l=1<<u.z;return!n&&(u.x===0||u.x===l-1)||u.y===0||u.y===l-1}const Rs=u=>({u_matrix:u});function xu(u,n,l,p,m){if(m>0){const y=o.exported.now(),w=(y-u.timeAdded)/m,A=n?(y-n.timeAdded)/m:-1,S=l.getSource(),P=p.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-P)>Math.abs(u.tileID.overscaledZ-P),R=D&&u.refreshedUponExpiration?1:o.clamp(D?w:1-A,0,1);return u.refreshedUponExpiration&&w>=1&&(u.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class md extends o.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new xn(Ot(),null),m=ye("mock-dem",l,p,n.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class _d extends o.SourceCache{constructor(n){const l=ye("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new xn(Ot(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,p){if(n.freezeTileCoverage)return;this.transform=n;const m=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const A=new o.Tile(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);A.state="loaded",this._tiles[w.key]=A}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Dl extends o.OverscaledTileID{constructor(n,l,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class gd extends o.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,m,y]=function(S){const P=new o.StructArrayLayout4i8,D=new o.StructArrayLayout3ui6,R=131;P.reserve(17161),D.reserve(33800);const N=o.EXTENT/128,W=o.EXTENT+N/2,$=W+N;for(let q=-N;q<$;q+=N)for(let V=-N;V<$;V+=N){const K=V<0||V>W||q<0||q>W?24575:0,Z=o.clamp(Math.round(V),0,o.EXTENT),oe=o.clamp(Math.round(q),0,o.EXTENT);P.emplaceBack(Z+K,oe,Z,oe)}const H=(q,V)=>{const K=V*R+q;D.emplaceBack(K+1,K,K+R),D.emplaceBack(K+R,K+R+1,K+1)};for(let q=1;q<129;q++)for(let V=1;V<129;V++)H(V,q);return[0,129].forEach(q=>{for(let V=0;V<130;V++)H(V,q),H(q,V)}),[P,D,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(p,o.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,p.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,p.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _d(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const A=w.gl;this._overlapStencilMode=new o.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new md(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,l,p){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const m=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(l,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=l.getIds().map(S=>{const P=l.getTileByID(S).tileID;return P.projMatrix=p.calculateProjMatrix(P.toUnwrapped()),P});(function(S,P){const D=P.transform.pointCoordinate(P.transform.getCameraPoint()),R=new o.pointGeometry(D.x,D.y);S.sort((N,W)=>{if(W.overscaledZ-N.overscaledZ)return W.overscaledZ-N.overscaledZ;const $=new o.pointGeometry(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),H=new o.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),q=R.mult(1<<N.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr($)-q.distSqr(H)})})(m,this.painter),this._previousZoom=p.zoom;const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const S in w){const P=w[S];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,n[S],y),P.usedForTerrain))continue;const D=n[S];P.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[l.id]=m.map(S=>new Dl(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const A={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const P=this.terrainTileForTile[S.key];if(!P)continue;const D=P.tileID.key;D in A||(this._visibleDemTiles.push(P),A[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const p in this.terrainTileForTile){const m=this.terrainTileForTile[p],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),Il(this.painter,m,y))}}_prepareDemTileUniforms(n,l,p,m){if(!l||l.demTexture==null)return!1;const y=n.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-y.z),A=m||"";return p[`u_dem_tl${A}`]=[y.x*w%1,y.y*w%1],p[`u_dem_scale${A}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const p=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(n,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((p,m)=>{if(!m.dem)return p;const y=m.dem.tree.minimums[0];return y>0&&n++,p+y},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(n,m,l.RGBA,{premultiply:!1}),y}setupElevationDraw(n,l,p){const m=this.painter.context,y=m.gl,w=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();let S=null,P=null,D=1;if(p&&p.morphing&&this._useVertexMorphing){const R=p.morphing.srcDemTile,N=p.morphing.dstDemTile;D=p.morphing.phase,R&&N&&(this._prepareDemTileUniforms(n,R,w,"_prev")&&(P=R),this._prepareDemTileUniforms(n,N,w)&&(S=N))}if(P&&S?(m.activeTexture.set(y.TEXTURE2),S.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),m.activeTexture.set(y.TEXTURE4),P.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),w.u_dem_lerp=D):(S=this.terrainTileForTile[n.tileID.key],m.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(n,S,w)?S.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),m.activeTexture.set(y.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&S){const R=(1<<S.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=R}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(m,w),this.painter.transform.projection.name==="globe"){const R=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(m,R)}}globeUniformValues(n,l,p){const m=n.projection;return{u_tile_tl_up:m.upVector(l,0,0),u_tile_tr_up:m.upVector(l,o.EXTENT,0),u_tile_br_up:m.upVector(l,o.EXTENT,o.EXTENT),u_tile_bl_up:m.upVector(l,0,o.EXTENT),u_tile_up_scale:p?o.GLOBE_METERS_TO_ECEF:m.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,w,A,S){if(m.transform.projection.name==="globe")(function(P,D,R,N,W){const $=P.context,H=$.gl;let q,V;const K=P.options.showTerrainWireframe?2:0,Z=P.transform,oe=o.globeUseCustomAntiAliasing(P,$,Z),ae=(we,fe)=>{if(V===we)return;const st=[Os[we],"PROJECTION_GLOBE_VIEW"];oe&&st.push("CUSTOM_ANTIALIASING"),fe&&st.push(Os[K]),q=P.useProgram("globeRaster",null,st),V=we},te=P.colorModeForRenderPass(),ce=new o.DepthMode(H.LEQUAL,o.DepthMode.ReadWrite,P.depthRangeFor3D);Ao.update(W);const be=o.calculateGlobeMercatorMatrix(Z),Pe=[o.mercatorXfromLng(Z.center.lng),o.mercatorYfromLat(Z.center.lat)],Ae=K?[!1,!0]:[!1],Ze=P.globeSharedBuffers,_e=[Z.width*o.exported.devicePixelRatio,Z.height*o.exported.devicePixelRatio],Be=Float32Array.from(Z.globeMatrix),Re={useDenormalizedUpVectorScale:!0};if(Ae.forEach(we=>{V=-1;const fe=we?H.LINES:H.TRIANGLES;for(const st of N){const Ke=R.getTile(st),tt=o.StencilMode.disabled,Je=D.prevTerrainTileForTile[st.key],vt=D.terrainTileForTile[st.key];Ta(Je,vt)&&Ao.newMorphing(st.key,Je,vt,W,250),$.activeTexture.set(H.TEXTURE0),Ke.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const kt=Ao.getMorphValuesForProxy(st.key),Pt=kt?1:0;kt&&o.extend$1(Re,{morphing:{srcDemTile:kt.from,dstDemTile:kt.to,phase:o.easeCubicInOut(kt.phase)}});const Et=o.tileCornersToBounds(st.canonical),Qe=o.getLatitudinalLod(Et.getCenter().lat),Bt=o.getGridMatrix(st.canonical,Et,Qe,Z.worldSize/Z._pixelsPerMercatorPixel),qt=o.globeNormalizeECEF(o.globeTileBounds(st.canonical)),Ti=Pl(Z.projMatrix,Be,be,qt,o.globeToMercatorTransition(Z.zoom),Pe,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,_e,Bt);if(ae(Pt,we),D.setupElevationDraw(Ke,q,Re),P.prepareDrawProgram($,q,st.toUnwrapped()),Ze){const[Ai,yi,_n]=we?Ze.getWirefameBuffers(P.context,Qe):Ze.getGridBuffers(Qe);q.draw($,fe,ce,tt,te,o.CullFaceMode.backCCW,Ti,"globe_raster",Ai,yi,_n)}}}),Ze){const we=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&we.push("CUSTOM_ANTIALIASING"),q=P.useProgram("globeRaster",null,we);for(const fe of N){const{x:st,y:Ke,z:tt}=fe.canonical,Je=Ke===0,vt=Ke===(1<<tt)-1,[kt,Pt,Et,Qe]=Ze.getPoleBuffers(tt);if(Qe&&(Je||vt)){const Bt=R.getTile(fe);$.activeTexture.set(H.TEXTURE0),Bt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let qt=o.globePoleMatrixForTile(tt,st,Z);const Ti=o.globeNormalizeECEF(o.globeTileBounds(fe.canonical)),Ai=(yi,_n)=>yi.draw($,H.TRIANGLES,ce,o.StencilMode.disabled,te,o.CullFaceMode.disabled,Pl(Z.projMatrix,qt,qt,Ti,0,Pe,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,_e),"globe_pole_raster",_n,Et,Qe);D.setupElevationDraw(Bt,q,Re),P.prepareDrawProgram($,q,fe.toUnwrapped()),Je&&Ai(q,kt),vt&&(qt=o.scale(o.create(),qt,[1,-1,1]),Ai(q,Pt))}}}})(m,y,w,A,S);else{const P=m.context,D=P.gl;let R,N;const W=m.options.showTerrainWireframe?2:0,$=(Z,oe)=>{if(N===Z)return;const ae=[Os[Z]];oe&&ae.push(Os[W]),R=m.useProgram("terrainRaster",null,ae),N=Z},H=m.colorModeForRenderPass(),q=new o.DepthMode(D.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);Ao.update(S);const V=m.transform,K=6*Math.pow(1.5,22-V.zoom)*y.exaggeration();(W?[!1,!0]:[!1]).forEach(Z=>{N=-1;const oe=Z?D.LINES:D.TRIANGLES,[ae,te]=Z?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const ce of A){const be=w.getTile(ce),Pe=o.StencilMode.disabled,Ae=y.prevTerrainTileForTile[ce.key],Ze=y.terrainTileForTile[ce.key];Ta(Ae,Ze)&&Ao.newMorphing(ce.key,Ae,Ze,S,250),P.activeTexture.set(D.TEXTURE0),be.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const _e=Ao.getMorphValuesForProxy(ce.key),Be=_e?1:0;let Re;_e&&(Re={morphing:{srcDemTile:_e.from,dstDemTile:_e.to,phase:o.easeCubicInOut(_e.phase)}});const we=vu(ce.projMatrix,ai(ce.canonical,V.renderWorldCopies)?K/10:K);$(Be,Z),y.setupElevationDraw(be,R,Re),m.prepareDrawProgram(P,R,ce.toUnwrapped()),R.draw(P,oe,q,Pe,H,o.CullFaceMode.backCCW,we,"terrain_raster",y.gridBuffer,ae,te)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),A=[],S=l.style.order;let P=0;for(const D of y){const R=m.getTileByID(D.proxyTileKey),N=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][n]:void 0,W=N!==void 0?m.renderCache[N]:this.pool[P++],$=N!==void 0;if(R.texture=W.tex,$&&!W.dirty){A.push(R.tileID);continue}let H;p.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(p.clear({color:o.Color.transparent,stencil:0}),W.dirty=!1);for(let q=w.start;q<=w.end;++q){const V=l.style._layers[S[q]];if(V.isHidden(l.transform.zoom))continue;const K=l.style._getLayerSourceCache(V),Z=K?this.proxyToSource[D.key][K.id]:[D];if(!Z)continue;const oe=Z;p.viewport.set([0,0,W.fb.width,W.fb.height]),H!==(K?K.id:null)&&(this._setupStencil(W,Z,V,K),H=K?K.id:null),l.renderLayer(l,K,V,oe)}this.renderedToTile?(W.dirty=!0,A.push(R.tileID)):$||--P,P===5&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(l===0)return{efficiency:100};let p,m=0,y=0,w=!1;for(let A=0;A<l;++A){const S=n._layers[n.order[A]];this._style.isLayerDraped(S)?(w&&++m,++y):w||(w=!0,p=S.id)}return y===0?{efficiency:100}:{efficiency:100*(1-m/y),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,p){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,A=1<<w.overscaledZ,{x:S,y:P}=w.canonical,D=S/A,R=(S+1)/A,N=P/A,W=(P+1)/A;return{minx:D,miny:N,maxx:R,maxy:W,t:y.dem.tree.raycastRoot(D,N,R,W,n,l,p),tile:y}});m.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,n,l,p);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,l=n.gl,p=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const m=new o.Texture(n,{width:p[0],height:p[1],data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=n.createFramebuffer(p[0],p[1],!1);return y.colorAttachment.set(m.texture),y.depthAttachment=new Ho(n,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],p=l.isHidden(this.painter.transform.zoom),m=l.getCrossfadeParameters(),y=!!m&&m.t!==1,w=l.hasTransition();return l.type!=="custom"&&!p&&(y||w)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof F){n=!0;break}if(n)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],m=p.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(p);if(p.type!=="raster"||m||!y)continue;const w=p.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const S=this.proxyToSource[A.key][y.id];if(S)for(const P of S){const D=xu(y.getTile(P),y.findLoadedParent(P,0),y,this.painter.transform,w);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,P)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const p=[];let m,y=0,w=this._style._layers[n[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<l;)w=this._style._layers[n[y]];for(;y<l;++y){const A=this._style._layers[n[y]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?m===void 0&&(m=y):m!==void 0&&(p.push({start:m,end:y-1}),m=void 0))}m!==void 0&&p.push({start:m,end:y-1}),this._drapedRenderBatches=p}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<w.length;++A){const S=Object.values(w[A]);l.renderCachePool.push(...S)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,m=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const A=p[w];if(l.getTileByID(A.key),l.proxyCachedFBO[A.key]!==void 0){const S=n[A.key],P=this.proxyToSource[A.key];let D=0;for(const R in P){const N=P[R],W=S[R];if(!W||W.length!==N.length||N.some(($,H)=>$!==W[H]||m[R]&&m[R].hasOwnProperty($.key))){D=-1;break}++D}for(const R in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][R]].dirty=D<0||D!==Object.values(S).length}}const y=[...this._drapedRenderBatches];y.sort((w,A)=>A.end-A.start-(w.end-w.start));for(const w of y)for(const A of p){if(l.proxyCachedFBO[A.key])continue;let S=l.renderCachePool.pop();S===void 0&&l.renderCache.length<50&&(S=l.renderCache.length,l.renderCache.push(this._createFBO())),S!==void 0&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][w.start]=S,l.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,p,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,l){const p=this.painter,m=this.painter.context,y=m.gl;p._tileClippingMaskIDs={},m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const w=p.useProgram("clippingMask");for(const A of n){const S=p._tileClippingMaskIDs[A.key]=--l;w.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},S,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Rs(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const p=[n.x,n.y,1,1];o.transformMat4$1(p,p,l.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const m=l._camera.position,y=o.mercatorZfromAltitude(1,l.center.lat),w=[m[0],m[1],m[2]/y,0],A=o.subtract([],p.slice(0,3),w);o.normalize(A,A);const S=this.raycast(w,A,this._exaggeration);return S!==null&&S?(o.scaleAndAdd(w,w,A,S),w[3]=w[2],w[2]*=y,w):null}drawDepth(){const n=this.painter,l=n.context,p=this.proxySourceCache,m=Math.ceil(n.width),y=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=l.gl,A=l.createFramebuffer(m,y,!0);l.activeTexture.set(w.TEXTURE0);const S=new o.Texture(l,{width:m,height:y,data:null},w.RGBA);S.bind(w.NEAREST,w.CLAMP_TO_EDGE),A.colorAttachment.set(S.texture);const P=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,m,y);A.depthAttachment.set(P),this._depthFBO=A,this._depthTexture=S}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,m,y]),function(w,A,S,P){if(w.transform.projection.name==="globe")return;const D=w.context,R=D.gl;D.clear({depth:1});const N=w.useProgram("terrainDepth"),W=new o.DepthMode(R.LESS,o.DepthMode.ReadWrite,w.depthRangeFor3D);for(const $ of P){const H=S.getTile($),q=vu($.projMatrix,0);A.setupElevationDraw(H,N),N.draw(D,R.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,q,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(n,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,p){if(n.getSource()instanceof ue)return this._setupProxiedCoordsForImageSource(n,l,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const m=this.proxiedCoords[n.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){const S=y[A],P=this._findTileCoveringTileID(S,n);if(P){const D=this._createProxiedId(S,P,p[S.key]&&p[S.key][n.id]);m.push(D),this.proxyToSource[S.key][n.id]=[D]}}let w=!1;for(let A=0;A<l.length;A++){const S=n.getTile(l[A]);if(!S||!S.hasData())continue;const P=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==S.tileID.canonical.z){const D=this.proxyToSource[P.tileID.key][n.id],R=this._createProxiedId(P.tileID,S,p[P.tileID.key]&&p[P.tileID.key][n.id]);D?D.splice(D.length-1,0,R):this.proxyToSource[P.tileID.key][n.id]=[R],m.push(R),w=!0}}this._sourceTilesOverlap[n.id]=w}_setupProxiedCoordsForImageSource(n,l,p){if(!n.getSource().loaded())return;const m=this.proxiedCoords[n.id]=[],y=this.proxyCoords,w=n.getSource(),A=new o.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),S=w.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((D,R)=>(D.min.x=Math.min(D.min.x,R.x-A.x),D.min.y=Math.min(D.min.y,R.y-A.y),D.max.x=Math.max(D.max.x,R.x-A.x),D.max.y=Math.max(D.max.y,R.y-A.y),D),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(D,R)=>{const N=D.wrap+D.canonical.x/(1<<D.canonical.z),W=D.canonical.y/(1<<D.canonical.z),$=o.EXTENT/(1<<D.canonical.z),H=R.wrap+R.canonical.x/(1<<R.canonical.z),q=R.canonical.y/(1<<R.canonical.z);return N+$<H+S.min.x||N>H+S.max.x||W+$<q+S.min.y||W>q+S.max.y};for(let D=0;D<y.length;D++){const R=y[D];for(let N=0;N<l.length;N++){const W=n.getTile(l[N]);if(!W||!W.hasData()||P(R,W.tileID))continue;const $=this._createProxiedId(R,W,p[R.key]&&p[R.key][n.id]),H=this.proxyToSource[R.key][n.id];H?H.push($):this.proxyToSource[R.key][n.id]=[$],m.push($)}}}_createProxiedId(n,l,p){let m=this.orthoMatrix;if(p){const y=p.find(w=>w.key===l.tileID.key);if(y)return y}if(l.tileID.key!==n.key){const y=n.canonical.z-l.tileID.canonical.z;let w,A,S;m=o.create();const P=l.tileID.wrap-n.wrap<<n.overscaledZ;y>0?(w=o.EXTENT>>y,A=w*((l.tileID.canonical.x<<y)-n.canonical.x+P),S=w*((l.tileID.canonical.y<<y)-n.canonical.y)):(w=o.EXTENT<<-y,A=o.EXTENT*(l.tileID.canonical.x-(n.canonical.x+P<<-y)),S=o.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-y))),o.ortho(m,0,w,0,w,0,1),o.translate(m,m,[A,S,0])}return new Dl(l.tileID,n.key,m)}_findTileCoveringTileID(n,l){let p=l.getTile(n);if(p&&p.hasData())return p;const m=this._findCoveringTileCache[l.id],y=m[n.key];if(p=y?l.getTileByID(y):null,p&&p.hasData()||y===null)return p;let w=p?p.tileID:n,A=w.overscaledZ;const S=l.getSource().minzoom,P=[];if(!y){const R=l.getSource().maxzoom;if(n.canonical.z>=R){const N=n.canonical.z-R;l.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,l.transform.tileZoom),w=new o.OverscaledTileID(A,n.wrap,R,n.canonical.x>>N,n.canonical.y>>N)):N!==0&&(A=R,w=new o.OverscaledTileID(A,n.wrap,R,n.canonical.x>>N,n.canonical.y>>N))}w.key!==n.key&&(P.push(w.key),p=l.getTile(w))}const D=R=>{P.forEach(N=>{m[N]=R}),P.length=0};for(A-=1;A>=S&&(!p||!p.hasData());A--){p&&D(p.tileID.key);const R=w.calculateScaledKey(A);if(p=l.getTileByID(R),p&&p.hasData())break;const N=m[R];if(N===null)break;N===void 0?P.push(R):p=l.getTileByID(N)}return D(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let p=0;const m=new o.StructArrayLayout2ui4,y=131;for(let w=1;w<129;w++){for(let A=1;A<129;A++)p=w*y+A,m.emplaceBack(p,p+1),m.emplaceBack(p,p+y),m.emplaceBack(p+1,p+y),w===128&&m.emplaceBack(p+y,p+y+1);m.emplaceBack(p+1,p+1+y)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class yd{static cacheKey(n,l,p,m){let y=`${l}${m?m.cacheKey:""}`;for(const w of p)n.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(n,l,p,m,y,w){const A=n.gl;this.program=A.createProgram();const S=function(q){const V=[];for(let K=0;K<q.length;K++){if(q[K]===null)continue;const Z=q[K].split(" ");V.push(Z.pop())}return V}(p.staticAttributes),P=m?m.getBinderAttributes():[],D=S.concat(P);let R=m?m.defines():[];R=R.concat(w.map(q=>`#define ${q}`));const N=R.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Al):Al,Al,gu,_u.fragmentSource,mu.fragmentSource,p.fragmentSource).join(`
`),W=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,gu,_u.vertexSource,mu.vertexSource,fu.vertexSource,p.vertexSource).join(`
`),$=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource($,N),A.compileShader($),A.attachShader(this.program,$);const H=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(H,W),A.compileShader(H),A.attachShader(this.program,H),this.attributes={},this.numAttributes=D.length;for(let q=0;q<this.numAttributes;q++)D[q]&&(A.bindAttribLocation(this.program,q,D[q]),this.attributes[D[q]]=q);A.linkProgram(this.program),A.deleteShader(H),A.deleteShader($),this.fixedUniforms=y(n),this.binderUniforms=m?m.getUniforms(n):[],w.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new o.Uniform1i(q),u_dem_prev:new o.Uniform1i(q),u_dem_unpack:new o.Uniform4f(q),u_dem_tl:new o.Uniform2f(q),u_dem_scale:new o.Uniform1f(q),u_dem_tl_prev:new o.Uniform2f(q),u_dem_scale_prev:new o.Uniform1f(q),u_dem_size:new o.Uniform1f(q),u_dem_lerp:new o.Uniform1f(q),u_exaggeration:new o.Uniform1f(q),u_depth:new o.Uniform1i(q),u_depth_size_inv:new o.Uniform2f(q),u_meter_to_dem:new o.Uniform1f(q),u_label_plane_matrix_inv:new o.UniformMatrix4f(q)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new o.Uniform3f(q),u_tile_tr_up:new o.Uniform3f(q),u_tile_br_up:new o.Uniform3f(q),u_tile_bl_up:new o.Uniform3f(q),u_tile_up_scale:new o.Uniform1f(q)}))(n)),w.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new o.UniformMatrix4f(q),u_fog_range:new o.Uniform2f(q),u_fog_color:new o.Uniform4f(q),u_fog_horizon_blend:new o.Uniform1f(q),u_fog_temporal_offset:new o.Uniform1f(q),u_frustum_tl:new o.Uniform3f(q),u_frustum_tr:new o.Uniform3f(q),u_frustum_br:new o.Uniform3f(q),u_frustum_bl:new o.Uniform3f(q),u_globe_pos:new o.Uniform3f(q),u_globe_radius:new o.Uniform1f(q),u_globe_transition:new o.Uniform1f(q),u_is_globe:new o.Uniform1i(q),u_viewport:new o.Uniform2f(q)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in l)p[m]&&p[m].set(this.program,m,l[m])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in l)p[m]&&p[m].set(this.program,m,l[m])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in l)p[m].set(this.program,m,l[m])}}draw(n,l,p,m,y,w,A,S,P,D,R,N,W,$,H){const q=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(p),n.setStencilMode(m),n.setColorMode(y),n.setCullFace(w);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,A[K]);$&&$.setUniforms(this.program,n,this.binderUniforms,N,{zoom:W});const V={[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[l];for(const K of R.get()){const Z=K.vaos||(K.vaos={});(Z[S]||(Z[S]=new Ea)).bind(n,this,P,$?$.getPaintVertexBuffers():[],D,K.vertexOffset,H||[]),q.drawElements(l,K.primitiveLength*V,q.UNSIGNED_SHORT,K.primitiveOffset*V*2)}}}function vd(u,n,l){const p=1/dn(l,1,n.transform.tileZoom),m=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,n.transform.tileZoom)/m,w=y*(l.tileID.canonical.x+l.tileID.wrap*m),A=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A]}}const bu=o.create(),Ll=(u,n,l,p,m,y,w,A,S,P,D)=>{const R=n.style.light,N=R.properties.get("position"),W=[N.x,N.y,N.z],$=o.create$1();R.properties.get("anchor")==="viewport"&&(o.fromRotation($,-n.transform.angle),o.transformMat3(W,W,$));const H=R.properties.get("color"),q=n.transform,V={u_matrix:u,u_lightpos:W,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:y};return q.projection.name==="globe"&&(V.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],V.u_zoom_transition=S,V.u_inv_rot_matrix=D,V.u_merc_center=P,V.u_up_dir=q.projection.upVector(new o.CanonicalTileID(0,0,0),P[0]*o.EXTENT,P[1]*o.EXTENT),V.u_height_lift=A),V},wu=(u,n,l,p,m,y,w,A,S,P,D,R,N)=>{const W=Ll(u,n,l,p,m,y,w,P,D,R,N),$={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return o.extend(W,vd(A,n,S),$)},zl=u=>({u_matrix:u}),Eu=(u,n,l,p)=>o.extend(zl(u),vd(l,n,p)),xd=(u,n)=>({u_matrix:u,u_world:n}),sm=(u,n,l,p,m)=>o.extend(Eu(u,n,l,p),{u_world:m}),Aa=o.create(),Sa=(u,n,l,p,m,y)=>{const w=u.transform,A=w.projection.name==="globe";let S;if(y.paint.get("circle-pitch-alignment")==="map")if(A){const D=o.globePixelsToTileUnits(w.zoom,n.canonical)*w._pixelsPerMercatorPixel;S=Float32Array.from([D,0,0,D])}else S=w.calculatePixelsToTileUnitsMatrix(l);else S=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:u.translatePosMatrix(n.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Aa,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){P.u_inv_rot_matrix=p,P.u_merc_center=m,P.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],P.u_zoom_transition=o.globeToMercatorTransition(w.zoom);const D=m[0]*o.EXTENT,R=m[1]*o.EXTENT;P.u_up_dir=w.projection.upVector(new o.CanonicalTileID(0,0,0),D,R)}return P},bd=u=>{const n=[];return u.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},kl=(u,n,l,p)=>{const m=o.EXTENT/l.tileSize;return{u_matrix:u,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},Ol=(u,n,l=1)=>({u_matrix:u,u_color:n,u_overlay:0,u_overlay_scale:l}),Rr=o.create(),Tu=(u,n,l,p,m,y,w)=>{const A=u.transform,S=A.projection.name==="globe",P=S?o.globePixelsToTileUnits(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:dn(l,1,y),D={u_matrix:n.projMatrix,u_extrude_scale:P,u_intensity:w,u_inv_rot_matrix:Rr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=p,D.u_merc_center=m,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=o.globeToMercatorTransition(A.zoom);const R=m[0]*o.EXTENT,N=m[1]*o.EXTENT;D.u_up_dir=A.projection.upVector(new o.CanonicalTileID(0,0,0),R,N)}return D},wd=(u,n,l,p,m,y,w,A)=>{const S=u.transform,P=S.calculatePixelsToTileUnitsMatrix(n),D={u_matrix:Rl(u,n,l,m),u_pixels_to_tile_units:P,u_device_pixel_ratio:w,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:A};if(Ed(l)){const R=Su(n,u.transform);D.u_texsize=n.lineAtlasTexture.size,D.u_scale=[R,p.fromScale,p.toScale],D.u_mix=p.t}return D},Au=(u,n,l,p,m,y)=>{const w=u.transform,A=Su(n,w);return{u_matrix:Rl(u,n,l,m),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Su(u,n){return 1/dn(u,1,n.tileZoom)}function Rl(u,n,l,p){return u.translatePosMatrix(p||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Ed(u){const n=u.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Cu=(u,n,l,p,m,y)=>{return{u_matrix:u,u_tl_parent:n,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(w=m.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:am(m.paint.get("raster-hue-rotate")),u_perspective_transform:y};var w,A};function am(u){u*=Math.PI/180;const n=Math.sin(u),l=Math.cos(u);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const Ca=o.create(),Td=(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H)=>{const q=m.transform,V={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:q.width/q.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:A,u_is_text:+S,u_pitch_with_map:+p,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ca,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ca,u_up_vector:[0,-1,0]};return H.name==="globe"&&(V.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],V.u_zoom_transition=R,V.u_inv_rot_matrix=W,V.u_merc_center=N,V.u_camera_forward=q._camera.forward(),V.u_ecef_origin=o.globeECEFOrigin(q.globeMatrix,D.toUnwrapped()),V.u_tile_matrix=Float32Array.from(q.globeMatrix),V.u_up_vector=$),V},Bl=(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H,q)=>o.extend(Td(u,n,l,p,m,y,w,A,S,P,R,N,W,$,H,q),{u_gamma_scale:p?m.transform.cameraToCenterDistance*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+D}),lm=(u,n,l,p,m,y,w,A,S,P,D,R,N,W,$,H)=>o.extend(Bl(u,n,l,p,m,y,w,A,!0,S,!0,D,R,N,W,$,H),{u_texsize_icon:P,u_texture_icon:1}),Iu=(u,n,l)=>({u_matrix:u,u_opacity:n,u_color:l}),cm=(u,n,l,p,m,y)=>o.extend(function(w,A,S,P){const D=S.imageManager.getPattern(w.from.toString()),R=S.imageManager.getPattern(w.to.toString()),{width:N,height:W}=S.imageManager.getPixelSize(),$=Math.pow(2,P.tileID.overscaledZ),H=P.tileSize*Math.pow(2,S.transform.tileZoom)/$,q=H*(P.tileID.canonical.x+P.tileID.wrap*$),V=H*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[N,W],u_mix:A.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/dn(P,1,S.transform.tileZoom),u_pixel_coord_upper:[q>>16,V>>16],u_pixel_coord_lower:[65535&q,65535&V]}}(p,y,l,m),{u_matrix:u,u_opacity:n}),Fl={fillExtrusion:u=>({u_matrix:new o.UniformMatrix4f(u),u_lightpos:new o.Uniform3f(u),u_lightintensity:new o.Uniform1f(u),u_lightcolor:new o.Uniform3f(u),u_vertical_gradient:new o.Uniform1f(u),u_opacity:new o.Uniform1f(u),u_edge_radius:new o.Uniform1f(u),u_ao:new o.Uniform2f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_up_dir:new o.Uniform3f(u),u_height_lift:new o.Uniform1f(u)}),fillExtrusionPattern:u=>({u_matrix:new o.UniformMatrix4f(u),u_lightpos:new o.Uniform3f(u),u_lightintensity:new o.Uniform1f(u),u_lightcolor:new o.Uniform3f(u),u_vertical_gradient:new o.Uniform1f(u),u_height_factor:new o.Uniform1f(u),u_edge_radius:new o.Uniform1f(u),u_ao:new o.Uniform2f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_up_dir:new o.Uniform3f(u),u_height_lift:new o.Uniform1f(u),u_image:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_pixel_coord_upper:new o.Uniform2f(u),u_pixel_coord_lower:new o.Uniform2f(u),u_scale:new o.Uniform3f(u),u_fade:new o.Uniform1f(u),u_opacity:new o.Uniform1f(u)}),fill:u=>({u_matrix:new o.UniformMatrix4f(u)}),fillPattern:u=>({u_matrix:new o.UniformMatrix4f(u),u_image:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_pixel_coord_upper:new o.Uniform2f(u),u_pixel_coord_lower:new o.Uniform2f(u),u_scale:new o.Uniform3f(u),u_fade:new o.Uniform1f(u)}),fillOutline:u=>({u_matrix:new o.UniformMatrix4f(u),u_world:new o.Uniform2f(u)}),fillOutlinePattern:u=>({u_matrix:new o.UniformMatrix4f(u),u_world:new o.Uniform2f(u),u_image:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_pixel_coord_upper:new o.Uniform2f(u),u_pixel_coord_lower:new o.Uniform2f(u),u_scale:new o.Uniform3f(u),u_fade:new o.Uniform1f(u)}),circle:u=>({u_camera_to_center_distance:new o.Uniform1f(u),u_extrude_scale:new o.UniformMatrix2f(u),u_device_pixel_ratio:new o.Uniform1f(u),u_matrix:new o.UniformMatrix4f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_up_dir:new o.Uniform3f(u)}),collisionBox:u=>({u_matrix:new o.UniformMatrix4f(u),u_camera_to_center_distance:new o.Uniform1f(u),u_extrude_scale:new o.Uniform2f(u)}),collisionCircle:u=>({u_matrix:new o.UniformMatrix4f(u),u_inv_matrix:new o.UniformMatrix4f(u),u_camera_to_center_distance:new o.Uniform1f(u),u_viewport_size:new o.Uniform2f(u)}),debug:u=>({u_color:new o.UniformColor(u),u_matrix:new o.UniformMatrix4f(u),u_overlay:new o.Uniform1i(u),u_overlay_scale:new o.Uniform1f(u)}),clippingMask:u=>({u_matrix:new o.UniformMatrix4f(u)}),heatmap:u=>({u_extrude_scale:new o.Uniform1f(u),u_intensity:new o.Uniform1f(u),u_matrix:new o.UniformMatrix4f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_up_dir:new o.Uniform3f(u)}),heatmapTexture:u=>({u_image:new o.Uniform1i(u),u_color_ramp:new o.Uniform1i(u),u_opacity:new o.Uniform1f(u)}),hillshade:u=>({u_matrix:new o.UniformMatrix4f(u),u_image:new o.Uniform1i(u),u_latrange:new o.Uniform2f(u),u_light:new o.Uniform2f(u),u_shadow:new o.UniformColor(u),u_highlight:new o.UniformColor(u),u_accent:new o.UniformColor(u)}),hillshadePrepare:u=>({u_matrix:new o.UniformMatrix4f(u),u_image:new o.Uniform1i(u),u_dimension:new o.Uniform2f(u),u_zoom:new o.Uniform1f(u),u_unpack:new o.Uniform4f(u)}),line:u=>({u_matrix:new o.UniformMatrix4f(u),u_pixels_to_tile_units:new o.UniformMatrix2f(u),u_device_pixel_ratio:new o.Uniform1f(u),u_units_to_pixels:new o.Uniform2f(u),u_dash_image:new o.Uniform1i(u),u_gradient_image:new o.Uniform1i(u),u_image_height:new o.Uniform1f(u),u_texsize:new o.Uniform2f(u),u_scale:new o.Uniform3f(u),u_mix:new o.Uniform1f(u),u_alpha_discard_threshold:new o.Uniform1f(u),u_trim_offset:new o.Uniform2f(u)}),linePattern:u=>({u_matrix:new o.UniformMatrix4f(u),u_texsize:new o.Uniform2f(u),u_pixels_to_tile_units:new o.UniformMatrix2f(u),u_device_pixel_ratio:new o.Uniform1f(u),u_image:new o.Uniform1i(u),u_units_to_pixels:new o.Uniform2f(u),u_scale:new o.Uniform3f(u),u_fade:new o.Uniform1f(u),u_alpha_discard_threshold:new o.Uniform1f(u)}),raster:u=>({u_matrix:new o.UniformMatrix4f(u),u_tl_parent:new o.Uniform2f(u),u_scale_parent:new o.Uniform1f(u),u_fade_t:new o.Uniform1f(u),u_opacity:new o.Uniform1f(u),u_image0:new o.Uniform1i(u),u_image1:new o.Uniform1i(u),u_brightness_low:new o.Uniform1f(u),u_brightness_high:new o.Uniform1f(u),u_saturation_factor:new o.Uniform1f(u),u_contrast_factor:new o.Uniform1f(u),u_spin_weights:new o.Uniform3f(u),u_perspective_transform:new o.Uniform2f(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new o.Uniform1i(u),u_is_size_feature_constant:new o.Uniform1i(u),u_size_t:new o.Uniform1f(u),u_size:new o.Uniform1f(u),u_camera_to_center_distance:new o.Uniform1f(u),u_rotate_symbol:new o.Uniform1i(u),u_aspect_ratio:new o.Uniform1f(u),u_fade_change:new o.Uniform1f(u),u_matrix:new o.UniformMatrix4f(u),u_label_plane_matrix:new o.UniformMatrix4f(u),u_coord_matrix:new o.UniformMatrix4f(u),u_is_text:new o.Uniform1i(u),u_pitch_with_map:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_camera_forward:new o.Uniform3f(u),u_tile_matrix:new o.UniformMatrix4f(u),u_up_vector:new o.Uniform3f(u),u_ecef_origin:new o.Uniform3f(u),u_texture:new o.Uniform1i(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new o.Uniform1i(u),u_is_size_feature_constant:new o.Uniform1i(u),u_size_t:new o.Uniform1f(u),u_size:new o.Uniform1f(u),u_camera_to_center_distance:new o.Uniform1f(u),u_rotate_symbol:new o.Uniform1i(u),u_aspect_ratio:new o.Uniform1f(u),u_fade_change:new o.Uniform1f(u),u_matrix:new o.UniformMatrix4f(u),u_label_plane_matrix:new o.UniformMatrix4f(u),u_coord_matrix:new o.UniformMatrix4f(u),u_is_text:new o.Uniform1i(u),u_pitch_with_map:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_texture:new o.Uniform1i(u),u_gamma_scale:new o.Uniform1f(u),u_device_pixel_ratio:new o.Uniform1f(u),u_tile_id:new o.Uniform3f(u),u_zoom_transition:new o.Uniform1f(u),u_inv_rot_matrix:new o.UniformMatrix4f(u),u_merc_center:new o.Uniform2f(u),u_camera_forward:new o.Uniform3f(u),u_tile_matrix:new o.UniformMatrix4f(u),u_up_vector:new o.Uniform3f(u),u_ecef_origin:new o.Uniform3f(u),u_is_halo:new o.Uniform1i(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new o.Uniform1i(u),u_is_size_feature_constant:new o.Uniform1i(u),u_size_t:new o.Uniform1f(u),u_size:new o.Uniform1f(u),u_camera_to_center_distance:new o.Uniform1f(u),u_rotate_symbol:new o.Uniform1i(u),u_aspect_ratio:new o.Uniform1f(u),u_fade_change:new o.Uniform1f(u),u_matrix:new o.UniformMatrix4f(u),u_label_plane_matrix:new o.UniformMatrix4f(u),u_coord_matrix:new o.UniformMatrix4f(u),u_is_text:new o.Uniform1i(u),u_pitch_with_map:new o.Uniform1i(u),u_texsize:new o.Uniform2f(u),u_texsize_icon:new o.Uniform2f(u),u_texture:new o.Uniform1i(u),u_texture_icon:new o.Uniform1i(u),u_gamma_scale:new o.Uniform1f(u),u_device_pixel_ratio:new o.Uniform1f(u),u_is_halo:new o.Uniform1i(u)}),background:u=>({u_matrix:new o.UniformMatrix4f(u),u_opacity:new o.Uniform1f(u),u_color:new o.UniformColor(u)}),backgroundPattern:u=>({u_matrix:new o.UniformMatrix4f(u),u_opacity:new o.Uniform1f(u),u_image:new o.Uniform1i(u),u_pattern_tl_a:new o.Uniform2f(u),u_pattern_br_a:new o.Uniform2f(u),u_pattern_tl_b:new o.Uniform2f(u),u_pattern_br_b:new o.Uniform2f(u),u_texsize:new o.Uniform2f(u),u_mix:new o.Uniform1f(u),u_pattern_size_a:new o.Uniform2f(u),u_pattern_size_b:new o.Uniform2f(u),u_scale_a:new o.Uniform1f(u),u_scale_b:new o.Uniform1f(u),u_pixel_coord_upper:new o.Uniform2f(u),u_pixel_coord_lower:new o.Uniform2f(u),u_tile_units_to_pixels:new o.Uniform1f(u)}),terrainRaster:Ml,terrainDepth:Ml,skybox:u=>({u_matrix:new o.UniformMatrix4f(u),u_sun_direction:new o.Uniform3f(u),u_cubemap:new o.Uniform1i(u),u_opacity:new o.Uniform1f(u),u_temporal_offset:new o.Uniform1f(u)}),skyboxGradient:u=>({u_matrix:new o.UniformMatrix4f(u),u_color_ramp:new o.Uniform1i(u),u_center_direction:new o.Uniform3f(u),u_radius:new o.Uniform1f(u),u_opacity:new o.Uniform1f(u),u_temporal_offset:new o.Uniform1f(u)}),skyboxCapture:u=>({u_matrix_3f:new o.UniformMatrix3f(u),u_sun_direction:new o.Uniform3f(u),u_sun_intensity:new o.Uniform1f(u),u_color_tint_r:new o.Uniform4f(u),u_color_tint_m:new o.Uniform4f(u),u_luminance:new o.Uniform1f(u)}),globeRaster:u=>({u_proj_matrix:new o.UniformMatrix4f(u),u_globe_matrix:new o.UniformMatrix4f(u),u_normalize_matrix:new o.UniformMatrix4f(u),u_merc_matrix:new o.UniformMatrix4f(u),u_zoom_transition:new o.Uniform1f(u),u_merc_center:new o.Uniform2f(u),u_image0:new o.Uniform1i(u),u_grid_matrix:new o.UniformMatrix3f(u),u_frustum_tl:new o.Uniform3f(u),u_frustum_tr:new o.Uniform3f(u),u_frustum_br:new o.Uniform3f(u),u_frustum_bl:new o.Uniform3f(u),u_globe_pos:new o.Uniform3f(u),u_globe_radius:new o.Uniform1f(u),u_viewport:new o.Uniform2f(u)}),globeAtmosphere:u=>({u_frustum_tl:new o.Uniform3f(u),u_frustum_tr:new o.Uniform3f(u),u_frustum_br:new o.Uniform3f(u),u_frustum_bl:new o.Uniform3f(u),u_horizon:new o.Uniform1f(u),u_transition:new o.Uniform1f(u),u_fadeout_range:new o.Uniform1f(u),u_color:new o.Uniform4f(u),u_high_color:new o.Uniform4f(u),u_space_color:new o.Uniform4f(u),u_star_intensity:new o.Uniform1f(u),u_star_density:new o.Uniform1f(u),u_star_size:new o.Uniform1f(u),u_temporal_offset:new o.Uniform1f(u),u_horizon_angle:new o.Uniform1f(u),u_rotation_matrix:new o.UniformMatrix4f(u)})};let Nl;function Mu(u,n,l,p,m,y,w){const A=u.context,S=A.gl,P=u.transform,D=u.useProgram("collisionBox"),R=[];let N=0,W=0;for(let oe=0;oe<p.length;oe++){const ae=p[oe],te=n.getTile(ae),ce=te.getBucket(l);if(!ce)continue;const be=xl(ae,ce,P);let Pe=be;m[0]===0&&m[1]===0||(Pe=u.translatePosMatrix(be,te,m,y));const Ae=w?ce.textCollisionBox:ce.iconCollisionBox,Ze=ce.collisionCircleArray;if(Ze.length>0){const _e=o.create(),Be=Pe;o.mul(_e,ce.placementInvProjMatrix,P.glCoordMatrix),o.mul(_e,_e,ce.placementViewportMatrix),R.push({circleArray:Ze,circleOffset:W,transform:Be,invTransform:_e,projection:ce.getProjection()}),N+=Ze.length/4,W=N}Ae&&(u.terrain&&u.terrain.setupElevationDraw(te,D),D.draw(A,S.LINES,o.DepthMode.disabled,o.StencilMode.disabled,u.colorModeForRenderPass(),o.CullFaceMode.disabled,kl(Pe,P,te,ce.getProjection()),l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,P.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!w||!R.length)return;const $=u.useProgram("collisionCircle"),H=new o.StructArrayLayout2f1f2i16;H.resize(4*N),H._trim();let q=0;for(const oe of R)for(let ae=0;ae<oe.circleArray.length/4;ae++){const te=4*ae,ce=oe.circleArray[te+0],be=oe.circleArray[te+1],Pe=oe.circleArray[te+2],Ae=oe.circleArray[te+3];H.emplace(q++,ce,be,Pe,Ae,0),H.emplace(q++,ce,be,Pe,Ae,1),H.emplace(q++,ce,be,Pe,Ae,2),H.emplace(q++,ce,be,Pe,Ae,3)}(!Nl||Nl.length<2*N)&&(Nl=function(oe){const ae=2*oe,te=new o.StructArrayLayout3ui6;te.resize(ae),te._trim();for(let ce=0;ce<ae;ce++){const be=6*ce;te.uint16[be+0]=4*ce+0,te.uint16[be+1]=4*ce+1,te.uint16[be+2]=4*ce+2,te.uint16[be+3]=4*ce+2,te.uint16[be+4]=4*ce+3,te.uint16[be+5]=4*ce+0}return te}(N));const V=A.createIndexBuffer(Nl,!0),K=A.createVertexBuffer(H,o.collisionCircleLayout.members,!0);for(const oe of R){const ae={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(Z=P).getCameraToCenterDistance(oe.projection),u_viewport_size:[Z.width,Z.height]};$.draw(A,S.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,u.colorModeForRenderPass(),o.CullFaceMode.disabled,ae,l.id,K,V,o.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,P.zoom)}var Z;K.destroy(),V.destroy()}const Pu=o.create();function Bs(u,n,l,p,m,y){const{horizontalAlign:w,verticalAlign:A}=o.getAnchorAlignment(u),S=-(w-.5)*n,P=-(A-.5)*l,D=o.evaluateVariableOffset(u,p);return new o.pointGeometry((S/m+D[0])*y,(P/m+D[1])*y)}function um(u,n,l,p,m,y,w,A,S,P,D){const R=u.text.placedSymbolArray,N=u.text.dynamicLayoutVertexArray,W=u.icon.dynamicLayoutVertexArray,$={},H=va(A,u.getProjection(),y),q=y.elevation,V=u.getProjection().upVectorScale(A.canonical,y.center.lat,y.worldSize);N.clear();for(let K=0;K<R.length;K++){const Z=R.get(K),oe=u.allowVerticalPlacement&&!Z.placedOrientation,ae=Z.hidden||!Z.crossTileID||oe?null:p[Z.crossTileID];if(ae){const te=new o.pointGeometry(Z.tileAnchorX,Z.tileAnchorY),ce=u.getProjection().upVector(A.canonical,te.x,te.y),be=q?q.getAtTileOffset(A,te.x,te.y):0,Pe=Xt([Z.projectedAnchorX+be*ce[0]*V.metersToTile,Z.projectedAnchorY+be*ce[1]*V.metersToTile,Z.projectedAnchorZ+be*ce[2]*V.metersToTile],l?H:w),Ae=Kt(y.getCameraToCenterDistance(u.getProjection()),Pe.signedDistanceFromCamera);let Ze=m.evaluateSizeForFeature(u.textSizeData,P,Z)*Ae/o.ONE_EM;l&&(Ze*=u.tilePixelRatio/S);const{width:_e,height:Be,anchor:Re,textOffset:we,textScale:fe}=ae,st=Bs(Re,_e,Be,we,fe,Ze);let Ke;if(l){const Je=te.add(st),{x:vt,y:kt,z:Pt}=u.getProjection().projectTilePoint(Je.x,Je.y,A.canonical);Ke=Xt([vt+be*ce[0]*V.metersToTile,kt+be*ce[1]*V.metersToTile,Pt+be*ce[2]*V.metersToTile],w).point}else{const Je=n?st.rotate(-y.angle):st;Ke=[Pe.point[0]+Je.x,Pe.point[1]+Je.y,0]}const tt=u.allowVerticalPlacement&&Z.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Je=0;Je<Z.numGlyphs;Je++)o.addDynamicAttributes(N,Ke[0],Ke[1],Ke[2],tt);D&&Z.associatedIconIndex>=0&&($[Z.associatedIconIndex]={shiftedAnchor:Ke,angle:tt})}else br(Z.numGlyphs,N)}if(D){W.clear();const K=u.icon.placedSymbolArray;for(let Z=0;Z<K.length;Z++){const oe=K.get(Z);if(oe.hidden)br(oe.numGlyphs,W);else{const ae=$[Z];if(ae)for(let te=0;te<oe.numGlyphs;te++)o.addDynamicAttributes(W,ae.shiftedAnchor[0],ae.shiftedAnchor[1],ae.shiftedAnchor[2],ae.angle);else br(oe.numGlyphs,W)}}u.icon.dynamicLayoutVertexBuffer.updateData(W)}u.text.dynamicLayoutVertexBuffer.updateData(N)}function hm(u,n,l){return l.iconsInText&&n?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Ad(u,n,l,p,m,y,w,A,S,P,D,R){const N=u.context,W=N.gl,$=u.transform,H=A==="map",q=S==="map",V=H&&l.layout.get("symbol-placement")!=="point",K=H&&!q&&!V,Z=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const ae=u.depthModeForSublayer(0,o.DepthMode.ReadOnly),te=[o.mercatorXfromLng($.center.lng),o.mercatorYfromLat($.center.lat)],ce=l.layout.get("text-variable-anchor"),be=$.projection.name==="globe",Pe=[],Ae=[0,-1,0];let Ze=Ae;!be&&!$.mercatorFromTransition||H||(Ze=function(_e){const Be=_e._camera.getWorldToCamera(_e.worldSize,1),Re=o.multiply([],Be,_e.globeMatrix);o.invert(Re,Re);const we=[0,0,0],fe=[0,1,0,0];return o.transformMat4$1(fe,fe,Re),we[0]=fe[0],we[1]=fe[1],we[2]=fe[2],o.normalize(we,we),we}($));for(const _e of p){const Be=n.getTile(_e),Re=Be.getBucket(l);if(!Re||Re.projection.name==="mercator"&&be)continue;const we=m?Re.text:Re.icon;if(!we||Re.fullyClipped||!we.segments.get().length)continue;const fe=we.programConfigurations.get(l.id),st=m||Re.sdfIcons,Ke=m?Re.textSizeData:Re.iconSizeData,tt=q||$.pitch!==0,Je=o.evaluateSizeForZoom(Ke,$.zoom);let vt,kt,Pt,Et,Qe=[0,0],Bt=null;if(m){if(kt=Be.glyphAtlasTexture,Pt=W.LINEAR,vt=Be.glyphAtlasTexture.size,Re.iconsInText){Qe=Be.imageAtlasTexture.size,Bt=Be.imageAtlasTexture;const wn=Ke.kind==="composite"||Ke.kind==="camera";Et=tt||u.options.rotating||u.options.zooming||wn?W.LINEAR:W.NEAREST}}else{const wn=l.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;kt=Be.imageAtlasTexture,Pt=st||u.options.rotating||u.options.zooming||wn||tt?W.LINEAR:W.NEAREST,vt=Be.imageAtlasTexture.size}const qt=Re.projection.name==="globe",Ti=qt?Ze:Ae,Ai=qt?o.globeToMercatorTransition($.zoom):0,yi=va(_e,Re.getProjection(),$),_n=$.calculatePixelsToTileUnitsMatrix(Be),Fn=Ms(yi,Be.tileID.canonical,q,H,$,Re.getProjection(),_n),Nr=u.terrain&&q&&V?o.invert(o.create(),Fn):Pu,ki=Ps(yi,Be.tileID.canonical,q,H,$,Re.getProjection(),_n),Gi=ce&&Re.hasTextData(),_i=l.layout.get("icon-text-fit")!=="none"&&Gi&&Re.hasIconData();if(V){const wn=$.elevation,Ur=wn?wn.getAtTileOffsetFunc(_e,$.center.lat,$.worldSize,Re.getProjection()):Tr=>[0,0,0],Io=ld(yi,Be.tileID.canonical,q,H,$,Re.getProjection(),_n);Ds(Re,yi,u,m,Io,ki,q,P,Ur,_e)}const nn=V||m&&ce||_i,Dn=u.translatePosMatrix(yi,Be,y,w),Pi=nn?Pu:Fn,Zn=u.translatePosMatrix(ki,Be,y,w,!0),is=Re.getProjection().createInversionMatrix($,_e.canonical),Er=[];u.terrainRenderModeElevated()&&q&&Er.push("PITCH_WITH_MAP_TERRAIN"),qt&&Er.push("PROJECTION_GLOBE_VIEW"),nn&&Er.push("PROJECTED_POS_ON_VIEWPORT");const Nn=st&&l.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vs;Vs=st?Re.iconsInText?lm(Ke.kind,Je,K,q,u,Dn,Pi,Zn,vt,Qe,_e,Ai,te,is,Ti,Re.getProjection()):Bl(Ke.kind,Je,K,q,u,Dn,Pi,Zn,m,vt,!0,_e,Ai,te,is,Ti,Re.getProjection()):Td(Ke.kind,Je,K,q,u,Dn,Pi,Zn,m,vt,_e,Ai,te,is,Ti,Re.getProjection());const Co={program:u.useProgram(hm(st,m,Re),fe,Er),buffers:we,uniformValues:Vs,atlasTexture:kt,atlasTextureIcon:Bt,atlasInterpolation:Pt,atlasInterpolationIcon:Et,isSDF:st,hasHalo:Nn,tile:Be,labelPlaneMatrixInv:Nr};if(Z&&Re.canOverlap){oe=!0;const wn=we.segments.get();for(const Ur of wn)Pe.push({segments:new o.SegmentVector([Ur]),sortKey:Ur.sortKey,state:Co})}else Pe.push({segments:we.segments,sortKey:0,state:Co})}oe&&Pe.sort((_e,Be)=>_e.sortKey-Be.sortKey);for(const _e of Pe){const Be=_e.state;if(u.terrain&&u.terrain.setupElevationDraw(Be.tile,Be.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:Be.labelPlaneMatrixInv}),N.activeTexture.set(W.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,W.CLAMP_TO_EDGE),Be.atlasTextureIcon&&(N.activeTexture.set(W.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Be.isSDF){const Re=Be.uniformValues;Be.hasHalo&&(Re.u_is_halo=1,Sd(Be.buffers,_e.segments,l,u,Be.program,ae,D,R,Re)),Re.u_is_halo=0}Sd(Be.buffers,_e.segments,l,u,Be.program,ae,D,R,Be.uniformValues)}}function Sd(u,n,l,p,m,y,w,A,S){const P=p.context,D=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer];m.draw(P,P.gl.TRIANGLES,y,w,A,o.CullFaceMode.disabled,S,l.id,u.layoutVertexBuffer,u.indexBuffer,n,l.paint,p.transform.zoom,u.programConfigurations.get(l.id),D)}function Cd(u,n,l,p,m,y,w){const A=u.context.gl,S=l.paint.get("fill-pattern"),P=S&&S.constantOr(1),D=l.getCrossfadeParameters();let R,N,W,$,H;w?(N=P&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=A.LINES):(N=P?"fillPattern":"fill",R=A.TRIANGLES);for(const q of p){const V=n.getTile(q);if(P&&!V.patternsLoaded())continue;const K=V.getBucket(l);if(!K)continue;u.prepareDrawTile();const Z=K.programConfigurations.get(l.id),oe=u.useProgram(N,Z);P&&(u.context.activeTexture.set(A.TEXTURE0),V.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Z.updatePaintBuffers(D));const ae=S.constantOr(null);if(ae&&V.imageAtlas){const ce=V.imageAtlas,be=ce.patternPositions[ae.to.toString()],Pe=ce.patternPositions[ae.from.toString()];be&&Pe&&Z.setConstantPatternPositions(be,Pe)}const te=u.translatePosMatrix(q.projMatrix,V,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){$=K.indexBuffer2,H=K.segments2;const ce=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];W=N==="fillOutlinePattern"&&P?sm(te,u,D,V,ce):xd(te,ce)}else $=K.indexBuffer,H=K.segments,W=P?Eu(te,u,D,V):zl(te);u.prepareDrawProgram(u.context,oe,q.toUnwrapped()),oe.draw(u.context,R,m,u.stencilModeForClipping(q),y,o.CullFaceMode.disabled,W,l.id,K.layoutVertexBuffer,$,H,l.paint,u.transform.zoom,Z)}}function Du(u,n,l,p,m,y,w){const A=u.context,S=A.gl,P=u.transform,D=l.paint.get("fill-extrusion-pattern"),R=D.constantOr(1),N=l.getCrossfadeParameters(),W=l.paint.get("fill-extrusion-opacity"),$=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],H=l.layout.get("fill-extrusion-edge-radius"),q=P.projection.name==="globe"?o.fillExtrusionHeightLift():0,V=P.projection.name==="globe",K=V?o.globeToMercatorTransition(P.zoom):0,Z=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)],oe=[];V&&(oe.push("PROJECTION_GLOBE_VIEW"),u.style.terrainSetForDrapingOnly()&&oe.push("TERRAIN")),$[0]>0&&oe.push("FAUX_AO");for(const ae of p){const te=n.getTile(ae),ce=te.getBucket(l);if(!ce||ce.projection.name!==P.projection.name)continue;const be=ce.programConfigurations.get(l.id),Pe=u.useProgram(R?"fillExtrusionPattern":"fillExtrusion",be,oe);if(u.terrain){const fe=u.terrain;if(u.style.terrainSetForDrapingOnly())fe.setupElevationDraw(te,Pe,{useMeterToDem:!0});else{if(!ce.enableTerrain)continue;if(fe.setupElevationDraw(te,Pe,{useMeterToDem:!0}),Lu(A,n,ae,ce,l,fe),!ce.centroidVertexBuffer){const st=Pe.attributes.a_centroid_pos;st!==void 0&&S.vertexAttrib2f(st,0,0)}}}R&&(u.context.activeTexture.set(S.TEXTURE0),te.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),be.updatePaintBuffers(N));const Ae=D.constantOr(null);if(Ae&&te.imageAtlas){const fe=te.imageAtlas,st=fe.patternPositions[Ae.to.toString()],Ke=fe.patternPositions[Ae.from.toString()];st&&Ke&&be.setConstantPatternPositions(st,Ke)}const Ze=u.translatePosMatrix(ae.projMatrix,te,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),_e=P.projection.createInversionMatrix(P,ae.canonical),Be=l.paint.get("fill-extrusion-vertical-gradient"),Re=R?wu(Ze,u,Be,W,$,H,ae,N,te,q,K,Z,_e):Ll(Ze,u,Be,W,$,H,ae,q,K,Z,_e);u.prepareDrawProgram(A,Pe,ae.toUnwrapped());const we=[];u.terrain&&we.push(ce.centroidVertexBuffer),V&&we.push(ce.layoutVertexExtBuffer),Pe.draw(A,A.gl.TRIANGLES,m,y,w,o.CullFaceMode.backCCW,Re,l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,l.paint,u.transform.zoom,be,we)}}function Lu(u,n,l,p,m,y){const w=[V=>{let K=V.canonical.x-1,Z=V.wrap;return K<0&&(K=(1<<V.canonical.z)-1,Z--),new o.OverscaledTileID(V.overscaledZ,Z,V.canonical.z,K,V.canonical.y)},V=>{let K=V.canonical.x+1,Z=V.wrap;return K===1<<V.canonical.z&&(K=0,Z++),new o.OverscaledTileID(V.overscaledZ,Z,V.canonical.z,K,V.canonical.y)},V=>new o.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,(V.canonical.y===0?1<<V.canonical.z:V.canonical.y)-1),V=>new o.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y===(1<<V.canonical.z)-1?0:V.canonical.y+1)],A=V=>{const K=n.getSource().minzoom,Z=ae=>{const te=n.getTileByID(ae);if(te&&te.hasData())return te.getBucket(m)},oe=[0,-1,1];for(const ae of oe){if(V.overscaledZ+ae<K)continue;const te=Z(V.calculateScaledKey(V.overscaledZ+ae));if(te)return te}},S=[0,0,0],P=(V,K)=>(S[0]=Math.min(V.min.y,K.min.y),S[1]=Math.max(V.max.y,K.max.y),S[2]=o.EXTENT-K.min.x>V.max.x?K.min.x-o.EXTENT:V.max.x,S),D=(V,K)=>(S[0]=Math.min(V.min.x,K.min.x),S[1]=Math.max(V.max.x,K.max.x),S[2]=o.EXTENT-K.min.y>V.max.y?K.min.y-o.EXTENT:V.max.y,S),R=[(V,K)=>P(V,K),(V,K)=>P(K,V),(V,K)=>D(V,K),(V,K)=>D(K,V)],N=new o.pointGeometry(0,0);let W,$,H;const q=(V,K,Z,oe,ae)=>{const te=[[oe?Z:V,oe?V:Z,0],[oe?Z:K,oe?K:Z,0]],ce=ae<0?o.EXTENT+ae:ae,be=[oe?ce:(V+K)/2,oe?(V+K)/2:ce,0];return Z===0&&ae<0||Z!==0&&ae>0?y.getForTilePoints(H,[be],!0,$):te.push(be),y.getForTilePoints(l,te,!0,W),Math.max(te[0][2],te[1][2],be[2])/y.exaggeration()};for(let V=0;V<4;V++){const K=(V<2?1:5)-V,Z=p.borders[V];if(Z.length===0)continue;const oe=H=w[V](l),ae=A(oe);if(!(ae&&ae instanceof o.FillExtrusionBucket&&ae.enableTerrain)||p.borderDoneWithNeighborZ[V]===ae.canonical.z&&ae.borderDoneWithNeighborZ[K]===p.canonical.z||($=y.findDEMTileFor(oe),!$||!$.dem))continue;if(!W){const Pe=y.findDEMTileFor(l);if(!Pe||!Pe.dem)return;W=Pe}const te=ae.borders[K];let ce=0;const be=ae.borderDoneWithNeighborZ[K]!==p.canonical.z;if(p.canonical.z===ae.canonical.z){for(let Pe=0;Pe<Z.length;Pe++){const Ae=p.featuresOnBorder[Z[Pe]],Ze=Ae.borders[V];let _e;for(;ce<te.length&&(_e=ae.featuresOnBorder[te[ce]],!(_e.borders[K][1]>Ze[0]+3));)be&&ae.encodeCentroid(void 0,_e,!1),ce++;if(_e&&ce<te.length){const Be=ce;let Re=0;for(;!(_e.borders[K][0]>Ze[1]-3)&&(Re++,++ce!==te.length);)_e=ae.featuresOnBorder[te[ce]];if(_e=ae.featuresOnBorder[te[Be]],Ae.intersectsCount()>1||_e.intersectsCount()>1||Re!==1){Re!==1&&(ce=Be),p.encodeCentroid(void 0,Ae,!1),be&&ae.encodeCentroid(void 0,_e,!1);continue}const we=R[V](Ae,_e),fe=V%2?o.EXTENT-1:0;N.x=q(we[0],Math.min(o.EXTENT-1,we[1]),fe,V<2,we[2]),N.y=0,p.encodeCentroid(N,Ae,!1),be&&ae.encodeCentroid(N,_e,!1)}else p.encodeCentroid(void 0,Ae,!1)}p.borderDoneWithNeighborZ[V]=ae.canonical.z,p.needsCentroidUpdate=!0,be&&(ae.borderDoneWithNeighborZ[K]=p.canonical.z,ae.needsCentroidUpdate=!0)}else{for(const Pe of Z)p.encodeCentroid(void 0,p.featuresOnBorder[Pe],!1);if(be){for(const Pe of te)ae.encodeCentroid(void 0,ae.featuresOnBorder[Pe],!1);ae.borderDoneWithNeighborZ[K]=p.canonical.z,ae.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[V]=ae.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(u)}const zu=new o.Color(1,0,0,1),Id=new o.Color(0,1,0,1),Md=new o.Color(0,0,1,1),Pd=new o.Color(1,0,1,1),ku=new o.Color(0,1,1,1);function Qo(u,n,l){const p=u.context,m=u.transform,y=p.gl,w=m.projection.name==="globe",A=w?["PROJECTION_GLOBE_VIEW"]:null;let S=l.projMatrix;if(w&&o.globeToMercatorTransition(m.zoom)>0){const Ae=o.transitionTileAABBinECEF(l.canonical,m),Ze=o.globeDenormalizeECEF(Ae);S=o.multiply(new Float32Array(16),m.globeMatrix,Ze),o.multiply(S,m.projMatrix,S)}const P=u.useProgram("debug",null,A),D=n.getTileByID(l.key);u.terrain&&u.terrain.setupElevationDraw(D,P);const R=o.DepthMode.disabled,N=o.StencilMode.disabled,W=u.colorModeForRenderPass(),$="$debug";p.activeTexture.set(y.TEXTURE0),u.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),w?D._makeGlobeTileDebugBuffers(u.context,m):D._makeDebugTileBoundsBuffers(u.context,m.projection);const H=D._tileDebugBuffer||u.debugBuffer,q=D._tileDebugIndexBuffer||u.debugIndexBuffer,V=D._tileDebugSegments||u.debugSegments;P.draw(p,y.LINE_STRIP,R,N,W,o.CullFaceMode.disabled,Ol(S,o.Color.red),$,H,q,V,null,null,null,[D._globeTileDebugBorderBuffer]);const K=D.latestRawTileData,Z=Math.floor((K&&K.byteLength||0)/1024),oe=n.getTile(l).tileSize,ae=512/Math.min(oe,512)*(l.overscaledZ/m.zoom)*.5;let te=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(te+=` => ${l.overscaledZ}`),te+=` ${Z}kb`,function(Ae,Ze){Ae.initDebugOverlayCanvas();const _e=Ae.debugOverlayCanvas,Be=Ae.context.gl,Re=Ae.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,_e.width,_e.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ze,5,5),Re.strokeText(Ze,5,5),Ae.debugOverlayTexture.update(_e),Ae.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(u,te);const ce=D._tileDebugTextBuffer||u.debugBuffer,be=D._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Pe=D._tileDebugTextSegments||u.debugSegments;P.draw(p,y.TRIANGLES,R,N,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Ol(S,o.Color.transparent,ae),$,ce,be,Pe,null,null,null,[D._globeTileDebugTextBuffer])}function Fs(u,n,l,p){to(u,0,n+l/2,u.transform.width,l,p)}function Ou(u,n,l,p){to(u,n-l/2,0,l,u.transform.height,p)}function to(u,n,l,p,m,y){const w=u.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),w.clear({color:y}),A.disable(A.SCISSOR_TEST)}const Ns=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Dd}=Ns;function Br(u,n,l,p){u.emplaceBack(n,l,p)}class pi{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Br(this.vertexArray,-1,-1,1),Br(this.vertexArray,1,-1,1),Br(this.vertexArray,-1,1,1),Br(this.vertexArray,1,1,1),Br(this.vertexArray,-1,-1,-1),Br(this.vertexArray,1,-1,-1),Br(this.vertexArray,-1,1,-1),Br(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Dd),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function io(u,n,l,p,m,y){const w=u.gl,A=n.paint.get("sky-atmosphere-color"),S=n.paint.get("sky-atmosphere-halo-color"),P=n.paint.get("sky-atmosphere-sun-intensity"),D=((R,N,W,$,H)=>({u_matrix_3f:R,u_sun_direction:N,u_sun_intensity:W,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),p),m,P,A,S);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,n.skyboxTexture,0),l.draw(u,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const dm=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ld{constructor(n){const l=new o.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new o.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,dm.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Us={symbol:function(u,n,l,p,m){if(u.renderPass!=="translucent")return;const y=o.StencilMode.disabled,w=u.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,S,P,D,R,N,W){const $=S.transform,H=R==="map",q=N==="map";for(const V of A){const K=D.getTile(V),Z=K.getBucket(P);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const oe=o.evaluateSizeForZoom(Z.textSizeData,$.zoom),ae=va(V,Z.getProjection(),$),te=$.calculatePixelsToTileUnitsMatrix(K),ce=Ms(ae,K.tileID.canonical,q,H,$,Z.getProjection(),te),be=P.layout.get("icon-text-fit")!=="none"&&Z.hasIconData();if(oe){const Pe=Math.pow(2,$.zoom-K.tileID.overscaledZ);um(Z,H,q,W,o.symbolSize,$,ce,V,Pe,oe,be)}}}(p,u,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),m),l.paint.get("icon-opacity").constantOr(1)!==0&&Ad(u,n,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),y,w),l.paint.get("text-opacity").constantOr(1)!==0&&Ad(u,n,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),y,w),n.map.showCollisionBoxes&&(Mu(u,n,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Mu(u,n,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(u,n,l,p){if(u.renderPass!=="translucent")return;const m=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),A=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const S=u.context,P=S.gl,D=u.transform,R=u.depthModeForSublayer(0,o.DepthMode.ReadOnly),N=o.StencilMode.disabled,W=u.colorModeForRenderPass(),$=D.projection.name==="globe",H=[o.mercatorXfromLng(D.center.lng),o.mercatorYfromLat(D.center.lat)],q=[];for(let K=0;K<p.length;K++){const Z=p[K],oe=n.getTile(Z),ae=oe.getBucket(l);if(!ae||ae.projection.name!==D.projection.name)continue;const te=ae.programConfigurations.get(l.id),ce=bd(l);$&&ce.push("PROJECTION_GLOBE_VIEW");const be=u.useProgram("circle",te,ce),Pe=ae.layoutVertexBuffer,Ae=ae.globeExtVertexBuffer,Ze=ae.indexBuffer,_e=D.projection.createInversionMatrix(D,Z.canonical),Be={programConfiguration:te,program:be,layoutVertexBuffer:Pe,globeExtVertexBuffer:Ae,indexBuffer:Ze,uniformValues:Sa(u,Z,oe,_e,H,l),tile:oe};if(A){const Re=ae.segments.get();for(const we of Re)q.push({segments:new o.SegmentVector([we]),sortKey:we.sortKey,state:Be})}else q.push({segments:ae.segments,sortKey:0,state:Be})}A&&q.sort((K,Z)=>K.sortKey-Z.sortKey);const V={useDepthForOcclusion:!$};for(const K of q){const{programConfiguration:Z,program:oe,layoutVertexBuffer:ae,globeExtVertexBuffer:te,indexBuffer:ce,uniformValues:be,tile:Pe}=K.state,Ae=K.segments;u.terrain&&u.terrain.setupElevationDraw(Pe,oe,V),u.prepareDrawProgram(S,oe,Pe.tileID.toUnwrapped()),oe.draw(S,P.TRIANGLES,R,N,W,o.CullFaceMode.disabled,be,l.id,ae,ce,Ae,l.paint,D.zoom,Z,[te])}},heatmap:function(u,n,l,p){if(l.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,y=m.gl,w=o.StencilMode.disabled,A=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(W,$,H,q){const V=W.gl,K=$.width*q,Z=$.height*q;W.activeTexture.set(V.TEXTURE1),W.viewport.set([0,0,K,Z]);let oe=H.heatmapFbo;if(!oe||oe&&(oe.width!==K||oe.height!==Z)){oe&&oe.destroy();const ae=V.createTexture();V.bindTexture(V.TEXTURE_2D,ae),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),oe=H.heatmapFbo=W.createFramebuffer(K,Z,!1),function(te,ce,be,Pe,Ae,Ze){const _e=te.gl;_e.texImage2D(_e.TEXTURE_2D,0,_e.RGBA,Ae,Ze,0,_e.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),Pe.colorAttachment.set(be)}(W,0,ae,oe,K,Z)}else V.bindTexture(V.TEXTURE_2D,oe.colorAttachment.get()),W.bindFramebuffer.set(oe.framebuffer)})(m,u,l,u.transform.projection.name==="globe"?.5:.25),m.clear({color:o.Color.transparent});const S=u.transform,P=S.projection.name==="globe",D=P?["PROJECTION_GLOBE_VIEW"]:null,R=P?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,N=[o.mercatorXfromLng(S.center.lng),o.mercatorYfromLat(S.center.lat)];for(let W=0;W<p.length;W++){const $=p[W];if(n.hasRenderableParent($))continue;const H=n.getTile($),q=H.getBucket(l);if(!q||q.projection.name!==S.projection.name)continue;const V=q.programConfigurations.get(l.id),K=u.useProgram("heatmap",V,D),{zoom:Z}=u.transform;u.terrain&&u.terrain.setupElevationDraw(H,K),u.prepareDrawProgram(m,K,$.toUnwrapped());const oe=S.projection.createInversionMatrix(S,$.canonical);K.draw(m,y.TRIANGLES,o.DepthMode.disabled,w,A,R,Tu(u,$,H,oe,N,Z,l.paint.get("heatmap-intensity")),l.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,l.paint,u.transform.zoom,V,P?[q.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,y){const w=m.context,A=w.gl,S=y.heatmapFbo;if(!S)return;w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,S.colorAttachment.get()),w.activeTexture.set(A.TEXTURE1);let P=y.colorRampTexture;P||(P=y.colorRampTexture=new o.Texture(w,y.colorRamp,A.RGBA)),P.bind(A.LINEAR,A.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((D,R,N,W)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(u,l))},line:function(u,n,l,p){if(u.renderPass!=="translucent")return;const m=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const w=u.depthModeForSublayer(0,o.DepthMode.ReadOnly),A=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture?1:o.exported.devicePixelRatio,P=l.paint.get("line-dasharray"),D=P.constantOr(1),R=l.layout.get("line-cap"),N=l.paint.get("line-pattern"),W=N.constantOr(1),$=l.paint.get("line-gradient"),H=l.getCrossfadeParameters(),q=W?"linePattern":"line",V=u.context,K=V.gl,Z=(ae=>{const te=[];Ed(ae)&&te.push("RENDER_LINE_DASH"),ae.paint.get("line-gradient")&&te.push("RENDER_LINE_GRADIENT");const ce=ae.paint.get("line-trim-offset");ce[0]===0&&ce[1]===0||te.push("RENDER_LINE_TRIM_OFFSET");const be=ae.paint.get("line-pattern").constantOr(1),Pe=ae.paint.get("line-opacity").constantOr(1)!==1;return!be&&Pe&&te.push("RENDER_LINE_ALPHA_DISCARD"),te})(l);let oe=Z.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const ae of p){const te=n.getTile(ae);if(W&&!te.patternsLoaded())continue;const ce=te.getBucket(l);if(!ce)continue;u.prepareDrawTile();const be=ce.programConfigurations.get(l.id),Pe=u.useProgram(q,be,Z),Ae=N.constantOr(null);if(Ae&&te.imageAtlas){const Ke=te.imageAtlas,tt=Ke.patternPositions[Ae.to.toString()],Je=Ke.patternPositions[Ae.from.toString()];tt&&Je&&be.setConstantPatternPositions(tt,Je)}const Ze=P.constantOr(null),_e=R.constantOr(null);if(!W&&Ze&&_e&&te.lineAtlas){const Ke=te.lineAtlas,tt=Ke.getDash(Ze.to,_e),Je=Ke.getDash(Ze.from,_e);tt&&Je&&be.setConstantPatternPositions(tt,Je)}let[Be,Re]=l.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&Be!==Re&&(Be===0&&(Be-=1),Re===1&&(Re+=1));const we=u.terrain?ae.projMatrix:null,fe=W?Au(u,te,l,H,we,S):wd(u,te,l,H,we,ce.lineClipsArray.length,S,[Be,Re]);if($){const Ke=ce.gradients[l.id];let tt=Ke.texture;if(l.gradientVersion!==Ke.version){let Je=256;if(l.stepInterpolant){const vt=n.getSource().maxzoom,kt=ae.canonical.z===vt?Math.ceil(1<<u.transform.maxZoom-ae.canonical.z):1;Je=o.clamp(o.nextPowerOfTwo(ce.maxLineLength/o.EXTENT*1024*kt),256,V.maxTextureSize)}Ke.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Je,image:Ke.gradient||void 0,clips:ce.lineClipsArray}),Ke.texture?Ke.texture.update(Ke.gradient):Ke.texture=new o.Texture(V,Ke.gradient,K.RGBA),Ke.version=l.gradientVersion,tt=Ke.texture}V.activeTexture.set(K.TEXTURE1),tt.bind(l.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}D&&(V.activeTexture.set(K.TEXTURE0),te.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),be.updatePaintBuffers(H)),W&&(V.activeTexture.set(K.TEXTURE0),te.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),be.updatePaintBuffers(H)),u.prepareDrawProgram(V,Pe,ae.toUnwrapped());const st=Ke=>{Pe.draw(V,K.TRIANGLES,w,Ke,A,o.CullFaceMode.disabled,fe,l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,l.paint,u.transform.zoom,be,[ce.layoutVertexBuffer2])};if(oe){const Ke=u.stencilModeForClipping(ae).ref;Ke===0&&u.terrain&&V.clear({stencil:0});const tt={func:K.EQUAL,mask:255};fe.u_alpha_discard_threshold=.8,st(new o.StencilMode(tt,Ke,255,K.KEEP,K.KEEP,K.INVERT)),fe.u_alpha_discard_threshold=0,st(new o.StencilMode(tt,Ke,255,K.KEEP,K.KEEP,K.KEEP))}else st(u.stencilModeForClipping(ae))}oe&&(u.resetStencilClippingMasks(),u.terrain&&V.clear({stencil:0}))},fill:function(u,n,l,p){const m=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=u.colorModeForRenderPass(),A=l.paint.get("fill-pattern"),S=u.opaquePassEnabledForLayer()&&!A.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===S){const P=u.depthModeForSublayer(1,u.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Cd(u,n,l,p,P,w,!1)}if(u.renderPass==="translucent"&&l.paint.get("fill-antialias")){const P=u.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Cd(u,n,l,p,P,w,!0)}},"fill-extrusion":function(u,n,l,p){const m=l.paint.get("fill-extrusion-opacity");if(m!==0&&u.renderPass==="translucent"){const y=new o.DepthMode(u.context.gl.LEQUAL,o.DepthMode.ReadWrite,u.depthRangeFor3D);if(m!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Du(u,n,l,p,y,o.StencilMode.disabled,o.ColorMode.disabled),Du(u,n,l,p,y,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const w=u.colorModeForRenderPass();Du(u,n,l,p,y,o.StencilMode.disabled,w)}}},hillshade:function(u,n,l,p){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const m=u.context,y=u.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=u.colorModeForRenderPass(),A=u.terrain&&u.terrain.renderingToTexture,[S,P]=u.renderPass!=="translucent"||A?[{},p]:u.stencilConfigForOverlap(p);for(const D of P){const R=n.getTile(D);if(R.needsHillshadePrepare&&u.renderPass==="offscreen")fd(u,R,l,y,o.StencilMode.disabled,w);else if(u.renderPass==="translucent"){const N=A&&u.terrain?u.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Cl(u,D,R,l,y,N,w)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,n,l,p,m,y){if(u.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const w=u.context,A=w.gl,S=n.getSource(),P=u.useProgram("raster"),D=u.colorModeForRenderPass(),R=u.terrain&&u.terrain.renderingToTexture,[N,W]=S instanceof ue||R?[{},p]:u.stencilConfigForOverlap(p),$=W[W.length-1].overscaledZ,H=!u.options.moving;for(const q of W){const V=R?o.DepthMode.disabled:u.depthModeForSublayer(q.overscaledZ-$,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,A.LESS),K=q.toUnwrapped(),Z=n.getTile(q);if(R&&(!Z||!Z.hasData()))continue;const oe=R?q.projMatrix:u.transform.calculateProjMatrix(K,H),ae=u.terrain&&R?u.terrain.stencilModeForRTTOverlap(q):N[q.overscaledZ],te=y?0:l.paint.get("raster-fade-duration");Z.registerFadeDuration(te);const ce=n.findLoadedParent(q,0),be=xu(Z,ce,n,u.transform,te);let Pe,Ae;u.terrain&&u.terrain.prepareDrawTile();const Ze=l.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;w.activeTexture.set(A.TEXTURE0),Z.texture.bind(Ze,A.CLAMP_TO_EDGE),w.activeTexture.set(A.TEXTURE1),ce?(ce.texture.bind(Ze,A.CLAMP_TO_EDGE),Pe=Math.pow(2,ce.tileID.overscaledZ-Z.tileID.overscaledZ),Ae=[Z.tileID.canonical.x*Pe%1,Z.tileID.canonical.y*Pe%1]):Z.texture.bind(Ze,A.CLAMP_TO_EDGE);const _e=Cu(oe,Ae||[0,0],Pe||1,be,l,S instanceof ue?S.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(w,P,K),S instanceof ue)S.boundsBuffer&&S.boundsSegments&&P.draw(w,A.TRIANGLES,V,o.StencilMode.disabled,D,o.CullFaceMode.disabled,_e,l.id,S.boundsBuffer,u.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Re,tileBoundsSegments:we}=u.getTileBoundsBuffers(Z);P.draw(w,A.TRIANGLES,V,ae,D,o.CullFaceMode.disabled,_e,l.id,Be,Re,we)}}u.resetStencilClippingMasks()},background:function(u,n,l,p){const m=l.paint.get("background-color"),y=l.paint.get("background-opacity");if(y===0)return;const w=u.context,A=w.gl,S=u.transform,P=S.tileSize,D=l.paint.get("background-pattern");if(u.isPatternMissing(D))return;const R=!D&&m.a===1&&y===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==R)return;const N=o.StencilMode.disabled,W=u.depthModeForSublayer(0,R==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),$=u.colorModeForRenderPass(),H=u.useProgram(D?"backgroundPattern":"background");let q,V=p;V||(q=u.getBackgroundTiles(),V=Object.values(q).map(Z=>Z.tileID)),D&&(w.activeTexture.set(A.TEXTURE0),u.imageManager.bind(u.context));const K=l.getCrossfadeParameters();for(const Z of V){const oe=Z.toUnwrapped(),ae=p?Z.projMatrix:u.transform.calculateProjMatrix(oe);u.prepareDrawTile();const te=n?n.getTile(Z):q?q[Z.key]:new o.Tile(Z,P,S.zoom,u),ce=D?cm(ae,y,u,D,{tileID:Z,tileSize:P},K):Iu(ae,y,m);u.prepareDrawProgram(w,H,oe);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Ae}=u.getTileBoundsBuffers(te);H.draw(w,A.TRIANGLES,W,N,$,o.CullFaceMode.disabled,ce,l.id,be,Pe,Ae)}},sky:function(u,n,l){const p=u.transform,m=p.projection.name==="mercator"||p.projection.name==="globe"?1:o.smoothstep(7,8,p.zoom),y=l.paint.get("sky-opacity")*m;if(y===0)return;const w=u.context,A=l.paint.get("sky-type"),S=new o.DepthMode(w.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),P=u.frameCounter/1e3%1;A==="atmosphere"?u.renderPass==="offscreen"?l.needsSkyboxCapture(u)&&(function(D,R,N,W){const $=D.context,H=$.gl;let q=R.skyboxFbo;if(!q){q=R.skyboxFbo=$.createFramebuffer(32,32,!1),R.skyboxGeometry=new pi($),R.skyboxTexture=$.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,R.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let oe=0;oe<6;++oe)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(q.framebuffer),$.viewport.set([0,0,32,32]);const V=R.getCenter(D,!0),K=D.useProgram("skyboxCapture"),Z=new Float64Array(16);o.identity(Z),o.rotateY(Z,Z,.5*-Math.PI),io($,R,K,Z,V,0),o.identity(Z),o.rotateY(Z,Z,.5*Math.PI),io($,R,K,Z,V,1),o.identity(Z),o.rotateX(Z,Z,.5*-Math.PI),io($,R,K,Z,V,2),o.identity(Z),o.rotateX(Z,Z,.5*Math.PI),io($,R,K,Z,V,3),o.identity(Z),io($,R,K,Z,V,4),o.identity(Z),o.rotateY(Z,Z,Math.PI),io($,R,K,Z,V,5),$.viewport.set([0,0,D.width,D.height])}(u,l),l.markSkyboxValid(u)):u.renderPass==="sky"&&function(D,R,N,W,$){const H=D.context,q=H.gl,V=D.transform,K=D.useProgram("skybox");H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,R.skyboxTexture);const Z=((oe,ae,te,ce,be)=>({u_matrix:oe,u_sun_direction:ae,u_cubemap:0,u_opacity:ce,u_temporal_offset:be}))(V.skyboxMatrix,R.getCenter(D,!1),0,W,$);D.prepareDrawProgram(H,K),K.draw(H,q.TRIANGLES,N,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,Z,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,l,S,y,P):A==="gradient"&&u.renderPass==="sky"&&function(D,R,N,W,$){const H=D.context,q=H.gl,V=D.transform,K=D.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new pi(H)),H.activeTexture.set(q.TEXTURE0);let Z=R.colorRampTexture;Z||(Z=R.colorRampTexture=new o.Texture(H,R.colorRamp,q.RGBA)),Z.bind(q.LINEAR,q.CLAMP_TO_EDGE);const oe=((ae,te,ce,be,Pe)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:te,u_radius:o.degToRad(ce),u_opacity:be,u_temporal_offset:Pe}))(V.skyboxMatrix,R.getCenter(D,!1),R.paint.get("sky-gradient-radius"),W,$);D.prepareDrawProgram(H,K),K.draw(H,q.TRIANGLES,N,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,oe,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,l,S,y,P)},debug:function(u,n,l){for(let p=0;p<l.length;p++)Qo(u,n,l[p])},custom:function(u,n,l){const p=u.context,m=l.implementation;if(u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(u.renderPass==="offscreen"){const y=m.prerender;y&&(u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),y.call(m,p.gl,u.transform.customLayerMatrix()),p.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const y=m.renderingMode==="3d"?new o.DepthMode(u.context.gl.LEQUAL,o.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,o.DepthMode.ReadOnly);p.setDepthMode(y),m.render(p.gl,u.transform.customLayerMatrix()),p.setDirty(),u.setBaseState(),p.bindFramebuffer.set(null)}}};class pm{constructor(n,l){this.context=new O(n),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yo,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gd(this,n));const m=this._terrain;this.transform.elevation=p?m:null,m.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,m]=l.getFovAdjustedRange(this.transform._fov);if(p>m)return void(this.transform.fogCullDistSq=null);const y=p+.78*(m-p);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const n=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(p,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const A=new o.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])A.emplaceBack(P);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new o.Texture(n,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=o.create();const S=this.context.gl;this.stencilClearMode=new o.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Ld(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Rs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,p){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const S of p)if(this._tileClippingMaskIDs[S.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=l.id;const m=this.context,y=m.gl;this.nextStencilID+p.length>256&&this.clearStencil(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const S=l.getTile(A),P=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:R,tileBoundsSegments:N}=this.getTileBoundsBuffers(S);w.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Rs(A.projMatrix),"$clipping",D,R,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,p=n.sort((w,A)=>A.overscaledZ-w.overscaledZ),m=p[p.length-1].overscaledZ,y=p[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let A=0;A<y;A++)w[A+m]=new o.StencilMode({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[w,p]}return[{[m]:o.StencilMode.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,l,p){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(p||this.context.gl.LEQUAL,l,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const p=this.style.order,m=this.style._sourceCaches;for(const S in m){const P=m[S];P.used&&P.prepare(this.context)}const y={},w={},A={};for(const S in m){const P=m[S];y[S]=P.getVisibleCoordinates(),w[S]=y[S].slice().reverse(),A[S]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<p.length;S++)if(this.style._layers[p[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const S of p){const P=this.style._layers[S],D=n._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const R=D?w[D.id]:void 0;(P.type==="custom"||P.isSky()||R&&R.length)&&this.renderLayer(this,D,P,R)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[p[this.currentLayer]],P=n._getLayerSourceCache(S);if(S.isSky())continue;const D=P?w[P.id]:void 0;this._renderTileClippingMasks(S,P,D),this.renderLayer(this,P,S,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(S,P){const D=S.context,R=D.gl,N=S.transform,W=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadOnly,[0,1]),$=S.useProgram("globeAtmosphere",null,N.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),H=o.globeToMercatorTransition(N.zoom),q=P.properties.get("color").toArray01(),V=P.properties.get("high-color").toArray01(),K=P.properties.get("space-color").toArray01PremultipliedAlpha(),Z=o.identity$1([]);o.rotateY$1(Z,Z,-o.degToRad(N._center.lng)),o.rotateX$1(Z,Z,o.degToRad(N._center.lat)),o.rotateZ$1(Z,Z,N.angle),o.rotateX$1(Z,Z,-N._pitch);const oe=o.fromQuat(new Float32Array(16),Z),ae=o.mapValue(P.properties.get("star-intensity"),0,1,0,.25),te=5e-4,ce=o.mapValue(P.properties.get("horizon-blend"),0,1,te,.25),be=o.globeUseCustomAntiAliasing(S,D,N)&&ce===te?N.worldSize/(2*Math.PI*1.025)-1:N.globeRadius,Pe=S.frameCounter/1e3%1,Ae=o.length(N.globeCenterInViewSpace),Ze=Math.sqrt(Math.pow(Ae,2)-Math.pow(be,2)),_e=Math.acos(Ze/Ae),Be=((we,fe,st,Ke,tt,Je,vt,kt,Pt,Et,Qe,Bt,qt,Ti)=>({u_frustum_tl:we,u_frustum_tr:fe,u_frustum_br:st,u_frustum_bl:Ke,u_horizon:tt,u_transition:Je,u_fadeout_range:vt,u_color:kt,u_high_color:Pt,u_space_color:Et,u_star_intensity:Qe,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Bt,u_horizon_angle:qt,u_rotation_matrix:Ti}))(N.frustumCorners.TL,N.frustumCorners.TR,N.frustumCorners.BR,N.frustumCorners.BL,N.frustumCorners.horizon,H,ce,q,V,K,ae,Pe,_e,oe);S.prepareDrawProgram(D,$);const Re=S.atmosphereBuffer;Re&&$.draw(D,R.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Be,"skybox",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const S=this.style._layers[p[this.currentLayer]],P=n._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,P,S,P?w[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const S=this.style._layers[p[this.currentLayer]],P=n._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=P?(S.type==="symbol"?A:w)[P.id]:void 0;this._renderTileClippingMasks(S,P,P?y[P.id]:void 0),this.renderLayer(this,P,S,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let S=null;o.values(this.style._layers).forEach(P=>{const D=n._getLayerSourceCache(P);D&&!P.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<D.getSource().maxzoom)&&(S=D)}),S&&this.options.showTileBoundaries&&Us.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const P=S.transform.padding;Fs(S,S.transform.height-(P.top||0),3,zu),Fs(S,P.bottom||0,3,Id),Ou(S,P.left||0,3,Md),Ou(S,S.transform.width-(P.right||0),3,Pd);const D=S.transform.centerPoint;(function(R,N,W,$){to(R,N-1,W-10,2,20,$),to(R,N-10,W-1,20,2,$)})(S,D.x,S.transform.height-D.y,ku)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,l,p,m){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||m&&m.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)||Us[p.type](n,l,p,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[n.id];p||(p=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),n.beginQueryEXT(n.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const p in n){const m=n[p],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),l[p]=w}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const m of n)p+=l.getQueryObjectEXT(m,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(m);return p}translatePosMatrix(n,l,p,m,y){if(!p[0]&&!p[1])return n;const w=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const P=Math.sin(w),D=Math.cos(w);p=[p[0]*D-p[1]*P,p[0]*P+p[1]*D]}const A=[y?p[0]:dn(l,p[0],this.transform.zoom),y?p[1]:dn(l,p[1],this.transform.zoom),0],S=new Float32Array(16);return o.translate(S,n,A),S}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const l=this.imageManager.getPattern(n.from.toString()),p=this.imageManager.getPattern(n.to.toString());return!l||!p}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),l&&!n&&l.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),n&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(n,l,p){this.cache=this.cache||{};const m=p||[],y=this.currentGlobalDefines().concat(m),w=yd.cacheKey(yu[n],n,y,l);return this.cache[w]||(this.cache[w]=new yd(this.context,n,yu[n],l,Fl[n],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const y=m.getOpacity(this.transform.pitch),w=((A,S,P,D,R,N,W,$,H,q,V)=>{const K=A.transform,Z=S.properties.get("color").toArray01();Z[3]=D;const oe=A.frameCounter/1e3%1;return{u_fog_matrix:P?K.calculateFogTileMatrix(P):A.identityMat,u_fog_range:S.getFovAdjustedRange(K._fov),u_fog_color:Z,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:oe,u_frustum_tl:R,u_frustum_tr:N,u_frustum_br:W,u_frustum_bl:$,u_globe_pos:H,u_globe_radius:q,u_viewport:V,u_globe_transition:o.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,m,p,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);l.setFogUniformValues(n,w)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const m of p)l[m.key]=n[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Ru{constructor(n=0,l=0,p=0,m=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=p,this.right=m}interpolate(n,l,p){return l.top!=null&&n.top!=null&&(this.top=o.number(n.top,l.top,p)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.number(n.bottom,l.bottom,p)),l.left!=null&&n.left!=null&&(this.left=o.number(n.left,l.left,p)),l.right!=null&&n.right!=null&&(this.right=o.number(n.right,l.right,p)),this}getCenter(n,l){const p=o.clamp((this.left+n-this.right)/2,0,n),m=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(p,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ru(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bu(u,n){const l=o.getColumn(u,3);o.fromQuat(u,n),o.setColumn(u,3,l)}function Fu(u,n){const l=o.identity$1([]);return o.rotateZ$1(l,l,-n),o.rotateX$1(l,l,-u),l}function Ia(u,n){const l=[u[0],u[1],0],p=[n[0],n[1],0];if(o.length(l)>=1e-15){const w=o.normalize([],l);o.scale$2(p,w,o.dot(p,w)),n[0]=p[0],n[1]=p[1]}const m=o.cross([],n,u);if(o.len(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return Fu(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}class Ma{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof o.MercatorCoordinate?n:new o.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=o.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,m=this.position,y=o.MercatorCoordinate.fromLngLat(n,p),w=[y.x-m.x,y.y-m.y,y.z-m.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Ia(w,l)}setPitchBearing(n,l){this.orientation=Fu(o.degToRad(n),o.degToRad(-l))}}class es{constructor(n,l){this._transform=o.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&o.setColumn(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.identity$1([]),n&&Bu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Fu(n,l),Bu(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const p=new Float64Array(16);return o.invert(p,this.getWorldToCamera(n,l)),p}getWorldToCameraPosition(n,l,p){const m=this.position;o.scale$2(m,m,-n);const y=new Float64Array(16);return o.fromScaling(y,[p,p,p]),o.translate(y,y,m),y[10]*=l,y}getWorldToCamera(n,l){const p=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.conjugate(m,this._orientation),o.scale$2(y,y,-n),o.fromQuat(p,m),o.translate(p,p,y),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(n,l,p,m){const y=new Float64Array(16);return o.perspective(y,n,l,p,m),y}getDistanceToElevation(n){const l=n===0?0:o.mercatorZfromAltitude(n,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new es([...this.position],[...this.orientation])}}function Ul(u,n){const l=Pa(u.projection,u.zoom,u.width,u.height),p=function(y,w,A,S,P){const D=new o.LngLat(A.lng-180*no,A.lat),R=new o.LngLat(A.lng+180*no,A.lat),N=y.project(D.lng,D.lat),W=y.project(R.lng,R.lat),$=-Math.atan2(W.y-N.y,W.x-N.x),H=o.MercatorCoordinate.fromLngLat(A);H.y=o.clamp(H.y,-.999975,.999975);const q=H.toLngLat(),V=y.project(q.lng,q.lat),K=o.MercatorCoordinate.fromLngLat(q);K.x+=no;const Z=K.toLngLat(),oe=y.project(Z.lng,Z.lat),ae=pt(oe.x-V.x,oe.y-V.y,$),te=o.MercatorCoordinate.fromLngLat(q);te.y+=no;const ce=te.toLngLat(),be=y.project(ce.lng,ce.lat),Pe=pt(be.x-V.x,be.y-V.y,$),Ae=Math.abs(ae.x)/Math.abs(Pe.y),Ze=o.identity([]);o.rotateZ(Ze,Ze,-$*(1-(P?0:S)));const _e=o.identity([]);return o.scale(_e,_e,[1,1-(1-Ae)*S,1]),_e[4]=-Pe.x/Pe.y*S,o.rotateZ(_e,_e,$),o.multiply(_e,Ze,_e),_e}(u.projection,0,u.center,l,n),m=jl(u);return o.scale(p,p,[m,m,1]),p}function jl(u){const n=u.projection,l=Pa(u.projection,u.zoom,u.width,u.height),p=Da(n,u.center),m=Da(n,o.LngLat.convert(n.center));return Math.pow(2,p*l+(1-l)*m)}function Pa(u,n,l,p,m=1/0){const y=u.range;if(!y)return 0;const w=Math.min(m,Math.max(l,p)),A=Math.log(w/1024)/Math.LN2;return o.smoothstep(y[0]+A,y[1]+A,n)}const no=1/4e4;function Da(u,n){const l=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=new o.LngLat(n.lng-180*no,l),m=new o.LngLat(n.lng+180*no,l),y=u.project(p.lng,l),w=u.project(m.lng,l),A=o.MercatorCoordinate.fromLngLat(p),S=o.MercatorCoordinate.fromLngLat(m),P=w.x-y.x,D=w.y-y.y,R=S.x-A.x,N=S.y-A.y,W=Math.sqrt((R*R+N*N)/(P*P+D*D));return Math.log(W)/Math.LN2}function pt(u,n,l){const p=Math.cos(l),m=Math.sin(l);return{x:u*p-n*m,y:u*m+n*p}}class nr{constructor(n,l,p,m,y,w,A){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=m??60,this.setProjection(w),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ru,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new es,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new nr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||l)&&this._updateCameraOnTerrain(),(n||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const p=!L(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(m,y,w){var A=y[0],S=y[1],P=y[2],D=y[3],R=Math.sin(w),N=Math.cos(w);m[0]=A*N+P*R,m[1]=S*N+D*R,m[2]=A*-R+P*N,m[3]=S*-R+D*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let m=0,y=0;for(let w=0;w<l.length;w++){const A=new o.pointGeometry(l[w][0]*this.width,p+l[w][1]*(this.height-p)),S=n.pointCoordinate(A);if(!S)continue;const P=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*P,y+=P}return y===0?NaN:m/y}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,m=this._mercatorZfromZoom(n),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-p,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const m=o.length(o.sub([],this._camera.position,p));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new Ma;return l.position=new o.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const l=o.transformQuat([],[0,0,-1],n),p=o.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const m=Ia(l,p);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;n[2]=o.clamp(n[2],m/p,m/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,p){this._unmodified=!1,this._edgeInsets.interpolate(n,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new o.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,m.x,y.x,w.x)),S=Math.floor(Math.max(p.x,m.x,y.x,w.x)),P=1;for(let D=A-P;D<=S+P;D++)D!==0&&l.push(new o.UnwrappedTileID(D,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const p=l,m=this.elevation&&!n.isTerrainDEM,y=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const w=this.locationCoordinate(this.center),A=this.center.lat,S=1<<l,P=[S*w.x,S*w.y,0],D=this.projection.name==="globe",R=!D,N=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,R),W=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=S*o.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),q=[S*W.x,S*W.y,H*(R?1:$)],V=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,Z=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=n.isTerrainDEM?-Z:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?jl(this):1,te=fe=>{const Ke=new o.MercatorCoordinate(fe.x+25e-6,fe.y,fe.z),tt=new o.MercatorCoordinate(fe.x,fe.y+25e-6,fe.z),Je=fe.toLngLat(),vt=Ke.toLngLat(),kt=tt.toLngLat(),Pt=this.locationCoordinate(Je),Et=this.locationCoordinate(vt),Qe=this.locationCoordinate(kt),Bt=Math.hypot(Et.x-Pt.x,Et.y-Pt.y),qt=Math.hypot(Qe.x-Pt.x,Qe.y-Pt.y);return Math.sqrt(Bt*qt)*ae/25e-6},ce=fe=>{const st=Z,Ke=oe;return{aabb:o.tileAABB(this,S,0,0,0,fe,Ke,st,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:st,wrap:fe,fullyVisible:!1}},be=[];let Pe=[];const Ae=l,Ze=n.reparseOverscaled?p:l,_e=fe=>fe*fe,Be=_e((H-this._centerAltitude)*$),Re=fe=>{if(!this._elevation||!fe.tileID||!y)return;const st=this._elevation.getMinMaxForTile(fe.tileID),Ke=fe.aabb;st?(Ke.min[2]=st.min,Ke.max[2]=st.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(fe.shouldSplit=we(fe),fe.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},we=fe=>{if(fe.zoom<K)return!0;if(fe.zoom===Ae)return!1;if(fe.shouldSplit!=null)return fe.shouldSplit;const st=fe.aabb.distanceX(q),Ke=fe.aabb.distanceY(q);let tt=Be,Je=1;if(D){tt=_e(fe.aabb.distanceZ(q));const Pt=Math.pow(2,fe.zoom),Et=o.latFromMercatorY((fe.y+1)/Pt),Qe=o.latFromMercatorY(fe.y/Pt),Bt=Math.min(Math.max(A,Et),Qe),qt=o.circumferenceAtLatitude(Bt)/o.circumferenceAtLatitude(A);if(Je=Bt===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&fe.zoom===Ae-1&&qt>=.9)return!0}else if(m&&(tt=_e(fe.aabb.distanceZ(q)*$)),this.projection.isReprojectedInTileSpace&&p<=5){const Pt=Math.pow(2,fe.zoom),Et=te(new o.MercatorCoordinate((fe.x+.5)/Pt,(fe.y+.5)/Pt));Je=Et>.85?1:Et}const vt=st*st+Ke*Ke+tt,kt=_e((1<<Ae-fe.zoom)*V*Je*((Pt,Et)=>{if(Et*_e(.707)<Pt)return 1;const Qe=Math.sqrt(Et/Pt);return Qe/(1.4144271570014144+(Math.pow(1.1,Qe-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Be),vt));return vt<kt};if(this.renderWorldCopies)for(let fe=1;fe<=3;fe++)be.push(ce(-fe)),be.push(ce(fe));for(be.push(ce(0));be.length>0;){const fe=be.pop(),st=fe.x,Ke=fe.y;let tt=fe.fullyVisible;if(!tt){const Je=fe.aabb.intersects(N);if(Je===0)continue;tt=Je===2}if(fe.zoom!==Ae&&we(fe))for(let Je=0;Je<4;Je++){const vt=(st<<1)+Je%2,kt=(Ke<<1)+(Je>>1),Pt={aabb:y?fe.aabb.quadrant(Je):o.tileAABB(this,S,fe.zoom+1,vt,kt,fe.wrap,fe.minZ,fe.maxZ,this.projection),zoom:fe.zoom+1,x:vt,y:kt,wrap:fe.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:fe.minZ,maxZ:fe.maxZ};m&&!D&&(Pt.tileID=new o.OverscaledTileID(fe.zoom+1===Ae?Ze:fe.zoom+1,fe.wrap,fe.zoom+1,vt,kt),Re(Pt)),be.push(Pt)}else{const Je=fe.zoom===Ae?Ze:fe.zoom;if(n.minzoom&&n.minzoom>Je)continue;const vt=P[0]-(.5+st+(fe.wrap<<fe.zoom))*(1<<l-fe.zoom),kt=P[1]-.5-Ke,Pt=fe.tileID?fe.tileID:new o.OverscaledTileID(Je,fe.wrap,fe.zoom,st,Ke);Pe.push({tileID:Pt,distanceSq:vt*vt+kt*kt})}}if(this.fogCullDistSq){const fe=this.fogCullDistSq,st=this.horizonLineFromTop();Pe=Pe.filter(Ke=>{const tt=[0,0,0,1],Je=[o.EXTENT,o.EXTENT,0,1],vt=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());o.transformMat4$1(tt,tt,vt),o.transformMat4$1(Je,Je,vt);const kt=o.getAABBPointSquareDist(tt,Je);if(kt===0)return!0;let Pt=!1;const Et=this._elevation;if(Et&&kt>fe&&st!==0){const Qe=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let Bt;n.isTerrainDEM||(Bt=Et.getMinMaxForTile(Ke.tileID)),Bt||(Bt={min:oe,max:Z});const qt=o.furthestTileCorner(this.rotation),Ti=[qt[0]*o.EXTENT,qt[1]*o.EXTENT,Bt.max];o.transformMat4(Ti,Ti,Qe),Pt=(1-Ti[1])*this.height*.5<st}return kt<fe||Pt})}return Pe.sort((fe,st)=>fe.distanceSq-st.distanceSq).map(fe=>fe.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=this.projection.project(n.lng,l);return new o.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,l){let p,m;const y=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;p=(l.x-y.x)/A,m=(l.y-y.y)/A}else{const A=this.pointCoordinate(l),S=this.pointCoordinate(y);p=A.x-S.x,m=A.y-S.y}const w=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(w.x-p,w.y-m))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const p=l?o.mercatorZfromAltitude(l,n.lat):void 0,m=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(m.x,m.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const p=l??this._centerAltitude,m=[n.x,n.y,0,1],y=[n.x,n.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const w=y[3];o.scale$1(m,m,1/m[3]),o.scale$1(y,y,1/w);const A=m[2],S=y[2];return{p0:m,p1:y,t:A===S?0:(p-A)/(S-A)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(p,p,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(p,p,1/p[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(p,p,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],p,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:p,t:m}=n,y=o.mercatorZfromAltitude(l[2],this._center.lat),w=o.mercatorZfromAltitude(p[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],p[0],m)/this.worldSize,o.number(l[1],p[1],m)/this.worldSize,o.number(y,w,m))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new o.MercatorCoordinate(l[0],l[1],l[2]);let p=0,m=this.horizonLineFromTop();if(n.y>m)return this.pointCoordinate(n);const y=.02*m,w=n.clone();for(let A=0;A<10&&m-p>y;A++){w.y=o.number(p,m,.66);const S=this.projection.pointCoordinate3D(this,w.x,w.y);S?(m=w.y,l=S):p=w.y}return l?new o.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,m=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:n,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,y=this.pointCoordinate3D(new o.pointGeometry(l,n)),w=this.pointCoordinate3D(new o.pointGeometry(m,n)),A=this.pointCoordinate3D(new o.pointGeometry(m,p)),S=this.pointCoordinate3D(new o.pointGeometry(l,p));let P=Math.min(y.x,S.x),D=Math.max(w.x,A.x),R=Math.min(y.y,w.y),N=Math.max(S.y,A.y);const W=Math.pow(2,-this.zoom)/16,$=(V,K,Z,oe)=>{const ae=(V+Z)/2,te=(K+oe)/2,ce=new o.pointGeometry(ae,te),be=this.pointCoordinate3D(ce),Pe=Math.max(0,P-be.x,R-be.y,be.x-D,be.y-N);P=Math.min(P,be.x),D=Math.max(D,be.x),R=Math.min(R,be.y),N=Math.max(N,be.y),Pe>W&&($(V,K,ae,te),$(ae,te,Z,oe))};$(l,n,m,n),$(m,n,m,p),$(m,p,l,p),$(l,p,l,n);const H=new o.LngLat(o.lngFromMercatorX(D),o.latFromMercatorY(R)),q=new o.LngLat(o.lngFromMercatorX(P),o.latFromMercatorY(N));return new o.LngLatBounds(q,H)}_getBounds(n,l){if(this.projection.name==="globe")return this._getGlobeBounds();const p=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(p,n),S=this.pointCoordinate(m,n);const P=this.pointCoordinate(y,l),D=this.pointCoordinate(w,l),R=(N,W)=>(W.y-N.y)/(W.x-N.x);return A.y>1&&S.y>=0?A=new o.MercatorCoordinate((1-D.y)/R(D,A)+D.x,1):A.y<0&&S.y<=1&&(A=new o.MercatorCoordinate(-D.y/R(D,A)+D.x,0)),S.y>1&&A.y>=0?S=new o.MercatorCoordinate((1-P.y)/R(P,S)+P.x,1):S.y<0&&A.y<=1&&(S=new o.MercatorCoordinate(-P.y/R(P,S)+P.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(A)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(P))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBounds(0,0);const l=n.visibleDemTiles.reduce((p,m)=>{if(m.dem){const y=m.dem.tree;p.min=Math.min(p.min,y.minimums[0]),p.max=Math.max(p.max,y.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,p=this._distanceTileDataCache;if(p[l])return p[l];const m=n.canonical,y=1/this.height,w=this.cameraWorldSize/this.zoomScale(m.z),A=(m.x+Math.pow(2,m.z)*n.wrap)*w,S=m.y*w,P=this.point,D=this.angle,R=Math.sin(-D),N=-Math.cos(-D);return p[l]={bearing:[R,N],center:[(P.x-A)*y,(P.y-S)*y],scale:w/o.EXTENT*y},p[l]}calculateFogTileMatrix(n){const l=n.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return o.multiply(m,this.worldToFogMatrix,m),p[l]=new Float32Array(m),p[l]}calculateProjMatrix(n,l=!1){const p=n.key,m=l?this._alignedProjMatrixCache:this._projMatrixCache;if(m[p])return m[p];const y=this.calculatePosMatrix(n,this.worldSize);return o.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,y),m[p]=new Float32Array(y),m[p]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const m=function(y,w){const{scale:A}=y.tileTransform,S=A*o.EXTENT/(y.tileSize*Math.pow(2,w.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return P=new Float32Array(4),N=(D=w.inverseAdjustmentMatrix)[1],W=D[2],$=D[3],q=(R=[S,S])[1],P[0]=D[0]*(H=R[0]),P[1]=N*H,P[2]=W*q,P[3]=$*q,P;var P,D,R,N,W,$,H,q}(n,this);return p[l]=m,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),m=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);p[2]/=y,m[2]/=y,o.normalize(m,m);const w=n.raycast(p,m,n.exaggeration());if(w){const A=o.scaleAndAdd([],p,m,w),S=new o.MercatorCoordinate(A[0],A[1],o.mercatorZfromAltitude(A[2],o.latFromMercatorY(A[1]))),P=(S.z+o.length([S.x-p[0],S.y-p[1],S.z-p[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),m=n.getAtPointOrZero(new o.MercatorCoordinate(...p)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(w<y){const A=this.locationCoordinate(this._center,this._centerAltitude),S=[A.x-p[0],A.y-p[1],A.z-p[2]],P=o.length(S);S[2]-=(y-w)/this._pixelsPerMercatorPixel;const D=o.length(S);if(D===0)return;o.scale$2(S,S,P/D*this._pixelsPerMercatorPixel),this._camera.position=[A.x-S[0],A.y-S[1],A.z*this._pixelsPerMercatorPixel-S[2]],this._camera.orientation=Ia(S,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const N=this.center;return N.lat=o.clamp(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(N.lng=o.clamp(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:m}=this.point;let y=0,w=p,A=m;const S=this.width/2,P=this.height/2,D=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(m-P<D&&(A=D+P),m+P>R&&(A=R-P),R-D<this.height&&(y=Math.max(y,this.height/(R-D)),A=(R+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,$=this.worldSize/2-(N+W)/2;w=(p+$+this.worldSize)%this.worldSize-$,w-S<N&&(w=N+S),w+S>W&&(w=W-S),W-N<this.width&&(y=Math.max(y,this.width/(W-N)),w=(W+N)/2)}w===p&&A===m||(this.center=this.unproject(new o.pointGeometry(w,A))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const p=Pa(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?l:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-n.x/this.width,y[9]=2*n.y/this.height;let w=o.mul([],y,m);if(this.projection.isReprojectedInTileSpace){const ae=this.locationCoordinate(this.center),te=o.identity([]);o.translate(te,te,[ae.x*this.worldSize,ae.y*this.worldSize,0]),o.multiply(te,te,Ul(this)),o.translate(te,te,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),o.multiply(w,w,te),this.inverseAdjustmentMatrix=function(ce){const be=Ul(ce,!0);return _t([],[be[0],be[1],be[4],be[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],w,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=w,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const A=o.invert([],y);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const S=new Float32Array(16);o.identity(S),o.scale(S,S,[1,-1,1]),o.rotateX(S,S,this._pitch),o.rotateZ(S,S,this.angle);const P=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-n.x/this.width,P[9]=2*(n.y+D)/this.height,this.skyboxMatrix=o.multiply(S,P,S);const R=this.point,N=R.x,W=R.y,$=this.width%2/2,H=this.height%2/2,q=Math.cos(this.angle),V=Math.sin(this.angle),K=N-Math.round(N)+q*$+V*H,Z=W-Math.round(W)+q*H+V*$,oe=new Float64Array(w);if(o.translate(oe,oe,[K>.5?K-1:K,Z>.5?Z-1:Z,0]),this.alignedProjMatrix=oe,w=o.create(),o.scale(w,w,[this.width/2,-this.height/2,1]),o.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=o.create(),o.scale(w,w,[1,-1,1]),o.translate(w,w,[-1,-1,0]),o.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=o.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ae,ae,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[n,n,l];o.scale$2(y,y,m),o.scale$2(p,p,-1),o.multiply$2(p,p,y);const w=o.create();o.translate(w,w,p),o.scale(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,m)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-p[0]*y,m.y/this.worldSize-p[1]*y,n/this.worldSize*this._centerAltitude-p[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],m=n[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(y=Math.min((l-p)/m,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:m}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),A=Math.max((n[2]-y)/Math.cos(p),w),S=this._zoomFromMercatorZ(A);o.scaleAndAdd(n,n,l,A),this._pitch=o.clamp(p,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){const l=w=>{const A=this.getCameraToCenterDistance(this.projection,w);return this.scaleZoom(A/(n*this.tileSize))};let p,m=l(this.zoom),y=Math.abs(m-l(m));for(;p!==y;)m=l(m),p=y,y=Math.abs(m-l(m));return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const p=Math.min(n.x,l.x),m=Math.max(n.x,l.x),y=Math.min(n.y,l.y),w=Math.max(n.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new o.pointGeometry(p,y),new o.pointGeometry(m,w),new o.pointGeometry(p,w),new o.pointGeometry(m,y)],S=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const D of A){const R=this.pointRayIntersection(D);if(R.t<0)return!0;const N=this.rayIntersectionCoordinate(R);if(N.x<S||N.y<0||N.x>P||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,l){const p=o.length(o.sub([],this._camera.position,n)),m=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(l,p){const m=[l[0],l[1],l[2],1];o.transformMat4$1(m,m,p);const y=Math.max(m[3],1e-6);return[m[0]/y,m[1]/y,m[2]/y,y]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}}getCameraToCenterDistance(n,l=this.zoom){const p=Pa(n,l,this.width,this.height,1024),m=n.pixelSpaceConversion(this.center.lat,this.worldSize,p);return .5/Math.tan(.5*this._fov)*this.height*m}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(n,n,this.globeMatrix),n}}function Nu(u,n){let l=!1,p=null;const m=()=>{p=null,l&&(u(),p=setTimeout(m,n),l=!1)};return()=>(l=!0,p||m(),p)}class zd{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Nu(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Uu(n);if(this._hashName){const p=this._hashName;let m=!1;const y=o.window.location.hash.slice(1).split("&").map(w=>{const A=w.split("=")[0];return A===p?(m=!0,`${A}=${l}`):w}).filter(w=>w);return m||y.push(`${p}=${l}`),`#${y.join("&")}`}return`#${l}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}function Uu(u,n){const l=u.getCenter(),p=Math.round(100*u.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),w=Math.round(l.lng*y)/y,A=Math.round(l.lat*y)/y,S=u.getBearing(),P=u.getPitch();let D=n?`/${w}/${A}/${p}`:`${p}/${A}/${w}`;return(S||P)&&(D+="/"+Math.round(10*S)/10),P&&(D+=`/${Math.round(P)}`),D}const ro={linearity:.3,easing:o.bezier(0,0,.3,1)},kd=o.extend({deceleration:2500,maxSpeed:1400},ro),Vl=o.extend({deceleration:20,maxSpeed:1400},ro),ju=o.extend({deceleration:1e3,maxSpeed:360},ro),$l=o.extend({deceleration:1e3,maxSpeed:90},ro);class Od{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(l.pan.mag()){const y=oo(l.pan.mag(),p,o.extend({},kd,n||{}));m.offset=l.pan.mult(y.amount/l.pan.mag()),m.center=this._map.transform.center,La(m,y)}if(l.zoom){const y=oo(l.zoom,p,Vl);m.zoom=this._map.transform.zoom+y.amount,La(m,y)}if(l.bearing){const y=oo(l.bearing,p,ju);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),La(m,y)}if(l.pitch){const y=oo(l.pitch,p,$l);m.pitch=this._map.transform.pitch+y.amount,La(m,y)}if(m.zoom||m.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function La(u,n){(!u.duration||u.duration<n.duration)&&(u.duration=n.duration,u.easing=n.easing)}function oo(u,n,l){const{maxSpeed:p,linearity:m,deceleration:y}=l,w=o.clamp(u*m/(n/1e3),-p,p),A=Math.abs(w)/(y*m);return{easing:l.easing,duration:1e3*A,amount:w*(A/2)}}class rr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p,m={}){const y=Ce(l.getCanvasContainer(),p),w=l.unproject(y);super(n,o.extend({point:y,lngLat:w,originalEvent:p},m)),this._defaultPrevented=!1,this.target=l}}class Gl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){const m=n==="touchend"?p.changedTouches:p.touches,y=xt(l.getCanvasContainer(),m),w=y.map(S=>l.unproject(S)),A=y.reduce((S,P,D,R)=>S.add(P.div(R.length)),new o.pointGeometry(0,0));super(n,{points:y,point:A,lngLats:w,lngLat:l.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class Rd extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){super(n,{originalEvent:p}),this._defaultPrevented=!1}}class ql{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Rd(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new rr(n.type,this._map,n))}mouseup(n){this._map.fire(new rr(n.type,this._map,n))}preclick(n){const l=o.extend({},n);l.type="preclick",this._map.fire(new rr(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new rr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new rr(n.type,this._map,n))}mouseover(n){this._map.fire(new rr(n.type,this._map,n))}mouseout(n){this._map.fire(new rr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Gl(n.type,this._map,n))}touchmove(n){this._map.fire(new Gl(n.type,this._map,n))}touchend(n){this._map.fire(new Gl(n.type,this._map,n))}touchcancel(n){this._map.fire(new Gl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vu{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new rr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new rr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bd{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(et(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const p=l,m=this._startPos,y=this._lastPos;if(!m||!y||y.equals(p)||!this._box&&p.dist(m)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=de("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(m.x,p.x),A=Math.max(m.x,p.x),S=Math.min(m.y,p.y),P=Math.max(m.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${S}px)`,this._box.style.width=A-w+"px",this._box.style.height=P-S+"px")})}mouseupWindow(n,l){if(!this._active)return;const p=this._startPos,m=l;if(p&&n.button===0){if(this.reset(),ft(),p.x!==m.x||p.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(p,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ut(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.Event(n,{originalEvent:l}))}}function Zl(u,n){const l={};for(let p=0;p<u.length;p++)l[u[p].identifier]=n[p];return l}class Wl{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const w of m)y._add(w);return y.div(m.length)}(l),this.touches=Zl(p,l)))}touchmove(n,l,p){if(this.aborted||!this.centroid)return;const m=Zl(p,l);for(const y in this.touches){const w=this.touches[y],A=m[y];(!A||A.dist(w)>30)&&(this.aborted=!0)}}touchend(n,l,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class za{constructor(n){this.singleTap=new Wl(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,p){this.singleTap.touchstart(n,l,p)}touchmove(n,l,p){this.singleTap.touchmove(n,l,p)}touchend(n,l,p){const m=this.singleTap.touchend(n,l,p);if(m){const y=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(y&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Fd{constructor(){this._zoomIn=new za({numTouches:1,numTaps:2}),this._zoomOut=new za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,p){this._zoomIn.touchstart(n,l,p),this._zoomOut.touchstart(n,l,p)}touchmove(n,l,p){this._zoomIn.touchmove(n,l,p),this._zoomOut.touchmove(n,l,p)}touchend(n,l,p){const m=this._zoomIn.touchend(n,l,p),y=this._zoomOut.touchend(n,l,p);return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nd={0:1,2:2};class Hl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const p=Gt(n);this._correctButton(n,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(n,l){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(m,y){const w=Nd[y];return m.buttons===void 0||(m.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(n){this._lastPoint&&Gt(n)===this._eventButton&&(this._moved&&ft(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ud extends Hl{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class $u extends Hl{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=.8*(l.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class ts extends Hl{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=-.5*(l.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class jd{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(n,l,p){return this._calculateTransform(n,l,p)}touchmove(n,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,p)}}touchend(n,l,p){this._calculateTransform(n,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,p){p.length>0&&(this._active=!0);const m=Zl(p,l),y=new o.pointGeometry(0,0),w=new o.pointGeometry(0,0);let A=0;for(const P in m){const D=m[P],R=this._touches[P];R&&(y._add(D),w._add(D.sub(R)),A++,m[P]=D)}if(this._touches=m,A<this._minTouches||!w.mag())return;const S=w.div(A);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(A),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=de("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Xl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,p){return{}}touchstart(n,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,p){const m=this._firstTwoTouches;if(!m)return;n.preventDefault();const[y,w]=m,A=ka(p,l,y),S=ka(p,l,w);if(!A||!S)return;const P=this._aroundCenter?null:A.add(S).div(2);return this._move([A,S],P,n)}touchend(n,l,p){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,w=ka(p,l,m),A=ka(p,l,y);w&&A||(this._active&&ft(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ka(u,n,l){for(let p=0;p<u.length;p++)if(u[p].identifier===l)return n[p]}function Gu(u,n){return Math.log(u/n)/Math.LN2}class Vd extends Xl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Gu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gu(this._distance,p),pinchAround:l}}}function qu(u,n){return 180*u.angleWith(n)/Math.PI}class Pn extends Xl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:qu(this._vector,p),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const m=qu(n,p);return Math.abs(m)<l}}function Zu(u){return Math.abs(u.y)>Math.abs(u.x)}class $d extends Xl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Zu(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,p){const m=this._lastPoints;if(!m)return;const y=n[0].sub(m[0]),w=n[1].sub(m[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(n,l,p){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,y=l.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=n.y>0==l.y>0;return Zu(n)&&Zu(l)&&w}}const fm={panStep:100,bearingStep:15,pitchStep:10};class mm{constructor(){const n=fm;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,p=0,m=0,y=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:A=>{const S=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:so,zoom:l?Math.round(S)+l*(n.shiftKey?2:1):S,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function so(u){return u*(2-u)}const Wu=4.000244140625;class js{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=o.exported.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Wu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Ce(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Wu?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&P!==0&&(P=1/P);const D=l(),R=Math.pow(2,D),N=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(N*P))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),m=this._startZoom,y=this._easing;let w,A=!1;if(this._type==="wheel"&&m&&y){const S=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),P=y(S);w=o.number(m,p,P),S<1?this._frameId||(this._frameId=!0):A=!0}else w=p,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:w-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.ease;if(this._prevEase){const p=this._prevEase,m=(o.exported.now()-p.start)/p.duration,y=p.easing(m+.01)-p.easing(m),w=.27/Math.sqrt(y*y+1e-4)*.01,A=Math.sqrt(.0729-w*w);l=o.bezier(w,A,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=de("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Fr{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mt{constructor(){this._tap=new za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,l,p))}touchmove(n,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=l[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,l,p)}touchend(n,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,l,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gd{constructor(n,l,p){this._el=n,this._mousePan=l,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qd{constructor(n,l,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oa{constructor(n,l,p,m){this._el=n,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const So=u=>u.zoom||u.drag||u.pitch||u.rotate;class Zd extends o.Event{}class Wd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const p=o.sub([],l,n);this.radius=o.length(p[2]<0?o.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const l=o.scale$2([],n,this.radius);if(l[2]>0){const p=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),m=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),y=o.add([],l,o.scale$2([],o.sub([],o.add([],m,p),l),2));l[0]=y[0],l[1]=y[1]}return l}}function Ra(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Hd{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Od(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,y,w]of this._listeners)m.addEventListener(y,m===o.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[n,l,p]of this._listeners)n.removeEventListener(l,n===o.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(n){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ql(l,n));const m=l.boxZoom=new Bd(l,n);this._add("boxZoom",m);const y=new Fd,w=new Kl;l.doubleClickZoom=new Fr(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const A=new mt;this._add("tapDragZoom",A);const S=l.touchPitch=new $d(l);this._add("touchPitch",S);const P=new $u(n),D=new ts(n);l.dragRotate=new qd(n,P,D),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const R=new Ud(n),N=new jd(l,n);l.dragPan=new Gd(p,R,N),this._add("mousePan",R),this._add("touchPan",N,["touchZoom","touchRotate"]);const W=new Pn,$=new Vd;l.touchZoomRotate=new Oa(p,$,W,A),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vu(l));const H=l.scrollZoom=new js(l,this);this._add("scrollZoom",H,["mousePan"]);const q=l.keyboard=new mm;this._add("keyboard",q);for(const V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[V]&&l[V].enable(n[V])}_add(n,l,p){this._handlers.push({handlerName:n,handler:l,allowed:p}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!So(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,l,p){for(const m in n)if(m!==p&&(!l||l.indexOf(m)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const p of n)this._el.contains(p.target)&&l.push(p);return l}handleEvent(n,l){this._updatingCamera=!0;const p=n.type==="renderFrame",m=p?void 0:n,y={needsRenderFrame:!1},w={},A={},S=n.touches?this._getMapTouches(n.touches):void 0,P=S?xt(this._el,S):p?void 0:Ce(this._el,n);for(const{handlerName:N,handler:W,allowed:$}of this._handlers){if(!W.isEnabled())continue;let H;this._blockedByActive(A,$,N)?W.reset():W[l||n.type]&&(H=W[l||n.type](n,P,S),this.mergeHandlerResult(y,w,H,N,m),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||W.isActive())&&(A[N]=W)}const D={};for(const N in this._previousActiveHandlers)A[N]||(D[N]=m);this._previousActiveHandlers=A,(Object.keys(D).length||Ra(y))&&(this._changes.push([y,w,D]),this._triggerRenderFrame()),(Object.keys(A).length||Ra(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,l,p,m,y){if(!p)return;o.extend(n,p);const w={handlerName:m,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(l.zoom=w),p.panDelta!==void 0&&(l.drag=w),p.pitchDelta!==void 0&&(l.pitch=w),p.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const n={},l={},p={};for(const[m,y,w]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.aroundCoord!==void 0&&(n.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),o.extend(l,y),o.extend(p,w);this._updateMapTransform(n,l,p),this._changes=[]}_updateMapTransform(n,l,p){const m=this._map,y=m.transform,w=K=>[K.x,K.y,K.z];if((K=>{const Z=this._eventsInProgress.drag;return Z&&!this._handlersById[Z.handlerName].isActive()})()&&!Ra(n)){const K=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",K!==y.zoom&&this._map._update(!0)}if(!Ra(n))return void this._fireEvents(l,p,!0);let{panDelta:A,zoomDelta:S,bearingDelta:P,pitchDelta:D,around:R,aroundCoord:N,pinchAround:W}=n;W!==void 0&&(R=W),(K=>l.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=w(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),R=R||m.transform.centerPoint,P&&(y.bearing+=P),D&&(y.pitch+=D),y._updateCameraState();const $=[0,0,0];if(A)if(y.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R).dir),Z=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R.sub(A)).dir);$[0]=Z[0]-K[0],$[1]=Z[1]-K[1]}else{const K=y.pointCoordinate(R);if(y.projection.name==="globe"){A=A.rotate(-y.angle);const Z=y._pixelsPerMercatorPixel/y.worldSize;$[0]=-A.x*o.mercatorScale(o.latFromMercatorY(K.y))*Z,$[1]=-A.y*o.mercatorScale(y.center.lat)*Z}else{const Z=y.pointCoordinate(R.sub(A));K&&Z&&($[0]=Z.x-K.x,$[1]=Z.y-K.y)}}const H=y.zoom,q=[0,0,0];if(S){const K=w(N||y.pointCoordinate3D(R)),Z={dir:o.normalize([],o.sub([],K,y._camera.position))};if(Z.dir[2]<0){const oe=y.zoomDeltaToMovement(K,S);o.scale$2(q,Z.dir,oe)}}const V=o.add($,$,q);y._translateCameraConstrained(V),S&&Math.abs(y.zoom-H)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,p,!0)}_fireEvents(n,l,p){const m=So(this._eventsInProgress),y=So(n),w={};for(const D in n){const{originalEvent:R}=n[D];this._eventsInProgress[D]||(w[`${D}start`]=R),this._eventsInProgress[D]=n[D]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in w)this._fireEvent(D,w[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in n){const{originalEvent:R}=n[D];this._fireEvent(D,R)}const A={};let S;for(const D in this._eventsInProgress){const{handlerName:R,originalEvent:N}=this._eventsInProgress[D];this._handlersById[R].isActive()||(delete this._eventsInProgress[D],S=l[R]||N,A[`${D}end`]=S)}for(const D in A)this._fireEvent(D,A[D]);const P=So(this._eventsInProgress);if(p&&(m||y)&&!P){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;D?(R(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:S})):(this._map.fire(new o.Event("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Zd("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xd extends o.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,p){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},l),p)}panTo(n,l,p){return this.easeTo(o.extend({center:n},l),p)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,p){return this.easeTo(o.extend({zoom:n},l),p)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,p){return this.easeTo(o.extend({bearing:n},l),p)}resetNorth(n,l){return this.rotateTo(0,o.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.LngLatBounds.convert(n);const p=l&&l.bearing||0,m=n.getNorthWest(),y=n.getSouthEast();return this._cameraForBounds(this.transform,m,y,p,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if(typeof(n=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const p=n.padding;n.padding={top:p,bottom:p,right:p,left:p}}return n.padding=o.extend(l,n.padding),n}_minimumAABBFrustumDistance(n,l){const p=l.max[0]-l.min[0],m=l.max[1]-l.min[1];return p/m>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):m/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,p,m,y){const w=n.clone(),A=this._extendCameraOptions(y);w.bearing=m;const S=o.LngLat.convert(l),P=o.LngLat.convert(p),D=.5*(S.lat+P.lat),R=.5*(S.lng+P.lng),N=o.latLngToECEF(D,R),W=o.normalize([],N),$=o.normalize([],o.cross([],W,[0,1,0])),H=o.cross([],$,W),q=[$[0],$[1],$[2],0,H[0],H[1],H[2],0,W[0],W[1],W[2],0,0,0,0,1],V=[N,o.latLngToECEF(S.lat,S.lng),o.latLngToECEF(P.lat,S.lng),o.latLngToECEF(P.lat,P.lng),o.latLngToECEF(S.lat,P.lng),o.latLngToECEF(D,S.lng),o.latLngToECEF(D,P.lng),o.latLngToECEF(S.lat,R),o.latLngToECEF(P.lat,R)];let K=o.Aabb.fromPoints(V.map(Ke=>[o.dot($,Ke),o.dot(H,Ke),o.dot(W,Ke)]));const Z=o.transformMat4([],K.center,q);o.squaredLength(Z)===0&&o.set(Z,0,0,1),o.normalize(Z,Z),o.scale$2(Z,Z,o.GLOBE_RADIUS),w.center=o.ecefToLatLng(Z);const oe=w.getWorldToCameraMatrix(),ae=o.invert(new Float64Array(16),oe);K=o.Aabb.applyTransform(K,o.multiply([],oe,q)),o.transformMat4(Z,Z,oe);const te=.5*(K.max[2]-K.min[2]),ce=this._minimumAABBFrustumDistance(w,K),be=o.scale$2([],[0,0,1],te),Pe=o.add(be,Z,be),Ae=ce+(w.pitch===0?0:o.distance(Z,Pe)),Ze=w.globeCenterInViewSpace,_e=o.sub([],Z,[Ze[0],Ze[1],Ze[2]]);o.normalize(_e,_e),o.scale$2(_e,_e,Ae);const Be=o.add([],Z,_e);o.transformMat4(Be,Be,ae);const Re=o.earthRadius/o.GLOBE_RADIUS,we=o.length(Be),fe=o.mercatorZfromAltitude(we*Re-o.earthRadius,0),st=Math.min(w.zoomFromMercatorZAdjusted(fe),A.maxZoom);return st>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(w.setProjection({name:"mercator"}),w.zoom=st,this._cameraForBounds(w,l,p,m,y)):{center:w.center,zoom:st,bearing:m}}queryTerrainElevation(n,l){const p=this.transform.elevation;return p?(l=o.extend({},{exaggerated:!0},l),p.getAtPoint(o.MercatorCoordinate.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,p,m,y){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,p,m,y);const w=n.clone(),A=this._extendCameraOptions(y),S=w.padding;w.bearing=m;const P=o.LngLat.convert(l),D=o.LngLat.convert(p),R=new o.LngLat(P.lng,D.lat),N=new o.LngLat(D.lng,P.lat),W=w.project(P),$=w.project(D),H=this.queryTerrainElevation(P),q=this.queryTerrainElevation(D),V=this.queryTerrainElevation(R),K=this.queryTerrainElevation(N),Z=[[W.x,W.y,Math.min(H||0,q||0,V||0,K||0)],[$.x,$.y,Math.max(H||0,q||0,V||0,K||0)]];let oe=o.Aabb.fromPoints(Z);const ae=w.getWorldToCameraMatrix(),te=o.invert(new Float64Array(16),ae);oe=o.Aabb.applyTransform(oe,ae);const ce=o.sub([],oe.max,oe.min),be=S.left||0,Pe=S.right||0,Ae=S.bottom||0,Ze=S.top||0,{left:_e,right:Be,top:Re,bottom:we}=A.padding,fe=.5*(be+Pe),st=.5*(Ze+Ae),Ke=Math.min(w.scaleZoom(w.scale*Math.min((w.width-(be+Pe+_e+Be))/ce[0],(w.height-(Ae+Ze+we+Re))/ce[1])),A.maxZoom),tt=w.scale/w.zoomScale(Ke);oe=new o.Aabb([oe.min[0]-(_e+fe)*tt,oe.min[1]-(we+st)*tt,oe.min[2]],[oe.max[0]+(Be+fe)*tt,oe.max[1]+(Re+st)*tt,oe.max[2]]);const Je=.5*ce[2],vt=this._minimumAABBFrustumDistance(w,oe),kt=[0,0,1,0];o.transformMat4$1(kt,kt,ae),o.normalize$2(kt,kt);const Pt=o.scale$2([],kt,vt+Je),Et=o.add([],oe.center,Pt),Qe=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new o.pointGeometry(A.offset.x,A.offset.y):o.pointGeometry.convert(A.offset)).rotate(-o.degToRad(m));oe.center[0]-=Qe.x*tt,oe.center[1]+=Qe.y*tt,o.transformMat4(oe.center,oe.center,te),o.transformMat4(Et,Et,te);const Bt=[oe.center[0],oe.center[1],Et[2]*w.pixelsPerMeter];o.scale$2(Bt,Bt,1/w.worldSize);const qt=o.lngFromMercatorX(Bt[0]),Ti=o.latFromMercatorY(Bt[1]),Ai=Math.min(w._zoomFromMercatorZ(Bt[2]),A.maxZoom),yi=new o.LngLat(qt,Ti);return w.mercatorFromTransition&&Ai<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(w.setProjection({name:"globe"}),w.zoom=Ai,this._cameraForBounds(w,l,p,m,y)):{center:yi,zoom:Ai,bearing:m}}fitBounds(n,l,p){const m=this.cameraForBounds(n,l);return this._fitInternal(m,l,p)}fitScreenCoordinates(n,l,p,m,y){const w=o.pointGeometry.convert(n),A=o.pointGeometry.convert(l),S=new o.pointGeometry(Math.min(w.x,A.x),Math.min(w.y,A.y)),P=new o.pointGeometry(Math.max(w.x,A.x),Math.max(w.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,A))return this;const D=this.transform.pointLocation3D(S),R=this.transform.pointLocation3D(P),N=this.transform.pointLocation3D(new o.pointGeometry(S.x,P.y)),W=this.transform.pointLocation3D(new o.pointGeometry(P.x,S.y)),$=[Math.min(D.lng,R.lng,N.lng,W.lng),Math.min(D.lat,R.lat,N.lat,W.lat)],H=[Math.max(D.lng,R.lng,N.lng,W.lng),Math.max(D.lat,R.lat,N.lat,W.lat)],q=this._cameraForBounds(this.transform,$,H,p,m);return this._fitInternal(q,m,y)}_fitInternal(n,l,p){return n?(delete(l=o.extend(n,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(n,l){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,w=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(m=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=o.LngLat.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(y=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(w=!0,p.pitch=+n.pitch),n.padding==null||p.isPaddingEqual(n.padding)||(p.padding=n.padding),n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),m&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),y&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),w&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Hu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.warnOnce(Hu),this;this.stop();const m=p.zoom,y=p.pitch,w=p.bearing;p.setFreeCameraOptions(n);const A=m!==p.zoom,S=y!==p.pitch,P=w!==p.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),A&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),P&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),S&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate===!1||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);const p=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),A=this.getPadding(),S="zoom"in n?+n.zoom:m,P="bearing"in n?this._normalizeBearing(n.bearing,y):y,D="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:p.padding,N=o.pointGeometry.convert(n.offset);let W,$,H;if(p.projection.name==="globe"){const Pe=o.MercatorCoordinate.fromLngLat(p.center),Ae=N.rotate(-p.angle);Pe.x+=Ae.x/p.worldSize,Pe.y+=Ae.y/p.worldSize;const Ze=Pe.toLngLat(),_e=o.LngLat.convert(n.center||Ze);this._normalizeCenter(_e),W=p.centerPoint.add(Ae),$=new o.pointGeometry(Pe.x,Pe.y).mult(p.worldSize),H=new o.pointGeometry(o.mercatorXfromLng(_e.lng),o.mercatorYfromLat(_e.lat)).mult(p.worldSize).sub($)}else{W=p.centerPoint.add(N);const Pe=p.pointLocation(W),Ae=o.LngLat.convert(n.center||Pe);this._normalizeCenter(Ae),$=p.project(Pe),H=p.project(Ae).sub($)}const q=p.zoomScale(S-m);let V,K;n.around&&(V=o.LngLat.convert(n.around),K=p.locationPoint(V));const Z=this._zooming||S!==m,oe=this._rotating||y!==P,ae=this._pitching||D!==w,te=!p.isPaddingEqual(R),ce=Pe=>Ae=>{if(Z&&(Pe.zoom=o.number(m,S,Ae)),oe&&(Pe.bearing=o.number(y,P,Ae)),ae&&(Pe.pitch=o.number(w,D,Ae)),te&&(Pe.interpolatePadding(A,R,Ae),W=Pe.centerPoint.add(N)),V)Pe.setLocationAtPoint(V,K);else{const Ze=Pe.zoomScale(Pe.zoom-m),_e=S>m?Math.min(2,q):Math.max(.5,q),Be=Math.pow(_e,1-Ae),Re=Pe.unproject($.add(H.mult(Ae*Be)).mult(Ze));Pe.setLocationAtPoint(Pe.renderWorldCopies?Re.wrap():Re,W)}return n.preloadOnly||this._fireMoveEvents(l),Pe};if(n.preloadOnly){const Pe=this._emulate(ce,n.duration,p);return this._preloadTiles(Pe),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Z,this._rotating=oe,this._pitching=ae,this._padding=te,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,be),this._ease(ce(p),Pe=>{p.recenterOnTerrain(),this._afterEase(l,Pe)},n),this}_prepareEase(n,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!p.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.Event("zoomend",n)),m&&this.fire(new o.Event("rotateend",n)),y&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,l){if(!n.essential&&o.exported.prefersReducedMotion){const tt=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,l)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const p=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),A=this.getPadding(),S="zoom"in n?o.clamp(+n.zoom,p.minZoom,p.maxZoom):m,P="bearing"in n?this._normalizeBearing(n.bearing,y):y,D="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:p.padding,N=p.zoomScale(S-m),W=o.pointGeometry.convert(n.offset);let $=p.centerPoint.add(W);const H=p.pointLocation($),q=o.LngLat.convert(n.center||H);this._normalizeCenter(q);const V=p.project(H),K=p.project(q).sub(V);let Z=n.curve;const oe=Math.max(p.width,p.height),ae=oe/N,te=K.mag();if("minZoom"in n){const tt=o.clamp(Math.min(n.minZoom,m,S),p.minZoom,p.maxZoom),Je=oe/p.zoomScale(tt-m);Z=Math.sqrt(Je/te*2)}const ce=Z*Z;function be(tt){const Je=(ae*ae-oe*oe+(tt?-1:1)*ce*ce*te*te)/(2*(tt?ae:oe)*ce*te);return Math.log(Math.sqrt(Je*Je+1)-Je)}function Pe(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Ae(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ze=be(0);let _e=function(tt){return Ae(Ze)/Ae(Ze+Z*tt)},Be=function(tt){return oe*((Ae(Ze)*(Pe(Je=Ze+Z*tt)/Ae(Je))-Pe(Ze))/ce)/te;var Je},Re=(be(1)-Ze)/Z;if(Math.abs(te)<1e-6||!isFinite(Re)){if(Math.abs(oe-ae)<1e-6)return this.easeTo(n,l);const tt=ae<oe?-1:1;Re=Math.abs(Math.log(ae/oe))/Z,Be=function(){return 0},_e=function(Je){return Math.exp(tt*Z*Je)}}n.duration="duration"in n?+n.duration:1e3*Re/("screenSpeed"in n?+n.screenSpeed/Z:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const we=y!==P,fe=D!==w,st=!p.isPaddingEqual(R),Ke=tt=>Je=>{const vt=Je*Re,kt=1/_e(vt);tt.zoom=Je===1?S:m+tt.scaleZoom(kt),we&&(tt.bearing=o.number(y,P,Je)),fe&&(tt.pitch=o.number(w,D,Je)),st&&(tt.interpolatePadding(A,R,Je),$=tt.centerPoint.add(W));const Pt=Je===1?q:tt.unproject(V.add(K.mult(Be(vt))).mult(kt));return tt.setLocationAtPoint(tt.renderWorldCopies?Pt.wrap():Pt,$),tt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),tt};if(n.preloadOnly){const tt=this._emulate(Ke,n.duration,p);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=we,this._pitching=fe,this._padding=st,this._prepareEase(l,!1),this._ease(Ke(p),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,l,p){p.animate===!1||p.duration===0?(n(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.wrap(n,-180,180);const p=Math.abs(n-l);return Math.abs(n-360-l)<p&&(n-=360),Math.abs(n+360-l)<p&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=n.lng-l.center.lng;n.lng+=p>180?-360:p<-180?360:0}_emulate(n,l,p){const m=Math.ceil(15*l/1e3),y=[],w=n(p.clone());for(let A=0;A<=m;A++){const S=w(A/m);y.push(S.clone())}return y}}class Xu{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=de("button","mapboxgl-ctrl-attrib-button",this._container),de("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=de("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const p=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",p),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const p=l.reduce((m,y,w)=>(y.value&&(m+=`${y.key}=${y.value}${w<l.length-1?"&":""}`),m),"?");n.href=`${o.config.FEEDBACK_URL}/${p}#${Uu(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const l=this._map.style._sourceCaches;for(const m in l){const y=l[m];if(y.used){const w=y.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((m,y)=>m.length-y.length),n=n.filter((m,y)=>{for(let w=y+1;w<n.length;w++)if(n[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ba{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=de("div","mapboxgl-ctrl");const l=de("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const p=n[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const m of p)if(m.id===n)return void(m.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fa(u,n,l){if(u=new o.LngLat(u.lng,u.lat),n){const p=new o.LngLat(u.lng-360,u.lat),m=new o.LngLat(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-l.center.lng)/360),w=l.locationPoint(u).distSqr(n),A=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(p).distSqr(n)<w&&(A||Math.abs(p.lng-l.center.lng)<y)?u=p:l.locationPoint(m).distSqr(n)<w&&(A||Math.abs(m.lng-l.center.lng)<y)&&(u=m)}for(;Math.abs(u.lng-l.center.lng)>180;){const p=l.locationPoint(u);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;u.lng>l.center.lng?u.lng-=360:u.lng+=360}return u}const Jl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ql extends o.Evented{constructor(n,l){if(super(),(n instanceof o.window.HTMLElement||l)&&(n=o.extend({element:n},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=de("div");const m=41,y=27,w=xe("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),A=xe("radialGradient",{id:"shadowGradient"},xe("defs",{},w));xe("stop",{offset:"10%","stop-opacity":.4},A),xe("stop",{offset:"100%","stop-opacity":.05},A),xe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),xe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),xe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),xe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const p=this._element.classList;for(const m in Jl)p.remove(`mapboxgl-marker-anchor-${m}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,p=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const p=n.unproject(l),m=n.getFreeCameraOptions();if(!m.position)return!1;const y=m.position.toLngLat();return y.distanceTo(p)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(l);let m;n._showingGlobe()&&o.isLngLatBehindGlobe(n.transform,this._lngLat)?m=0:(m=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Jl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!n||p!=="map")return"";if(!l._showingGlobe()){const S=l.getPitch();return S?`rotateX(${S}deg)`:""}const m=o.radToDeg(o.globeTiltAtLngLat(l.transform,this._lngLat)),y=n.sub(o.globeCenterToScreenPoint(l.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const A=m/w;return`rotateX(${-y.y*A}deg) rotateY(${y.x*A}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let p=0;const m=this.getRotationAlignment();if(m==="map")if(l._showingGlobe()){const y=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),w=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);p=o.radToDeg(Math.atan2(w.y,w.x))-90}else p=-l.getBearing();else if(m==="horizon"){const y=o.smoothstep(4,6,l.getZoom()),w=o.globeCenterToScreenPoint(l.transform);w.y+=y*l.transform.height;const A=n.sub(w),S=o.radToDeg(Math.atan2(A.y,A.x));p=(S>90?S-270:S+90)*(1-y)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){o.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Fa(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){const l=this._map;if(!l)return;const p=this._pointerdownPos,m=this._positionDelta;if(p&&m){if(!this._isDragging){const y=this._clickTolerance||l._clickTolerance;if(n.point.dist(p)<y)return;this._isDragging=!0}this._pos=n.point.sub(m),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,p=this._pos;l&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Kd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ku(u=new o.pointGeometry(0,0),n="bottom"){if(typeof u=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(n){case"top":return new o.pointGeometry(0,u);case"top-left":return new o.pointGeometry(l,l);case"top-right":return new o.pointGeometry(-l,l);case"bottom":return new o.pointGeometry(0,-u);case"bottom-left":return new o.pointGeometry(l,-l);case"bottom-right":return new o.pointGeometry(-l,-l);case"left":return new o.pointGeometry(u,0);case"right":return new o.pointGeometry(-u,0)}return new o.pointGeometry(0,0)}return u instanceof o.pointGeometry||Array.isArray(u)?o.pointGeometry.convert(u):o.pointGeometry.convert(u[n]||[0,0])}class Jd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,p){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+p}}const Qd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Yu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ec(u){u.parentNode&&u.parentNode.removeChild(u)}const ep={showCompass:!0,showZoom:!0,visualizePitch:!1};class tp{constructor(n,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new $u({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new ts({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),et()}move(n,l){const p=this.map,m=this.mouseRotate.mousemoveWindow(n,l),y=m&&m.bearingDelta;if(y&&p.setBearing(p.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,l),A=w&&w.pitchDelta;A&&p.setPitch(p.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ut(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ce(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ce(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=xt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ip={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ju={maxWidth:100,unit:"metric"};function np(u,n,l){const p=tc(n),m=p/n,y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=u*m+"px",this._container.innerHTML=`${p}&nbsp;${y}`})}function tc(u){const n=Math.pow(10,`${Math.floor(u)}`.length-1);let l=u/n;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const m=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*m)/m}(l),n*l}const Na={version:o.version,supported:U,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Xd{constructor(u){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(u=o.extend({},Yu,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(u.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new nr(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Yl,this._domRenderTaskQueue=new Yl,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Qd,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=o.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Hd(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new zd(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,o.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new Xu({customAttribution:u.customAttribution})),this._logoControl=new Ba,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(u,n){if(n===void 0&&(n=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=u.onAdd(this);this._controls.push(u);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(u);return n>-1&&this._controls.splice(n,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),this.fire(new o.Event("resize",u)),n&&this.fire(new o.Event("moveend",u)),this}getBounds(){return this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(o.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?o.window.navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(n=>n==="auto"?o.window.navigator.language:n):u}setLanguage(u){const n=this._parseLanguage(u);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,n=u.projection.name;let l;n==="globe"&&u.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(u.setMercatorFromTransition(),l=!0):n==="mercator"&&u.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(u.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,n){return this._updateProjection(u||n||{name:"mercator"})}_updateProjection(u){let n;if(n=u.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(u){return this.transform.locationPoint3D(o.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(o.pointGeometry.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(u,n,l){if(u==="mouseenter"||u==="mouseover"){let p=!1;const m=w=>{const A=n.filter(P=>this.getLayer(P)),S=A.length?this.queryRenderedFeatures(w.point,{layers:A}):[];S.length?p||(p=!0,l.call(this,new rr(u,this,w.originalEvent,{features:S}))):p=!1},y=()=>{p=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:m,mouseout:y}}}if(u==="mouseleave"||u==="mouseout"){let p=!1;const m=w=>{const A=n.filter(S=>this.getLayer(S));(A.length?this.queryRenderedFeatures(w.point,{layers:A}):[]).length?p=!0:p&&(p=!1,l.call(this,new rr(u,this,w.originalEvent)))},y=w=>{p&&(p=!1,l.call(this,new rr(u,this,w.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:m,mouseout:y}}}{const p=m=>{const y=n.filter(A=>this.getLayer(A)),w=y.length?this.queryRenderedFeatures(m.point,{layers:y}):[];w.length&&(m.features=w,l.call(this,m),delete m.features)};return{layers:new Set(n),listener:l,delegates:{[u]:p}}}}on(u,n,l){if(l===void 0)return super.on(u,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(u,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(u,n,l){if(l===void 0)return super.once(u,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(u,n,l);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(u,n,l){if(l===void 0)return super.off(u,n);n=new Set(Array.isArray(n)?n:[n]);const p=(y,w)=>{if(y.size!==w.size)return!1;for(const A of y)if(!w.has(A))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[u]:void 0;return m&&(y=>{for(let w=0;w<y.length;w++){const A=y[w];if(A.listener===l&&p(A.layers,n)){for(const S in A.delegates)this.off(S,A.delegates[S]);return y.splice(w,1),this}}})(m),this}queryRenderedFeatures(u,n){return this.style?(n!==void 0||u===void 0||u instanceof o.pointGeometry||Array.isArray(u)||(n=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(u,n){return this.style.querySourceFeatures(u,n)}setStyle(u,n){return(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(u,n))}_getUIString(u){const n=this._locale[u];if(n==null)throw new Error(`Missing UI string '${u}'`);return n}_updateStyle(u,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new kr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,n){if(typeof u=="string"){const l=this._requestManager.normalizeStyleURL(u),p=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(p,(m,y)=>{m?this.fire(new o.ErrorEvent(m)):y&&this._updateDiff(y,n)})}else typeof u=="object"&&this._updateDiff(u,n)}_updateDiff(u,n){try{this.style.setState(u)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(u,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(u,n){return this._lazyInitEmptyStyle(),this.style.addSource(u,n),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const n in u){const l=u[n]._tiles;for(const p in l){const m=l[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(u,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(u,n,l)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,n,{pixelRatio:l=1,sdf:p=!1,stretchX:m,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap){const{width:A,height:S,data:P}=o.exported.getImageData(n);this.style.addImage(u,{data:new o.RGBAImage({width:A,height:S},P),pixelRatio:l,stretchX:m,stretchY:y,content:w,sdf:p,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:S}=n,P=n;this.style.addImage(u,{data:new o.RGBAImage({width:A,height:S},new Uint8Array(P.data)),pixelRatio:l,stretchX:m,stretchY:y,content:w,sdf:p,version:0,userImage:P}),P.onAdd&&P.onAdd(this,u)}}updateImage(u,n){const l=this.style.getImage(u);if(!l)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap?o.exported.getImageData(n):n,{width:m,height:y}=p;m!==void 0&&y!==void 0?m===l.data.width&&y===l.data.height?(l.data.replace(p.data,!(n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap)),this.style.updateImage(u,l)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,n){o.getImage(this._requestManager.transformRequest(u,o.ResourceType.Image),(l,p)=>{n(l,p instanceof o.window.HTMLImageElement?o.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(u,n){return this._lazyInitEmptyStyle(),this.style.addLayer(u,n),this._update(!0)}moveLayer(u,n){return this.style.moveLayer(u,n),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,n,l){return this.style.setLayerZoomRange(u,n,l),this._update(!0)}setFilter(u,n,l={}){return this.style.setFilter(u,n,l),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,n,l,p={}){return this.style.setPaintProperty(u,n,l,p),this._update(!0)}getPaintProperty(u,n){return this.style.getPaintProperty(u,n)}setLayoutProperty(u,n,l,p={}){return this.style.setLayoutProperty(u,n,l,p),this._update(!0)}getLayoutProperty(u,n){return this.style.getLayoutProperty(u,n)}setLight(u,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(u),this.transform):0}setFeatureState(u,n){return this.style.setFeatureState(u,n),this._update()}removeFeatureState(u,n){return this.style.removeFeatureState(u,n),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,p,m,y=this._container;for(;y&&(!p||!m);){const w=o.window.getComputedStyle(y).transform;w&&w!=="none"&&(l=w.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(m=l[3])),y=y.parentElement}this._containerWidth=p?Math.abs(u/p):u,this._containerHeight=m?Math.abs(n/m):n}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=de("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=de("div","mapboxgl-canvas-container",u);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=de("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=de("div","mapboxgl-control-container",u),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{p[m]=de("div",`mapboxgl-ctrl-${m}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,n){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(u),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${n}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const n=this._markers.indexOf(u);n!==-1&&this._markers.splice(n,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const n=this._popups.indexOf(u);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const u=o.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);n?(o.storeAuthState(n,!0),this.painter=new pm(n,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(n)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let n;const l=this.painter.context.extTimerQuery,p=o.exported.now();if(this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();let m=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,P=this.transform.pitch,D=o.exported.now();this.style.zoomHistory.update(S,D);const R=new o.EvaluationParameters(S,{now:D,fadeDuration:y,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=R.crossFadingFactor();N===1&&N===this._crossFadingFactor||(m=!0,this._crossFadingFactor=N),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const S=o.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const P=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:S,gpuTime:P})),o.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(S);this.fire(new o.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(S);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(A||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const n of this._markers)u&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!u||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(u,n=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((n||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const p=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=u;const w=Math.abs(p-m);if(w>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(m),l(m);this._averageElevation.easeTo(m,u,300)}else if(w>1e-4)return this._averageElevation.jumpTo(m),l(m)}return!!this._averageElevation.isEasing(u)&&l(this._averageElevation.getValue(u))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===o.AUTH_ERR_MSG||u.status===401)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof Ba&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function m(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(m(u),n.canvasCopies.map(m),n.timeStamps)}_canvasPixelComparison(u,n,l){let p=l[1]-l[0];const m=u.length/4;for(let y=0;y<n.length;y++){const w=n[y];let A=0;for(let S=0;S<w.length;S+=4)w[S]===u[S]&&w[S+1]===u[S+1]&&w[S+2]===u[S+2]&&w[S+3]===u[S+3]&&(A+=1);p+=(l[y+2]-l[y+1])*(1-A/m)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),ec(this._canvasContainer),ec(this._controlContainer),ec(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(u){const n=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(n,(l,p)=>l._preloadTiles(u,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,n){o.setCacheLimits(u,n)}get version(){return o.version}},NavigationControl:class{constructor(u){this.options=o.extend({},ep,u),this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),de("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),de("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=de("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const n=u.getZoom(),l=n===u.getMaxZoom(),p=n===u.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tp(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,n){const l=de("button",u,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(u,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);u.setAttribute("aria-label",l),u.firstElementChild&&u.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(u){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ip,u),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Nu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,u(l)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(u){const n=this._map.getMaxBounds(),l=u.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",u)),this._finish()}}_updateCamera(u){const n=new o.LngLat(u.coords.longitude,u.coords.latitude),l=u.coords.accuracy,p=this._map.getBearing(),m=o.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),m,{geolocateSource:!0})}_updateMarker(u){if(u){const n=new o.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,n=o.mercatorZfromAltitude(1,u._center.lat)*u.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=de("button","mapboxgl-ctrl-geolocate",this._container),de("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=de("div","mapboxgl-user-location"),this._dotElement.appendChild(de("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(de("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ql({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=de("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ql({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xu,ScaleControl:class{constructor(u){this.options=o.extend({},Ju,u),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=np.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,p=n._containerWidth/2-u/2,m=n.unproject([p,l]),y=n.unproject([p+u,l]),w=m.distanceTo(y);if(this.options.unit==="imperial"){const A=3.2808*w;A>5280?this._setScale(u,A/5280,"mile"):this._setScale(u,A,"foot")}else this.options.unit==="nautical"?this._setScale(u,w/1852,"nautical-mile"):w>=1e3?this._setScale(u,w/1e3,"kilometer"):this._setScale(u,w,"meter")}_setScale(u,n,l){const p=tc(n),m=p/n;this._map._requestDomTask(()=>{this._container.style.width=u*m+"px",this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof o.window.HTMLElement?this._container=u.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=de("button","mapboxgl-ctrl-fullscreen",this._controlContainer);de("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(u){super(),this.options=o.extend(Object.create(Kd),u),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=o.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(o.window.document.createTextNode(u))}setHTML(u){const n=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let p;for(l.innerHTML=u;p=l.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=de("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(u),this.options.closeButton){const l=this._closeButton=de("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let n;return this._classList.delete(u)?n=!1:(this._classList.add(u),n=!0),this._updateClassList(),n}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,p=this._pos;if(!n||!l||!p)return"bottom";const m=l.offsetWidth,y=l.offsetHeight,w=p.x<m/2,A=p.x>n.transform.width-m/2;if(p.y+u<y)return w?"top-left":A?"top-right":"top";if(p.y>n.transform.height-y){if(w)return"bottom-left";if(A)return"bottom-right"}return w?"left":A?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),u.className=n.join(" ")}_update(u){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=de("div","mapboxgl-popup",n.getContainer()),this._tip=de("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fa(this._lngLat,this._pos,n.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u?u:n.project(this._lngLat),y=Ku(this.options.offset),w=this._anchor=this._getAnchor(y.y),A=Ku(this.options.offset,w),S=m.add(A).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Jl[w]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&n._showingGlobe()){const m=o.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Yd);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Ql,Style:kr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Ma,Evented:o.Evented,config:o.config,prewarm:function(){Ot().acquire(Mt)},clearPrewarmedResources:function(){const u=Tt;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Mt),Tt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(u){o.config.ACCESS_TOKEN=u},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(u){o.config.API_URL=u},get workerCount(){return St.workerCount},set workerCount(u){St.workerCount=u},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){o.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){o.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Na});var I=x;return I})})(PC);const jc=lg;var Qc=LC,DC=Object.prototype.hasOwnProperty;function LC(){for(var s={},a=0;a<arguments.length;a++){var d=arguments[a];for(var g in d)DC.call(d,g)&&(s[g]=d[g])}return s}var cg={},zC={get exports(){return cg},set exports(s){cg=s}};(function(s,a){(function(){var d={};s.exports=d,d.simpleFilter=function(g,x){return x.filter(function(E){return d.test(g,E)})},d.test=function(g,x){return d.match(g,x)!==null},d.match=function(g,x,E){E=E||{};var I=0,o=[],L=x.length,U=0,G=0,J=E.pre||"",de=E.post||"",xe=E.caseSensitive&&x||x.toLowerCase(),ge;g=E.caseSensitive&&g||g.toLowerCase();for(var Ie=0;Ie<L;Ie++)ge=x[Ie],xe[Ie]===g[I]?(ge=J+ge+de,I+=1,G+=1+G):G=0,U+=G,o[o.length]=ge;return I===g.length?(U=xe===g?1/0:U,{rendered:o.join(""),score:U}):null},d.filter=function(g,x,E){return!x||x.length===0?[]:typeof g!="string"?x:(E=E||{},x.reduce(function(I,o,L,U){var G=o;E.extract&&(G=E.extract(o));var J=d.match(g,G,E);return J!=null&&(I[I.length]={string:J.rendered,score:J.score,index:L,original:o}),I},[]).sort(function(I,o){var L=o.score-I.score;return L||I.index-o.index}))}})()})(zC);var yr=function(s){return this.component=s,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,s.el.parentNode.insertBefore(this.wrapper,s.el.nextSibling),this};yr.prototype.show=function(){this.element.style.display="block"};yr.prototype.hide=function(){this.element.style.display="none"};yr.prototype.add=function(s){this.items.push(s)};yr.prototype.clear=function(){this.items=[],this.active=0};yr.prototype.isEmpty=function(){return!this.items.length};yr.prototype.isVisible=function(){return this.element.style.display==="block"};yr.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var s=0;s<this.items.length;s++)this.drawItem(this.items[s],this.active===s);this.show()};yr.prototype.drawItem=function(s,a){var d=document.createElement("li"),g=document.createElement("a");a&&(d.className+=" active"),g.innerHTML=s.string,d.appendChild(g),this.element.appendChild(d),d.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),d.addEventListener("mouseup",function(){this.handleMouseUp.call(this,s)}.bind(this))};yr.prototype.handleMouseUp=function(s){this.selectingListItem=!1,this.component.value(s.original),this.clear(),this.draw()};yr.prototype.move=function(s){this.active=s,this.draw()};yr.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};yr.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};yr.prototype.drawError=function(s){var a=document.createElement("li");a.innerHTML=s,this.element.appendChild(a),this.show()};var kC=yr,OC=Qc,RC=cg,BC=kC,tr=function(s,a,d){return d=d||{},this.options=OC({minLength:2,limit:5,filter:!0,hideOnBlur:!0},d),this.el=s,this.data=a||[],this.list=new BC(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(g){this.handleKeyUp(g.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(g){this.handleKeyDown(g)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(g){this.handlePaste(g)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};tr.prototype.handleKeyUp=function(s){s===40||s===38||s===27||s===13||s===9||this.handleInputChange(this.el.value)};tr.prototype.handleKeyDown=function(s){switch(s.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&s.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};tr.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};tr.prototype.handlePaste=function(s){if(s.clipboardData)this.handleInputChange(s.clipboardData.getData("Text"));else{var a=this;setTimeout(function(){a.handleInputChange(s.target.value)},100)}};tr.prototype.handleInputChange=function(s){if(this.query=this.normalize(s),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(a){for(var d=0;d<a.length&&(this.list.add(a[d]),d!==this.options.limit-1);d++);this.list.draw()}.bind(this))};tr.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};tr.prototype.update=function(s){this.data=s,this.handleKeyUp()};tr.prototype.clear=function(){this.data=[],this.list.clear()};tr.prototype.normalize=function(s){return s=s.toLowerCase(),s};tr.prototype.match=function(s,a){return s.indexOf(a)>-1};tr.prototype.value=function(s){if(this.selected=s,this.el.value=this.getItemValue(s),document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!1),this.el.dispatchEvent(a)}else this.el.fireEvent("onchange")};tr.prototype.getCandidates=function(s){var a={pre:"<strong>",post:"</strong>",extract:function(g){return this.getItemValue(g)}.bind(this)},d;this.options.filter?(d=RC.filter(this.query,this.data,a),d=d.map(function(g){return{original:g.original,string:this.render(g.original,g.string)}}.bind(this))):d=this.data.map(function(g){var x=this.render(g);return{original:g,string:x}}.bind(this)),s(d)};tr.prototype.getItemValue=function(s){return s};tr.prototype.render=function(s,a){if(a)return a;for(var d=s.original?this.getItemValue(s.original):this.getItemValue(s),g=this.normalize(d),x=g.lastIndexOf(this.query);x>-1;){var E=x+this.query.length;d=d.slice(0,x)+"<strong>"+d.slice(x,E)+"</strong>"+d.slice(E),x=g.slice(0,x).lastIndexOf(this.query)}return d};tr.prototype.renderError=function(s){this.list.drawError(s)};var FC=tr,B1=FC,NC=B1;typeof window<"u"&&(window.Suggestions=B1);var UC="Expected a function",P0=0/0,jC="[object Symbol]",VC=/^\s+|\s+$/g,$C=/^[-+]0x[0-9a-f]+$/i,GC=/^0b[01]+$/i,qC=/^0o[0-7]+$/i,ZC=parseInt,WC=typeof _o=="object"&&_o&&_o.Object===Object&&_o,HC=typeof self=="object"&&self&&self.Object===Object&&self,XC=WC||HC||Function("return this")(),KC=Object.prototype,YC=KC.toString,JC=Math.max,QC=Math.min,S_=function(){return XC.Date.now()};function eI(s,a,d){var g,x,E,I,o,L,U=0,G=!1,J=!1,de=!0;if(typeof s!="function")throw new TypeError(UC);a=D0(a)||0,ug(d)&&(G=!!d.leading,J="maxWait"in d,E=J?JC(D0(d.maxWait)||0,a):E,de="trailing"in d?!!d.trailing:de);function xe(xt){var Gt=g,At=x;return g=x=void 0,U=xt,I=s.apply(At,Gt),I}function ge(xt){return U=xt,o=setTimeout(et,a),G?xe(xt):I}function Ie(xt){var Gt=xt-L,At=xt-U,_t=a-Gt;return J?QC(_t,E-At):_t}function Ne(xt){var Gt=xt-L,At=xt-U;return L===void 0||Gt>=a||Gt<0||J&&At>=E}function et(){var xt=S_();if(Ne(xt))return ut(xt);o=setTimeout(et,Ie(xt))}function ut(xt){return o=void 0,de&&g?xe(xt):(g=x=void 0,I)}function Ve(){o!==void 0&&clearTimeout(o),U=0,g=L=x=o=void 0}function ft(){return o===void 0?I:ut(S_())}function Ce(){var xt=S_(),Gt=Ne(xt);if(g=arguments,x=this,L=xt,Gt){if(o===void 0)return ge(L);if(J)return o=setTimeout(et,a),xe(L)}return o===void 0&&(o=setTimeout(et,a)),I}return Ce.cancel=Ve,Ce.flush=ft,Ce}function ug(s){var a=typeof s;return!!s&&(a=="object"||a=="function")}function tI(s){return!!s&&typeof s=="object"}function iI(s){return typeof s=="symbol"||tI(s)&&YC.call(s)==jC}function D0(s){if(typeof s=="number")return s;if(iI(s))return P0;if(ug(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=ug(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=s.replace(VC,"");var d=GC.test(s);return d||qC.test(s)?ZC(s.slice(2),d?2:8):$C.test(s)?P0:+s}var nI=eI,Ef={},rI={get exports(){return Ef},set exports(s){Ef=s}},Rc=typeof Reflect=="object"?Reflect:null,L0=Rc&&typeof Rc.apply=="function"?Rc.apply:function(a,d,g){return Function.prototype.apply.call(a,d,g)},hf;Rc&&typeof Rc.ownKeys=="function"?hf=Rc.ownKeys:Object.getOwnPropertySymbols?hf=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:hf=function(a){return Object.getOwnPropertyNames(a)};function oI(s){console&&console.warn&&console.warn(s)}var F1=Number.isNaN||function(a){return a!==a};function Vi(){Vi.init.call(this)}rI.exports=Vi;Ef.once=cI;Vi.EventEmitter=Vi;Vi.prototype._events=void 0;Vi.prototype._eventsCount=0;Vi.prototype._maxListeners=void 0;var z0=10;function Vf(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(Vi,"defaultMaxListeners",{enumerable:!0,get:function(){return z0},set:function(s){if(typeof s!="number"||s<0||F1(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");z0=s}});Vi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Vi.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||F1(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function N1(s){return s._maxListeners===void 0?Vi.defaultMaxListeners:s._maxListeners}Vi.prototype.getMaxListeners=function(){return N1(this)};Vi.prototype.emit=function(a){for(var d=[],g=1;g<arguments.length;g++)d.push(arguments[g]);var x=a==="error",E=this._events;if(E!==void 0)x=x&&E.error===void 0;else if(!x)return!1;if(x){var I;if(d.length>0&&(I=d[0]),I instanceof Error)throw I;var o=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw o.context=I,o}var L=E[a];if(L===void 0)return!1;if(typeof L=="function")L0(L,this,d);else for(var U=L.length,G=G1(L,U),g=0;g<U;++g)L0(G[g],this,d);return!0};function U1(s,a,d,g){var x,E,I;if(Vf(d),E=s._events,E===void 0?(E=s._events=Object.create(null),s._eventsCount=0):(E.newListener!==void 0&&(s.emit("newListener",a,d.listener?d.listener:d),E=s._events),I=E[a]),I===void 0)I=E[a]=d,++s._eventsCount;else if(typeof I=="function"?I=E[a]=g?[d,I]:[I,d]:g?I.unshift(d):I.push(d),x=N1(s),x>0&&I.length>x&&!I.warned){I.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=s,o.type=a,o.count=I.length,oI(o)}return s}Vi.prototype.addListener=function(a,d){return U1(this,a,d,!1)};Vi.prototype.on=Vi.prototype.addListener;Vi.prototype.prependListener=function(a,d){return U1(this,a,d,!0)};function sI(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j1(s,a,d){var g={fired:!1,wrapFn:void 0,target:s,type:a,listener:d},x=sI.bind(g);return x.listener=d,g.wrapFn=x,x}Vi.prototype.once=function(a,d){return Vf(d),this.on(a,j1(this,a,d)),this};Vi.prototype.prependOnceListener=function(a,d){return Vf(d),this.prependListener(a,j1(this,a,d)),this};Vi.prototype.removeListener=function(a,d){var g,x,E,I,o;if(Vf(d),x=this._events,x===void 0)return this;if(g=x[a],g===void 0)return this;if(g===d||g.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete x[a],x.removeListener&&this.emit("removeListener",a,g.listener||d));else if(typeof g!="function"){for(E=-1,I=g.length-1;I>=0;I--)if(g[I]===d||g[I].listener===d){o=g[I].listener,E=I;break}if(E<0)return this;E===0?g.shift():aI(g,E),g.length===1&&(x[a]=g[0]),x.removeListener!==void 0&&this.emit("removeListener",a,o||d)}return this};Vi.prototype.off=Vi.prototype.removeListener;Vi.prototype.removeAllListeners=function(a){var d,g,x;if(g=this._events,g===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete g[a]),this;if(arguments.length===0){var E=Object.keys(g),I;for(x=0;x<E.length;++x)I=E[x],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=g[a],typeof d=="function")this.removeListener(a,d);else if(d!==void 0)for(x=d.length-1;x>=0;x--)this.removeListener(a,d[x]);return this};function V1(s,a,d){var g=s._events;if(g===void 0)return[];var x=g[a];return x===void 0?[]:typeof x=="function"?d?[x.listener||x]:[x]:d?lI(x):G1(x,x.length)}Vi.prototype.listeners=function(a){return V1(this,a,!0)};Vi.prototype.rawListeners=function(a){return V1(this,a,!1)};Vi.listenerCount=function(s,a){return typeof s.listenerCount=="function"?s.listenerCount(a):$1.call(s,a)};Vi.prototype.listenerCount=$1;function $1(s){var a=this._events;if(a!==void 0){var d=a[s];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}Vi.prototype.eventNames=function(){return this._eventsCount>0?hf(this._events):[]};function G1(s,a){for(var d=new Array(a),g=0;g<a;++g)d[g]=s[g];return d}function aI(s,a){for(;a+1<s.length;a++)s[a]=s[a+1];s.pop()}function lI(s){for(var a=new Array(s.length),d=0;d<a.length;++d)a[d]=s[d].listener||s[d];return a}function cI(s,a){return new Promise(function(d,g){function x(I){s.removeListener(a,E),g(I)}function E(){typeof s.removeListener=="function"&&s.removeListener("error",x),d([].slice.call(arguments))}q1(s,a,E,{once:!0}),a!=="error"&&uI(s,x,{once:!0})})}function uI(s,a,d){typeof s.on=="function"&&q1(s,"error",a,d)}function q1(s,a,d,g){if(typeof s.on=="function")g.once?s.once(a,d):s.on(a,d);else if(typeof s.addEventListener=="function")s.addEventListener(a,function x(E){g.once&&s.removeEventListener(a,x),d(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var hI={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function dI(s){var a=s.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return a?{key:a[1],value:a[2]}:null}function pI(s){var a=s.match(/<?([^>]*)>(.*)/);if(!a)return null;var d=a[1],g=a[2].split(";"),x=null,E=g.reduce(function(I,o){var L=dI(o);return L?L.key==="rel"?(x||(x=L.value),I):(I[L.key]=L.value,I):I},{});return x?{url:d,rel:x,params:E}:null}function fI(s){return s?s.split(/,\s*</).reduce(function(a,d){var g=pI(d);if(!g)return a;var x=g.rel.split(/\s+/);return x.forEach(function(E){a[E]||(a[E]={url:g.url,params:g.params})}),a},{}):{}}var mI=fI,_I=mI;function Gg(s,a){this.request=s,this.headers=a.headers,this.rawBody=a.body,this.statusCode=a.statusCode;try{this.body=JSON.parse(a.body||"{}")}catch{this.body=a.body}this.links=_I(this.headers.link)}Gg.prototype.hasNextPage=function(){return!!this.links.next};Gg.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var gI=Gg,$f={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},k0=$f;function yI(s){var a=s.type||k0.ERROR_HTTP,d;if(s.body)try{d=JSON.parse(s.body)}catch{d=s.body}else d=null;var g=s.message||null;g||(typeof d=="string"?g=d:d&&typeof d.message=="string"?g=d.message:a===k0.ERROR_REQUEST_ABORTED&&(g="Request aborted")),this.message=g,this.type=a,this.statusCode=s.statusCode||null,this.request=s.request,this.body=d}var vI=yI;function xI(s){var a=s.indexOf(":"),d=s.substring(0,a).trim().toLowerCase(),g=s.substring(a+1).trim();return{name:d,value:g}}function bI(s){var a={};return s&&s.trim().split(/[\r|\n]+/).forEach(function(d){var g=xI(d);a[g.name]=g.value}),a}var wI=bI,EI=gI,O0=vI,C_=$f,TI=wI,Tf={};function AI(s){var a=Tf[s.id];a&&(a.abort(),delete Tf[s.id])}function SI(s,a){return new EI(s,{body:a.response,headers:TI(a.getAllResponseHeaders()),statusCode:a.status})}function R0(s){var a=s.total,d=s.loaded,g=100*d/a;return{total:a,transferred:d,percent:g}}function Z1(s,a){return new Promise(function(d,g){a.onprogress=function(I){s.emitter.emit(C_.EVENT_PROGRESS_DOWNLOAD,R0(I))};var x=s.file;x&&(a.upload.onprogress=function(I){s.emitter.emit(C_.EVENT_PROGRESS_UPLOAD,R0(I))}),a.onerror=function(I){g(I)},a.onabort=function(){var I=new O0({request:s,type:C_.ERROR_REQUEST_ABORTED});g(I)},a.onload=function(){if(delete Tf[s.id],a.status<200||a.status>=400){var I=new O0({request:s,body:a.response,statusCode:a.status});g(I);return}d(a)};var E=s.body;typeof E=="string"?a.send(E):E?a.send(JSON.stringify(E)):x?a.send(x):a.send(),Tf[s.id]=a}).then(function(d){return SI(s,d)})}function W1(s,a){var d=s.url(a),g=new window.XMLHttpRequest;return g.open(s.method,d),Object.keys(s.headers).forEach(function(x){g.setRequestHeader(x,s.headers[x])}),g}function CI(s){return Promise.resolve().then(function(){var a=W1(s,s.client.accessToken);return Z1(s,a)})}var II={browserAbort:AI,sendRequestXhr:Z1,browserSend:CI,createRequestXhr:W1},Af={},MI={get exports(){return Af},set exports(s){Af=s}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(s,a){(function(d){var g=a,x=s&&s.exports==g&&s,E=typeof _o=="object"&&_o;(E.global===E||E.window===E)&&(d=E);var I=function(ge){this.message=ge};I.prototype=new Error,I.prototype.name="InvalidCharacterError";var o=function(ge){throw new I(ge)},L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=/[\t\n\f\r ]/g,G=function(ge){ge=String(ge).replace(U,"");var Ie=ge.length;Ie%4==0&&(ge=ge.replace(/==?$/,""),Ie=ge.length),(Ie%4==1||/[^+a-zA-Z0-9/]/.test(ge))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var Ne=0,et,ut,Ve="",ft=-1;++ft<Ie;)ut=L.indexOf(ge.charAt(ft)),et=Ne%4?et*64+ut:ut,Ne++%4&&(Ve+=String.fromCharCode(255&et>>(-2*Ne&6)));return Ve},J=function(ge){ge=String(ge),/[^\0-\xFF]/.test(ge)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var Ie=ge.length%3,Ne="",et=-1,ut,Ve,ft,Ce,xt=ge.length-Ie;++et<xt;)ut=ge.charCodeAt(et)<<16,Ve=ge.charCodeAt(++et)<<8,ft=ge.charCodeAt(++et),Ce=ut+Ve+ft,Ne+=L.charAt(Ce>>18&63)+L.charAt(Ce>>12&63)+L.charAt(Ce>>6&63)+L.charAt(Ce&63);return Ie==2?(ut=ge.charCodeAt(et)<<8,Ve=ge.charCodeAt(++et),Ce=ut+Ve,Ne+=L.charAt(Ce>>10)+L.charAt(Ce>>4&63)+L.charAt(Ce<<2&63)+"="):Ie==1&&(Ce=ge.charCodeAt(et),Ne+=L.charAt(Ce>>2)+L.charAt(Ce<<4&63)+"=="),Ne},de={encode:J,decode:G,version:"0.1.0"};if(g&&!g.nodeType)if(x)x.exports=de;else for(var xe in de)de.hasOwnProperty(xe)&&(g[xe]=de[xe]);else d.base64=de})(_o)})(MI,Af);var PI=Af,I_={};function DI(s){if(I_[s])return I_[s];var a=s.split("."),d=a[0],g=a[1];if(!g)throw new Error("Invalid token");var x=LI(g),E={usage:d,user:x.u};return Qa(x,"a")&&(E.authorization=x.a),Qa(x,"exp")&&(E.expires=x.exp*1e3),Qa(x,"iat")&&(E.created=x.iat*1e3),Qa(x,"scopes")&&(E.scopes=x.scopes),Qa(x,"client")&&(E.client=x.client),Qa(x,"ll")&&(E.lastLogin=x.ll),Qa(x,"iu")&&(E.impersonator=x.iu),I_[s]=E,E}function LI(s){try{return JSON.parse(PI.decode(s))}catch{throw new Error("Invalid token")}}function Qa(s,a){return Object.prototype.hasOwnProperty.call(s,a)}var H1=DI,hg={},zI={get exports(){return hg},set exports(s){hg=s}};(function(s){var a=Object.prototype.hasOwnProperty,d="~";function g(){}Object.create&&(g.prototype=Object.create(null),new g().__proto__||(d=!1));function x(L,U,G){this.fn=L,this.context=U,this.once=G||!1}function E(L,U,G,J,de){if(typeof G!="function")throw new TypeError("The listener must be a function");var xe=new x(G,J||L,de),ge=d?d+U:U;return L._events[ge]?L._events[ge].fn?L._events[ge]=[L._events[ge],xe]:L._events[ge].push(xe):(L._events[ge]=xe,L._eventsCount++),L}function I(L,U){--L._eventsCount===0?L._events=new g:delete L._events[U]}function o(){this._events=new g,this._eventsCount=0}o.prototype.eventNames=function(){var U=[],G,J;if(this._eventsCount===0)return U;for(J in G=this._events)a.call(G,J)&&U.push(d?J.slice(1):J);return Object.getOwnPropertySymbols?U.concat(Object.getOwnPropertySymbols(G)):U},o.prototype.listeners=function(U){var G=d?d+U:U,J=this._events[G];if(!J)return[];if(J.fn)return[J.fn];for(var de=0,xe=J.length,ge=new Array(xe);de<xe;de++)ge[de]=J[de].fn;return ge},o.prototype.listenerCount=function(U){var G=d?d+U:U,J=this._events[G];return J?J.fn?1:J.length:0},o.prototype.emit=function(U,G,J,de,xe,ge){var Ie=d?d+U:U;if(!this._events[Ie])return!1;var Ne=this._events[Ie],et=arguments.length,ut,Ve;if(Ne.fn){switch(Ne.once&&this.removeListener(U,Ne.fn,void 0,!0),et){case 1:return Ne.fn.call(Ne.context),!0;case 2:return Ne.fn.call(Ne.context,G),!0;case 3:return Ne.fn.call(Ne.context,G,J),!0;case 4:return Ne.fn.call(Ne.context,G,J,de),!0;case 5:return Ne.fn.call(Ne.context,G,J,de,xe),!0;case 6:return Ne.fn.call(Ne.context,G,J,de,xe,ge),!0}for(Ve=1,ut=new Array(et-1);Ve<et;Ve++)ut[Ve-1]=arguments[Ve];Ne.fn.apply(Ne.context,ut)}else{var ft=Ne.length,Ce;for(Ve=0;Ve<ft;Ve++)switch(Ne[Ve].once&&this.removeListener(U,Ne[Ve].fn,void 0,!0),et){case 1:Ne[Ve].fn.call(Ne[Ve].context);break;case 2:Ne[Ve].fn.call(Ne[Ve].context,G);break;case 3:Ne[Ve].fn.call(Ne[Ve].context,G,J);break;case 4:Ne[Ve].fn.call(Ne[Ve].context,G,J,de);break;default:if(!ut)for(Ce=1,ut=new Array(et-1);Ce<et;Ce++)ut[Ce-1]=arguments[Ce];Ne[Ve].fn.apply(Ne[Ve].context,ut)}}return!0},o.prototype.on=function(U,G,J){return E(this,U,G,J,!1)},o.prototype.once=function(U,G,J){return E(this,U,G,J,!0)},o.prototype.removeListener=function(U,G,J,de){var xe=d?d+U:U;if(!this._events[xe])return this;if(!G)return I(this,xe),this;var ge=this._events[xe];if(ge.fn)ge.fn===G&&(!de||ge.once)&&(!J||ge.context===J)&&I(this,xe);else{for(var Ie=0,Ne=[],et=ge.length;Ie<et;Ie++)(ge[Ie].fn!==G||de&&!ge[Ie].once||J&&ge[Ie].context!==J)&&Ne.push(ge[Ie]);Ne.length?this._events[xe]=Ne.length===1?Ne[0]:Ne:I(this,xe)}return this},o.prototype.removeAllListeners=function(U){var G;return U?(G=d?d+U:U,this._events[G]&&I(this,G)):(this._events=new g,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=d,o.EventEmitter=o,s.exports=o})(zI);function kI(s){return s.map(encodeURIComponent).join(",")}function X1(s){return Array.isArray(s)?kI(s):encodeURIComponent(String(s))}function K1(s,a,d){if(d===!1||d===null)return s;var g=/\?/.test(s)?"&":"?",x=encodeURIComponent(a);return d!==void 0&&d!==""&&d!==!0&&(x+="="+X1(d)),""+s+g+x}function OI(s,a){if(!a)return s;var d=s;return Object.keys(a).forEach(function(g){var x=a[g];x!==void 0&&(Array.isArray(x)&&(x=x.filter(function(E){return E!=null}).join(",")),d=K1(d,g,x))}),d}function RI(s,a){if(!a||s.slice(0,4)==="http")return s;var d=s[0]==="/"?"":"/";return""+a.replace(/\/$/,"")+d+s}function BI(s,a){return a?s.replace(/\/:([a-zA-Z0-9]+)/g,function(d,g){var x=a[g];if(x===void 0)throw new Error("Unspecified route parameter "+g);var E=X1(x);return"/"+E}):s}var FI={appendQueryObject:OI,appendQueryParam:K1,prependOrigin:RI,interpolateRouteParams:BI},NI=H1,qg=Qc,UI=hg,Yp=FI,B0=$f,jI=1;function ca(s,a){if(!s)throw new Error("MapiRequest requires a client");if(!a||!a.path||!a.method)throw new Error("MapiRequest requires an options object with path and method properties");var d={};a.body&&(d["content-type"]="application/json");var g=qg(d,a.headers),x=Object.keys(g).reduce(function(E,I){return E[I.toLowerCase()]=g[I],E},{});this.id=jI++,this._options=a,this.emitter=new UI,this.client=s,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=a.path,this.method=a.method,this.origin=a.origin||s.origin,this.query=a.query||{},this.params=a.params||{},this.body=a.body||null,this.file=a.file||null,this.encoding=a.encoding||"utf8",this.sendFileAs=a.sendFileAs||null,this.headers=x}ca.prototype.url=function(a){var d=Yp.prependOrigin(this.path,this.origin);d=Yp.appendQueryObject(d,this.query);var g=this.params,x=a??this.client.accessToken;if(x){d=Yp.appendQueryParam(d,"access_token",x);var E=NI(x).user;g=qg({ownerId:E},g)}return d=Yp.interpolateRouteParams(d,g),d};ca.prototype.send=function(){var a=this;if(a.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return a.sent=!0,a.client.sendRequest(a).then(function(d){return a.response=d,a.emitter.emit(B0.EVENT_RESPONSE,d),d},function(d){throw a.error=d,a.emitter.emit(B0.EVENT_ERROR,d),d})};ca.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};ca.prototype.eachPage=function(a){var d=this;function g(I){function o(){delete d._nextPageRequest;var L=I.nextPage();L&&(d._nextPageRequest=L,E(L))}a(null,I,o)}function x(I){a(I,null,function(){})}function E(I){I.send().then(g,x)}E(this)};ca.prototype.clone=function(){return this._extend()};ca.prototype._extend=function(a){var d=qg(this._options,a);return new ca(this.client,d)};var VI=ca,$I=H1,GI=VI,qI=$f;function Y1(s){if(!s||!s.accessToken)throw new Error("Cannot create a client without an access token");$I(s.accessToken),this.accessToken=s.accessToken,this.origin=s.origin||qI.API_ORIGIN}Y1.prototype.createRequest=function(a){return new GI(this,a)};var J1=Y1,Q1=II,ew=J1;function Vc(s){ew.call(this,s)}Vc.prototype=Object.create(ew.prototype);Vc.prototype.constructor=Vc;Vc.prototype.sendRequest=Q1.browserSend;Vc.prototype.abortRequest=Q1.browserAbort;function ZI(s){return new Vc(s)}var tw=ZI,WI=tw,HI=WI,XI=Object.prototype.toString,KI=function(s){var a;return XI.call(s)==="[object Object]"&&(a=Object.getPrototypeOf(s),a===null||a===Object.getPrototypeOf({}))},YI=KI,JI=Qc,iw="value",M_=`
  `,Zi={};Zi.assert=function(s,a){return a=a||{},function(d){var g=ua(s,d);if(g){var x=Zg(g,a);throw a.apiName&&(x=a.apiName+": "+x),new Error(x)}}};Zi.shape=function(a){var d=iM(a);return function(x){var E=ua(Zi.plainObject,x);if(E)return E;for(var I,o,L=[],U=0;U<d.length;U++)I=d[U].key,o=d[U].value,E=ua(o,x[I]),E&&L.push([I].concat(E));return L.length<2?L[0]:function(G){L=L.map(function(xe){var ge=xe[0],Ie=Zg(xe,G).split(`
`).join(M_);return"- "+ge+": "+Ie});var J=G.path.join("."),de=J===iw?"":" of "+J;return"The following properties"+de+" have invalid values:"+M_+L.join(M_)}}};Zi.strictShape=function(a){var d=Zi.shape(a);return function(x){var E=d(x);if(E)return E;var I=Object.keys(x).reduce(function(o,L){return a[L]===void 0&&o.push(L),o},[]);if(I.length!==0)return function(){return"The following keys are invalid: "+I.join(", ")}}};Zi.arrayOf=function(a){return nw(a)};Zi.tuple=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return nw(a)};function nw(s){var a=Array.isArray(s),d=function(g){return a?s[g]:s};return function(x){var E=ua(Zi.plainArray,x);if(E)return E;if(a&&x.length!==s.length)return"an array with "+s.length+" items";for(var I=0;I<x.length;I++)if(E=ua(d(I),x[I]),E)return[I].concat(E)}}Zi.required=function(a){function d(g){return g==null?function(x){return rw(x,ow(x.path)?"cannot be undefined/null.":"is required.")}:a.apply(this,arguments)}return d.__required=!0,d};Zi.oneOfType=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(g){var x=a.map(function(E){return ua(E,g)}).filter(Boolean);if(x.length===a.length)return x.every(function(E){return E.length===1&&typeof E[0]=="string"})?QI(x.map(function(E){return E[0]})):x.reduce(function(E,I){return I.length>E.length?I:E})}};Zi.equal=function(a){return function(g){if(g!==a)return JSON.stringify(a)}};Zi.oneOf=function(){var a=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),d=a.map(function(g){return Zi.equal(g)});return Zi.oneOfType.apply(this,d)};Zi.range=function(a){var d=a[0],g=a[1];return function(E){var I=ua(Zi.number,E);if(I||E<d||E>g)return"number between "+d+" & "+g+" (inclusive)"}};Zi.any=function(){};Zi.boolean=function(a){if(typeof a!="boolean")return"boolean"};Zi.number=function(a){if(typeof a!="number")return"number"};Zi.plainArray=function(a){if(!Array.isArray(a))return"array"};Zi.plainObject=function(a){if(!YI(a))return"object"};Zi.string=function(a){if(typeof a!="string")return"string"};Zi.func=function(a){if(typeof a!="function")return"function"};function ua(s,a){if(!(a==null&&!s.hasOwnProperty("__required"))){var d=s(a);if(d)return Array.isArray(d)?d:[d]}}function Zg(s,a){var d=s.length,g=s[d-1],x=s.slice(0,d-1);return x.length===0&&(x=[iw]),a=JI(a,{path:x}),typeof g=="function"?g(a):rw(a,eM(g))}function QI(s){return s.length<2?s[0]:s.length===2?s.join(" or "):s.slice(0,-1).join(", ")+", or "+s.slice(-1)}function eM(s){return"must be "+tM(s)+"."}function tM(s){return/^an? /.test(s)?s:/^[aeiou]/i.test(s)?"an "+s:/^[a-z]/i.test(s)?"a "+s:s}function rw(s,a){var d=ow(s.path),g=s.path.join(".")+" "+a,x=d?"Item at position ":"";return x+g}function ow(s){return typeof s[s.length-1]=="number"||typeof s[0]=="number"}function iM(s){return Object.keys(s||{}).map(function(a){return{key:a,value:s[a]}})}Zi.validate=ua;Zi.processMessage=Zg;var nM=Zi,rM=Qc,Bc=nM;function oM(s){if(typeof window<"u")return s instanceof _o.Blob||s instanceof _o.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof s=="string"||s.pipe!==void 0))return"Filename or Readable stream"}function sM(s,a){return Bc.assert(Bc.strictShape(s),a)}function aM(s){var a="date";if(typeof s=="boolean")return a;try{var d=new Date(s);if(d.getTime&&isNaN(d.getTime()))return a}catch{return a}}function lM(s){return Bc.tuple(Bc.number,Bc.number)(s)}var cM=rM(Bc,{file:oM,date:aM,coordinates:lM,assertShape:sM});function uM(s,a){var d=function(g,x){return a.indexOf(g)!==-1&&x!==void 0};return typeof a=="function"&&(d=a),Object.keys(s).filter(function(g){return d(g,s[g])}).reduce(function(g,x){return g[x]=s[x],g},{})}var hM=uM;function dM(s,a){return Object.keys(s).reduce(function(d,g){return d[g]=a(g,s[g]),d},{})}var pM=dM,fM=pM;function mM(s){return fM(s,function(a,d){return typeof d=="boolean"?JSON.stringify(d):d})}var _M=mM,gM=J1,yM=tw;function vM(s){return function(a){var d;gM.prototype.isPrototypeOf(a)?d=a:d=yM(a);var g=Object.create(s);return g.client=d,g}}var xM=vM,sw=Qc,vi=cM,Sf=hM,aw=_M,bM=xM,Wg={},lw=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Wg.forwardGeocode=function(s){vi.assertShape({query:vi.required(vi.string),mode:vi.oneOf("mapbox.places","mapbox.places-permanent"),countries:vi.arrayOf(vi.string),proximity:vi.oneOf(vi.coordinates,"ip"),types:vi.arrayOf(vi.oneOf(lw)),autocomplete:vi.boolean,bbox:vi.arrayOf(vi.number),limit:vi.number,language:vi.arrayOf(vi.string),routing:vi.boolean,fuzzyMatch:vi.boolean,worldview:vi.string})(s),s.mode=s.mode||"mapbox.places";var a=aw(sw({country:s.countries},Sf(s,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Sf(s,["mode","query"]),query:a})};Wg.reverseGeocode=function(s){vi.assertShape({query:vi.required(vi.coordinates),mode:vi.oneOf("mapbox.places","mapbox.places-permanent"),countries:vi.arrayOf(vi.string),types:vi.arrayOf(vi.oneOf(lw)),bbox:vi.arrayOf(vi.number),limit:vi.number,language:vi.arrayOf(vi.string),reverseMode:vi.oneOf("distance","score"),routing:vi.boolean,worldview:vi.string})(s),s.mode=s.mode||"mapbox.places";var a=aw(sw({country:s.countries},Sf(s,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Sf(s,["mode","query"]),query:a})};var wM=bM(Wg);let EM="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",cw=s=>crypto.getRandomValues(new Uint8Array(s)),uw=(s,a,d)=>{let g=(2<<Math.log(s.length-1)/Math.LN2)-1,x=-~(1.6*g*a/s.length);return(E=a)=>{let I="";for(;;){let o=d(x),L=x;for(;L--;)if(I+=s[o[L]&g]||"",I.length===E)return I}}},TM=(s,a=21)=>uw(s,a,cw),AM=(s=21)=>crypto.getRandomValues(new Uint8Array(s)).reduce((a,d)=>(d&=63,d<36?a+=d.toString(36):d<62?a+=(d-26).toString(36).toUpperCase():d>62?a+="-":a+="_",a),"");const SM=Object.freeze(Object.defineProperty({__proto__:null,nanoid:AM,customAlphabet:TM,customRandom:uw,urlAlphabet:EM,random:cw},Symbol.toStringTag,{value:"Module"})),CM=MC(SM);var IM=CM.nanoid;function hw(s){this.origin=s.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=s.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=s,this.send=this.send.bind(this),this.countries=s.countries?s.countries.split(","):null,this.types=s.types?s.types.split(","):null,this.bbox=s.bbox?s.bbox:null,this.language=s.language?s.language.split(","):null,this.limit=s.limit?+s.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(s),this.eventQueue=new Array,this.flushInterval=s.flushInterval||1e3,this.maxQueueSize=s.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}hw.prototype={select:function(s,a){var d=this.getSelectedIndex(s,a),g=this.getEventPayload("search.select",a);if(g.resultIndex=d,g.resultPlaceName=s.place_name,g.resultId=s.id,!(d===this.lastSentIndex&&g.queryString===this.lastSentInput||d==-1)&&(this.lastSentIndex=d,this.lastSentInput=g.queryString,!!g.queryString))return this.push(g)},start:function(s){var a=this.getEventPayload("search.start",s);if(a.queryString)return this.push(a)},keyevent:function(s,a){if(s.key&&!(s.metaKey||[9,27,37,39,13,38,40].indexOf(s.keyCode)!==-1)){var d=this.getEventPayload("search.keystroke",a);if(d.lastAction=s.key,!!d.queryString)return this.push(d)}},send:function(s,a){if(!this.enableEventLogging)return a?a():void 0;var d=this.getRequestOptions(s);this.request(d,function(g){if(g)return this.handleError(g,a);if(a)return a()}.bind(this))},getRequestOptions:function(s){Array.isArray(s)||(s=[s]);var a={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)};return a},getEventPayload:function(s,a){var d;a.options.proximity?typeof a.options.proximity=="object"?d=[a.options.proximity.longitude,a.options.proximity.latitude]:a.options.proximity==="ip"?d=[999,999]:d=a.options.proximity:d=null;var g=a._map?a._map.getZoom():void 0,x={event:s,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:a.options.autocomplete,fuzzyMatch:a.options.fuzzyMatch,proximity:d,limit:a.options.limit,routing:a.options.routing,worldview:a.options.worldview,mapZoom:g,keyboardLocale:this.locale};return s==="search.select"?x.queryString=a.inputString:s!="search.select"&&a._inputEl?x.queryString=a._inputEl.value:x.queryString=a.inputString,x},request:function(s,a){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(this.readyState==4)return this.status==204?a(null):a(this.statusText)},d.open(s.method,s.host+"/"+s.path,!0);for(var g in s.headers){var x=s.headers[g];d.setRequestHeader(g,x)}d.send(s.body)},handleError:function(s,a){if(a)return a(s)},generateSessionID:function(){return IM()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(s,a){if(a._typeahead){var d=a._typeahead.data,g=s.id,x=d.map(function(I){return I.id}),E=x.indexOf(g);return E}},shouldEnableLogging:function(s){return!(s.enableEventLogging===!1||s.origin&&s.origin!=="https://api.mapbox.com"||s.localGeocoder||s.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(s,a){this.eventQueue.push(s),(this.eventQueue.length>=this.maxQueueSize||a)&&this.flush()},remove:function(){this.flush()}};var MM=hw,PM={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},DM={placeholder:PM},dg={},LM={get exports(){return dg},set exports(s){dg=s}};(function(s){(function(a,d,g){s.exports?s.exports=g():a[d]=g()})(_o,"subtag",function(){var a="",d=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function g(L){return L.match(d)||[]}function x(L){return g(L).filter(function(U,G){return U&&G})}function E(L){return L=g(L),{language:L[1]||a,extlang:L[2]||a,script:L[3]||a,region:L[4]||a}}function I(L,U,G){Object.defineProperty(L,U,{value:G,enumerable:!0})}function o(L,U,G){function J(de){return g(de)[L]||a}I(J,"pattern",U),I(E,G,J)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),I(E,"split",x),E})})(LM);function dw(){}dw.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const s={enableHighAccuracy:!0};return new Promise(function(a,d){window.navigator.geolocation.getCurrentPosition(a,d,s)})}};var zM=dw;function kM(s,a){const d=pw(s),g=["address","street","place","country"];var x;if(typeof a=="function")return a(d);const E=g.indexOf(a);return E===-1?x=g:x=g.slice(E),x.reduce(function(I,o){return d[o]?(I!==""&&(I=I+", "),I+d[o]):I},"")}function pw(s){const a=s.address||"",d=s.text||"",g=s.place_name||"",E={address:g.split(",")[0],houseNumber:a,street:d,placeName:g};return s.context.forEach(function(I){const o=I.id.split(".")[0];E[o]=I.text}),E}const OM=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var RM={transformFeatureToGeolocationText:kM,getAddressInfo:pw,REVERSE_GEOCODE_COORD_RGX:OM},BM=NC,FM=nI,tl=Qc,NM=Ef.EventEmitter,F0=hI,P_=HI,D_=wM,UM=MM,jM=DM,VM=dg,$M=zM,N0=RM;const ea={FORWARD:0,LOCAL:1,REVERSE:2};function GM(){var s=document.createElement("div");return s.className="mapboxgl-ctrl-geocoder--powered-by",s.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',s}function fw(s){this._eventEmitter=new NM,this.options=tl({},this.options,s),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new $M}fw.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(s){return s.place_name},render:function(s){var a=s.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+a[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+a.splice(1,a.length).join(",")+"</div></div>"}},addTo:function(s){function a(d,g){if(!document.body.contains(g))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const x=d.onAdd();g.appendChild(x)}if(s._controlContainer)s.addControl(this);else if(s instanceof HTMLElement)a(this,s);else if(typeof s=="string"){const d=document.querySelectorAll(s);if(d.length===0)throw new Error("Element ",s,"not found.");if(d.length>1)throw new Error("Geocoder can only be added to a single html element");a(this,d[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(s){if(s&&typeof s!="string"&&(this._map=s),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=D_(P_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new UM(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var a=this.container=document.createElement("div");a.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var d=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",FM(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(U){this.eventManager.keyevent(U,this)}.bind(this));var g=document.createElement("div");g.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var x=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(x),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),g.appendChild(this._clearEl),g.appendChild(this._loadingEl),a.appendChild(d),a.appendChild(this._inputEl),a.appendChild(g),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var E=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(E),g.appendChild(this._geolocateEl),this._showGeolocateButton()}var I=this._typeahead=new BM(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),I.getItemValue=this.options.getItemValue;var o=I.list.draw,L=this._footerNode=GM();return I.list.draw=function(){o.call(this),L.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),L.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(L)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),a},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(s){this._hideLoadingIcon();const a={geometry:{type:"Point",coordinates:[s.coords.longitude,s.coords.latitude]}};this._handleMarker(a),this._fly(a),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(a),this._showClearButton(),this.fresh=!1;const d={limit:1,language:[this.options.language],query:a.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const g=a.geometry.coordinates[0]+","+a.geometry.coordinates[1];this._setInputValue(g),this._eventEmitter.emit("result",{result:a})}else this.geocoderService.reverseGeocode(d).send().then(function(g){const x=g.body.features[0];if(x){const E=N0.transformFeatureToGeolocationText(x,this.options.addressAccuracy);this._setInputValue(E),x.user_coordinates=a.geometry.coordinates,this._eventEmitter.emit("result",{result:x})}else this._eventEmitter.emit("result",{result:{user_coordinates:a.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(s){s.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(s,a){var d=document.createElementNS("http://www.w3.org/2000/svg","svg");return d.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+s),d.setAttribute("viewBox","0 0 18 18"),d.setAttribute("xml:space","preserve"),d.setAttribute("width",18),d.setAttribute("height",18),d.innerHTML=a,d},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(s){this._inputEl.value=s,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(s){var a=(s.clipboardData||window.clipboardData).getData("text");a.length>=this.options.minLength&&this._geocode(a)},_onKeyDown:function(s){var a=27,d=9;if(s.keyCode===a&&this.options.clearAndBlurOnEsc)return this._clear(s),this._inputEl.blur();var g=s.target&&s.target.shadowRoot?s.target.shadowRoot.activeElement:s.target,x=g?g.value:"";if(!x)return this.fresh=!0,s.keyCode!==d&&this.clear(s),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(s.metaKey||[d,a,37,39,13,38,40].indexOf(s.keyCode)!==-1)&&g.value.length>=this.options.minLength&&this._geocode(g.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(s){this.options.clearOnBlur&&this._clearOnBlur(s),this.options.collapsed&&this._collapse()},_onChange:function(){var s=this._typeahead.selected;s&&JSON.stringify(s)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(s),this.options.marker&&this._mapboxgl&&this._handleMarker(s),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(s),this._eventEmitter.emit("result",{result:s}),this.eventManager.select(s,this))},_fly:function(s){var a;if(s.properties&&F0[s.properties.short_code])a=tl({},this.options.flyTo),this._map&&this._map.fitBounds(F0[s.properties.short_code].bbox,a);else if(s.bbox){var d=s.bbox;a=tl({},this.options.flyTo),this._map&&this._map.fitBounds([[d[0],d[1]],[d[2],d[3]]],a)}else{var g={zoom:this.options.zoom};a=tl({},g,this.options.flyTo),s.center?a.center=s.center:s.geometry&&s.geometry.type&&s.geometry.type==="Point"&&s.geometry.coordinates&&(a.center=s.geometry.coordinates),this._map&&this._map.flyTo(a)}},_requestType:function(s,a){var d;return s.localGeocoderOnly?d=ea.LOCAL:s.reverseGeocode&&N0.REVERSE_GEOCODE_COORD_RGX.test(a)?d=ea.REVERSE:d=ea.FORWARD,d},_setupConfig:function(s,a){const d=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],g=/[\s,]+/;var x=this,E=d.reduce(function(o,L){if(x.options[L]===void 0||x.options[L]===null)return o;["countries","types","language"].indexOf(L)>-1?o[L]=x.options[L].split(g):o[L]=x.options[L];const U=typeof x.options[L].longitude=="number"&&typeof x.options[L].latitude=="number";if(L==="proximity"&&U){const G=x.options[L].longitude,J=x.options[L].latitude;o[L]=[G,J]}return o},{});switch(s){case ea.REVERSE:{var I=a.split(g).map(function(o){return parseFloat(o,10)});x.options.flipCoordinates||I.reverse(),E.types&&E.types[0],E=tl(E,{query:I,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in E&&delete E[o]})}break;case ea.FORWARD:{const o=a.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(a=a.replace(/,/g," ")),E=tl(E,{query:a})}break}return E},_geocode:function(s){this.inputString=s,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:s});const a=this._requestType(this.options,s),d=this._setupConfig(a,s);var g;switch(a){case ea.LOCAL:g=Promise.resolve();break;case ea.FORWARD:g=this.geocoderService.forwardGeocode(d).send();break;case ea.REVERSE:g=this.geocoderService.reverseGeocode(d).send();break}var x=this.options.localGeocoder?this.options.localGeocoder(s)||[]:[],E=[],I=null;return g.catch(function(o){I=o}.bind(this)).then(function(o){this._hideLoadingIcon();var L={};return o?o.statusCode=="200"&&(L=o.body,L.request=o.request,L.headers=o.headers):L={type:"FeatureCollection",features:[]},L.config=d,this.fresh&&(this.eventManager.start(this),this.fresh=!1),L.features=L.features?x.concat(L.features):x,this.options.externalGeocoder?(E=this.options.externalGeocoder(s,L.features)||Promise.resolve([]),E.then(function(U){return L.features=L.features?U.concat(L.features):U,L},function(){return L})):L}.bind(this)).then(function(o){if(I)throw I;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),x.length&&this.options.localGeocoder||E.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(x)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:x}),this._eventEmitter.emit("error",{error:o})}.bind(this)),g},_clear:function(s){s&&s.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(s){this._clear(s),this._inputEl.focus()},_clearOnBlur:function(s){var a=this;s.relatedTarget&&a._clear(s)},_onQueryResult:function(s){var a=s.body;if(a.features.length){var d=a.features[0];this._typeahead.selected=d,this._inputEl.value=d.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var s=this._map.getCenter().wrap();this.setProximity({longitude:s.lng,latitude:s.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(s){return this._geocode(s).then(this._onQueryResult),this},_renderError:function(){var s="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(s)},_renderLocationError:function(){var s="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(s)},_renderNoResults:function(){var s="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(s)},_renderUserDeniedGeolocationError:function(){var s="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(s)},_renderMessage:function(s){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(s)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var s=this.options.language.split(",")[0],a=VM.language(s),d=jM.placeholder[a];if(d)return d}return"Search"},setInput:function(s){return this._inputEl.value=s,this._typeahead.selected=null,this._typeahead.clear(),s.length>=this.options.minLength&&this._geocode(s),this},setProximity:function(s,a=!0){return this.options.proximity=s,a&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(s){return s&&typeof s=="function"&&(this._typeahead.render=s),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(s){var a=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=s||this.options.language||a,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(s){return this.options.zoom=s,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(s){return this.options.flyTo=s,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(s){return this.placeholder=s||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(s){return this.options.bbox=s,this},getCountries:function(){return this.options.countries},setCountries:function(s){return this.options.countries=s,this},getTypes:function(){return this.options.types},setTypes:function(s){return this.options.types=s,this},getMinLength:function(){return this.options.minLength},setMinLength:function(s){return this.options.minLength=s,this._typeahead&&(this._typeahead.options.minLength=s),this},getLimit:function(){return this.options.limit},setLimit:function(s){return this.options.limit=s,this._typeahead&&(this._typeahead.options.limit=s),this},getFilter:function(){return this.options.filter},setFilter:function(s){return this.options.filter=s,this},setOrigin:function(s){return this.options.origin=s,this.geocoderService=D_(P_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(s){return this.options.accessToken=s,this.geocoderService=D_(P_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(s){return this.options.autocomplete=s,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(s){return this.options.fuzzyMatch=s,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(s){return this.options.routing=s,this},getRouting:function(){return this.options.routing},setWorldview:function(s){return this.options.worldview=s,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(s){if(this._map){this._removeMarker();var a={color:"#4668F2"},d=tl({},a,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(d),s.center?this.mapMarker.setLngLat(s.center).addTo(this._map):s.geometry&&s.geometry.type&&s.geometry.type==="Point"&&s.geometry.coordinates&&this.mapMarker.setLngLat(s.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(s,a){return this._eventEmitter.on(s,a),this},off:function(s,a){return this._eventEmitter.removeListener(s,a),this.eventManager.remove(),this}};var qM=fw;function Hg(){return{map:Fh("mapbox-map")}}var L_=new Map,ZM=/onMb([A-Z])(.+)/;function WM(s){return L_.has(s)||L_.set(s,s.replace(ZM,(a,d,g)=>d.toLowerCase()+g)),L_.get(s)}function mw(s,a,d=[],g=null){const x=iC(),E=ps(()=>Object.entries(x).filter(([U,G])=>U.startsWith("on")&&typeof G=="function").map(([U])=>U)),I=new Map;function o(U){Array.isArray(U)&&U.forEach(G=>{const J=I.get(G);typeof J=="function"&&J()})}function L(U){Array.isArray(U)&&U.forEach(G=>{const J=WM(G);if(!d.includes(J))return;const de=(...xe)=>{s(`mb-${J}`,...xe)};g?(ti(a).on(J,g,de),I.set(G,()=>{ti(a).off(J,g,de)})):(ti(a).on(J,de),I.set(G,()=>{ti(a).off(J,de)}))})}sa(E,(U,G)=>{const J=Array.isArray(U)?(G??[]).filter(xe=>!U.includes(xe)):G??[],de=Array.isArray(G)?(U??[]).filter(xe=>!G.includes(xe)):U??[];if(ti(a))o(J),L(de);else{const xe=sa(a,ge=>{ge&&(o(J),L(de),xe())})}},{immediate:!0})}function HM(s){return s.charAt(0).toUpperCase()+s.slice(1)}function XM(s,a,d){function g(x){Object.keys(s).filter(E=>s[E]!==void 0&&s[E]!==null).forEach(E=>{var I,o;const L=E==="mapStyle"?"setStyle":`set${HM(E)}`,U=typeof x[L]=="function",G=typeof d[E]>"u"||"bind"in d[E]?(o=(I=d[E])==null?void 0:I.bind)!=null?o:!1:!0;if(!U||!G)return;const{type:J}=s[E],de={deep:J===Object||Array.isArray(J)&&J.includes(Object)};sa(()=>s[E],xe=>{x[L](xe)},de)})}if(ti(a))g(ti(a));else{const x=sa(a,E=>{E&&(g(E),x())})}}var Gf=(s,a)=>{const d=s.__vccOpts||s;for(const[g,x]of a)d[g]=x;return d},KM=["id"],YM={id:{type:String,required:!0},options:{type:Object,default:()=>{}},beforeId:{type:String,default:void 0}},JM=["mousedown","mouseup","click","dblclick","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"],QM={__name:"MapboxLayer",props:YM,setup(s,{emit:a}){const d=s,{map:g}=Hg(),x=ps(()=>{const o={...d.options,id:d.id};return(o.paint===null||o.paint===void 0)&&delete o.paint,(o.layout===null||o.layout===void 0)&&delete o.layout,o});mw(a,g,JM,d.id);function E(){typeof ti(g).getLayer(d.id)<"u"&&ti(g).removeLayer(d.id)}function I(){typeof ti(g).getSource(d.id)<"u"&&ti(g).removeSource(d.id)}return Jh(()=>{E(),I(),ti(g).addLayer(ti(x),d.beforeId)}),Qh(()=>{E(),I()}),(o,L)=>(kn(),sr("div",{id:o.id},null,8,KM))}},z_=Gf(QM,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxLayer.vue"]]),eP=["id"],tP={__name:"MapboxSource",props:{options:{type:Object,default:()=>{}},id:{type:String,required:!0}},setup(s){const a=s,{map:d}=Hg();return sa(()=>a.options.data,g=>{ti(d).getSource(a.id).setData(g)}),Jh(()=>{ti(d).addSource(a.id,a.options)}),Qh(()=>{const{_layers:g}=ti(d).style;Object.values(g).forEach(x=>{x.source===a.id&&ti(d).removeLayer(x.id)}),ti(d).removeSource(a.id)}),(g,x)=>(kn(),sr("div",{id:s.id},null,8,eP))}},iP=Gf(tP,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxSource.vue"]]),nP=["id"],rP={data:{type:[String,Object],required:!0},clusterMaxZoom:{type:Number,default:14},clusterRadius:{type:Number,default:50},clustersLayout:{type:Object,default:()=>({})},clustersPaint:{type:Object,default:()=>({"circle-color":"#000","circle-radius":40})},clusterCountLayout:{type:Object,default:()=>({"text-field":["get","point_count_abbreviated"]})},clusterCountPaint:{type:Object,default:()=>({"text-color":"white"})},unclusteredPointLayerType:{type:String,default:"circle"},unclusteredPointLayout:{type:Object,default:()=>({})},unclusteredPointPaint:{type:Object,default:()=>({"circle-color":"#000","circle-radius":4})}},oP={__name:"MapboxCluster",props:rP,setup(s,{emit:a}){const d=s;let g=0;const{map:x}=Hg(),E=lf(`mb-cluster-${g}`);g+=1;const I=ut=>`${ti(E)}-${ut}`,o=ps(()=>I("source")),L=ps(()=>{const{data:ut,clusterMaxZoom:Ve,clusterRadius:ft}=d;return{type:"geojson",cluster:!0,data:ut,clusterMaxZoom:Ve,clusterRadius:ft}}),U=ps(()=>({id:I("clusters"),type:"circle",source:ti(o),filter:["has","point_count"],layout:d.clustersLayout,paint:d.clustersPaint})),G=ps(()=>({id:I("cluster-count"),type:"symbol",source:ti(o),filter:["has","point_count"],layout:d.clusterCountLayout,paint:d.clusterCountPaint})),J=ps(()=>({id:I("unclustered-point"),type:d.unclusteredPointLayerType,source:ti(o),filter:["!",["has","point_count"]],layout:d.unclusteredPointLayout,paint:d.unclusteredPointPaint}));function de(ut){const Ve=ti(x).queryRenderedFeatures(ut.point,{layers:[ti(U).id]})[0],{cluster_id:ft}=Ve.properties;a("mb-cluster-click",ft,ut),ti(x).getSource(ti(o)).getClusterExpansionZoom(ft,(Ce,xt)=>{Ce||ti(x).easeTo({center:Ve.geometry.coordinates,zoom:xt})})}function xe(){ti(x).getCanvas().style.cursor="pointer"}function ge(){ti(x).getCanvas().style.cursor=""}function Ie(ut){const[Ve]=ut.features;a("mb-feature-click",Ve,ut)}function Ne(ut){const[Ve]=ut.features;a("mb-feature-mouseenter",Ve,ut),ti(x).getCanvas().style.cursor="pointer"}function et(ut){a("mb-feature-mouseleave",ut),ti(x).getCanvas().style.cursor=""}return(ut,Ve)=>(kn(),sr("div",{id:E.value},[Qn(iP,{id:ti(o),options:ti(L)},null,8,["id","options"]),Qn(z_,{id:ti(U).id,options:ti(U),onMbClick:de,onMbMouseenter:xe,onMbMouseleave:ge},null,8,["id","options"]),Qn(z_,{id:ti(G).id,options:ti(G)},null,8,["id","options"]),Qn(z_,{id:ti(J).id,options:ti(J),onMbClick:Ie,onMbMouseenter:Ne,onMbMouseleave:et},null,8,["id","options"])],8,nP))}},sP=Gf(oP,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxCluster.vue"]]);if(!jc)throw new Error("mapboxgl is not installed.");if(!qM)throw new Error("MapboxGeocoder is not installed.");var aP={key:0},lP={key:1};if(!jc)throw new Error("mapboxgl is not installed.");var{LngLatBounds:U0,LngLat:cP}=jc,j0={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[U0,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[cP,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[U0,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0}},uP=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],hP={inheritAttrs:!1},dP=Object.assign(hP,{__name:"MapboxMap",props:j0,setup(s,{expose:a,emit:d}){const g=s,x=lf();h1("mapbox-map",x);const E=lf(),I=lf(!1),o=ps(()=>{const{accessToken:L,mapStyle:U,...G}=g;return!G.container&&E.value&&(G.container=E.value),{style:U,...G}});return mw(d,x,uP),XM(g,x,j0),Jh(()=>{jc.accessToken=g.accessToken,x.value=new jc.Map(o.value),x.value.on("load",()=>{I.value=!0}),d("mb-created",x.value);const L=new ResizeObserver(()=>{x.value.resize()});L.observe(o.value.container),Qh(()=>{L.disconnect(),x.value.remove()})}),a({map:x}),(L,U)=>(kn(),sr(gr,null,[Vt("div",D1({ref_key:"root",ref:E},L.$attrs),null,16),I.value?(kn(),sr("div",aP,[p0(L.$slots,"default")])):(kn(),sr("div",lP,[p0(L.$slots,"loader")]))],64))}}),pP=Gf(dP,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMap.vue"]]);if(!jc)throw new Error("mapboxgl is not installed.");function _w(s,a){return function(){return s.apply(a,arguments)}}const{toString:gw}=Object.prototype,{getPrototypeOf:Xg}=Object,Kg=(s=>a=>{const d=gw.call(a);return s[d]||(s[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),ws=s=>(s=s.toLowerCase(),a=>Kg(a)===s),qf=s=>a=>typeof a===s,{isArray:eu}=Array,Kh=qf("undefined");function fP(s){return s!==null&&!Kh(s)&&s.constructor!==null&&!Kh(s.constructor)&&hl(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const yw=ws("ArrayBuffer");function mP(s){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(s):a=s&&s.buffer&&yw(s.buffer),a}const _P=qf("string"),hl=qf("function"),vw=qf("number"),Yg=s=>s!==null&&typeof s=="object",gP=s=>s===!0||s===!1,df=s=>{if(Kg(s)!=="object")return!1;const a=Xg(s);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},yP=ws("Date"),vP=ws("File"),xP=ws("Blob"),bP=ws("FileList"),wP=s=>Yg(s)&&hl(s.pipe),EP=s=>{const a="[object FormData]";return s&&(typeof FormData=="function"&&s instanceof FormData||gw.call(s)===a||hl(s.toString)&&s.toString()===a)},TP=ws("URLSearchParams"),AP=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ed(s,a,{allOwnKeys:d=!1}={}){if(s===null||typeof s>"u")return;let g,x;if(typeof s!="object"&&(s=[s]),eu(s))for(g=0,x=s.length;g<x;g++)a.call(null,s[g],g,s);else{const E=d?Object.getOwnPropertyNames(s):Object.keys(s),I=E.length;let o;for(g=0;g<I;g++)o=E[g],a.call(null,s[o],o,s)}}function xw(s,a){a=a.toLowerCase();const d=Object.keys(s);let g=d.length,x;for(;g-- >0;)if(x=d[g],a===x.toLowerCase())return x;return null}const bw=typeof self>"u"?typeof global>"u"?globalThis:global:self,ww=s=>!Kh(s)&&s!==bw;function pg(){const{caseless:s}=ww(this)&&this||{},a={},d=(g,x)=>{const E=s&&xw(a,x)||x;df(a[E])&&df(g)?a[E]=pg(a[E],g):df(g)?a[E]=pg({},g):eu(g)?a[E]=g.slice():a[E]=g};for(let g=0,x=arguments.length;g<x;g++)arguments[g]&&ed(arguments[g],d);return a}const SP=(s,a,d,{allOwnKeys:g}={})=>(ed(a,(x,E)=>{d&&hl(x)?s[E]=_w(x,d):s[E]=x},{allOwnKeys:g}),s),CP=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),IP=(s,a,d,g)=>{s.prototype=Object.create(a.prototype,g),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:a.prototype}),d&&Object.assign(s.prototype,d)},MP=(s,a,d,g)=>{let x,E,I;const o={};if(a=a||{},s==null)return a;do{for(x=Object.getOwnPropertyNames(s),E=x.length;E-- >0;)I=x[E],(!g||g(I,s,a))&&!o[I]&&(a[I]=s[I],o[I]=!0);s=d!==!1&&Xg(s)}while(s&&(!d||d(s,a))&&s!==Object.prototype);return a},PP=(s,a,d)=>{s=String(s),(d===void 0||d>s.length)&&(d=s.length),d-=a.length;const g=s.indexOf(a,d);return g!==-1&&g===d},DP=s=>{if(!s)return null;if(eu(s))return s;let a=s.length;if(!vw(a))return null;const d=new Array(a);for(;a-- >0;)d[a]=s[a];return d},LP=(s=>a=>s&&a instanceof s)(typeof Uint8Array<"u"&&Xg(Uint8Array)),zP=(s,a)=>{const g=(s&&s[Symbol.iterator]).call(s);let x;for(;(x=g.next())&&!x.done;){const E=x.value;a.call(s,E[0],E[1])}},kP=(s,a)=>{let d;const g=[];for(;(d=s.exec(a))!==null;)g.push(d);return g},OP=ws("HTMLFormElement"),RP=s=>s.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(d,g,x){return g.toUpperCase()+x}),V0=(({hasOwnProperty:s})=>(a,d)=>s.call(a,d))(Object.prototype),BP=ws("RegExp"),Ew=(s,a)=>{const d=Object.getOwnPropertyDescriptors(s),g={};ed(d,(x,E)=>{a(x,E,s)!==!1&&(g[E]=x)}),Object.defineProperties(s,g)},FP=s=>{Ew(s,(a,d)=>{if(hl(s)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const g=s[d];if(hl(g)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},NP=(s,a)=>{const d={},g=x=>{x.forEach(E=>{d[E]=!0})};return eu(s)?g(s):g(String(s).split(a)),d},UP=()=>{},jP=(s,a)=>(s=+s,Number.isFinite(s)?s:a),VP=s=>{const a=new Array(10),d=(g,x)=>{if(Yg(g)){if(a.indexOf(g)>=0)return;if(!("toJSON"in g)){a[x]=g;const E=eu(g)?[]:{};return ed(g,(I,o)=>{const L=d(I,x+1);!Kh(L)&&(E[o]=L)}),a[x]=void 0,E}}return g};return d(s,0)},Ge={isArray:eu,isArrayBuffer:yw,isBuffer:fP,isFormData:EP,isArrayBufferView:mP,isString:_P,isNumber:vw,isBoolean:gP,isObject:Yg,isPlainObject:df,isUndefined:Kh,isDate:yP,isFile:vP,isBlob:xP,isRegExp:BP,isFunction:hl,isStream:wP,isURLSearchParams:TP,isTypedArray:LP,isFileList:bP,forEach:ed,merge:pg,extend:SP,trim:AP,stripBOM:CP,inherits:IP,toFlatObject:MP,kindOf:Kg,kindOfTest:ws,endsWith:PP,toArray:DP,forEachEntry:zP,matchAll:kP,isHTMLForm:OP,hasOwnProperty:V0,hasOwnProp:V0,reduceDescriptors:Ew,freezeMethods:FP,toObjectSet:NP,toCamelCase:RP,noop:UP,toFiniteNumber:jP,findKey:xw,global:bw,isContextDefined:ww,toJSONObject:VP};function Mi(s,a,d,g,x){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",a&&(this.code=a),d&&(this.config=d),g&&(this.request=g),x&&(this.response=x)}Ge.inherits(Mi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ge.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Tw=Mi.prototype,Aw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{Aw[s]={value:s}});Object.defineProperties(Mi,Aw);Object.defineProperty(Tw,"isAxiosError",{value:!0});Mi.from=(s,a,d,g,x,E)=>{const I=Object.create(Tw);return Ge.toFlatObject(s,I,function(L){return L!==Error.prototype},o=>o!=="isAxiosError"),Mi.call(I,s.message,a,d,g,x),I.cause=s,I.name=s.name,E&&Object.assign(I,E),I};var $P=typeof self=="object"?self.FormData:window.FormData;const GP=$P;function fg(s){return Ge.isPlainObject(s)||Ge.isArray(s)}function Sw(s){return Ge.endsWith(s,"[]")?s.slice(0,-2):s}function $0(s,a,d){return s?s.concat(a).map(function(x,E){return x=Sw(x),!d&&E?"["+x+"]":x}).join(d?".":""):a}function qP(s){return Ge.isArray(s)&&!s.some(fg)}const ZP=Ge.toFlatObject(Ge,{},null,function(a){return/^is[A-Z]/.test(a)});function WP(s){return s&&Ge.isFunction(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator]}function Zf(s,a,d){if(!Ge.isObject(s))throw new TypeError("target must be an object");a=a||new(GP||FormData),d=Ge.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ie,Ne){return!Ge.isUndefined(Ne[Ie])});const g=d.metaTokens,x=d.visitor||G,E=d.dots,I=d.indexes,L=(d.Blob||typeof Blob<"u"&&Blob)&&WP(a);if(!Ge.isFunction(x))throw new TypeError("visitor must be a function");function U(ge){if(ge===null)return"";if(Ge.isDate(ge))return ge.toISOString();if(!L&&Ge.isBlob(ge))throw new Mi("Blob is not supported. Use a Buffer instead.");return Ge.isArrayBuffer(ge)||Ge.isTypedArray(ge)?L&&typeof Blob=="function"?new Blob([ge]):Buffer.from(ge):ge}function G(ge,Ie,Ne){let et=ge;if(ge&&!Ne&&typeof ge=="object"){if(Ge.endsWith(Ie,"{}"))Ie=g?Ie:Ie.slice(0,-2),ge=JSON.stringify(ge);else if(Ge.isArray(ge)&&qP(ge)||Ge.isFileList(ge)||Ge.endsWith(Ie,"[]")&&(et=Ge.toArray(ge)))return Ie=Sw(Ie),et.forEach(function(Ve,ft){!(Ge.isUndefined(Ve)||Ve===null)&&a.append(I===!0?$0([Ie],ft,E):I===null?Ie:Ie+"[]",U(Ve))}),!1}return fg(ge)?!0:(a.append($0(Ne,Ie,E),U(ge)),!1)}const J=[],de=Object.assign(ZP,{defaultVisitor:G,convertValue:U,isVisitable:fg});function xe(ge,Ie){if(!Ge.isUndefined(ge)){if(J.indexOf(ge)!==-1)throw Error("Circular reference detected in "+Ie.join("."));J.push(ge),Ge.forEach(ge,function(et,ut){(!(Ge.isUndefined(et)||et===null)&&x.call(a,et,Ge.isString(ut)?ut.trim():ut,Ie,de))===!0&&xe(et,Ie?Ie.concat(ut):[ut])}),J.pop()}}if(!Ge.isObject(s))throw new TypeError("data must be an object");return xe(s),a}function G0(s){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(g){return a[g]})}function Jg(s,a){this._pairs=[],s&&Zf(s,this,a)}const Cw=Jg.prototype;Cw.append=function(a,d){this._pairs.push([a,d])};Cw.toString=function(a){const d=a?function(g){return a.call(this,g,G0)}:G0;return this._pairs.map(function(x){return d(x[0])+"="+d(x[1])},"").join("&")};function HP(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Iw(s,a,d){if(!a)return s;const g=d&&d.encode||HP,x=d&&d.serialize;let E;if(x?E=x(a,d):E=Ge.isURLSearchParams(a)?a.toString():new Jg(a,d).toString(g),E){const I=s.indexOf("#");I!==-1&&(s=s.slice(0,I)),s+=(s.indexOf("?")===-1?"?":"&")+E}return s}class XP{constructor(){this.handlers=[]}use(a,d,g){return this.handlers.push({fulfilled:a,rejected:d,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){Ge.forEach(this.handlers,function(g){g!==null&&a(g)})}}const q0=XP,Mw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},KP=typeof URLSearchParams<"u"?URLSearchParams:Jg,YP=FormData,JP=(()=>{let s;return typeof navigator<"u"&&((s=navigator.product)==="ReactNative"||s==="NativeScript"||s==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),QP=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),$o={isBrowser:!0,classes:{URLSearchParams:KP,FormData:YP,Blob},isStandardBrowserEnv:JP,isStandardBrowserWebWorkerEnv:QP,protocols:["http","https","file","blob","url","data"]};function eD(s,a){return Zf(s,new $o.classes.URLSearchParams,Object.assign({visitor:function(d,g,x,E){return $o.isNode&&Ge.isBuffer(d)?(this.append(g,d.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},a))}function tD(s){return Ge.matchAll(/\w+|\[(\w*)]/g,s).map(a=>a[0]==="[]"?"":a[1]||a[0])}function iD(s){const a={},d=Object.keys(s);let g;const x=d.length;let E;for(g=0;g<x;g++)E=d[g],a[E]=s[E];return a}function Pw(s){function a(d,g,x,E){let I=d[E++];const o=Number.isFinite(+I),L=E>=d.length;return I=!I&&Ge.isArray(x)?x.length:I,L?(Ge.hasOwnProp(x,I)?x[I]=[x[I],g]:x[I]=g,!o):((!x[I]||!Ge.isObject(x[I]))&&(x[I]=[]),a(d,g,x[I],E)&&Ge.isArray(x[I])&&(x[I]=iD(x[I])),!o)}if(Ge.isFormData(s)&&Ge.isFunction(s.entries)){const d={};return Ge.forEachEntry(s,(g,x)=>{a(tD(g),x,d,0)}),d}return null}const nD={"Content-Type":void 0};function rD(s,a,d){if(Ge.isString(s))try{return(a||JSON.parse)(s),Ge.trim(s)}catch(g){if(g.name!=="SyntaxError")throw g}return(d||JSON.stringify)(s)}const Wf={transitional:Mw,adapter:["xhr","http"],transformRequest:[function(a,d){const g=d.getContentType()||"",x=g.indexOf("application/json")>-1,E=Ge.isObject(a);if(E&&Ge.isHTMLForm(a)&&(a=new FormData(a)),Ge.isFormData(a))return x&&x?JSON.stringify(Pw(a)):a;if(Ge.isArrayBuffer(a)||Ge.isBuffer(a)||Ge.isStream(a)||Ge.isFile(a)||Ge.isBlob(a))return a;if(Ge.isArrayBufferView(a))return a.buffer;if(Ge.isURLSearchParams(a))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let o;if(E){if(g.indexOf("application/x-www-form-urlencoded")>-1)return eD(a,this.formSerializer).toString();if((o=Ge.isFileList(a))||g.indexOf("multipart/form-data")>-1){const L=this.env&&this.env.FormData;return Zf(o?{"files[]":a}:a,L&&new L,this.formSerializer)}}return E||x?(d.setContentType("application/json",!1),rD(a)):a}],transformResponse:[function(a){const d=this.transitional||Wf.transitional,g=d&&d.forcedJSONParsing,x=this.responseType==="json";if(a&&Ge.isString(a)&&(g&&!this.responseType||x)){const I=!(d&&d.silentJSONParsing)&&x;try{return JSON.parse(a)}catch(o){if(I)throw o.name==="SyntaxError"?Mi.from(o,Mi.ERR_BAD_RESPONSE,this,null,this.response):o}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$o.classes.FormData,Blob:$o.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ge.forEach(["delete","get","head"],function(a){Wf.headers[a]={}});Ge.forEach(["post","put","patch"],function(a){Wf.headers[a]=Ge.merge(nD)});const Qg=Wf,oD=Ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),sD=s=>{const a={};let d,g,x;return s&&s.split(`
`).forEach(function(I){x=I.indexOf(":"),d=I.substring(0,x).trim().toLowerCase(),g=I.substring(x+1).trim(),!(!d||a[d]&&oD[d])&&(d==="set-cookie"?a[d]?a[d].push(g):a[d]=[g]:a[d]=a[d]?a[d]+", "+g:g)}),a},Z0=Symbol("internals");function kh(s){return s&&String(s).trim().toLowerCase()}function pf(s){return s===!1||s==null?s:Ge.isArray(s)?s.map(pf):String(s)}function aD(s){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=d.exec(s);)a[g[1]]=g[2];return a}function lD(s){return/^[-_a-zA-Z]+$/.test(s.trim())}function W0(s,a,d,g){if(Ge.isFunction(g))return g.call(this,a,d);if(Ge.isString(a)){if(Ge.isString(g))return a.indexOf(g)!==-1;if(Ge.isRegExp(g))return g.test(a)}}function cD(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,d,g)=>d.toUpperCase()+g)}function uD(s,a){const d=Ge.toCamelCase(" "+a);["get","set","has"].forEach(g=>{Object.defineProperty(s,g+d,{value:function(x,E,I){return this[g].call(this,a,x,E,I)},configurable:!0})})}class Hf{constructor(a){a&&this.set(a)}set(a,d,g){const x=this;function E(o,L,U){const G=kh(L);if(!G)throw new Error("header name must be a non-empty string");const J=Ge.findKey(x,G);(!J||x[J]===void 0||U===!0||U===void 0&&x[J]!==!1)&&(x[J||L]=pf(o))}const I=(o,L)=>Ge.forEach(o,(U,G)=>E(U,G,L));return Ge.isPlainObject(a)||a instanceof this.constructor?I(a,d):Ge.isString(a)&&(a=a.trim())&&!lD(a)?I(sD(a),d):a!=null&&E(d,a,g),this}get(a,d){if(a=kh(a),a){const g=Ge.findKey(this,a);if(g){const x=this[g];if(!d)return x;if(d===!0)return aD(x);if(Ge.isFunction(d))return d.call(this,x,g);if(Ge.isRegExp(d))return d.exec(x);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,d){if(a=kh(a),a){const g=Ge.findKey(this,a);return!!(g&&(!d||W0(this,this[g],g,d)))}return!1}delete(a,d){const g=this;let x=!1;function E(I){if(I=kh(I),I){const o=Ge.findKey(g,I);o&&(!d||W0(g,g[o],o,d))&&(delete g[o],x=!0)}}return Ge.isArray(a)?a.forEach(E):E(a),x}clear(){return Object.keys(this).forEach(this.delete.bind(this))}normalize(a){const d=this,g={};return Ge.forEach(this,(x,E)=>{const I=Ge.findKey(g,E);if(I){d[I]=pf(x),delete d[E];return}const o=a?cD(E):String(E).trim();o!==E&&delete d[E],d[o]=pf(x),g[o]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const d=Object.create(null);return Ge.forEach(this,(g,x)=>{g!=null&&g!==!1&&(d[x]=a&&Ge.isArray(g)?g.join(", "):g)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,d])=>a+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...d){const g=new this(a);return d.forEach(x=>g.set(x)),g}static accessor(a){const g=(this[Z0]=this[Z0]={accessors:{}}).accessors,x=this.prototype;function E(I){const o=kh(I);g[o]||(uD(x,I),g[o]=!0)}return Ge.isArray(a)?a.forEach(E):E(a),this}}Hf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);Ge.freezeMethods(Hf.prototype);Ge.freezeMethods(Hf);const ms=Hf;function k_(s,a){const d=this||Qg,g=a||d,x=ms.from(g.headers);let E=g.data;return Ge.forEach(s,function(o){E=o.call(d,E,x.normalize(),a?a.status:void 0)}),x.normalize(),E}function Dw(s){return!!(s&&s.__CANCEL__)}function td(s,a,d){Mi.call(this,s??"canceled",Mi.ERR_CANCELED,a,d),this.name="CanceledError"}Ge.inherits(td,Mi,{__CANCEL__:!0});const hD=null;function dD(s,a,d){const g=d.config.validateStatus;!d.status||!g||g(d.status)?s(d):a(new Mi("Request failed with status code "+d.status,[Mi.ERR_BAD_REQUEST,Mi.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const pD=$o.isStandardBrowserEnv?function(){return{write:function(d,g,x,E,I,o){const L=[];L.push(d+"="+encodeURIComponent(g)),Ge.isNumber(x)&&L.push("expires="+new Date(x).toGMTString()),Ge.isString(E)&&L.push("path="+E),Ge.isString(I)&&L.push("domain="+I),o===!0&&L.push("secure"),document.cookie=L.join("; ")},read:function(d){const g=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove:function(d){this.write(d,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function fD(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function mD(s,a){return a?s.replace(/\/+$/,"")+"/"+a.replace(/^\/+/,""):s}function Lw(s,a){return s&&!fD(a)?mD(s,a):a}const _D=$o.isStandardBrowserEnv?function(){const a=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let g;function x(E){let I=E;return a&&(d.setAttribute("href",I),I=d.href),d.setAttribute("href",I),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return g=x(window.location.href),function(I){const o=Ge.isString(I)?x(I):I;return o.protocol===g.protocol&&o.host===g.host}}():function(){return function(){return!0}}();function gD(s){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return a&&a[1]||""}function yD(s,a){s=s||10;const d=new Array(s),g=new Array(s);let x=0,E=0,I;return a=a!==void 0?a:1e3,function(L){const U=Date.now(),G=g[E];I||(I=U),d[x]=L,g[x]=U;let J=E,de=0;for(;J!==x;)de+=d[J++],J=J%s;if(x=(x+1)%s,x===E&&(E=(E+1)%s),U-I<a)return;const xe=G&&U-G;return xe?Math.round(de*1e3/xe):void 0}}function H0(s,a){let d=0;const g=yD(50,250);return x=>{const E=x.loaded,I=x.lengthComputable?x.total:void 0,o=E-d,L=g(o),U=E<=I;d=E;const G={loaded:E,total:I,progress:I?E/I:void 0,bytes:o,rate:L||void 0,estimated:L&&I&&U?(I-E)/L:void 0,event:x};G[a?"download":"upload"]=!0,s(G)}}const vD=typeof XMLHttpRequest<"u",xD=vD&&function(s){return new Promise(function(d,g){let x=s.data;const E=ms.from(s.headers).normalize(),I=s.responseType;let o;function L(){s.cancelToken&&s.cancelToken.unsubscribe(o),s.signal&&s.signal.removeEventListener("abort",o)}Ge.isFormData(x)&&($o.isStandardBrowserEnv||$o.isStandardBrowserWebWorkerEnv)&&E.setContentType(!1);let U=new XMLHttpRequest;if(s.auth){const xe=s.auth.username||"",ge=s.auth.password?unescape(encodeURIComponent(s.auth.password)):"";E.set("Authorization","Basic "+btoa(xe+":"+ge))}const G=Lw(s.baseURL,s.url);U.open(s.method.toUpperCase(),Iw(G,s.params,s.paramsSerializer),!0),U.timeout=s.timeout;function J(){if(!U)return;const xe=ms.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders()),Ie={data:!I||I==="text"||I==="json"?U.responseText:U.response,status:U.status,statusText:U.statusText,headers:xe,config:s,request:U};dD(function(et){d(et),L()},function(et){g(et),L()},Ie),U=null}if("onloadend"in U?U.onloadend=J:U.onreadystatechange=function(){!U||U.readyState!==4||U.status===0&&!(U.responseURL&&U.responseURL.indexOf("file:")===0)||setTimeout(J)},U.onabort=function(){U&&(g(new Mi("Request aborted",Mi.ECONNABORTED,s,U)),U=null)},U.onerror=function(){g(new Mi("Network Error",Mi.ERR_NETWORK,s,U)),U=null},U.ontimeout=function(){let ge=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const Ie=s.transitional||Mw;s.timeoutErrorMessage&&(ge=s.timeoutErrorMessage),g(new Mi(ge,Ie.clarifyTimeoutError?Mi.ETIMEDOUT:Mi.ECONNABORTED,s,U)),U=null},$o.isStandardBrowserEnv){const xe=(s.withCredentials||_D(G))&&s.xsrfCookieName&&pD.read(s.xsrfCookieName);xe&&E.set(s.xsrfHeaderName,xe)}x===void 0&&E.setContentType(null),"setRequestHeader"in U&&Ge.forEach(E.toJSON(),function(ge,Ie){U.setRequestHeader(Ie,ge)}),Ge.isUndefined(s.withCredentials)||(U.withCredentials=!!s.withCredentials),I&&I!=="json"&&(U.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&U.addEventListener("progress",H0(s.onDownloadProgress,!0)),typeof s.onUploadProgress=="function"&&U.upload&&U.upload.addEventListener("progress",H0(s.onUploadProgress)),(s.cancelToken||s.signal)&&(o=xe=>{U&&(g(!xe||xe.type?new td(null,s,U):xe),U.abort(),U=null)},s.cancelToken&&s.cancelToken.subscribe(o),s.signal&&(s.signal.aborted?o():s.signal.addEventListener("abort",o)));const de=gD(G);if(de&&$o.protocols.indexOf(de)===-1){g(new Mi("Unsupported protocol "+de+":",Mi.ERR_BAD_REQUEST,s));return}U.send(x||null)})},ff={http:hD,xhr:xD};Ge.forEach(ff,(s,a)=>{if(s){try{Object.defineProperty(s,"name",{value:a})}catch{}Object.defineProperty(s,"adapterName",{value:a})}});const bD={getAdapter:s=>{s=Ge.isArray(s)?s:[s];const{length:a}=s;let d,g;for(let x=0;x<a&&(d=s[x],!(g=Ge.isString(d)?ff[d.toLowerCase()]:d));x++);if(!g)throw g===!1?new Mi(`Adapter ${d} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Ge.hasOwnProp(ff,d)?`Adapter '${d}' is not available in the build`:`Unknown adapter '${d}'`);if(!Ge.isFunction(g))throw new TypeError("adapter is not a function");return g},adapters:ff};function O_(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new td(null,s)}function X0(s){return O_(s),s.headers=ms.from(s.headers),s.data=k_.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),bD.getAdapter(s.adapter||Qg.adapter)(s).then(function(g){return O_(s),g.data=k_.call(s,s.transformResponse,g),g.headers=ms.from(g.headers),g},function(g){return Dw(g)||(O_(s),g&&g.response&&(g.response.data=k_.call(s,s.transformResponse,g.response),g.response.headers=ms.from(g.response.headers))),Promise.reject(g)})}const K0=s=>s instanceof ms?s.toJSON():s;function $c(s,a){a=a||{};const d={};function g(U,G,J){return Ge.isPlainObject(U)&&Ge.isPlainObject(G)?Ge.merge.call({caseless:J},U,G):Ge.isPlainObject(G)?Ge.merge({},G):Ge.isArray(G)?G.slice():G}function x(U,G,J){if(Ge.isUndefined(G)){if(!Ge.isUndefined(U))return g(void 0,U,J)}else return g(U,G,J)}function E(U,G){if(!Ge.isUndefined(G))return g(void 0,G)}function I(U,G){if(Ge.isUndefined(G)){if(!Ge.isUndefined(U))return g(void 0,U)}else return g(void 0,G)}function o(U,G,J){if(J in a)return g(U,G);if(J in s)return g(void 0,U)}const L={url:E,method:E,data:E,baseURL:I,transformRequest:I,transformResponse:I,paramsSerializer:I,timeout:I,timeoutMessage:I,withCredentials:I,adapter:I,responseType:I,xsrfCookieName:I,xsrfHeaderName:I,onUploadProgress:I,onDownloadProgress:I,decompress:I,maxContentLength:I,maxBodyLength:I,beforeRedirect:I,transport:I,httpAgent:I,httpsAgent:I,cancelToken:I,socketPath:I,responseEncoding:I,validateStatus:o,headers:(U,G)=>x(K0(U),K0(G),!0)};return Ge.forEach(Object.keys(s).concat(Object.keys(a)),function(G){const J=L[G]||x,de=J(s[G],a[G],G);Ge.isUndefined(de)&&J!==o||(d[G]=de)}),d}const zw="1.2.1",ey={};["object","boolean","number","function","string","symbol"].forEach((s,a)=>{ey[s]=function(g){return typeof g===s||"a"+(a<1?"n ":" ")+s}});const Y0={};ey.transitional=function(a,d,g){function x(E,I){return"[Axios v"+zw+"] Transitional option '"+E+"'"+I+(g?". "+g:"")}return(E,I,o)=>{if(a===!1)throw new Mi(x(I," has been removed"+(d?" in "+d:"")),Mi.ERR_DEPRECATED);return d&&!Y0[I]&&(Y0[I]=!0,console.warn(x(I," has been deprecated since v"+d+" and will be removed in the near future"))),a?a(E,I,o):!0}};function wD(s,a,d){if(typeof s!="object")throw new Mi("options must be an object",Mi.ERR_BAD_OPTION_VALUE);const g=Object.keys(s);let x=g.length;for(;x-- >0;){const E=g[x],I=a[E];if(I){const o=s[E],L=o===void 0||I(o,E,s);if(L!==!0)throw new Mi("option "+E+" must be "+L,Mi.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new Mi("Unknown option "+E,Mi.ERR_BAD_OPTION)}}const mg={assertOptions:wD,validators:ey},ta=mg.validators;class Cf{constructor(a){this.defaults=a,this.interceptors={request:new q0,response:new q0}}request(a,d){typeof a=="string"?(d=d||{},d.url=a):d=a||{},d=$c(this.defaults,d);const{transitional:g,paramsSerializer:x,headers:E}=d;g!==void 0&&mg.assertOptions(g,{silentJSONParsing:ta.transitional(ta.boolean),forcedJSONParsing:ta.transitional(ta.boolean),clarifyTimeoutError:ta.transitional(ta.boolean)},!1),x!==void 0&&mg.assertOptions(x,{encode:ta.function,serialize:ta.function},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let I;I=E&&Ge.merge(E.common,E[d.method]),I&&Ge.forEach(["delete","get","head","post","put","patch","common"],ge=>{delete E[ge]}),d.headers=ms.concat(I,E);const o=[];let L=!0;this.interceptors.request.forEach(function(Ie){typeof Ie.runWhen=="function"&&Ie.runWhen(d)===!1||(L=L&&Ie.synchronous,o.unshift(Ie.fulfilled,Ie.rejected))});const U=[];this.interceptors.response.forEach(function(Ie){U.push(Ie.fulfilled,Ie.rejected)});let G,J=0,de;if(!L){const ge=[X0.bind(this),void 0];for(ge.unshift.apply(ge,o),ge.push.apply(ge,U),de=ge.length,G=Promise.resolve(d);J<de;)G=G.then(ge[J++],ge[J++]);return G}de=o.length;let xe=d;for(J=0;J<de;){const ge=o[J++],Ie=o[J++];try{xe=ge(xe)}catch(Ne){Ie.call(this,Ne);break}}try{G=X0.call(this,xe)}catch(ge){return Promise.reject(ge)}for(J=0,de=U.length;J<de;)G=G.then(U[J++],U[J++]);return G}getUri(a){a=$c(this.defaults,a);const d=Lw(a.baseURL,a.url);return Iw(d,a.params,a.paramsSerializer)}}Ge.forEach(["delete","get","head","options"],function(a){Cf.prototype[a]=function(d,g){return this.request($c(g||{},{method:a,url:d,data:(g||{}).data}))}});Ge.forEach(["post","put","patch"],function(a){function d(g){return function(E,I,o){return this.request($c(o||{},{method:a,headers:g?{"Content-Type":"multipart/form-data"}:{},url:E,data:I}))}}Cf.prototype[a]=d(),Cf.prototype[a+"Form"]=d(!0)});const mf=Cf;class ty{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(E){d=E});const g=this;this.promise.then(x=>{if(!g._listeners)return;let E=g._listeners.length;for(;E-- >0;)g._listeners[E](x);g._listeners=null}),this.promise.then=x=>{let E;const I=new Promise(o=>{g.subscribe(o),E=o}).then(x);return I.cancel=function(){g.unsubscribe(E)},I},a(function(E,I,o){g.reason||(g.reason=new td(E,I,o),d(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const d=this._listeners.indexOf(a);d!==-1&&this._listeners.splice(d,1)}static source(){let a;return{token:new ty(function(x){a=x}),cancel:a}}}const ED=ty;function TD(s){return function(d){return s.apply(null,d)}}function AD(s){return Ge.isObject(s)&&s.isAxiosError===!0}function kw(s){const a=new mf(s),d=_w(mf.prototype.request,a);return Ge.extend(d,mf.prototype,a,{allOwnKeys:!0}),Ge.extend(d,a,null,{allOwnKeys:!0}),d.create=function(x){return kw($c(s,x))},d}const On=kw(Qg);On.Axios=mf;On.CanceledError=td;On.CancelToken=ED;On.isCancel=Dw;On.VERSION=zw;On.toFormData=Zf;On.AxiosError=Mi;On.Cancel=On.CanceledError;On.all=function(a){return Promise.all(a)};On.spread=TD;On.isAxiosError=AD;On.mergeConfig=$c;On.AxiosHeaders=ms;On.formToJSON=s=>Pw(Ge.isHTMLForm(s)?new FormData(s):s);On.default=On;const Jp=On;var lr="top",Mr="bottom",Pr="right",cr="left",Xf="auto",tu=[lr,Mr,Pr,cr],dl="start",Gc="end",Ow="clippingParents",iy="viewport",Sc="popper",Rw="reference",_g=tu.reduce(function(s,a){return s.concat([a+"-"+dl,a+"-"+Gc])},[]),ny=[].concat(tu,[Xf]).reduce(function(s,a){return s.concat([a,a+"-"+dl,a+"-"+Gc])},[]),Bw="beforeRead",Fw="read",Nw="afterRead",Uw="beforeMain",jw="main",Vw="afterMain",$w="beforeWrite",Gw="write",qw="afterWrite",Zw=[Bw,Fw,Nw,Uw,jw,Vw,$w,Gw,qw];function Zo(s){return s?(s.nodeName||"").toLowerCase():null}function Xr(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var a=s.ownerDocument;return a&&a.defaultView||window}return s}function pl(s){var a=Xr(s).Element;return s instanceof a||s instanceof Element}function Wr(s){var a=Xr(s).HTMLElement;return s instanceof a||s instanceof HTMLElement}function ry(s){if(typeof ShadowRoot>"u")return!1;var a=Xr(s).ShadowRoot;return s instanceof a||s instanceof ShadowRoot}function SD(s){var a=s.state;Object.keys(a.elements).forEach(function(d){var g=a.styles[d]||{},x=a.attributes[d]||{},E=a.elements[d];!Wr(E)||!Zo(E)||(Object.assign(E.style,g),Object.keys(x).forEach(function(I){var o=x[I];o===!1?E.removeAttribute(I):E.setAttribute(I,o===!0?"":o)}))})}function CD(s){var a=s.state,d={popper:{position:a.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(a.elements.popper.style,d.popper),a.styles=d,a.elements.arrow&&Object.assign(a.elements.arrow.style,d.arrow),function(){Object.keys(a.elements).forEach(function(g){var x=a.elements[g],E=a.attributes[g]||{},I=Object.keys(a.styles.hasOwnProperty(g)?a.styles[g]:d[g]),o=I.reduce(function(L,U){return L[U]="",L},{});!Wr(x)||!Zo(x)||(Object.assign(x.style,o),Object.keys(E).forEach(function(L){x.removeAttribute(L)}))})}}const oy={name:"applyStyles",enabled:!0,phase:"write",fn:SD,effect:CD,requires:["computeStyles"]};function Go(s){return s.split("-")[0]}var cl=Math.max,If=Math.min,qc=Math.round;function gg(){var s=navigator.userAgentData;return s!=null&&s.brands?s.brands.map(function(a){return a.brand+"/"+a.version}).join(" "):navigator.userAgent}function Ww(){return!/^((?!chrome|android).)*safari/i.test(gg())}function Zc(s,a,d){a===void 0&&(a=!1),d===void 0&&(d=!1);var g=s.getBoundingClientRect(),x=1,E=1;a&&Wr(s)&&(x=s.offsetWidth>0&&qc(g.width)/s.offsetWidth||1,E=s.offsetHeight>0&&qc(g.height)/s.offsetHeight||1);var I=pl(s)?Xr(s):window,o=I.visualViewport,L=!Ww()&&d,U=(g.left+(L&&o?o.offsetLeft:0))/x,G=(g.top+(L&&o?o.offsetTop:0))/E,J=g.width/x,de=g.height/E;return{width:J,height:de,top:G,right:U+J,bottom:G+de,left:U,x:U,y:G}}function sy(s){var a=Zc(s),d=s.offsetWidth,g=s.offsetHeight;return Math.abs(a.width-d)<=1&&(d=a.width),Math.abs(a.height-g)<=1&&(g=a.height),{x:s.offsetLeft,y:s.offsetTop,width:d,height:g}}function Hw(s,a){var d=a.getRootNode&&a.getRootNode();if(s.contains(a))return!0;if(d&&ry(d)){var g=a;do{if(g&&s.isSameNode(g))return!0;g=g.parentNode||g.host}while(g)}return!1}function xs(s){return Xr(s).getComputedStyle(s)}function ID(s){return["table","td","th"].indexOf(Zo(s))>=0}function fa(s){return((pl(s)?s.ownerDocument:s.document)||window.document).documentElement}function Kf(s){return Zo(s)==="html"?s:s.assignedSlot||s.parentNode||(ry(s)?s.host:null)||fa(s)}function J0(s){return!Wr(s)||xs(s).position==="fixed"?null:s.offsetParent}function MD(s){var a=/firefox/i.test(gg()),d=/Trident/i.test(gg());if(d&&Wr(s)){var g=xs(s);if(g.position==="fixed")return null}var x=Kf(s);for(ry(x)&&(x=x.host);Wr(x)&&["html","body"].indexOf(Zo(x))<0;){var E=xs(x);if(E.transform!=="none"||E.perspective!=="none"||E.contain==="paint"||["transform","perspective"].indexOf(E.willChange)!==-1||a&&E.willChange==="filter"||a&&E.filter&&E.filter!=="none")return x;x=x.parentNode}return null}function id(s){for(var a=Xr(s),d=J0(s);d&&ID(d)&&xs(d).position==="static";)d=J0(d);return d&&(Zo(d)==="html"||Zo(d)==="body"&&xs(d).position==="static")?a:d||MD(s)||a}function ay(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function Vh(s,a,d){return cl(s,If(a,d))}function PD(s,a,d){var g=Vh(s,a,d);return g>d?d:g}function Xw(){return{top:0,right:0,bottom:0,left:0}}function Kw(s){return Object.assign({},Xw(),s)}function Yw(s,a){return a.reduce(function(d,g){return d[g]=s,d},{})}var DD=function(a,d){return a=typeof a=="function"?a(Object.assign({},d.rects,{placement:d.placement})):a,Kw(typeof a!="number"?a:Yw(a,tu))};function LD(s){var a,d=s.state,g=s.name,x=s.options,E=d.elements.arrow,I=d.modifiersData.popperOffsets,o=Go(d.placement),L=ay(o),U=[cr,Pr].indexOf(o)>=0,G=U?"height":"width";if(!(!E||!I)){var J=DD(x.padding,d),de=sy(E),xe=L==="y"?lr:cr,ge=L==="y"?Mr:Pr,Ie=d.rects.reference[G]+d.rects.reference[L]-I[L]-d.rects.popper[G],Ne=I[L]-d.rects.reference[L],et=id(E),ut=et?L==="y"?et.clientHeight||0:et.clientWidth||0:0,Ve=Ie/2-Ne/2,ft=J[xe],Ce=ut-de[G]-J[ge],xt=ut/2-de[G]/2+Ve,Gt=Vh(ft,xt,Ce),At=L;d.modifiersData[g]=(a={},a[At]=Gt,a.centerOffset=Gt-xt,a)}}function zD(s){var a=s.state,d=s.options,g=d.element,x=g===void 0?"[data-popper-arrow]":g;x!=null&&(typeof x=="string"&&(x=a.elements.popper.querySelector(x),!x)||Hw(a.elements.popper,x)&&(a.elements.arrow=x))}const Jw={name:"arrow",enabled:!0,phase:"main",fn:LD,effect:zD,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Wc(s){return s.split("-")[1]}var kD={top:"auto",right:"auto",bottom:"auto",left:"auto"};function OD(s){var a=s.x,d=s.y,g=window,x=g.devicePixelRatio||1;return{x:qc(a*x)/x||0,y:qc(d*x)/x||0}}function Q0(s){var a,d=s.popper,g=s.popperRect,x=s.placement,E=s.variation,I=s.offsets,o=s.position,L=s.gpuAcceleration,U=s.adaptive,G=s.roundOffsets,J=s.isFixed,de=I.x,xe=de===void 0?0:de,ge=I.y,Ie=ge===void 0?0:ge,Ne=typeof G=="function"?G({x:xe,y:Ie}):{x:xe,y:Ie};xe=Ne.x,Ie=Ne.y;var et=I.hasOwnProperty("x"),ut=I.hasOwnProperty("y"),Ve=cr,ft=lr,Ce=window;if(U){var xt=id(d),Gt="clientHeight",At="clientWidth";if(xt===Xr(d)&&(xt=fa(d),xs(xt).position!=="static"&&o==="absolute"&&(Gt="scrollHeight",At="scrollWidth")),xt=xt,x===lr||(x===cr||x===Pr)&&E===Gc){ft=Mr;var _t=J&&xt===Ce&&Ce.visualViewport?Ce.visualViewport.height:xt[Gt];Ie-=_t-g.height,Ie*=L?1:-1}if(x===cr||(x===lr||x===Mr)&&E===Gc){Ve=Pr;var It=J&&xt===Ce&&Ce.visualViewport?Ce.visualViewport.width:xt[At];xe-=It-g.width,xe*=L?1:-1}}var mi=Object.assign({position:o},U&&kD),Bi=G===!0?OD({x:xe,y:Ie}):{x:xe,y:Ie};if(xe=Bi.x,Ie=Bi.y,L){var bi;return Object.assign({},mi,(bi={},bi[ft]=ut?"0":"",bi[Ve]=et?"0":"",bi.transform=(Ce.devicePixelRatio||1)<=1?"translate("+xe+"px, "+Ie+"px)":"translate3d("+xe+"px, "+Ie+"px, 0)",bi))}return Object.assign({},mi,(a={},a[ft]=ut?Ie+"px":"",a[Ve]=et?xe+"px":"",a.transform="",a))}function RD(s){var a=s.state,d=s.options,g=d.gpuAcceleration,x=g===void 0?!0:g,E=d.adaptive,I=E===void 0?!0:E,o=d.roundOffsets,L=o===void 0?!0:o,U={placement:Go(a.placement),variation:Wc(a.placement),popper:a.elements.popper,popperRect:a.rects.popper,gpuAcceleration:x,isFixed:a.options.strategy==="fixed"};a.modifiersData.popperOffsets!=null&&(a.styles.popper=Object.assign({},a.styles.popper,Q0(Object.assign({},U,{offsets:a.modifiersData.popperOffsets,position:a.options.strategy,adaptive:I,roundOffsets:L})))),a.modifiersData.arrow!=null&&(a.styles.arrow=Object.assign({},a.styles.arrow,Q0(Object.assign({},U,{offsets:a.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:L})))),a.attributes.popper=Object.assign({},a.attributes.popper,{"data-popper-placement":a.placement})}const ly={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:RD,data:{}};var Qp={passive:!0};function BD(s){var a=s.state,d=s.instance,g=s.options,x=g.scroll,E=x===void 0?!0:x,I=g.resize,o=I===void 0?!0:I,L=Xr(a.elements.popper),U=[].concat(a.scrollParents.reference,a.scrollParents.popper);return E&&U.forEach(function(G){G.addEventListener("scroll",d.update,Qp)}),o&&L.addEventListener("resize",d.update,Qp),function(){E&&U.forEach(function(G){G.removeEventListener("scroll",d.update,Qp)}),o&&L.removeEventListener("resize",d.update,Qp)}}const cy={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:BD,data:{}};var FD={left:"right",right:"left",bottom:"top",top:"bottom"};function _f(s){return s.replace(/left|right|bottom|top/g,function(a){return FD[a]})}var ND={start:"end",end:"start"};function eb(s){return s.replace(/start|end/g,function(a){return ND[a]})}function uy(s){var a=Xr(s),d=a.pageXOffset,g=a.pageYOffset;return{scrollLeft:d,scrollTop:g}}function hy(s){return Zc(fa(s)).left+uy(s).scrollLeft}function UD(s,a){var d=Xr(s),g=fa(s),x=d.visualViewport,E=g.clientWidth,I=g.clientHeight,o=0,L=0;if(x){E=x.width,I=x.height;var U=Ww();(U||!U&&a==="fixed")&&(o=x.offsetLeft,L=x.offsetTop)}return{width:E,height:I,x:o+hy(s),y:L}}function jD(s){var a,d=fa(s),g=uy(s),x=(a=s.ownerDocument)==null?void 0:a.body,E=cl(d.scrollWidth,d.clientWidth,x?x.scrollWidth:0,x?x.clientWidth:0),I=cl(d.scrollHeight,d.clientHeight,x?x.scrollHeight:0,x?x.clientHeight:0),o=-g.scrollLeft+hy(s),L=-g.scrollTop;return xs(x||d).direction==="rtl"&&(o+=cl(d.clientWidth,x?x.clientWidth:0)-E),{width:E,height:I,x:o,y:L}}function dy(s){var a=xs(s),d=a.overflow,g=a.overflowX,x=a.overflowY;return/auto|scroll|overlay|hidden/.test(d+x+g)}function Qw(s){return["html","body","#document"].indexOf(Zo(s))>=0?s.ownerDocument.body:Wr(s)&&dy(s)?s:Qw(Kf(s))}function $h(s,a){var d;a===void 0&&(a=[]);var g=Qw(s),x=g===((d=s.ownerDocument)==null?void 0:d.body),E=Xr(g),I=x?[E].concat(E.visualViewport||[],dy(g)?g:[]):g,o=a.concat(I);return x?o:o.concat($h(Kf(I)))}function yg(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function VD(s,a){var d=Zc(s,!1,a==="fixed");return d.top=d.top+s.clientTop,d.left=d.left+s.clientLeft,d.bottom=d.top+s.clientHeight,d.right=d.left+s.clientWidth,d.width=s.clientWidth,d.height=s.clientHeight,d.x=d.left,d.y=d.top,d}function tb(s,a,d){return a===iy?yg(UD(s,d)):pl(a)?VD(a,d):yg(jD(fa(s)))}function $D(s){var a=$h(Kf(s)),d=["absolute","fixed"].indexOf(xs(s).position)>=0,g=d&&Wr(s)?id(s):s;return pl(g)?a.filter(function(x){return pl(x)&&Hw(x,g)&&Zo(x)!=="body"}):[]}function GD(s,a,d,g){var x=a==="clippingParents"?$D(s):[].concat(a),E=[].concat(x,[d]),I=E[0],o=E.reduce(function(L,U){var G=tb(s,U,g);return L.top=cl(G.top,L.top),L.right=If(G.right,L.right),L.bottom=If(G.bottom,L.bottom),L.left=cl(G.left,L.left),L},tb(s,I,g));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function eE(s){var a=s.reference,d=s.element,g=s.placement,x=g?Go(g):null,E=g?Wc(g):null,I=a.x+a.width/2-d.width/2,o=a.y+a.height/2-d.height/2,L;switch(x){case lr:L={x:I,y:a.y-d.height};break;case Mr:L={x:I,y:a.y+a.height};break;case Pr:L={x:a.x+a.width,y:o};break;case cr:L={x:a.x-d.width,y:o};break;default:L={x:a.x,y:a.y}}var U=x?ay(x):null;if(U!=null){var G=U==="y"?"height":"width";switch(E){case dl:L[U]=L[U]-(a[G]/2-d[G]/2);break;case Gc:L[U]=L[U]+(a[G]/2-d[G]/2);break}}return L}function Hc(s,a){a===void 0&&(a={});var d=a,g=d.placement,x=g===void 0?s.placement:g,E=d.strategy,I=E===void 0?s.strategy:E,o=d.boundary,L=o===void 0?Ow:o,U=d.rootBoundary,G=U===void 0?iy:U,J=d.elementContext,de=J===void 0?Sc:J,xe=d.altBoundary,ge=xe===void 0?!1:xe,Ie=d.padding,Ne=Ie===void 0?0:Ie,et=Kw(typeof Ne!="number"?Ne:Yw(Ne,tu)),ut=de===Sc?Rw:Sc,Ve=s.rects.popper,ft=s.elements[ge?ut:de],Ce=GD(pl(ft)?ft:ft.contextElement||fa(s.elements.popper),L,G,I),xt=Zc(s.elements.reference),Gt=eE({reference:xt,element:Ve,strategy:"absolute",placement:x}),At=yg(Object.assign({},Ve,Gt)),_t=de===Sc?At:xt,It={top:Ce.top-_t.top+et.top,bottom:_t.bottom-Ce.bottom+et.bottom,left:Ce.left-_t.left+et.left,right:_t.right-Ce.right+et.right},mi=s.modifiersData.offset;if(de===Sc&&mi){var Bi=mi[x];Object.keys(It).forEach(function(bi){var hn=[Pr,Mr].indexOf(bi)>=0?1:-1,Ft=[lr,Mr].indexOf(bi)>=0?"y":"x";It[bi]+=Bi[Ft]*hn})}return It}function qD(s,a){a===void 0&&(a={});var d=a,g=d.placement,x=d.boundary,E=d.rootBoundary,I=d.padding,o=d.flipVariations,L=d.allowedAutoPlacements,U=L===void 0?ny:L,G=Wc(g),J=G?o?_g:_g.filter(function(ge){return Wc(ge)===G}):tu,de=J.filter(function(ge){return U.indexOf(ge)>=0});de.length===0&&(de=J);var xe=de.reduce(function(ge,Ie){return ge[Ie]=Hc(s,{placement:Ie,boundary:x,rootBoundary:E,padding:I})[Go(Ie)],ge},{});return Object.keys(xe).sort(function(ge,Ie){return xe[ge]-xe[Ie]})}function ZD(s){if(Go(s)===Xf)return[];var a=_f(s);return[eb(s),a,eb(a)]}function WD(s){var a=s.state,d=s.options,g=s.name;if(!a.modifiersData[g]._skip){for(var x=d.mainAxis,E=x===void 0?!0:x,I=d.altAxis,o=I===void 0?!0:I,L=d.fallbackPlacements,U=d.padding,G=d.boundary,J=d.rootBoundary,de=d.altBoundary,xe=d.flipVariations,ge=xe===void 0?!0:xe,Ie=d.allowedAutoPlacements,Ne=a.options.placement,et=Go(Ne),ut=et===Ne,Ve=L||(ut||!ge?[_f(Ne)]:ZD(Ne)),ft=[Ne].concat(Ve).reduce(function(dn,vn){return dn.concat(Go(vn)===Xf?qD(a,{placement:vn,boundary:G,rootBoundary:J,padding:U,flipVariations:ge,allowedAutoPlacements:Ie}):vn)},[]),Ce=a.rects.reference,xt=a.rects.popper,Gt=new Map,At=!0,_t=ft[0],It=0;It<ft.length;It++){var mi=ft[It],Bi=Go(mi),bi=Wc(mi)===dl,hn=[lr,Mr].indexOf(Bi)>=0,Ft=hn?"width":"height",ui=Hc(a,{placement:mi,boundary:G,rootBoundary:J,altBoundary:de,padding:U}),Jt=hn?bi?Pr:cr:bi?Mr:lr;Ce[Ft]>xt[Ft]&&(Jt=_f(Jt));var ei=_f(Jt),Wi=[];if(E&&Wi.push(ui[Bi]<=0),o&&Wi.push(ui[Jt]<=0,ui[ei]<=0),Wi.every(function(dn){return dn})){_t=mi,At=!1;break}Gt.set(mi,Wi)}if(At)for(var gi=ge?3:1,yn=function(vn){var Hi=ft.find(function(Yi){var pn=Gt.get(Yi);if(pn)return pn.slice(0,vn).every(function(In){return In})});if(Hi)return _t=Hi,"break"},Ki=gi;Ki>0;Ki--){var xn=yn(Ki);if(xn==="break")break}a.placement!==_t&&(a.modifiersData[g]._skip=!0,a.placement=_t,a.reset=!0)}}const tE={name:"flip",enabled:!0,phase:"main",fn:WD,requiresIfExists:["offset"],data:{_skip:!1}};function ib(s,a,d){return d===void 0&&(d={x:0,y:0}),{top:s.top-a.height-d.y,right:s.right-a.width+d.x,bottom:s.bottom-a.height+d.y,left:s.left-a.width-d.x}}function nb(s){return[lr,Pr,Mr,cr].some(function(a){return s[a]>=0})}function HD(s){var a=s.state,d=s.name,g=a.rects.reference,x=a.rects.popper,E=a.modifiersData.preventOverflow,I=Hc(a,{elementContext:"reference"}),o=Hc(a,{altBoundary:!0}),L=ib(I,g),U=ib(o,x,E),G=nb(L),J=nb(U);a.modifiersData[d]={referenceClippingOffsets:L,popperEscapeOffsets:U,isReferenceHidden:G,hasPopperEscaped:J},a.attributes.popper=Object.assign({},a.attributes.popper,{"data-popper-reference-hidden":G,"data-popper-escaped":J})}const iE={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:HD};function XD(s,a,d){var g=Go(s),x=[cr,lr].indexOf(g)>=0?-1:1,E=typeof d=="function"?d(Object.assign({},a,{placement:s})):d,I=E[0],o=E[1];return I=I||0,o=(o||0)*x,[cr,Pr].indexOf(g)>=0?{x:o,y:I}:{x:I,y:o}}function KD(s){var a=s.state,d=s.options,g=s.name,x=d.offset,E=x===void 0?[0,0]:x,I=ny.reduce(function(G,J){return G[J]=XD(J,a.rects,E),G},{}),o=I[a.placement],L=o.x,U=o.y;a.modifiersData.popperOffsets!=null&&(a.modifiersData.popperOffsets.x+=L,a.modifiersData.popperOffsets.y+=U),a.modifiersData[g]=I}const nE={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:KD};function YD(s){var a=s.state,d=s.name;a.modifiersData[d]=eE({reference:a.rects.reference,element:a.rects.popper,strategy:"absolute",placement:a.placement})}const py={name:"popperOffsets",enabled:!0,phase:"read",fn:YD,data:{}};function JD(s){return s==="x"?"y":"x"}function QD(s){var a=s.state,d=s.options,g=s.name,x=d.mainAxis,E=x===void 0?!0:x,I=d.altAxis,o=I===void 0?!1:I,L=d.boundary,U=d.rootBoundary,G=d.altBoundary,J=d.padding,de=d.tether,xe=de===void 0?!0:de,ge=d.tetherOffset,Ie=ge===void 0?0:ge,Ne=Hc(a,{boundary:L,rootBoundary:U,padding:J,altBoundary:G}),et=Go(a.placement),ut=Wc(a.placement),Ve=!ut,ft=ay(et),Ce=JD(ft),xt=a.modifiersData.popperOffsets,Gt=a.rects.reference,At=a.rects.popper,_t=typeof Ie=="function"?Ie(Object.assign({},a.rects,{placement:a.placement})):Ie,It=typeof _t=="number"?{mainAxis:_t,altAxis:_t}:Object.assign({mainAxis:0,altAxis:0},_t),mi=a.modifiersData.offset?a.modifiersData.offset[a.placement]:null,Bi={x:0,y:0};if(xt){if(E){var bi,hn=ft==="y"?lr:cr,Ft=ft==="y"?Mr:Pr,ui=ft==="y"?"height":"width",Jt=xt[ft],ei=Jt+Ne[hn],Wi=Jt-Ne[Ft],gi=xe?-At[ui]/2:0,yn=ut===dl?Gt[ui]:At[ui],Ki=ut===dl?-At[ui]:-Gt[ui],xn=a.elements.arrow,dn=xe&&xn?sy(xn):{width:0,height:0},vn=a.modifiersData["arrow#persistent"]?a.modifiersData["arrow#persistent"].padding:Xw(),Hi=vn[hn],Yi=vn[Ft],pn=Vh(0,Gt[ui],dn[ui]),In=Ve?Gt[ui]/2-gi-pn-Hi-It.mainAxis:yn-pn-Hi-It.mainAxis,fn=Ve?-Gt[ui]/2+gi+pn+Yi+It.mainAxis:Ki+pn+Yi+It.mainAxis,ur=a.elements.arrow&&id(a.elements.arrow),se=ur?ft==="y"?ur.clientTop||0:ur.clientLeft||0:0,me=(bi=mi==null?void 0:mi[ft])!=null?bi:0,Me=Jt+In-me-se,$e=Jt+fn-me,Xe=Vh(xe?If(ei,Me):ei,Jt,xe?cl(Wi,$e):Wi);xt[ft]=Xe,Bi[ft]=Xe-Jt}if(o){var nt,gt=ft==="x"?lr:cr,lt=ft==="x"?Mr:Pr,rt=xt[Ce],Ye=Ce==="y"?"height":"width",bt=rt+Ne[gt],wt=rt-Ne[lt],Ct=[lr,cr].indexOf(et)!==-1,Nt=(nt=mi==null?void 0:mi[Ce])!=null?nt:0,Wt=Ct?bt:rt-Gt[Ye]-At[Ye]-Nt+It.altAxis,ni=Ct?rt+Gt[Ye]+At[Ye]-Nt-It.altAxis:wt,si=xe&&Ct?PD(Wt,rt,ni):Vh(xe?Wt:bt,rt,xe?ni:wt);xt[Ce]=si,Bi[Ce]=si-rt}a.modifiersData[g]=Bi}}const rE={name:"preventOverflow",enabled:!0,phase:"main",fn:QD,requiresIfExists:["offset"]};function eL(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function tL(s){return s===Xr(s)||!Wr(s)?uy(s):eL(s)}function iL(s){var a=s.getBoundingClientRect(),d=qc(a.width)/s.offsetWidth||1,g=qc(a.height)/s.offsetHeight||1;return d!==1||g!==1}function nL(s,a,d){d===void 0&&(d=!1);var g=Wr(a),x=Wr(a)&&iL(a),E=fa(a),I=Zc(s,x,d),o={scrollLeft:0,scrollTop:0},L={x:0,y:0};return(g||!g&&!d)&&((Zo(a)!=="body"||dy(E))&&(o=tL(a)),Wr(a)?(L=Zc(a,!0),L.x+=a.clientLeft,L.y+=a.clientTop):E&&(L.x=hy(E))),{x:I.left+o.scrollLeft-L.x,y:I.top+o.scrollTop-L.y,width:I.width,height:I.height}}function rL(s){var a=new Map,d=new Set,g=[];s.forEach(function(E){a.set(E.name,E)});function x(E){d.add(E.name);var I=[].concat(E.requires||[],E.requiresIfExists||[]);I.forEach(function(o){if(!d.has(o)){var L=a.get(o);L&&x(L)}}),g.push(E)}return s.forEach(function(E){d.has(E.name)||x(E)}),g}function oL(s){var a=rL(s);return Zw.reduce(function(d,g){return d.concat(a.filter(function(x){return x.phase===g}))},[])}function sL(s){var a;return function(){return a||(a=new Promise(function(d){Promise.resolve().then(function(){a=void 0,d(s())})})),a}}function aL(s){var a=s.reduce(function(d,g){var x=d[g.name];return d[g.name]=x?Object.assign({},x,g,{options:Object.assign({},x.options,g.options),data:Object.assign({},x.data,g.data)}):g,d},{});return Object.keys(a).map(function(d){return a[d]})}var rb={placement:"bottom",modifiers:[],strategy:"absolute"};function ob(){for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];return!a.some(function(g){return!(g&&typeof g.getBoundingClientRect=="function")})}function Yf(s){s===void 0&&(s={});var a=s,d=a.defaultModifiers,g=d===void 0?[]:d,x=a.defaultOptions,E=x===void 0?rb:x;return function(o,L,U){U===void 0&&(U=E);var G={placement:"bottom",orderedModifiers:[],options:Object.assign({},rb,E),modifiersData:{},elements:{reference:o,popper:L},attributes:{},styles:{}},J=[],de=!1,xe={state:G,setOptions:function(et){var ut=typeof et=="function"?et(G.options):et;Ie(),G.options=Object.assign({},E,G.options,ut),G.scrollParents={reference:pl(o)?$h(o):o.contextElement?$h(o.contextElement):[],popper:$h(L)};var Ve=oL(aL([].concat(g,G.options.modifiers)));return G.orderedModifiers=Ve.filter(function(ft){return ft.enabled}),ge(),xe.update()},forceUpdate:function(){if(!de){var et=G.elements,ut=et.reference,Ve=et.popper;if(ob(ut,Ve)){G.rects={reference:nL(ut,id(Ve),G.options.strategy==="fixed"),popper:sy(Ve)},G.reset=!1,G.placement=G.options.placement,G.orderedModifiers.forEach(function(It){return G.modifiersData[It.name]=Object.assign({},It.data)});for(var ft=0;ft<G.orderedModifiers.length;ft++){if(G.reset===!0){G.reset=!1,ft=-1;continue}var Ce=G.orderedModifiers[ft],xt=Ce.fn,Gt=Ce.options,At=Gt===void 0?{}:Gt,_t=Ce.name;typeof xt=="function"&&(G=xt({state:G,options:At,name:_t,instance:xe})||G)}}}},update:sL(function(){return new Promise(function(Ne){xe.forceUpdate(),Ne(G)})}),destroy:function(){Ie(),de=!0}};if(!ob(o,L))return xe;xe.setOptions(U).then(function(Ne){!de&&U.onFirstUpdate&&U.onFirstUpdate(Ne)});function ge(){G.orderedModifiers.forEach(function(Ne){var et=Ne.name,ut=Ne.options,Ve=ut===void 0?{}:ut,ft=Ne.effect;if(typeof ft=="function"){var Ce=ft({state:G,name:et,instance:xe,options:Ve}),xt=function(){};J.push(Ce||xt)}})}function Ie(){J.forEach(function(Ne){return Ne()}),J=[]}return xe}}var lL=Yf(),cL=[cy,py,ly,oy],uL=Yf({defaultModifiers:cL}),hL=[cy,py,ly,oy,nE,tE,rE,Jw,iE],fy=Yf({defaultModifiers:hL});const oE=Object.freeze(Object.defineProperty({__proto__:null,popperGenerator:Yf,detectOverflow:Hc,createPopperBase:lL,createPopper:fy,createPopperLite:uL,top:lr,bottom:Mr,right:Pr,left:cr,auto:Xf,basePlacements:tu,start:dl,end:Gc,clippingParents:Ow,viewport:iy,popper:Sc,reference:Rw,variationPlacements:_g,placements:ny,beforeRead:Bw,read:Fw,afterRead:Nw,beforeMain:Uw,main:jw,afterMain:Vw,beforeWrite:$w,write:Gw,afterWrite:qw,modifierPhases:Zw,applyStyles:oy,arrow:Jw,computeStyles:ly,eventListeners:cy,flip:tE,hide:iE,offset:nE,popperOffsets:py,preventOverflow:rE},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.2.3 (https://getbootstrap.com/)
  * Copyright 2011-2022 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const dL=1e6,pL=1e3,vg="transitionend",fL=s=>s==null?`${s}`:Object.prototype.toString.call(s).match(/\s([a-z]+)/i)[1].toLowerCase(),mL=s=>{do s+=Math.floor(Math.random()*dL);while(document.getElementById(s));return s},sE=s=>{let a=s.getAttribute("data-bs-target");if(!a||a==="#"){let d=s.getAttribute("href");if(!d||!d.includes("#")&&!d.startsWith("."))return null;d.includes("#")&&!d.startsWith("#")&&(d=`#${d.split("#")[1]}`),a=d&&d!=="#"?d.trim():null}return a},aE=s=>{const a=sE(s);return a&&document.querySelector(a)?a:null},_s=s=>{const a=sE(s);return a?document.querySelector(a):null},_L=s=>{if(!s)return 0;let{transitionDuration:a,transitionDelay:d}=window.getComputedStyle(s);const g=Number.parseFloat(a),x=Number.parseFloat(d);return!g&&!x?0:(a=a.split(",")[0],d=d.split(",")[0],(Number.parseFloat(a)+Number.parseFloat(d))*pL)},lE=s=>{s.dispatchEvent(new Event(vg))},gs=s=>!s||typeof s!="object"?!1:(typeof s.jquery<"u"&&(s=s[0]),typeof s.nodeType<"u"),ha=s=>gs(s)?s.jquery?s[0]:s:typeof s=="string"&&s.length>0?document.querySelector(s):null,iu=s=>{if(!gs(s)||s.getClientRects().length===0)return!1;const a=getComputedStyle(s).getPropertyValue("visibility")==="visible",d=s.closest("details:not([open])");if(!d)return a;if(d!==s){const g=s.closest("summary");if(g&&g.parentNode!==d||g===null)return!1}return a},da=s=>!s||s.nodeType!==Node.ELEMENT_NODE||s.classList.contains("disabled")?!0:typeof s.disabled<"u"?s.disabled:s.hasAttribute("disabled")&&s.getAttribute("disabled")!=="false",cE=s=>{if(!document.documentElement.attachShadow)return null;if(typeof s.getRootNode=="function"){const a=s.getRootNode();return a instanceof ShadowRoot?a:null}return s instanceof ShadowRoot?s:s.parentNode?cE(s.parentNode):null},Mf=()=>{},nd=s=>{s.offsetHeight},uE=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,R_=[],gL=s=>{document.readyState==="loading"?(R_.length||document.addEventListener("DOMContentLoaded",()=>{for(const a of R_)a()}),R_.push(s)):s()},Hr=()=>document.documentElement.dir==="rtl",Kr=s=>{gL(()=>{const a=uE();if(a){const d=s.NAME,g=a.fn[d];a.fn[d]=s.jQueryInterface,a.fn[d].Constructor=s,a.fn[d].noConflict=()=>(a.fn[d]=g,s.jQueryInterface)}})},fs=s=>{typeof s=="function"&&s()},hE=(s,a,d=!0)=>{if(!d){fs(s);return}const g=5,x=_L(a)+g;let E=!1;const I=({target:o})=>{o===a&&(E=!0,a.removeEventListener(vg,I),fs(s))};a.addEventListener(vg,I),setTimeout(()=>{E||lE(a)},x)},my=(s,a,d,g)=>{const x=s.length;let E=s.indexOf(a);return E===-1?!d&&g?s[x-1]:s[0]:(E+=d?1:-1,g&&(E=(E+x)%x),s[Math.max(0,Math.min(E,x-1))])},yL=/[^.]*(?=\..*)\.|.*/,vL=/\..*/,xL=/::\d+$/,B_={};let sb=1;const dE={mouseenter:"mouseover",mouseleave:"mouseout"},bL=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function pE(s,a){return a&&`${a}::${sb++}`||s.uidEvent||sb++}function fE(s){const a=pE(s);return s.uidEvent=a,B_[a]=B_[a]||{},B_[a]}function wL(s,a){return function d(g){return _y(g,{delegateTarget:s}),d.oneOff&&it.off(s,g.type,a),a.apply(s,[g])}}function EL(s,a,d){return function g(x){const E=s.querySelectorAll(a);for(let{target:I}=x;I&&I!==this;I=I.parentNode)for(const o of E)if(o===I)return _y(x,{delegateTarget:I}),g.oneOff&&it.off(s,x.type,a,d),d.apply(I,[x])}}function mE(s,a,d=null){return Object.values(s).find(g=>g.callable===a&&g.delegationSelector===d)}function _E(s,a,d){const g=typeof a=="string",x=g?d:a||d;let E=gE(s);return bL.has(E)||(E=s),[g,x,E]}function ab(s,a,d,g,x){if(typeof a!="string"||!s)return;let[E,I,o]=_E(a,d,g);a in dE&&(I=(ge=>function(Ie){if(!Ie.relatedTarget||Ie.relatedTarget!==Ie.delegateTarget&&!Ie.delegateTarget.contains(Ie.relatedTarget))return ge.call(this,Ie)})(I));const L=fE(s),U=L[o]||(L[o]={}),G=mE(U,I,E?d:null);if(G){G.oneOff=G.oneOff&&x;return}const J=pE(I,a.replace(yL,"")),de=E?EL(s,d,I):wL(s,I);de.delegationSelector=E?d:null,de.callable=I,de.oneOff=x,de.uidEvent=J,U[J]=de,s.addEventListener(o,de,E)}function xg(s,a,d,g,x){const E=mE(a[d],g,x);E&&(s.removeEventListener(d,E,Boolean(x)),delete a[d][E.uidEvent])}function TL(s,a,d,g){const x=a[d]||{};for(const E of Object.keys(x))if(E.includes(g)){const I=x[E];xg(s,a,d,I.callable,I.delegationSelector)}}function gE(s){return s=s.replace(vL,""),dE[s]||s}const it={on(s,a,d,g){ab(s,a,d,g,!1)},one(s,a,d,g){ab(s,a,d,g,!0)},off(s,a,d,g){if(typeof a!="string"||!s)return;const[x,E,I]=_E(a,d,g),o=I!==a,L=fE(s),U=L[I]||{},G=a.startsWith(".");if(typeof E<"u"){if(!Object.keys(U).length)return;xg(s,L,I,E,x?d:null);return}if(G)for(const J of Object.keys(L))TL(s,L,J,a.slice(1));for(const J of Object.keys(U)){const de=J.replace(xL,"");if(!o||a.includes(de)){const xe=U[J];xg(s,L,I,xe.callable,xe.delegationSelector)}}},trigger(s,a,d){if(typeof a!="string"||!s)return null;const g=uE(),x=gE(a),E=a!==x;let I=null,o=!0,L=!0,U=!1;E&&g&&(I=g.Event(a,d),g(s).trigger(I),o=!I.isPropagationStopped(),L=!I.isImmediatePropagationStopped(),U=I.isDefaultPrevented());let G=new Event(a,{bubbles:o,cancelable:!0});return G=_y(G,d),U&&G.preventDefault(),L&&s.dispatchEvent(G),G.defaultPrevented&&I&&I.preventDefault(),G}};function _y(s,a){for(const[d,g]of Object.entries(a||{}))try{s[d]=g}catch{Object.defineProperty(s,d,{configurable:!0,get(){return g}})}return s}const ia=new Map,F_={set(s,a,d){ia.has(s)||ia.set(s,new Map);const g=ia.get(s);if(!g.has(a)&&g.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(g.keys())[0]}.`);return}g.set(a,d)},get(s,a){return ia.has(s)&&ia.get(s).get(a)||null},remove(s,a){if(!ia.has(s))return;const d=ia.get(s);d.delete(a),d.size===0&&ia.delete(s)}};function lb(s){if(s==="true")return!0;if(s==="false")return!1;if(s===Number(s).toString())return Number(s);if(s===""||s==="null")return null;if(typeof s!="string")return s;try{return JSON.parse(decodeURIComponent(s))}catch{return s}}function N_(s){return s.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`)}const ys={setDataAttribute(s,a,d){s.setAttribute(`data-bs-${N_(a)}`,d)},removeDataAttribute(s,a){s.removeAttribute(`data-bs-${N_(a)}`)},getDataAttributes(s){if(!s)return{};const a={},d=Object.keys(s.dataset).filter(g=>g.startsWith("bs")&&!g.startsWith("bsConfig"));for(const g of d){let x=g.replace(/^bs/,"");x=x.charAt(0).toLowerCase()+x.slice(1,x.length),a[x]=lb(s.dataset[g])}return a},getDataAttribute(s,a){return lb(s.getAttribute(`data-bs-${N_(a)}`))}};class rd{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(a){return a=this._mergeConfigObj(a),a=this._configAfterMerge(a),this._typeCheckConfig(a),a}_configAfterMerge(a){return a}_mergeConfigObj(a,d){const g=gs(d)?ys.getDataAttribute(d,"config"):{};return{...this.constructor.Default,...typeof g=="object"?g:{},...gs(d)?ys.getDataAttributes(d):{},...typeof a=="object"?a:{}}}_typeCheckConfig(a,d=this.constructor.DefaultType){for(const g of Object.keys(d)){const x=d[g],E=a[g],I=gs(E)?"element":fL(E);if(!new RegExp(x).test(I))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${g}" provided type "${I}" but expected type "${x}".`)}}}const AL="5.2.3";class yo extends rd{constructor(a,d){super(),a=ha(a),a&&(this._element=a,this._config=this._getConfig(d),F_.set(this._element,this.constructor.DATA_KEY,this))}dispose(){F_.remove(this._element,this.constructor.DATA_KEY),it.off(this._element,this.constructor.EVENT_KEY);for(const a of Object.getOwnPropertyNames(this))this[a]=null}_queueCallback(a,d,g=!0){hE(a,d,g)}_getConfig(a){return a=this._mergeConfigObj(a,this._element),a=this._configAfterMerge(a),this._typeCheckConfig(a),a}static getInstance(a){return F_.get(ha(a),this.DATA_KEY)}static getOrCreateInstance(a,d={}){return this.getInstance(a)||new this(a,typeof d=="object"?d:null)}static get VERSION(){return AL}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(a){return`${a}${this.EVENT_KEY}`}}const Jf=(s,a="hide")=>{const d=`click.dismiss${s.EVENT_KEY}`,g=s.NAME;it.on(document,d,`[data-bs-dismiss="${g}"]`,function(x){if(["A","AREA"].includes(this.tagName)&&x.preventDefault(),da(this))return;const E=_s(this)||this.closest(`.${g}`);s.getOrCreateInstance(E)[a]()})},SL="alert",CL="bs.alert",yE=`.${CL}`,IL=`close${yE}`,ML=`closed${yE}`,PL="fade",DL="show";class Qf extends yo{static get NAME(){return SL}close(){if(it.trigger(this._element,IL).defaultPrevented)return;this._element.classList.remove(DL);const d=this._element.classList.contains(PL);this._queueCallback(()=>this._destroyElement(),this._element,d)}_destroyElement(){this._element.remove(),it.trigger(this._element,ML),this.dispose()}static jQueryInterface(a){return this.each(function(){const d=Qf.getOrCreateInstance(this);if(typeof a=="string"){if(d[a]===void 0||a.startsWith("_")||a==="constructor")throw new TypeError(`No method named "${a}"`);d[a](this)}})}}Jf(Qf,"close");Kr(Qf);const LL="button",zL="bs.button",kL=`.${zL}`,OL=".data-api",RL="active",cb='[data-bs-toggle="button"]',BL=`click${kL}${OL}`;class em extends yo{static get NAME(){return LL}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(RL))}static jQueryInterface(a){return this.each(function(){const d=em.getOrCreateInstance(this);a==="toggle"&&d[a]()})}}it.on(document,BL,cb,s=>{s.preventDefault();const a=s.target.closest(cb);em.getOrCreateInstance(a).toggle()});Kr(em);const oi={find(s,a=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(a,s))},findOne(s,a=document.documentElement){return Element.prototype.querySelector.call(a,s)},children(s,a){return[].concat(...s.children).filter(d=>d.matches(a))},parents(s,a){const d=[];let g=s.parentNode.closest(a);for(;g;)d.push(g),g=g.parentNode.closest(a);return d},prev(s,a){let d=s.previousElementSibling;for(;d;){if(d.matches(a))return[d];d=d.previousElementSibling}return[]},next(s,a){let d=s.nextElementSibling;for(;d;){if(d.matches(a))return[d];d=d.nextElementSibling}return[]},focusableChildren(s){const a=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(d=>`${d}:not([tabindex^="-"])`).join(",");return this.find(a,s).filter(d=>!da(d)&&iu(d))}},FL="swipe",nu=".bs.swipe",NL=`touchstart${nu}`,UL=`touchmove${nu}`,jL=`touchend${nu}`,VL=`pointerdown${nu}`,$L=`pointerup${nu}`,GL="touch",qL="pen",ZL="pointer-event",WL=40,HL={endCallback:null,leftCallback:null,rightCallback:null},XL={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Pf extends rd{constructor(a,d){super(),this._element=a,!(!a||!Pf.isSupported())&&(this._config=this._getConfig(d),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return HL}static get DefaultType(){return XL}static get NAME(){return FL}dispose(){it.off(this._element,nu)}_start(a){if(!this._supportPointerEvents){this._deltaX=a.touches[0].clientX;return}this._eventIsPointerPenTouch(a)&&(this._deltaX=a.clientX)}_end(a){this._eventIsPointerPenTouch(a)&&(this._deltaX=a.clientX-this._deltaX),this._handleSwipe(),fs(this._config.endCallback)}_move(a){this._deltaX=a.touches&&a.touches.length>1?0:a.touches[0].clientX-this._deltaX}_handleSwipe(){const a=Math.abs(this._deltaX);if(a<=WL)return;const d=a/this._deltaX;this._deltaX=0,d&&fs(d>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(it.on(this._element,VL,a=>this._start(a)),it.on(this._element,$L,a=>this._end(a)),this._element.classList.add(ZL)):(it.on(this._element,NL,a=>this._start(a)),it.on(this._element,UL,a=>this._move(a)),it.on(this._element,jL,a=>this._end(a)))}_eventIsPointerPenTouch(a){return this._supportPointerEvents&&(a.pointerType===qL||a.pointerType===GL)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const KL="carousel",YL="bs.carousel",ma=`.${YL}`,vE=".data-api",JL="ArrowLeft",QL="ArrowRight",ez=500,Oh="next",Tc="prev",Cc="left",gf="right",tz=`slide${ma}`,U_=`slid${ma}`,iz=`keydown${ma}`,nz=`mouseenter${ma}`,rz=`mouseleave${ma}`,oz=`dragstart${ma}`,sz=`load${ma}${vE}`,az=`click${ma}${vE}`,xE="carousel",ef="active",lz="slide",cz="carousel-item-end",uz="carousel-item-start",hz="carousel-item-next",dz="carousel-item-prev",bE=".active",wE=".carousel-item",pz=bE+wE,fz=".carousel-item img",mz=".carousel-indicators",_z="[data-bs-slide], [data-bs-slide-to]",gz='[data-bs-ride="carousel"]',yz={[JL]:gf,[QL]:Cc},vz={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},xz={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class od extends yo{constructor(a,d){super(a,d),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=oi.findOne(mz,this._element),this._addEventListeners(),this._config.ride===xE&&this.cycle()}static get Default(){return vz}static get DefaultType(){return xz}static get NAME(){return KL}next(){this._slide(Oh)}nextWhenVisible(){!document.hidden&&iu(this._element)&&this.next()}prev(){this._slide(Tc)}pause(){this._isSliding&&lE(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){it.one(this._element,U_,()=>this.cycle());return}this.cycle()}}to(a){const d=this._getItems();if(a>d.length-1||a<0)return;if(this._isSliding){it.one(this._element,U_,()=>this.to(a));return}const g=this._getItemIndex(this._getActive());if(g===a)return;const x=a>g?Oh:Tc;this._slide(x,d[a])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(a){return a.defaultInterval=a.interval,a}_addEventListeners(){this._config.keyboard&&it.on(this._element,iz,a=>this._keydown(a)),this._config.pause==="hover"&&(it.on(this._element,nz,()=>this.pause()),it.on(this._element,rz,()=>this._maybeEnableCycle())),this._config.touch&&Pf.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const g of oi.find(fz,this._element))it.on(g,oz,x=>x.preventDefault());const d={leftCallback:()=>this._slide(this._directionToOrder(Cc)),rightCallback:()=>this._slide(this._directionToOrder(gf)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),ez+this._config.interval))}};this._swipeHelper=new Pf(this._element,d)}_keydown(a){if(/input|textarea/i.test(a.target.tagName))return;const d=yz[a.key];d&&(a.preventDefault(),this._slide(this._directionToOrder(d)))}_getItemIndex(a){return this._getItems().indexOf(a)}_setActiveIndicatorElement(a){if(!this._indicatorsElement)return;const d=oi.findOne(bE,this._indicatorsElement);d.classList.remove(ef),d.removeAttribute("aria-current");const g=oi.findOne(`[data-bs-slide-to="${a}"]`,this._indicatorsElement);g&&(g.classList.add(ef),g.setAttribute("aria-current","true"))}_updateInterval(){const a=this._activeElement||this._getActive();if(!a)return;const d=Number.parseInt(a.getAttribute("data-bs-interval"),10);this._config.interval=d||this._config.defaultInterval}_slide(a,d=null){if(this._isSliding)return;const g=this._getActive(),x=a===Oh,E=d||my(this._getItems(),g,x,this._config.wrap);if(E===g)return;const I=this._getItemIndex(E),o=xe=>it.trigger(this._element,xe,{relatedTarget:E,direction:this._orderToDirection(a),from:this._getItemIndex(g),to:I});if(o(tz).defaultPrevented||!g||!E)return;const U=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(I),this._activeElement=E;const G=x?uz:cz,J=x?hz:dz;E.classList.add(J),nd(E),g.classList.add(G),E.classList.add(G);const de=()=>{E.classList.remove(G,J),E.classList.add(ef),g.classList.remove(ef,J,G),this._isSliding=!1,o(U_)};this._queueCallback(de,g,this._isAnimated()),U&&this.cycle()}_isAnimated(){return this._element.classList.contains(lz)}_getActive(){return oi.findOne(pz,this._element)}_getItems(){return oi.find(wE,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(a){return Hr()?a===Cc?Tc:Oh:a===Cc?Oh:Tc}_orderToDirection(a){return Hr()?a===Tc?Cc:gf:a===Tc?gf:Cc}static jQueryInterface(a){return this.each(function(){const d=od.getOrCreateInstance(this,a);if(typeof a=="number"){d.to(a);return}if(typeof a=="string"){if(d[a]===void 0||a.startsWith("_")||a==="constructor")throw new TypeError(`No method named "${a}"`);d[a]()}})}}it.on(document,az,_z,function(s){const a=_s(this);if(!a||!a.classList.contains(xE))return;s.preventDefault();const d=od.getOrCreateInstance(a),g=this.getAttribute("data-bs-slide-to");if(g){d.to(g),d._maybeEnableCycle();return}if(ys.getDataAttribute(this,"slide")==="next"){d.next(),d._maybeEnableCycle();return}d.prev(),d._maybeEnableCycle()});it.on(window,sz,()=>{const s=oi.find(gz);for(const a of s)od.getOrCreateInstance(a)});Kr(od);const bz="collapse",wz="bs.collapse",sd=`.${wz}`,Ez=".data-api",Tz=`show${sd}`,Az=`shown${sd}`,Sz=`hide${sd}`,Cz=`hidden${sd}`,Iz=`click${sd}${Ez}`,j_="show",Pc="collapse",tf="collapsing",Mz="collapsed",Pz=`:scope .${Pc} .${Pc}`,Dz="collapse-horizontal",Lz="width",zz="height",kz=".collapse.show, .collapse.collapsing",bg='[data-bs-toggle="collapse"]',Oz={parent:null,toggle:!0},Rz={parent:"(null|element)",toggle:"boolean"};class Yh extends yo{constructor(a,d){super(a,d),this._isTransitioning=!1,this._triggerArray=[];const g=oi.find(bg);for(const x of g){const E=aE(x),I=oi.find(E).filter(o=>o===this._element);E!==null&&I.length&&this._triggerArray.push(x)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Oz}static get DefaultType(){return Rz}static get NAME(){return bz}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let a=[];if(this._config.parent&&(a=this._getFirstLevelChildren(kz).filter(o=>o!==this._element).map(o=>Yh.getOrCreateInstance(o,{toggle:!1}))),a.length&&a[0]._isTransitioning||it.trigger(this._element,Tz).defaultPrevented)return;for(const o of a)o.hide();const g=this._getDimension();this._element.classList.remove(Pc),this._element.classList.add(tf),this._element.style[g]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const x=()=>{this._isTransitioning=!1,this._element.classList.remove(tf),this._element.classList.add(Pc,j_),this._element.style[g]="",it.trigger(this._element,Az)},I=`scroll${g[0].toUpperCase()+g.slice(1)}`;this._queueCallback(x,this._element,!0),this._element.style[g]=`${this._element[I]}px`}hide(){if(this._isTransitioning||!this._isShown()||it.trigger(this._element,Sz).defaultPrevented)return;const d=this._getDimension();this._element.style[d]=`${this._element.getBoundingClientRect()[d]}px`,nd(this._element),this._element.classList.add(tf),this._element.classList.remove(Pc,j_);for(const x of this._triggerArray){const E=_s(x);E&&!this._isShown(E)&&this._addAriaAndCollapsedClass([x],!1)}this._isTransitioning=!0;const g=()=>{this._isTransitioning=!1,this._element.classList.remove(tf),this._element.classList.add(Pc),it.trigger(this._element,Cz)};this._element.style[d]="",this._queueCallback(g,this._element,!0)}_isShown(a=this._element){return a.classList.contains(j_)}_configAfterMerge(a){return a.toggle=Boolean(a.toggle),a.parent=ha(a.parent),a}_getDimension(){return this._element.classList.contains(Dz)?Lz:zz}_initializeChildren(){if(!this._config.parent)return;const a=this._getFirstLevelChildren(bg);for(const d of a){const g=_s(d);g&&this._addAriaAndCollapsedClass([d],this._isShown(g))}}_getFirstLevelChildren(a){const d=oi.find(Pz,this._config.parent);return oi.find(a,this._config.parent).filter(g=>!d.includes(g))}_addAriaAndCollapsedClass(a,d){if(a.length)for(const g of a)g.classList.toggle(Mz,!d),g.setAttribute("aria-expanded",d)}static jQueryInterface(a){const d={};return typeof a=="string"&&/show|hide/.test(a)&&(d.toggle=!1),this.each(function(){const g=Yh.getOrCreateInstance(this,d);if(typeof a=="string"){if(typeof g[a]>"u")throw new TypeError(`No method named "${a}"`);g[a]()}})}}it.on(document,Iz,bg,function(s){(s.target.tagName==="A"||s.delegateTarget&&s.delegateTarget.tagName==="A")&&s.preventDefault();const a=aE(this),d=oi.find(a);for(const g of d)Yh.getOrCreateInstance(g,{toggle:!1}).toggle()});Kr(Yh);const ub="dropdown",Bz="bs.dropdown",ml=`.${Bz}`,gy=".data-api",Fz="Escape",hb="Tab",Nz="ArrowUp",db="ArrowDown",Uz=2,jz=`hide${ml}`,Vz=`hidden${ml}`,$z=`show${ml}`,Gz=`shown${ml}`,EE=`click${ml}${gy}`,TE=`keydown${ml}${gy}`,qz=`keyup${ml}${gy}`,Ic="show",Zz="dropup",Wz="dropend",Hz="dropstart",Xz="dropup-center",Kz="dropdown-center",ol='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Yz=`${ol}.${Ic}`,yf=".dropdown-menu",Jz=".navbar",Qz=".navbar-nav",ek=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",tk=Hr()?"top-end":"top-start",ik=Hr()?"top-start":"top-end",nk=Hr()?"bottom-end":"bottom-start",rk=Hr()?"bottom-start":"bottom-end",ok=Hr()?"left-start":"right-start",sk=Hr()?"right-start":"left-start",ak="top",lk="bottom",ck={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},uk={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class qo extends yo{constructor(a,d){super(a,d),this._popper=null,this._parent=this._element.parentNode,this._menu=oi.next(this._element,yf)[0]||oi.prev(this._element,yf)[0]||oi.findOne(yf,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return ck}static get DefaultType(){return uk}static get NAME(){return ub}toggle(){return this._isShown()?this.hide():this.show()}show(){if(da(this._element)||this._isShown())return;const a={relatedTarget:this._element};if(!it.trigger(this._element,$z,a).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(Qz))for(const g of[].concat(...document.body.children))it.on(g,"mouseover",Mf);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ic),this._element.classList.add(Ic),it.trigger(this._element,Gz,a)}}hide(){if(da(this._element)||!this._isShown())return;const a={relatedTarget:this._element};this._completeHide(a)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(a){if(!it.trigger(this._element,jz,a).defaultPrevented){if("ontouchstart"in document.documentElement)for(const g of[].concat(...document.body.children))it.off(g,"mouseover",Mf);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ic),this._element.classList.remove(Ic),this._element.setAttribute("aria-expanded","false"),ys.removeDataAttribute(this._menu,"popper"),it.trigger(this._element,Vz,a)}}_getConfig(a){if(a=super._getConfig(a),typeof a.reference=="object"&&!gs(a.reference)&&typeof a.reference.getBoundingClientRect!="function")throw new TypeError(`${ub.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return a}_createPopper(){if(typeof oE>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let a=this._element;this._config.reference==="parent"?a=this._parent:gs(this._config.reference)?a=ha(this._config.reference):typeof this._config.reference=="object"&&(a=this._config.reference);const d=this._getPopperConfig();this._popper=fy(a,this._menu,d)}_isShown(){return this._menu.classList.contains(Ic)}_getPlacement(){const a=this._parent;if(a.classList.contains(Wz))return ok;if(a.classList.contains(Hz))return sk;if(a.classList.contains(Xz))return ak;if(a.classList.contains(Kz))return lk;const d=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return a.classList.contains(Zz)?d?ik:tk:d?rk:nk}_detectNavbar(){return this._element.closest(Jz)!==null}_getOffset(){const{offset:a}=this._config;return typeof a=="string"?a.split(",").map(d=>Number.parseInt(d,10)):typeof a=="function"?d=>a(d,this._element):a}_getPopperConfig(){const a={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ys.setDataAttribute(this._menu,"popper","static"),a.modifiers=[{name:"applyStyles",enabled:!1}]),{...a,...typeof this._config.popperConfig=="function"?this._config.popperConfig(a):this._config.popperConfig}}_selectMenuItem({key:a,target:d}){const g=oi.find(ek,this._menu).filter(x=>iu(x));g.length&&my(g,d,a===db,!g.includes(d)).focus()}static jQueryInterface(a){return this.each(function(){const d=qo.getOrCreateInstance(this,a);if(typeof a=="string"){if(typeof d[a]>"u")throw new TypeError(`No method named "${a}"`);d[a]()}})}static clearMenus(a){if(a.button===Uz||a.type==="keyup"&&a.key!==hb)return;const d=oi.find(Yz);for(const g of d){const x=qo.getInstance(g);if(!x||x._config.autoClose===!1)continue;const E=a.composedPath(),I=E.includes(x._menu);if(E.includes(x._element)||x._config.autoClose==="inside"&&!I||x._config.autoClose==="outside"&&I||x._menu.contains(a.target)&&(a.type==="keyup"&&a.key===hb||/input|select|option|textarea|form/i.test(a.target.tagName)))continue;const o={relatedTarget:x._element};a.type==="click"&&(o.clickEvent=a),x._completeHide(o)}}static dataApiKeydownHandler(a){const d=/input|textarea/i.test(a.target.tagName),g=a.key===Fz,x=[Nz,db].includes(a.key);if(!x&&!g||d&&!g)return;a.preventDefault();const E=this.matches(ol)?this:oi.prev(this,ol)[0]||oi.next(this,ol)[0]||oi.findOne(ol,a.delegateTarget.parentNode),I=qo.getOrCreateInstance(E);if(x){a.stopPropagation(),I.show(),I._selectMenuItem(a);return}I._isShown()&&(a.stopPropagation(),I.hide(),E.focus())}}it.on(document,TE,ol,qo.dataApiKeydownHandler);it.on(document,TE,yf,qo.dataApiKeydownHandler);it.on(document,EE,qo.clearMenus);it.on(document,qz,qo.clearMenus);it.on(document,EE,ol,function(s){s.preventDefault(),qo.getOrCreateInstance(this).toggle()});Kr(qo);const pb=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",fb=".sticky-top",nf="padding-right",mb="margin-right";class wg{constructor(){this._element=document.body}getWidth(){const a=document.documentElement.clientWidth;return Math.abs(window.innerWidth-a)}hide(){const a=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,nf,d=>d+a),this._setElementAttributes(pb,nf,d=>d+a),this._setElementAttributes(fb,mb,d=>d-a)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,nf),this._resetElementAttributes(pb,nf),this._resetElementAttributes(fb,mb)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(a,d,g){const x=this.getWidth(),E=I=>{if(I!==this._element&&window.innerWidth>I.clientWidth+x)return;this._saveInitialAttribute(I,d);const o=window.getComputedStyle(I).getPropertyValue(d);I.style.setProperty(d,`${g(Number.parseFloat(o))}px`)};this._applyManipulationCallback(a,E)}_saveInitialAttribute(a,d){const g=a.style.getPropertyValue(d);g&&ys.setDataAttribute(a,d,g)}_resetElementAttributes(a,d){const g=x=>{const E=ys.getDataAttribute(x,d);if(E===null){x.style.removeProperty(d);return}ys.removeDataAttribute(x,d),x.style.setProperty(d,E)};this._applyManipulationCallback(a,g)}_applyManipulationCallback(a,d){if(gs(a)){d(a);return}for(const g of oi.find(a,this._element))d(g)}}const AE="backdrop",hk="fade",_b="show",gb=`mousedown.bs.${AE}`,dk={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},pk={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class SE extends rd{constructor(a){super(),this._config=this._getConfig(a),this._isAppended=!1,this._element=null}static get Default(){return dk}static get DefaultType(){return pk}static get NAME(){return AE}show(a){if(!this._config.isVisible){fs(a);return}this._append();const d=this._getElement();this._config.isAnimated&&nd(d),d.classList.add(_b),this._emulateAnimation(()=>{fs(a)})}hide(a){if(!this._config.isVisible){fs(a);return}this._getElement().classList.remove(_b),this._emulateAnimation(()=>{this.dispose(),fs(a)})}dispose(){this._isAppended&&(it.off(this._element,gb),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const a=document.createElement("div");a.className=this._config.className,this._config.isAnimated&&a.classList.add(hk),this._element=a}return this._element}_configAfterMerge(a){return a.rootElement=ha(a.rootElement),a}_append(){if(this._isAppended)return;const a=this._getElement();this._config.rootElement.append(a),it.on(a,gb,()=>{fs(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(a){hE(a,this._getElement(),this._config.isAnimated)}}const fk="focustrap",mk="bs.focustrap",Df=`.${mk}`,_k=`focusin${Df}`,gk=`keydown.tab${Df}`,yk="Tab",vk="forward",yb="backward",xk={autofocus:!0,trapElement:null},bk={autofocus:"boolean",trapElement:"element"};class CE extends rd{constructor(a){super(),this._config=this._getConfig(a),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return xk}static get DefaultType(){return bk}static get NAME(){return fk}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),it.off(document,Df),it.on(document,_k,a=>this._handleFocusin(a)),it.on(document,gk,a=>this._handleKeydown(a)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,it.off(document,Df))}_handleFocusin(a){const{trapElement:d}=this._config;if(a.target===document||a.target===d||d.contains(a.target))return;const g=oi.focusableChildren(d);g.length===0?d.focus():this._lastTabNavDirection===yb?g[g.length-1].focus():g[0].focus()}_handleKeydown(a){a.key===yk&&(this._lastTabNavDirection=a.shiftKey?yb:vk)}}const wk="modal",Ek="bs.modal",vo=`.${Ek}`,Tk=".data-api",Ak="Escape",Sk=`hide${vo}`,Ck=`hidePrevented${vo}`,IE=`hidden${vo}`,ME=`show${vo}`,Ik=`shown${vo}`,Mk=`resize${vo}`,Pk=`click.dismiss${vo}`,Dk=`mousedown.dismiss${vo}`,Lk=`keydown.dismiss${vo}`,zk=`click${vo}${Tk}`,vb="modal-open",kk="fade",xb="show",V_="modal-static",Ok=".modal.show",Rk=".modal-dialog",Bk=".modal-body",Fk='[data-bs-toggle="modal"]',Nk={backdrop:!0,focus:!0,keyboard:!0},Uk={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Xc extends yo{constructor(a,d){super(a,d),this._dialog=oi.findOne(Rk,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new wg,this._addEventListeners()}static get Default(){return Nk}static get DefaultType(){return Uk}static get NAME(){return wk}toggle(a){return this._isShown?this.hide():this.show(a)}show(a){this._isShown||this._isTransitioning||it.trigger(this._element,ME,{relatedTarget:a}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(vb),this._adjustDialog(),this._backdrop.show(()=>this._showElement(a)))}hide(){!this._isShown||this._isTransitioning||it.trigger(this._element,Sk).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(xb),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){for(const a of[window,this._dialog])it.off(a,vo);this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new SE({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new CE({trapElement:this._element})}_showElement(a){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const d=oi.findOne(Bk,this._dialog);d&&(d.scrollTop=0),nd(this._element),this._element.classList.add(xb);const g=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,it.trigger(this._element,Ik,{relatedTarget:a})};this._queueCallback(g,this._dialog,this._isAnimated())}_addEventListeners(){it.on(this._element,Lk,a=>{if(a.key===Ak){if(this._config.keyboard){a.preventDefault(),this.hide();return}this._triggerBackdropTransition()}}),it.on(window,Mk,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),it.on(this._element,Dk,a=>{it.one(this._element,Pk,d=>{if(!(this._element!==a.target||this._element!==d.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(vb),this._resetAdjustments(),this._scrollBar.reset(),it.trigger(this._element,IE)})}_isAnimated(){return this._element.classList.contains(kk)}_triggerBackdropTransition(){if(it.trigger(this._element,Ck).defaultPrevented)return;const d=this._element.scrollHeight>document.documentElement.clientHeight,g=this._element.style.overflowY;g==="hidden"||this._element.classList.contains(V_)||(d||(this._element.style.overflowY="hidden"),this._element.classList.add(V_),this._queueCallback(()=>{this._element.classList.remove(V_),this._queueCallback(()=>{this._element.style.overflowY=g},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const a=this._element.scrollHeight>document.documentElement.clientHeight,d=this._scrollBar.getWidth(),g=d>0;if(g&&!a){const x=Hr()?"paddingLeft":"paddingRight";this._element.style[x]=`${d}px`}if(!g&&a){const x=Hr()?"paddingRight":"paddingLeft";this._element.style[x]=`${d}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(a,d){return this.each(function(){const g=Xc.getOrCreateInstance(this,a);if(typeof a=="string"){if(typeof g[a]>"u")throw new TypeError(`No method named "${a}"`);g[a](d)}})}}it.on(document,zk,Fk,function(s){const a=_s(this);["A","AREA"].includes(this.tagName)&&s.preventDefault(),it.one(a,ME,x=>{x.defaultPrevented||it.one(a,IE,()=>{iu(this)&&this.focus()})});const d=oi.findOne(Ok);d&&Xc.getInstance(d).hide(),Xc.getOrCreateInstance(a).toggle(this)});Jf(Xc);Kr(Xc);const jk="offcanvas",Vk="bs.offcanvas",Es=`.${Vk}`,PE=".data-api",$k=`load${Es}${PE}`,Gk="Escape",bb="show",wb="showing",Eb="hiding",qk="offcanvas-backdrop",DE=".offcanvas.show",Zk=`show${Es}`,Wk=`shown${Es}`,Hk=`hide${Es}`,Tb=`hidePrevented${Es}`,LE=`hidden${Es}`,Xk=`resize${Es}`,Kk=`click${Es}${PE}`,Yk=`keydown.dismiss${Es}`,Jk='[data-bs-toggle="offcanvas"]',Qk={backdrop:!0,keyboard:!0,scroll:!1},eO={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class pa extends yo{constructor(a,d){super(a,d),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Qk}static get DefaultType(){return eO}static get NAME(){return jk}toggle(a){return this._isShown?this.hide():this.show(a)}show(a){if(this._isShown||it.trigger(this._element,Zk,{relatedTarget:a}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new wg().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(wb);const g=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(bb),this._element.classList.remove(wb),it.trigger(this._element,Wk,{relatedTarget:a})};this._queueCallback(g,this._element,!0)}hide(){if(!this._isShown||it.trigger(this._element,Hk).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Eb),this._backdrop.hide();const d=()=>{this._element.classList.remove(bb,Eb),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new wg().reset(),it.trigger(this._element,LE)};this._queueCallback(d,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const a=()=>{if(this._config.backdrop==="static"){it.trigger(this._element,Tb);return}this.hide()},d=Boolean(this._config.backdrop);return new SE({className:qk,isVisible:d,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:d?a:null})}_initializeFocusTrap(){return new CE({trapElement:this._element})}_addEventListeners(){it.on(this._element,Yk,a=>{if(a.key===Gk){if(!this._config.keyboard){it.trigger(this._element,Tb);return}this.hide()}})}static jQueryInterface(a){return this.each(function(){const d=pa.getOrCreateInstance(this,a);if(typeof a=="string"){if(d[a]===void 0||a.startsWith("_")||a==="constructor")throw new TypeError(`No method named "${a}"`);d[a](this)}})}}it.on(document,Kk,Jk,function(s){const a=_s(this);if(["A","AREA"].includes(this.tagName)&&s.preventDefault(),da(this))return;it.one(a,LE,()=>{iu(this)&&this.focus()});const d=oi.findOne(DE);d&&d!==a&&pa.getInstance(d).hide(),pa.getOrCreateInstance(a).toggle(this)});it.on(window,$k,()=>{for(const s of oi.find(DE))pa.getOrCreateInstance(s).show()});it.on(window,Xk,()=>{for(const s of oi.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(s).position!=="fixed"&&pa.getOrCreateInstance(s).hide()});Jf(pa);Kr(pa);const tO=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),iO=/^aria-[\w-]*$/i,nO=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,rO=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,oO=(s,a)=>{const d=s.nodeName.toLowerCase();return a.includes(d)?tO.has(d)?Boolean(nO.test(s.nodeValue)||rO.test(s.nodeValue)):!0:a.filter(g=>g instanceof RegExp).some(g=>g.test(d))},zE={"*":["class","dir","id","lang","role",iO],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};function sO(s,a,d){if(!s.length)return s;if(d&&typeof d=="function")return d(s);const x=new window.DOMParser().parseFromString(s,"text/html"),E=[].concat(...x.body.querySelectorAll("*"));for(const I of E){const o=I.nodeName.toLowerCase();if(!Object.keys(a).includes(o)){I.remove();continue}const L=[].concat(...I.attributes),U=[].concat(a["*"]||[],a[o]||[]);for(const G of L)oO(G,U)||I.removeAttribute(G.nodeName)}return x.body.innerHTML}const aO="TemplateFactory",lO={allowList:zE,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},cO={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},uO={entry:"(string|element|function|null)",selector:"(string|element)"};class hO extends rd{constructor(a){super(),this._config=this._getConfig(a)}static get Default(){return lO}static get DefaultType(){return cO}static get NAME(){return aO}getContent(){return Object.values(this._config.content).map(a=>this._resolvePossibleFunction(a)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(a){return this._checkContent(a),this._config.content={...this._config.content,...a},this}toHtml(){const a=document.createElement("div");a.innerHTML=this._maybeSanitize(this._config.template);for(const[x,E]of Object.entries(this._config.content))this._setContent(a,E,x);const d=a.children[0],g=this._resolvePossibleFunction(this._config.extraClass);return g&&d.classList.add(...g.split(" ")),d}_typeCheckConfig(a){super._typeCheckConfig(a),this._checkContent(a.content)}_checkContent(a){for(const[d,g]of Object.entries(a))super._typeCheckConfig({selector:d,entry:g},uO)}_setContent(a,d,g){const x=oi.findOne(g,a);if(x){if(d=this._resolvePossibleFunction(d),!d){x.remove();return}if(gs(d)){this._putElementInTemplate(ha(d),x);return}if(this._config.html){x.innerHTML=this._maybeSanitize(d);return}x.textContent=d}}_maybeSanitize(a){return this._config.sanitize?sO(a,this._config.allowList,this._config.sanitizeFn):a}_resolvePossibleFunction(a){return typeof a=="function"?a(this):a}_putElementInTemplate(a,d){if(this._config.html){d.innerHTML="",d.append(a);return}d.textContent=a.textContent}}const dO="tooltip",pO=new Set(["sanitize","allowList","sanitizeFn"]),$_="fade",fO="modal",rf="show",mO=".tooltip-inner",Ab=`.${fO}`,Sb="hide.bs.modal",Rh="hover",G_="focus",_O="click",gO="manual",yO="hide",vO="hidden",xO="show",bO="shown",wO="inserted",EO="click",TO="focusin",AO="focusout",SO="mouseenter",CO="mouseleave",IO={AUTO:"auto",TOP:"top",RIGHT:Hr()?"left":"right",BOTTOM:"bottom",LEFT:Hr()?"right":"left"},MO={allowList:zE,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,0],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},PO={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ru extends yo{constructor(a,d){if(typeof oE>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(a,d),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return MO}static get DefaultType(){return PO}static get NAME(){return dO}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),it.off(this._element.closest(Ab),Sb,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const a=it.trigger(this._element,this.constructor.eventName(xO)),g=(cE(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(a.defaultPrevented||!g)return;this._disposePopper();const x=this._getTipElement();this._element.setAttribute("aria-describedby",x.getAttribute("id"));const{container:E}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(E.append(x),it.trigger(this._element,this.constructor.eventName(wO))),this._popper=this._createPopper(x),x.classList.add(rf),"ontouchstart"in document.documentElement)for(const o of[].concat(...document.body.children))it.on(o,"mouseover",Mf);const I=()=>{it.trigger(this._element,this.constructor.eventName(bO)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(I,this.tip,this._isAnimated())}hide(){if(!this._isShown()||it.trigger(this._element,this.constructor.eventName(yO)).defaultPrevented)return;if(this._getTipElement().classList.remove(rf),"ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))it.off(x,"mouseover",Mf);this._activeTrigger[_O]=!1,this._activeTrigger[G_]=!1,this._activeTrigger[Rh]=!1,this._isHovered=null;const g=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),it.trigger(this._element,this.constructor.eventName(vO)))};this._queueCallback(g,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(a){const d=this._getTemplateFactory(a).toHtml();if(!d)return null;d.classList.remove($_,rf),d.classList.add(`bs-${this.constructor.NAME}-auto`);const g=mL(this.constructor.NAME).toString();return d.setAttribute("id",g),this._isAnimated()&&d.classList.add($_),d}setContent(a){this._newContent=a,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(a){return this._templateFactory?this._templateFactory.changeContent(a):this._templateFactory=new hO({...this._config,content:a,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[mO]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(a){return this.constructor.getOrCreateInstance(a.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains($_)}_isShown(){return this.tip&&this.tip.classList.contains(rf)}_createPopper(a){const d=typeof this._config.placement=="function"?this._config.placement.call(this,a,this._element):this._config.placement,g=IO[d.toUpperCase()];return fy(this._element,a,this._getPopperConfig(g))}_getOffset(){const{offset:a}=this._config;return typeof a=="string"?a.split(",").map(d=>Number.parseInt(d,10)):typeof a=="function"?d=>a(d,this._element):a}_resolvePossibleFunction(a){return typeof a=="function"?a.call(this._element):a}_getPopperConfig(a){const d={placement:a,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:g=>{this._getTipElement().setAttribute("data-popper-placement",g.state.placement)}}]};return{...d,...typeof this._config.popperConfig=="function"?this._config.popperConfig(d):this._config.popperConfig}}_setListeners(){const a=this._config.trigger.split(" ");for(const d of a)if(d==="click")it.on(this._element,this.constructor.eventName(EO),this._config.selector,g=>{this._initializeOnDelegatedTarget(g).toggle()});else if(d!==gO){const g=d===Rh?this.constructor.eventName(SO):this.constructor.eventName(TO),x=d===Rh?this.constructor.eventName(CO):this.constructor.eventName(AO);it.on(this._element,g,this._config.selector,E=>{const I=this._initializeOnDelegatedTarget(E);I._activeTrigger[E.type==="focusin"?G_:Rh]=!0,I._enter()}),it.on(this._element,x,this._config.selector,E=>{const I=this._initializeOnDelegatedTarget(E);I._activeTrigger[E.type==="focusout"?G_:Rh]=I._element.contains(E.relatedTarget),I._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},it.on(this._element.closest(Ab),Sb,this._hideModalHandler)}_fixTitle(){const a=this._element.getAttribute("title");a&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",a),this._element.setAttribute("data-bs-original-title",a),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(a,d){clearTimeout(this._timeout),this._timeout=setTimeout(a,d)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(a){const d=ys.getDataAttributes(this._element);for(const g of Object.keys(d))pO.has(g)&&delete d[g];return a={...d,...typeof a=="object"&&a?a:{}},a=this._mergeConfigObj(a),a=this._configAfterMerge(a),this._typeCheckConfig(a),a}_configAfterMerge(a){return a.container=a.container===!1?document.body:ha(a.container),typeof a.delay=="number"&&(a.delay={show:a.delay,hide:a.delay}),typeof a.title=="number"&&(a.title=a.title.toString()),typeof a.content=="number"&&(a.content=a.content.toString()),a}_getDelegateConfig(){const a={};for(const d in this._config)this.constructor.Default[d]!==this._config[d]&&(a[d]=this._config[d]);return a.selector=!1,a.trigger="manual",a}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(a){return this.each(function(){const d=ru.getOrCreateInstance(this,a);if(typeof a=="string"){if(typeof d[a]>"u")throw new TypeError(`No method named "${a}"`);d[a]()}})}}Kr(ru);const DO="popover",LO=".popover-header",zO=".popover-body",kO={...ru.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},OO={...ru.DefaultType,content:"(null|string|element|function)"};class yy extends ru{static get Default(){return kO}static get DefaultType(){return OO}static get NAME(){return DO}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[LO]:this._getTitle(),[zO]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(a){return this.each(function(){const d=yy.getOrCreateInstance(this,a);if(typeof a=="string"){if(typeof d[a]>"u")throw new TypeError(`No method named "${a}"`);d[a]()}})}}Kr(yy);const RO="scrollspy",BO="bs.scrollspy",vy=`.${BO}`,FO=".data-api",NO=`activate${vy}`,Cb=`click${vy}`,UO=`load${vy}${FO}`,jO="dropdown-item",Ac="active",VO='[data-bs-spy="scroll"]',q_="[href]",$O=".nav, .list-group",Ib=".nav-link",GO=".nav-item",qO=".list-group-item",ZO=`${Ib}, ${GO} > ${Ib}, ${qO}`,WO=".dropdown",HO=".dropdown-toggle",XO={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},KO={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class tm extends yo{constructor(a,d){super(a,d),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return XO}static get DefaultType(){return KO}static get NAME(){return RO}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const a of this._observableSections.values())this._observer.observe(a)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(a){return a.target=ha(a.target)||document.body,a.rootMargin=a.offset?`${a.offset}px 0px -30%`:a.rootMargin,typeof a.threshold=="string"&&(a.threshold=a.threshold.split(",").map(d=>Number.parseFloat(d))),a}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(it.off(this._config.target,Cb),it.on(this._config.target,Cb,q_,a=>{const d=this._observableSections.get(a.target.hash);if(d){a.preventDefault();const g=this._rootElement||window,x=d.offsetTop-this._element.offsetTop;if(g.scrollTo){g.scrollTo({top:x,behavior:"smooth"});return}g.scrollTop=x}}))}_getNewObserver(){const a={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(d=>this._observerCallback(d),a)}_observerCallback(a){const d=I=>this._targetLinks.get(`#${I.target.id}`),g=I=>{this._previousScrollData.visibleEntryTop=I.target.offsetTop,this._process(d(I))},x=(this._rootElement||document.documentElement).scrollTop,E=x>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=x;for(const I of a){if(!I.isIntersecting){this._activeTarget=null,this._clearActiveClass(d(I));continue}const o=I.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(E&&o){if(g(I),!x)return;continue}!E&&!o&&g(I)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const a=oi.find(q_,this._config.target);for(const d of a){if(!d.hash||da(d))continue;const g=oi.findOne(d.hash,this._element);iu(g)&&(this._targetLinks.set(d.hash,d),this._observableSections.set(d.hash,g))}}_process(a){this._activeTarget!==a&&(this._clearActiveClass(this._config.target),this._activeTarget=a,a.classList.add(Ac),this._activateParents(a),it.trigger(this._element,NO,{relatedTarget:a}))}_activateParents(a){if(a.classList.contains(jO)){oi.findOne(HO,a.closest(WO)).classList.add(Ac);return}for(const d of oi.parents(a,$O))for(const g of oi.prev(d,ZO))g.classList.add(Ac)}_clearActiveClass(a){a.classList.remove(Ac);const d=oi.find(`${q_}.${Ac}`,a);for(const g of d)g.classList.remove(Ac)}static jQueryInterface(a){return this.each(function(){const d=tm.getOrCreateInstance(this,a);if(typeof a=="string"){if(d[a]===void 0||a.startsWith("_")||a==="constructor")throw new TypeError(`No method named "${a}"`);d[a]()}})}}it.on(window,UO,()=>{for(const s of oi.find(VO))tm.getOrCreateInstance(s)});Kr(tm);const YO="tab",JO="bs.tab",_l=`.${JO}`,QO=`hide${_l}`,eR=`hidden${_l}`,tR=`show${_l}`,iR=`shown${_l}`,nR=`click${_l}`,rR=`keydown${_l}`,oR=`load${_l}`,sR="ArrowLeft",Mb="ArrowRight",aR="ArrowUp",Pb="ArrowDown",sl="active",Db="fade",Z_="show",lR="dropdown",cR=".dropdown-toggle",uR=".dropdown-menu",W_=":not(.dropdown-toggle)",hR='.list-group, .nav, [role="tablist"]',dR=".nav-item, .list-group-item",pR=`.nav-link${W_}, .list-group-item${W_}, [role="tab"]${W_}`,kE='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',H_=`${pR}, ${kE}`,fR=`.${sl}[data-bs-toggle="tab"], .${sl}[data-bs-toggle="pill"], .${sl}[data-bs-toggle="list"]`;class fl extends yo{constructor(a){super(a),this._parent=this._element.closest(hR),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),it.on(this._element,rR,d=>this._keydown(d)))}static get NAME(){return YO}show(){const a=this._element;if(this._elemIsActive(a))return;const d=this._getActiveElem(),g=d?it.trigger(d,QO,{relatedTarget:a}):null;it.trigger(a,tR,{relatedTarget:d}).defaultPrevented||g&&g.defaultPrevented||(this._deactivate(d,a),this._activate(a,d))}_activate(a,d){if(!a)return;a.classList.add(sl),this._activate(_s(a));const g=()=>{if(a.getAttribute("role")!=="tab"){a.classList.add(Z_);return}a.removeAttribute("tabindex"),a.setAttribute("aria-selected",!0),this._toggleDropDown(a,!0),it.trigger(a,iR,{relatedTarget:d})};this._queueCallback(g,a,a.classList.contains(Db))}_deactivate(a,d){if(!a)return;a.classList.remove(sl),a.blur(),this._deactivate(_s(a));const g=()=>{if(a.getAttribute("role")!=="tab"){a.classList.remove(Z_);return}a.setAttribute("aria-selected",!1),a.setAttribute("tabindex","-1"),this._toggleDropDown(a,!1),it.trigger(a,eR,{relatedTarget:d})};this._queueCallback(g,a,a.classList.contains(Db))}_keydown(a){if(![sR,Mb,aR,Pb].includes(a.key))return;a.stopPropagation(),a.preventDefault();const d=[Mb,Pb].includes(a.key),g=my(this._getChildren().filter(x=>!da(x)),a.target,d,!0);g&&(g.focus({preventScroll:!0}),fl.getOrCreateInstance(g).show())}_getChildren(){return oi.find(H_,this._parent)}_getActiveElem(){return this._getChildren().find(a=>this._elemIsActive(a))||null}_setInitialAttributes(a,d){this._setAttributeIfNotExists(a,"role","tablist");for(const g of d)this._setInitialAttributesOnChild(g)}_setInitialAttributesOnChild(a){a=this._getInnerElement(a);const d=this._elemIsActive(a),g=this._getOuterElement(a);a.setAttribute("aria-selected",d),g!==a&&this._setAttributeIfNotExists(g,"role","presentation"),d||a.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(a,"role","tab"),this._setInitialAttributesOnTargetPanel(a)}_setInitialAttributesOnTargetPanel(a){const d=_s(a);d&&(this._setAttributeIfNotExists(d,"role","tabpanel"),a.id&&this._setAttributeIfNotExists(d,"aria-labelledby",`#${a.id}`))}_toggleDropDown(a,d){const g=this._getOuterElement(a);if(!g.classList.contains(lR))return;const x=(E,I)=>{const o=oi.findOne(E,g);o&&o.classList.toggle(I,d)};x(cR,sl),x(uR,Z_),g.setAttribute("aria-expanded",d)}_setAttributeIfNotExists(a,d,g){a.hasAttribute(d)||a.setAttribute(d,g)}_elemIsActive(a){return a.classList.contains(sl)}_getInnerElement(a){return a.matches(H_)?a:oi.findOne(H_,a)}_getOuterElement(a){return a.closest(dR)||a}static jQueryInterface(a){return this.each(function(){const d=fl.getOrCreateInstance(this);if(typeof a=="string"){if(d[a]===void 0||a.startsWith("_")||a==="constructor")throw new TypeError(`No method named "${a}"`);d[a]()}})}}it.on(document,nR,kE,function(s){["A","AREA"].includes(this.tagName)&&s.preventDefault(),!da(this)&&fl.getOrCreateInstance(this).show()});it.on(window,oR,()=>{for(const s of oi.find(fR))fl.getOrCreateInstance(s)});Kr(fl);const mR="toast",_R="bs.toast",_a=`.${_R}`,gR=`mouseover${_a}`,yR=`mouseout${_a}`,vR=`focusin${_a}`,xR=`focusout${_a}`,bR=`hide${_a}`,wR=`hidden${_a}`,ER=`show${_a}`,TR=`shown${_a}`,AR="fade",Lb="hide",of="show",sf="showing",SR={animation:"boolean",autohide:"boolean",delay:"number"},CR={animation:!0,autohide:!0,delay:5e3};class im extends yo{constructor(a,d){super(a,d),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return CR}static get DefaultType(){return SR}static get NAME(){return mR}show(){if(it.trigger(this._element,ER).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(AR);const d=()=>{this._element.classList.remove(sf),it.trigger(this._element,TR),this._maybeScheduleHide()};this._element.classList.remove(Lb),nd(this._element),this._element.classList.add(of,sf),this._queueCallback(d,this._element,this._config.animation)}hide(){if(!this.isShown()||it.trigger(this._element,bR).defaultPrevented)return;const d=()=>{this._element.classList.add(Lb),this._element.classList.remove(sf,of),it.trigger(this._element,wR)};this._element.classList.add(sf),this._queueCallback(d,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(of),super.dispose()}isShown(){return this._element.classList.contains(of)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(a,d){switch(a.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=d;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=d;break}}if(d){this._clearTimeout();return}const g=a.relatedTarget;this._element===g||this._element.contains(g)||this._maybeScheduleHide()}_setListeners(){it.on(this._element,gR,a=>this._onInteraction(a,!0)),it.on(this._element,yR,a=>this._onInteraction(a,!1)),it.on(this._element,vR,a=>this._onInteraction(a,!0)),it.on(this._element,xR,a=>this._onInteraction(a,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(a){return this.each(function(){const d=im.getOrCreateInstance(this,a);if(typeof a=="string"){if(typeof d[a]>"u")throw new TypeError(`No method named "${a}"`);d[a](this)}})}}Jf(im);Kr(im);const IR={class:"container-fluid h-100 d-flex flex-column p-0"},MR={class:"row flex-grow-1 gx-0"},PR={key:0,class:"col-md-4 vh-100 d-flex flex-column"},DR=Vt("h3",{class:"mx-auto"},"Merge2Hotspot",-1),LR={class:"nav nav-tabs nav-fill",id:"mainTab",role:"tablist"},zR=Vt("li",{class:"nav-item",role:"presentation"},[Vt("button",{class:"nav-link active",id:"introduction-tab","data-bs-toggle":"tab","data-bs-target":"#introduction",type:"button",role:"tab","aria-controls":"introduction","aria-selected":"true"}," 1. Introduction ")],-1),kR=Vt("li",{class:"nav-item",role:"presentation"},[Vt("button",{class:"nav-link",id:"import-tab","data-bs-toggle":"tab","data-bs-target":"#import",type:"button",role:"tab","aria-controls":"import","aria-selected":"false"}," 2. Import ")],-1),OR={class:"nav-item",role:"presentation"},RR=["aria-disabled"],BR={class:"nav-item",role:"presentation"},FR=["aria-disabled"],NR={class:"tab-content overflow-auto"},UR={class:"tab-pane active px-3 py-3",id:"introduction",role:"tabpanel","aria-labelledby":"introduction-tab"},jR=Vt("h4",null,"How does it work?",-1),VR=Vt("p",null," This app helps you find your checklists for which the associated location is not an eBird hotspot (i.e. personal location) and suggests nearby hotspots. A link to to merge your personal location to the hotspot will be provided. ",-1),$R=Vt("p",null,[ul(" Assigning a hotspot to your data is essential for data analysis. For instance, you can then compute the probability of observation of each specie for a given hotspot and "),Vt("a",{href:"https://zoziologie.raphaelnussbaumer.com/ebird2latex/",traget:"_blank"},"generate a checklist"),ul(". Step by step instructions are given below. ")],-1),GR={class:"d-grid gap-2 col-6 mx-auto"},qR={class:"tab-pane px-3 py-3",id:"import",role:"tabpanel","aria-labelledby":"import-tab"},ZR=Vt("h4",null,"Generate your eBird File",-1),WR=Vt("p",null," The first step is to download all your eBird data on your computer. ",-1),HR=Vt("a",{role:"button",class:"btn btn-primary mb-3 w-100",href:"https://ebird.org/downloadMyData",target:"_blank"}," Download your eBird file ",-1),XR=Vt("h4",null,"Import your eBird File",-1),KR=Vt("p",null,[ul(" Import your "),Vt("code",null,"MyEBirdData.csv"),ul(" using the upload file below. Note this the file is never sent to our server, only used in your browser. ")],-1),YR={class:"w-100 mb-3"},JR=Vt("span",{class:"custom-file-control"},null,-1),QR={key:0},eB=Vt("div",{class:"alert alert-warning d-flex align-items-center",role:"alert"},[Vt("div",{class:"spinner-border me-2 spinner-border-sm",role:"status","aria-hidden":"true"}),Vt("strong",{class:"me-1"},"Loading data."),ul(" This might take up to a minute... ")],-1),tB=[eB],iB={key:1},nB={class:"alert alert-success",role:"alert"},rB=Vt("i",{class:"bi bi-check-circle-fill me-2"},null,-1),oB=Vt("strong",null,"Data loaded successfuly! ",-1),sB=Vt("br",null,null,-1),aB={class:"d-grid gap-2 col-6 mx-auto"},lB={class:"tab-pane px-3 py-3",id:"hotspot",role:"tabpanel","aria-labelledby":"hotspot-tab"},cB=P1('<h4>Download eBird hotspots</h4><div class="card mb-2"><h6 class="card-header"><a data-bs-toggle="collapse" href="#instruction1" aria-expanded="true" aria-controls="instruction1" class="d-block text-decoration-none" id="instruction1-heading"><i class="bi bi-info-circle-fill"></i> Instruction </a></h6><div id="instruction1" class="collapse" aria-labelledby="instruction1-heading"><div class="card-body"><p> You can now see all your birded locations with the number of checklists (icon value). </p><p> From these locations, we listed below the different countries/regions you&#39;ve been birding. The blue badges <span class="badge bg-primary rounded-pill" style="float:inherit;">25</span> indicate the number of locations birded in this particular region. </p><p> Click on the download icon <button class="btn btn-outline-primary btn-sm"><i class="bi bi-download"></i></button> to download all eBird hotspots for this region. We recommend this you download regions rather than countries when possible. </p><p> Once you are done, click on the button &quot;Find locations without hotspot&quot; below the list. </p></div></div></div>',2),uB={class:"list-group"},hB={class:"ms-2 me-auto"},dB={class:"fw-bold me-2"},pB={class:"badge bg-primary rounded-pill"},fB=["onClick"],mB={key:0,class:"bi bi-download"},_B={key:1,class:"spinner-border spinner-border-sm",role:"status"},gB=Vt("span",{class:"visually-hidden"},"Loading...",-1),yB=[gB],vB={key:2,class:"bi bi-check-circle"},xB={class:"d-grid gap-2 col-6 mx-auto"},bB={class:"tab-pane px-3 py-3",id:"merge",role:"tabpanel","aria-labelledby":"merge-tab"},wB=P1('<h4>Merge personal locations</h4><div class="card mb-2"><h6 class="card-header"><a data-bs-toggle="collapse" href="#instruction2" aria-expanded="true" aria-controls="instruction2" class="d-block text-decoration-none" id="instruction2-heading"><i class="bi bi-info-circle-fill"></i> Instruction </a></h6><div id="instruction2" class="collapse" aria-labelledby="instruction2-heading"><div class="card-body"><p> Locations without hotspots are listed in the table below and sorted by distance to the nearest hotspot (right column). Click on each table row to view this location on the map. </p><p> If you would like to merge the location with an hotspot or suggest the location as a hotpost, click on <i class="fas fa-edit"></i>. </p><p> Last tip, you can display/hide the eBird hotspots by toggling the checkbox of the layer on the top-right corner of your screen. Sometimes your personal location marker is hidden behind a hotspot marker. </p></div></div></div>',2),EB={class:"d-grid gap-2 col-6 mx-auto"},TB={components:{},data(){return{map:null,showSidebar:!0,myEBirdData:[],loadingData:!1,hotspot:[],tileProviders:[{name:"Mapbox.Streets",visible:!0,url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",attribution:""},{name:"Mapbox.Dark",visible:!1,url:"https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",attribution:""},{name:"Mapbox.Satellite",visible:!1,url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",attribution:""}],region:[]}},methods:{formatNb(s){return s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},processFile(s){this.loadingData=!0;const a=new FileReader;a.onload=d=>{const g=d.target.result,x=",",E=g.slice(0,g.indexOf(`
`)).split(x),I=["Submission ID","Location ID","Location","Longitude","Latitude","State/Province"],o=["subid","locid","locname","lng","lat","region"],L=I.map(J=>{const de=E.indexOf(J);if(de===-1)throw new TypeError("CSV file not valid. It does not contains the header: "+J);return de}),G=g.slice(g.indexOf(`
`)+1).split(`
`).map(function(J){const de=J.split(x);return I.reduce(function(ge,Ie,Ne){return ge[o[Ne]]=de[L[Ne]],ge},{})});this.myEBirdData=[...new Map(G.map(J=>[J.subid,J])).values()].filter(J=>!isNaN(J.lat)&!isNaN(J.lng)),this.loadingData=!1,this.region.forEach(J=>{J.subidnb=this.myEBirdData.filter(de=>de.region.split("-")[0]===J.code|de.region===J.code).reduce((de,xe)=>de+xe.subid.length,0)}),this.fitMap(this.myEBirdData)},a.readAsText(s.target.files[0])},navTabActivate(s){new fl(document.querySelector("#mainTab .nav-item #"+s+"-tab")).show()},downloadRegion(s){s.status="loading",Jp.get("https://ebird.org/ws2.0/ref/hotspot/"+s.code+"?fmt=json&key=vcs68p4j67pt").then(a=>this.hotspot=[...new Set([...this.hotspot,...a.data])].filter(d=>d.locId!=null)).catch(function(a){alert("Error with: "+s+". "+a)}).then(()=>{s.status="downloaded"})},fitMap(s){this.map.fitBounds(s.reduce((a,d)=>[[Math.min(a[0][0],d.lng),Math.min(a[0][1],d.lat)],[Math.max(a[1][0],d.lng),Math.max(a[1][1],d.lat)]],[[180,90],[-180,-90]]))}},computed:{myLocation(){return Array.from(new Set(this.myEBirdData.map(s=>s.locid))).map(s=>{let a=this.myEBirdData.filter(d=>d.locid===s);return{locid:s,locname:a[0].locname,lng:parseFloat(a[0].lng),lat:parseFloat(a[0].lat),subid:a.map(d=>d.subid),region:a[0].region}})},myLocationGeojson(){return{name:"NewFeatureType",type:"FeatureCollection",id:"jksdf",features:this.myLocation.map(s=>({type:"Feature",properties:{id:"location-"+s.locid},geometry:{coordinates:[s.lng,s.lat,0],type:"Point"}}))}},hotspotGeojson(){return{name:"NewFeatureTypesdss",type:"FeatureCollection",id:"dsds",features:this.hotspot.map(s=>({type:"Feature",properties:{id:"hotspot-"+s.locId},geometry:{coordinates:[s.lng,s.lat,0],type:"Point"}}))}},runMerge(){}},mounted(){Jp.get("https://api.ebird.org/v2/ref/region/list/country/world?key=vcs68p4j67pt").then(s=>{s.data=s.data.filter(function(a){return!["US","CA"].includes(a.code)}),this.region=[...this.region,...s.data],Jp.get("https://api.ebird.org/v2/ref/region/list/subnational1/US?key=vcs68p4j67pt").then(a=>{this.region=[...this.region,...a.data],Jp.get("https://api.ebird.org/v2/ref/region/list/subnational1/CA?key=vcs68p4j67pt").then(d=>{this.region=[...this.region,...d.data].sort((g,x)=>g.name>x.name?1:-1).map(g=>(g.status=null,g))})})})}},AB=Object.assign(TB,{__name:"App",setup(s){return(a,d)=>(kn(),sr("div",IR,[Vt("div",MR,[a.showSidebar?(kn(),sr("div",PR,[DR,Vt("ul",LR,[zR,kR,Vt("li",OR,[Vt("button",{class:Dc(["nav-link",{disabled:a.myEBirdData.length==0}]),"aria-disabled":a.myEBirdData.length>0,id:"hotspot-tab","data-bs-toggle":"tab","data-bs-target":"#hotspot",type:"button",role:"tab","aria-controls":"hotspot","aria-selected":"false"}," 3. Hotspot ",10,RR)]),Vt("li",BR,[Vt("button",{class:Dc(["nav-link",{disabled:a.myEBirdData.length==0|a.hotspot.length==0}]),"aria-disabled":a.myEBirdData.length>0,id:"merge-tab","data-bs-toggle":"tab","data-bs-target":"#merge",type:"button",role:"tab","aria-controls":"merge","aria-selected":"false"}," 4. Merge ",10,FR)])]),Vt("div",NR,[Vt("div",UR,[jR,VR,$R,Vt("div",GR,[Vt("button",{type:"button",class:"btn btn-primary",onClick:d[0]||(d[0]=g=>a.navTabActivate("import"))}," Next ")])]),Vt("div",qR,[ZR,WR,HR,XR,KR,Vt("label",YR,[Vt("input",{type:"file",id:"uploadMyEBirdData",class:"form-control",accept:".csv",onChange:d[1]||(d[1]=(...g)=>a.processFile&&a.processFile(...g))},null,32),JR]),a.loadingData?(kn(),sr("div",QR,tB)):a.myEBirdData.length>0&a.myLocation.length>0?(kn(),sr("div",iB,[Vt("div",nB,[rB,oB,ul(" "+$p(a.formatNb(a.myEBirdData.length))+" checklists over "+$p(a.formatNb(a.myLocation.length))+" locations. ",1),sB]),Vt("div",aB,[Vt("button",{type:"button",class:"btn btn-primary",onClick:d[2]||(d[2]=g=>a.navTabActivate("hotspot"))}," Next ")])])):Kp("",!0)]),Vt("div",lB,[cB,Vt("ul",uB,[(kn(!0),sr(gr,null,IS(a.region.filter(g=>g.subidnb>0),g=>(kn(),sr("li",{key:g.code,class:"list-group-item d-flex justify-content-between align-items-start px-1 py-1"},[Vt("div",hB,[Vt("span",dB,$p(g.name),1),Vt("span",pB,$p(a.formatNb(g.subidnb)),1)]),Vt("button",{class:Dc(["btn btn-outline-primary btn-sm",{disabled:g.status!=null}]),onClick:x=>a.downloadRegion(g)},[g.status==null?(kn(),sr("i",mB)):g.status=="loading"?(kn(),sr("div",_B,yB)):g.status=="downloaded"?(kn(),sr("i",vB)):Kp("",!0)],10,fB)]))),128))]),Vt("div",xB,[Vt("button",{type:"button",class:"btn btn-primary",onClick:d[3]||(d[3]=g=>a.navTabActivate("merge"))}," Next ")])]),Vt("div",bB,[wB,Vt("div",EB,[Vt("button",{type:"button",class:"btn btn-primary",onClick:d[4]||(d[4]=g=>a.runMerge())}," Find location to merge ")])])])])):Kp("",!0),Vt("div",{class:"col flex-grow-1",onShown:d[6]||(d[6]=g=>a.reloadMap())},[Qn(ti(pP),{"map-style":"mapbox://styles/mapbox/streets-v11",style:{height:"100%"},"access-token":"pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",onMbCreated:d[5]||(d[5]=g=>a.map=g)},{default:u1(()=>[a.myLocation.length>0?(kn(),jg(ti(sP),{key:0,data:a.myLocationGeojson,clustersPaint:{"circle-color":"#558ed9","circle-radius":20}},null,8,["data"])):Kp("",!0)]),_:1})],32)])]))}}),SB=CC(AB);SB.mount("#app");
